<!DOCTYPE html>
<!--
Copyright 2012 Mozilla Foundation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

Adobe CMap resources are covered by their own copyright but the same license:

    Copyright 1990-2015 Adobe Systems Incorporated.

See https://github.com/adobe-type-tools/cmap-resources
-->
<html dir="ltr" mozdisallowselectionprint>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  <meta name="google" content="notranslate">
  <title>두플러스 : 복음을 읽는 새로운 습관</title>
  <link rel="icon" href="../../../images/ic_mo_home.svg" type="/duranno/image/x-icon">
  <!-- <link rel="stylesheet" href="./common.css" />
<link rel="stylesheet" href="./desktop-viewer.css" /> -->


  <link rel="stylesheet" href="viewer.css">
<!-- <link rel="stylesheet" href="fonts.css"> -->
<!-- This snippet is used in production (included from viewer.html) -->
<link rel="resource" type="application/l10n" href="locale/locale.properties">
<script src="../build/pdf.js"></script>

  <script src="viewer.js"></script>
  <script src="./api-connect.js"></script>
  <script src="./common.js"></script>
  <style>
    /* body *::-webkit-scrollbar {
      display: none;
    }

    body * {
      -ms-overflow-style: none;

    } */

    .modal-parent * ::-webkit-scrollbar {
      display: none;
    }

    html,
    body {
      overflow: hidden;

      /* 셀렉트 막기 */
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .paginated {
      /* padding-bottom: 60vh; */
      border: 0 !important;
      margin-bottom: 60vh !important;
    }

    .page {
      /* margin-bottom: 1px; */
    }


    #div-loading.show {
      background-image: "/images/dplus-logo.png" !important;
      width: 100vw;
      height: 100vh;
      display: block !important;
    }

    .header__inner {
      width: 100vw;
    }

    .modal-parent {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      /* background-color: rgba(0, 0, 0, 0.4); */
    }

    .header__title {
      width: calc(66% - 120px) !important;
    }

    .action-buttons {
      flex-shrink: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: flex-end !important;
      position: absolute !important;
      right: 10px !important;
      width: auto !important;
    }

    .header__title {
      flex-shrink: 0 !important;
      font-weight: 550 !important;
      font-size: 25px !important;
      position: absolute !important;
      left: 50px !important;
    }

    .color-label.on {
      border-color: var(--color-secondary);
      border-width: 2px;
    }
  </style>
</head>

<body tabindex="1">
  <!-- <div id="outerContainer" style="display:none"> -->
  <div id="outerContainer" style="position:absolute">
    <!-- <div id="sidebarContainer"> -->
    <div id="sidebarContainer" style="display:none">
      <div id="toolbarSidebar">
        <div id="toolbarSidebarLeft">
          <div class="splitToolbarButton toggled">
            <button id="viewThumbnail" class="toolbarButton toggled" title="Show Thumbnails" tabindex="2"
              data-l10n-id="thumbs">
              <span data-l10n-id="thumbs_label">Thumbnails</span>
            </button>
            <button id="viewOutline" class="toolbarButton"
              title="Show Document Outline (double-click to expand/collapse all items)" tabindex="3"
              data-l10n-id="document_outline">
              <span data-l10n-id="document_outline_label">Document Outline</span>
            </button>
            <button id="viewAttachments" class="toolbarButton" title="Show Attachments" tabindex="4"
              data-l10n-id="attachments">
              <span data-l10n-id="attachments_label">Attachments</span>
            </button>
            <button id="viewLayers" class="toolbarButton"
              title="Show Layers (double-click to reset all layers to the default state)" tabindex="5"
              data-l10n-id="layers">
              <span data-l10n-id="layers_label">Layers</span>
            </button>
          </div>
        </div>

        <div id="toolbarSidebarRight">
          <div id="outlineOptionsContainer" class="hidden">
            <div class="verticalToolbarSeparator"></div>

            <button id="currentOutlineItem" class="toolbarButton" disabled="disabled" title="Find Current Outline Item"
              tabindex="6" data-l10n-id="current_outline_item">
              <span data-l10n-id="current_outline_item_label">Current Outline Item</span>
            </button>
          </div>
        </div>
      </div>
      <div id="sidebarContent">
        <div id="thumbnailView">
        </div>
        <div id="outlineView" class="hidden">
        </div>
        <div id="attachmentsView" class="hidden">
        </div>
        <div id="layersView" class="hidden">
        </div>
      </div>
      <div id="sidebarResizer"></div>
    </div> <!-- sidebarContainer -->
  </div>
  <div id="mainContainer">
    <!-- <div class="findbar hidden doorHanger" id="findbar" style="display:none"> -->
    <div class="findbar hidden doorHanger" id="findbar" style="top:70px; left: calc(100vw - 310px); position:absolute;">
      <div id="findbarInputContainer">
        <input id="findInput" class="toolbarField" title="Find" placeholder="Find in document…" tabindex="91"
          data-l10n-id="find_input">
        <div class="splitToolbarButton">
          <button id="findPrevious" class="toolbarButton findPrevious"
            title="Find the previous occurrence of the phrase" tabindex="92" data-l10n-id="find_previous">
            <span data-l10n-id="find_previous_label">Previous</span>
          </button>
          <div class="splitToolbarButtonSeparator"></div>
          <button id="findNext" class="toolbarButton findNext" title="Find the next occurrence of the phrase"
            tabindex="93" data-l10n-id="find_next">
            <span data-l10n-id="find_next_label">Next</span>
          </button>
        </div>
      </div>

      <div id="findbarOptionsOneContainer">
        <input type="checkbox" id="findHighlightAll" class="toolbarField" tabindex="94">
        <label for="findHighlightAll" class="toolbarLabel" data-l10n-id="find_highlight">Highlight all</label>
        <input type="checkbox" id="findMatchCase" class="toolbarField" tabindex="95">
        <label for="findMatchCase" class="toolbarLabel" data-l10n-id="find_match_case_label">Match case</label>
      </div>
      <div id="findbarOptionsTwoContainer">
        <input type="checkbox" id="findEntireWord" class="toolbarField" tabindex="96">
        <label for="findEntireWord" class="toolbarLabel" data-l10n-id="find_entire_word_label">Whole words</label>
        <span id="findResultsCount" class="toolbarLabel hidden"></span>
      </div>

      <div id="findbarMessageContainer">
        <span id="findMsg" class="toolbarLabel"></span>
      </div>
    </div> <!-- findbar -->
    <!-- <div id="secondaryToolbar" class="secondaryToolbar hidden doorHangerRight"> -->
    <div id="secondaryToolbar" class="secondaryToolbar hidden doorHangerRight" style="display:none">
      <div id="secondaryToolbarButtonContainer">
        <button id="secondaryPresentationMode" class="secondaryToolbarButton presentationMode visibleLargeView"
          title="Switch to Presentation Mode" tabindex="51" data-l10n-id="presentation_mode">
          <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
        </button>

        <button id="secondaryOpenFile" class="secondaryToolbarButton openFile visibleLargeView" title="Open File"
          tabindex="52" data-l10n-id="open_file">
          <span data-l10n-id="open_file_label">Open</span>
        </button>

        <button id="secondaryPrint" class="secondaryToolbarButton print visibleMediumView" title="Print" tabindex="53"
          data-l10n-id="print">
          <span data-l10n-id="print_label">Print</span>
        </button>

        <button id="secondaryDownload" class="secondaryToolbarButton download visibleMediumView" title="Download"
          tabindex="54" data-l10n-id="download">
          <span data-l10n-id="download_label">Download</span>
        </button>

        <a href="#" id="secondaryViewBookmark" class="secondaryToolbarButton bookmark visibleSmallView"
          title="Current view (copy or open in new window)" tabindex="55" data-l10n-id="bookmark">
          <span data-l10n-id="bookmark_label">Current View</span>
        </a>

        <div class="horizontalToolbarSeparator visibleLargeView"></div>

        <button id="firstPage" class="secondaryToolbarButton firstPage" title="Go to First Page" tabindex="56"
          data-l10n-id="first_page">
          <span data-l10n-id="first_page_label">Go to First Page</span>
        </button>
        <button id="lastPage" class="secondaryToolbarButton lastPage" title="Go to Last Page" tabindex="57"
          data-l10n-id="last_page">
          <span data-l10n-id="last_page_label">Go to Last Page</span>
        </button>

        <div class="horizontalToolbarSeparator"></div>

        <button id="pageRotateCw" class="secondaryToolbarButton rotateCw" title="Rotate Clockwise" tabindex="58"
          data-l10n-id="page_rotate_cw">
          <span data-l10n-id="page_rotate_cw_label">Rotate Clockwise</span>
        </button>
        <button id="pageRotateCcw" class="secondaryToolbarButton rotateCcw" title="Rotate Counterclockwise"
          tabindex="59" data-l10n-id="page_rotate_ccw">
          <span data-l10n-id="page_rotate_ccw_label">Rotate Counterclockwise</span>
        </button>

        <div class="horizontalToolbarSeparator"></div>

        <button id="cursorSelectTool" class="secondaryToolbarButton selectTool toggled"
          title="Enable Text Selection Tool" tabindex="60" data-l10n-id="cursor_text_select_tool">
          <span data-l10n-id="cursor_text_select_tool_label">Text Selection Tool</span>
        </button>
        <button id="cursorHandTool" class="secondaryToolbarButton handTool" title="Enable Hand Tool" tabindex="61"
          data-l10n-id="cursor_hand_tool">
          <span data-l10n-id="cursor_hand_tool_label">Hand Tool</span>
        </button>

        <div class="horizontalToolbarSeparator"></div>

        title="Use Vertical Scrolling" tabindex="62" data-l10n-id="scroll_vertical">
        <button id="scrollVertical" class="secondaryToolbarButton scrollModeButtons scrollVertical toggled" <span
          data-l10n-id="scroll_vertical_label">Vertical Scrolling</span>
        </button>
        <button id="scrollHorizontal" class="secondaryToolbarButton scrollModeButtons scrollHorizontal"
          title="Use Horizontal Scrolling" tabindex="63" data-l10n-id="scroll_horizontal">
          <span data-l10n-id="scroll_horizontal_label">Horizontal Scrolling</span>
        </button>
        <button id="scrollWrapped" class="secondaryToolbarButton scrollModeButtons scrollWrapped"
          title="Use Wrapped Scrolling" tabindex="64" data-l10n-id="scroll_wrapped">
          <span data-l10n-id="scroll_wrapped_label">Wrapped Scrolling</span>
        </button>

        <div class="horizontalToolbarSeparator scrollModeButtons"></div>

        <button id="spreadNone" class="secondaryToolbarButton spreadModeButtons spreadNone toggled"
          title="Do not join page spreads" tabindex="65" data-l10n-id="spread_none">
          <span data-l10n-id="spread_none_label">No Spreads</span>
        </button>
        <button id="spreadOdd" class="secondaryToolbarButton spreadModeButtons spreadOdd"
          title="Join page spreads starting with odd-numbered pages" tabindex="66" data-l10n-id="spread_odd">
          <span data-l10n-id="spread_odd_label">Odd Spreads</span>
        </button>
        <button id="spreadEven" class="secondaryToolbarButton spreadModeButtons spreadEven"
          title="Join page spreads starting with even-numbered pages" tabindex="67" data-l10n-id="spread_even">
          <span data-l10n-id="spread_even_label">Even Spreads</span>
        </button>

        <div class="horizontalToolbarSeparator spreadModeButtons"></div>

        <button id="documentProperties" class="secondaryToolbarButton documentProperties" title="Document Properties…"
          tabindex="68" data-l10n-id="document_properties">
          <span data-l10n-id="document_properties_label">Document Properties…</span>
        </button>
      </div>
    </div> <!-- secondaryToolbar -->

    <!-- <div class="toolbar"  style=""> -->
    <div class="toolbar" style="display:none">
      <div id="toolbarContainer">
        <div id="toolbarViewer">
          <div id="toolbarViewerLeft">
            <button id="sidebarToggle" class="toolbarButton" title="Toggle Sidebar" tabindex="11"
              data-l10n-id="toggle_sidebar" aria-expanded="false" aria-controls="sidebarContainer">
              <span data-l10n-id="toggle_sidebar_label">Toggle Sidebar</span>
            </button>
            <div class="toolbarButtonSpacer"></div>
            <button id="viewFind" class="toolbarButton" title="Find in Document" tabindex="12" data-l10n-id="findbar"
              aria-expanded="false" aria-controls="findbar">
              <span data-l10n-id="findbar_label">Find</span>
            </button>
            <div class="splitToolbarButton hiddenSmallView">
              <button class="toolbarButton pageUp" title="Previous Page" id="previous" tabindex="13"
                data-l10n-id="previous">
                <span data-l10n-id="previous_label">Previous</span>
              </button>
              <div class="splitToolbarButtonSeparator"></div>
              <button class="toolbarButton pageDown" title="Next Page" id="next" tabindex="14" data-l10n-id="next">
                <span data-l10n-id="next_label">Next</span>
              </button>
            </div>
            <input type="number" id="pageNumber" class="toolbarField pageNumber" title="Page" value="1" size="4" min="1"
              tabindex="15" data-l10n-id="page" autocomplete="off">
            <span id="numPages" class="toolbarLabel"></span>
          </div>
          <div id="toolbarViewerRight">
            <button id="presentationMode" class="toolbarButton presentationMode hiddenLargeView"
              title="Switch to Presentation Mode" tabindex="31" data-l10n-id="presentation_mode">
              <span data-l10n-id="presentation_mode_label">Presentation Mode</span>
            </button>

            <button id="openFile" class="toolbarButton openFile hiddenLargeView" title="Open File" tabindex="32"
              data-l10n-id="open_file">
              <span data-l10n-id="open_file_label">Open</span>
            </button>

            <button id="print" class="toolbarButton print hiddenMediumView" title="Print" tabindex="33"
              data-l10n-id="print">
              <span data-l10n-id="print_label">Print</span>
            </button>

            <button id="download" class="toolbarButton download hiddenMediumView" title="Download" tabindex="34"
              data-l10n-id="download">
              <span data-l10n-id="download_label">Download</span>
            </button>
            <a href="#" id="viewBookmark" class="toolbarButton bookmark hiddenSmallView"
              title="Current view (copy or open in new window)" tabindex="35" data-l10n-id="bookmark">
              <span data-l10n-id="bookmark_label">Current View</span>
            </a>

            <div class="verticalToolbarSeparator hiddenSmallView"></div>

            <button id="secondaryToolbarToggle" class="toolbarButton" title="Tools" tabindex="36" data-l10n-id="tools"
              aria-expanded="false" aria-controls="secondaryToolbar">
              <span data-l10n-id="tools_label">Tools</span>
            </button>
          </div>
          <div id="toolbarViewerMiddle">
            <div class="splitToolbarButton">
              <button id="zoomOut" class="toolbarButton zoomOut" title="Zoom Out" tabindex="21" data-l10n-id="zoom_out">
                <span data-l10n-id="zoom_out_label">Zoom Out</span>
              </button>
              <div class="splitToolbarButtonSeparator"></div>
              <button id="zoomIn" class="toolbarButton zoomIn" title="Zoom In" tabindex="22" data-l10n-id="zoom_in">
                <span data-l10n-id="zoom_in_label">Zoom In</span>
              </button>
            </div>
            <span id="scaleSelectContainer" class="dropdownToolbarButton">
              <select id="scaleSelect" title="Zoom" tabindex="23" data-l10n-id="zoom">
                <option id="pageAutoOption" title="" value="auto" selected="selected" data-l10n-id="page_scale_auto">
                  Automatic Zoom</option>
                <option id="pageActualOption" title="" value="page-actual" data-l10n-id="page_scale_actual">Actual
                  Size</option>
                <option id="pageFitOption" title="" value="page-fit" data-l10n-id="page_scale_fit">Page Fit</option>
                <option id="pageWidthOption" title="" value="page-width" data-l10n-id="page_scale_width">Page Width
                </option>
                <option id="customScaleOption" title="" value="custom" disabled="disabled" hidden="true"></option>
                <option title="" value="0.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 50 }'>50%
                </option>
                <option title="" value="0.75" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 75 }'>75%
                </option>
                <option title="" value="1" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 100 }'>100%
                </option>
                <option title="" value="1.25" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 125 }'>125%
                </option>
                <option title="" value="1.5" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 150 }'>150%
                </option>
                <option title="" value="2" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 200 }'>200%
                </option>
                <option title="" value="3" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 300 }'>300%
                </option>
                <option title="" value="4" data-l10n-id="page_scale_percent" data-l10n-args='{ "scale": 400 }'>400%
                </option>
              </select>
            </span>
          </div>
        </div>
        <div id="loadingBar">
          <div class="progress">
            <div class="glimmer">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- <div id="toolBarContainer" style="z-index: 99999; display:none"> -->
    <!-- <div id="toolBarContainer" style="z-index: 99999;">
          <button id="zoomOut" class="" title="Zoom Out" style="margin-left:10px;">
            -
          </button>
          <button id="zoomIn" class="">
            +
          </button>

          <input type="text" id="findText"/>
        </div> -->

    <!-- <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"></div>  
        </div> -->

    <div id="errorWrapper" hidden='true' style="z-index: 9999;">
      <div id="errorMessageLeft">
        <span id="errorMessage"></span>
        <button id="errorShowMore" data-l10n-id="error_more_info">
          More Information
        </button>
        <button id="errorShowLess" data-l10n-id="error_less_info" hidden='true'>
          Less Information
        </button>
      </div>
      <div id="errorMessageRight">
        <button id="errorClose" data-l10n-id="error_close">
          Close
        </button>
      </div>
      <div class="clearBoth"></div>
      <textarea id="errorMoreInfo" hidden='true' readonly="readonly"></textarea>
    </div>
  </div> <!-- mainContainer -->
  <div id="overlayContainer" class="hidden">
    <div id="passwordOverlay" class="container hidden">
      <div class="dialog">
        <div class="row">
          <p id="passwordText" data-l10n-id="password_label">Enter the password to open this PDF file:</p>
        </div>
        <div class="row">
          <input type="password" id="password" class="toolbarField">
        </div>
        <div class="buttonRow">
          <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">Cancel</span></button>
          <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">OK</span></button>
        </div>
      </div>
    </div>
    <div id="documentPropertiesOverlay" class="container hidden">
      <div class="dialog">
        <div class="row">
          <span data-l10n-id="document_properties_file_name">File name:</span>
          <p id="fileNameField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_file_size">File size:</span>
          <p id="fileSizeField">-</p>
        </div>
        <div class="separator"></div>
        <div class="row">
          <span data-l10n-id="document_properties_title">Title:</span>
          <p id="titleField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_author">Author:</span>
          <p id="authorField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_subject">Subject:</span>
          <p id="subjectField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_keywords">Keywords:</span>
          <p id="keywordsField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_creation_date">Creation Date:</span>
          <p id="creationDateField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_modification_date">Modification Date:</span>
          <p id="modificationDateField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_creator">Creator:</span>
          <p id="creatorField">-</p>
        </div>
        <div class="separator"></div>
        <div class="row">
          <span data-l10n-id="document_properties_producer">PDF Producer:</span>
          <p id="producerField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_version">PDF Version:</span>
          <p id="versionField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_page_count">Page Count:</span>
          <p id="pageCountField">-</p>
        </div>
        <div class="row">
          <span data-l10n-id="document_properties_page_size">Page Size:</span>
          <p id="pageSizeField">-</p>
        </div>
        <div class="separator"></div>
        <div class="row">
          <span data-l10n-id="document_properties_linearized">Fast Web View:</span>
          <p id="linearizedField">-</p>
        </div>
        <div class="buttonRow">
          <button id="documentPropertiesClose" class="overlayButton"><span
              data-l10n-id="document_properties_close">Close</span></button>
        </div>
      </div>
    </div>
    <div id="printServiceOverlay" class="container hidden">
      <div class="dialog">
        <div class="row">
          <span data-l10n-id="print_progress_message">Preparing document for printing…</span>
        </div>
        <div class="row">
          <progress value="0" max="100"></progress>
          <span data-l10n-id="print_progress_percent" data-l10n-args='{ "progress": 0 }'
            class="relative-progress">0%</span>
        </div>
        <div class="buttonRow">
          <button id="printCancel" class="overlayButton"><span
              data-l10n-id="print_progress_close">Cancel</span></button>
        </div>
      </div>
    </div>
  </div> <!-- overlayContainer -->
  </div> <!-- outerContainer -->
  <div id="printContainer" style="display:none"></div>
  <!-- //로딩창 -->
  <div id="div-loading" style="
          position: absolute;
          z-index: 9000;
          display: none;
          left: 0;
          top: 0;
          width: 100vw;
          height: 100vh;
          text-align: center;
          align-items: center;
          background-color: white;
          top : 10px;" class="Background-1 show">
    <div style="margin: auto;top: 50%;left: 50%;position: absolute;transform: translate(-50%,-50%);">
      <img src="./images/duranno-logo-pc.png"
        style="position:relative; display:block; margin:auto; width:min(15vw, 15vh);" />
      <span style="position: relative; margin: auto; text-align: center; font-size:min(1.5vh, 1.5vw); top : 10px;">정보를
        불러오고
        있습니다.</span>
      <p style="margin-top: 10px;"></p>
    </div>
  </div>
  <!-- <header id="header-ebook" class="header header--fixed" onclick="event.stopPropagation();"> -->
  <header id="header-ebook" class="header header--fixed" onclick="event.stopPropagation(); closeModalDetail();">
    <div class="header__inner">
      <button class="controller-button" onclick="window.location.replace(document.referrer) ; event.stopPropagation();">
        <img src="./images/chapter_prev.svg" alt="뒤로가기" />
      </button>
      <h1 id="h1-title" class="header__title ellipsis-1">나단이 찾아온 날</h1>

      <div class="page-mode">
        <!-- * active 클래스: page-mode__button--active -->
        <button id="oneviewButton" class=" page-mode__button page-mode__button--single page-mode__button--active ">
          <img src="./images/page_single.svg" alt="한 쪽 보기">
        </button>
        <button id="twoviewButton" class="page-mode__button page-mode__button--double">
          <img src="./images/page_double.svg" alt="두 쪽 보기">
        </button>
      </div>

      <ul class="action-buttons">
        <li>
          <button class="action-buttons__button" onclick="openChapterList()">
            <img src="./images/menu_list.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">목차</span>
          </button>
        </li>
        <li>
          <button class="action-buttons__button" onclick="openReadingNote()">
            <img src="./images/menu_note.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">독서 노트</span>
          </button>
        </li>
        <li>
          <!--<button class="action-buttons__button action-buttons__button&#45;&#45;off">
                <img
                  src="./images/menu_screensetting.svg"
                  alt=""
                  class="action-buttons__icon"
                >
                <span class="action-buttons__text">보기설정</span>
              </button>-->
          <button id="settingButton" class="action-buttons__button action-buttons__button__off"
            onclick="openSettingModal()">
            <img src="./images/menu_screensetting.svg" alt="" class="action-buttons__icon">
            <!-- <img src="./images/menu_screensetting.svg_on" alt="" class="action-buttons__icon"> -->
            <!-- <span class="action-buttons__text color-secondary">보기설정</span> -->
            <span class="action-buttons__text">보기 설정</span>
          </button>
        </li>
        <li>
          <button class="action-buttons__button" onclick="openReviewModal()">
            <img src="./images/menu_review.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">리뷰</span>
          </button>
        </li>
        <!-- <li>
          <button class="action-buttons__button" onclick="toggleFindbar()">
            <img src="./images/menu_search.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">검색</span>
          </button>
        </li> -->
        <li>
          <button id="button-bookmark" class="action-buttons__button action-buttons__button--off"
            onclick="bookmarkButtonClick()">
            <img src="./images/bookmark.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">책갈피</span>
          </button>
          <!-- <button class="action-buttons__button action-buttons__button--on">
            <img src="./images/bookmark_on.svg" alt="" class="action-buttons__icon">
            <span class="action-buttons__text">북마크</span>
          </button> -->
        </li>
      </ul>
    </div>
  </header>

  <!-- main content -->
  <main class="content">
    <div class="content__container">
      <button id="image-bookmark" class="content__bookmark" style="opacity:0; z-index: 9;">
        <img src="./images/bookmark_lg.svg" alt="북마크">
      </button>

      <div id="viewerContainer" tabindex="0" style="height:100vh;">
        <div id="viewer" class="pdfViewer"></div>
      </div>
    </div>

    <!-- controller -->
    <!-- * controller 접힘 클래스: controller--folded-->
    <!-- <div id="footer-ebook" class="controller controller--fixed" onclick="event.stopPropagation();"> -->
    <div id="footer-ebook" class="controller controller--fixed" onclick="event.stopPropagation();">
      <div class="page-slider">
        <div class="page-slider__text">
          <span id="label-progress" class="page-slider__text--current">1</span>
          <span id="label-progress2" class="page-slider__text--total"> /301</span>
        </div>
      </div>
      <div class="range-slider range-slider--black">
        <!-- <span class="range-slider__bar"></span>
        <span class="range-slider__bar range-slider__bar--current" style="width: 7.3%"></span>
        <button class="range-slider__bar--pointer" style="left: 7.3%"></button> -->
        <input type="range" id="progress-bar" class="progress__range">
      </div>
      <div class="controller-buttons">
        <button class="controller-button controller-button__back" onclick="moveToPrevPage();">
          <img src="./images/back.svg" alt="">
        </button>
        <button class="controller-button controller-button__prev" onclick="prevChapter();">
          <img src="./images/chapter_prev.svg" alt="이전 챕터">
          이전 챕터
        </button>
        <button class="controller-button controller-button__next" onclick="nextChapter();">
          다음 챕터
          <img src="./images/chapter_next.svg" alt="다음 챕터">
        </button>
      </div>
    </div>
  </main>


  <!-- 보기설정 -->
  <div class="modal-parent" id="modal-setting">
    <div style="position: absolute; inset: 50% auto auto 50%; transform: translate(-50%, -50%);" class="setting"
      onclick="event.stopPropagation();">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56">
        <button class="modal__close" onClick="closeSettingModal();">
          <img src="./images/close.svg" alt="닫기">
        </button>
      </div>
      <section class="setting__section">
        <div class="setting__item setting__paint overflow-auto">
          <strong class="sc-only">배경색</strong>
          <ul class="highlight-setting" id="highlight-setting">
            <li>
              <button type="button" name="Background-0" class="color-label highlight__button size-28 on"
                onClick="changeBackground('')" style="font-size:12px; line-height:1em; padding:0px;">
                원본
              </button>
            </li>

            <li>
              <button type="button" name="Background-1" class="color-label highlight__button color-label--white size-28"
                onClick="changeBackground('Background-1')"></button>
            </li>
            <li>
              <button type="button" name="Background-2" class="
                              color-label
                              highlight__button
                              color-label--light-yellow
                              size-28
                            " onClick="changeBackground('Background-2')"></button>
            </li>
            <li>
              <button type="button" name="Background-3" class="
                              color-label
                              highlight__button
                              color-label--skyblue
                              size-28
                            " onClick="changeBackground('Background-3')"></button>
            </li>
            <li>
              <button type="button" name="Background-4" class="
                              color-label
                              highlight__button
                              color-label--darkblue
                              size-28
                            " onClick="changeBackground('Background-4')"></button>
            </li>
            <li>
              <button type="button" name="Background-5" class="color-label highlight__button color-label--gray size-28"
                onClick="changeBackground('Background-5')"></button>
            </li>
            <li>
              <button type="button" name="Background-6" class="
                              color-label
                              highlight__button
                              color-label--dark-gray
                              size-28
                            " onClick="changeBackground('Background-6')"></button>
            </li>
          </ul>
        </div>
      </section>

      <section class="setting__section">
        <div class="setting__item setting__flow-page-">
          <strong class="setting__title">넘김 설정</strong>
          <div class="setting__field">
            <button class="setting__more" id="btn-scroll-mode"
              onclick="event.stopPropagation(); openSelectModal('페이지', '스크롤',this,changeScrollType, event); ">페이지</button>
          </div>
        </div>
      </section>

      <div class="setting__bottom">
        <div class="row justify-between">
          <p style="margin-bottom: 13px; font-weight: 300; color: #999; font-size: 10px;">
          </p>
          <!-- <button class="button-user">사용자 설정으로 보기</button> -->
          <button class="button-reset" onclick="resetSetting()">
            <img src="./images/reset.svg" alt="" />
            <span> 설정 초기화 </span>
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- 목차 -->
  <div class="modal-parent" id="modal-chapter">
    <div class="modal" style="position:absolute; inset:50% auto auto 50%; transform: translate(-50%, -50%);"
      onclick="event.stopPropagation();">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56">
        <button class="modal__close" onClick="closeChapterList();">
          <img src="./images/close.svg" alt="닫기">
        </button>
      </div>
      <div class="modal__title chapter__title">
        <h2>목차</h2>
      </div>
      <div id="modal-chapter-item-frame" class="modal__content" style="padding: 23px 0">
        <!--<div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1"> Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div>-->
      </div>
    </div>
  </div>
  <!-- // 목차 -->


  <!-- 독서노트 -->
  <div class="modal-parent" id="modal-note">
    <div class="modal" style="position: absolute;inset: 50% auto auto 50%;transform: translate(-50%, -50%);"
      onclick="event.stopPropagation();">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56">
        <button class="modal__close" onClick="closeReadingNote(); closeModalDetail();">
          <img src=" ./images/close.svg" alt="닫기">
        </button>
      </div>
      <div class="modal__title">
        <h2>독서 노트 - 책갈피</h2>
      </div>
      <div id="div-reading-note-content" class="modal__content" style="height:480px">
        <section id="section-reading-note" class="modal-content__section" style="padding-top: 0px;">
          <h4 class="note__chapter">Part 1. 오늘을 사는 힘</h4>
          <div class="note-item">
            <div class="note-item__label">
              <button type="button" class="color-label size-13 color-label--blue" onClick=""></button>
            </div>
            <div class="note-item__content">
              <p>우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.</p>
              <div class="memo">
                <div class="memo__inner">
                  <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12">
                  <p class="memo__text">자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니...</p>
                </div>
                <button class="memo__fold-button" onClick="">
                  펼치기
                  <img alt="메모" src="./images/note_memo_more.svg" width="8">
                </button>
                <!--<button
                class="memo__fold-button memo__fold-button__spread"
                onClick=""
              >
                접기
                <img
                  alt="메모"
                  src="./images/note_memo_more.svg"
                  width="8"
               >
              </button>-->
              </div>
              <div class="modal-content__bottom">
                <ul class="modal-content__info">
                  <li>51페이지</li>
                  <li>2021.05.23</li>
                </ul>
                <button type="button" class="button-more" onClick=""></button>
              </div>
            </div>
          </div>
          <div class="note-item">
            <div class="note-item__label">
              <button type="button" class="color-label size-13 color-label--red" onClick=""></button>
            </div>
            <div class="note-item__content">
              <p>우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.</p>
              <div class="memo">
                <div class="memo__inner">
                  <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12">
                  <!--<p class="memo__text">자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니다.</p>-->

                  <!--메모 수정-->
                  <div class="edit-memo">
                    <textarea class="edit-memo__textarea" maxlength="1000" name="" placeholder="메모를 입력해주세요."></textarea>
                    <div class="edit-memo__bottom">
                      <div class="edit-memo__length"><span>4</span>&nbsp;/&nbsp;1000자</div>
                      <div class="edit-memo__buttons">
                        <div class="edit-memo__button edit-memo__button--white" onClick="">취소</div>
                        <div class="edit-memo__button edit-memo__button--black" onClick="">완료</div>
                      </div>
                    </div>
                  </div>
                  <!--//메모 수정-->
                </div>
              </div>
              <div class="modal-content__bottom">
                <ul class="modal-content__info">
                  <li>51페이지</li>
                  <li>2021.05.23</li>
                </ul>
                <button type="button" class="button-more" onClick=""></button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <!-- //독서노트 -->

  <!-- 리뷰 모달 -->
  <div id="modal-review" class="modal-parent">
    <div class="modal"
      style="position: absolute;inset: 50% auto auto 50%;transform: translate(-50%, -50%); height: auto;"
      onclick="event.stopPropagation();">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56">
        <button class="modal__close" onClick="closeModal();">
          <img src="./images/close.svg" alt="닫기">
        </button>
      </div>
      <div class="modal__title bdb">
        <h2>리뷰</h2>
      </div>
      <div class="modal__content" onscroll="fixRangePosition(this, event)">
        <!-- 리뷰 -->
        <section class="review__container">
          <!-- 콘텐츠 평균 별점 -->
          <dl class="review-average">
            <dt>콘텐츠 평균 별점</dt>
            <dd>
              <div id="div-review-average" class="review-average__text"></div>
              <div id="div-review-average-stars" class="review-average__stars">
                <img src="./images/stars/star_average_100.svg" alt="">
                <img src="./images/stars/star_average_100.svg" alt="">
                <img src="./images/stars/star_average_100.svg" alt="">
                <img src="./images/stars/star_average_100.svg" alt="">
                <img src="./images/stars/star_average_40.svg" alt="">
              </div>
            </dd>
          </dl>

          <!-- 리뷰 목록 -->
          <div class="reviews" style="height: 430px;">
            <!-- 내가 남긴  리뷰 -->
            <div class="review-item my-review">
              <div id="div-mine" class="review-item__inner" style="display:none">
                <div class="review-item__header">
                  <div class="row">
                    <div class="thumbnail">
                      <img id="img-review-mine-profile" src="./images/profile.svg" alt="홍길동">
                    </div>
                    <div class="row review-item__name">
                      <b>나자신</b>님
                    </div>
                    <div class="review-item__date">
                      2021.10.15
                    </div>
                  </div>
                  <div class="row">
                    <!--<img
                                class="pin"
                                alt="고정된 리뷰"
                                title="고정된 리뷰"
                                src="/images/pin.svg"
                              />-->
                    <div class="stars--primary small">
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_half.svg" alt="">
                      </button>
                    </div>
                  </div>
                </div>
                <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                  2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                  이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>

                <div class="my-review__buttons">
                  <button class="my-review__button edit">
                    <img alt="수정" src="./images/review_edit.svg" />
                    수정
                  </button>

                  <button class="my-review__button remove">
                    <img alt="삭제" src="./images/review_remove.svg" />
                    삭제
                  </button>
                </div>
              </div>
            </div>

            <!-- 내가 남긴  리뷰 수정 -->
            <div class="review-item my-review my-review-edit">
              <div id="div-write-review" class="review-item__inner">
                <div class="my-review-edit__score">
                  <strong id="text-starpoint">내 별점 0점</strong>

                  <div class="stars--primary">
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <input id="input-star" oninput="changeStar(this); event.preventDefault(); event.stopPropagation();"
                      type="range" step="1" min="1" max="5" value="5"
                      style="opacity: 0; position:absolute; height:26px;"
                      onclick=" event.preventDefault(); event.stopPropagation();" />
                  </div>
                </div>
                <div class="my-review-edit__form">
                  <textarea id="textarea-review" maxlength="1000" onclick="event.stopPropagation();"
                    placeholder="리뷰를 입력해 주세요" name="" id="" cols="30" rows="10"></textarea>

                  <div class="edit-memo__bottom my-review">
                    <div class="edit-memo__length">
                      <span id="span-review-length">0</span>&nbsp;/&nbsp;1000자
                    </div>
                    <!-- <div></div> -->
                    <div class="edit-memo__buttons">
                      <button class="edit-memo__button edit-memo__button--white"
                        onClick="modifyReviewCancel();">취소</button>
                      <button id="btn-review-modify" class="edit-memo__button edit-memo__button--black"
                        onClick="modifyReviewComplete()">수정완료</button>
                      <button id="btn-review-register" class="edit-memo__button edit-memo__button--black"
                        onClick="registerReview()">등록</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- 타인의 리뷰 -->
            <ul id="ul-review" class="reviews-others">
              <li>
                <div class="review-item">
                  <div class="review-item__inner">
                    <div class="review-item__header">
                      <div class="row">
                        <div class="thumbnail">
                          <img src="./images/profile.svg" alt="홍길동">
                        </div>
                        <div class="row review-item__name">
                          <b>야고보</b>님
                        </div>
                        <div class="review-item__date">
                          2021.10.15
                        </div>
                      </div>
                      <div class="row">
                        <img class="pin" alt="고정된 리뷰" title="고정된 리뷰" src="./images/pin.svg" />
                        <!--<div class="stars&#45;&#45;primary small">
                                      <button class="star">
                                        <img src="./images/stars/star_primary_full.svg" alt="">
                                      </button>
                                      <button class="star">
                                        <img src="./images/stars/star_primary_full.svg" alt="">
                                      </button>
                                      <button class="star">
                                        <img src="./images/stars/star_primary_full.svg" alt="">
                                      </button>
                                      <button class="star">
                                        <img src="./images/stars/star_primary_full.svg" alt="">
                                      </button>
                                      <button class="star">
                                        <img src="./images/stars/star_primary_half.svg" alt="">
                                      </button>
                                    </div>-->
                      </div>
                    </div>
                    <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                      2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                      이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>
                  </div>
                </div>
                <span class="dashed"></span>
              </li>

              <li>
                <div class="review-item">
                  <div class="review-item__inner">
                    <div class="review-item__header">
                      <div class="row">
                        <div class="thumbnail">
                          <img src="./images/profile.svg" alt="홍길동">
                        </div>
                        <div class="row review-item__name">
                          <b>야고보</b>님
                        </div>
                        <div class="review-item__date">
                          2021.10.15
                        </div>
                      </div>
                      <div class="row">
                        <!-- <img
                                      alt="고정된 리뷰"
                                      title="고정된 리뷰"
                                      src="/images/pin.svg"
                                      width="22"
                                    />-->
                        <div class="stars--primary small">
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_half.svg" alt="">
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                      2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                      이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>
                  </div>
                </div>
                <span class="dashed"></span>
              </li>
            </ul>
          </div>
        </section>
        <!-- // 리뷰 -->
      </div>
    </div>
  </div>
  <!-- 리뷰 모달 -->

  <!--하얀 컨테이너 -->
  <div id="modal-report" class="modal-parent"
    style="border: 0.1rem solid; position: absolute; background-color:white; left:50vw; top : 50vh; width:300px; height:auto; transform: translate(-50%, -50%); padding:20px">
    <div class="modal" onclick="event.stopPropagation();" style="display: block;
     flex-direction: row;
     width: auto;
     height: auto;
     border: none;
     box-shadow:none;
     background-color: none">
      <div style="margin-bottom:10px;">신고하기</div>
      <div>
        <select id="option-report" style="border-radius:5px; width:260px; height:auto">
        </select>
      </div>
      <div id="div-report-text" style="height:auto; width:auto; margin-top: 10px; display:none;">
        <textarea id="textarea-report"
          style="height:150px; width:100%; background-color:rgb(238, 238, 238); border-radius:10px;"
          placeholder="신고 사유를 입력해 주세요" maxlength="1000"></textarea>
      </div>
      </select>
      <div style="vertical-align: baseline; display: flex; float:right; margin-top:10px;">
        <button style="margin-right:20px; color: rgb(153, 153, 153);"
          onclick="document.getElementById('modal-report').style.display='none';">취소</button>
        <button style="color:rgb(28, 167, 236);" onclick="reportComplete()">전송</button>
      </div>
    </div>
  </div>

  <script>
    let _bookNo = 2;
    let _memberNo = 2;
    let _contentNo = 2;
    let _highDefinition = false;
    let _completeReadYN = "N";

    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("memberNo") != null) {
      _memberNo = urlParams.get("memberNo");
    }
    if (urlParams.get("bookNo") != null) {
      _bookNo = urlParams.get("bookNo");

      httpGet("GetBookTitleByContentNo", { ContentNo: _bookNo }).then(function (data) {
        if (data && data[0]) {
          document.getElementById("h1-title").innerHTML = data[0].ContentTitle;
        }
      })
    }

    //로그인 정보 체크 && 읽을 수 있는 책인지 검사 ==========================================
    function getCookie(cookieName) {
      var cookieValue = null;
      if (document.cookie) {
        var array = document.cookie.split((escape(cookieName) + '='));
        if (array.length >= 2) {
          var arraySub = array[1].split(';');
          cookieValue = unescape(arraySub[0]);
        }
      }
      return cookieValue;
    }
    const token = getCookie("Token");
    const user = getCookie("user");
    // const token = "ZXlKaGJHY2lPaUpvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEx6QTBMM2h0YkdSemFXY3RiVzl5WlNOb2JXRmpMWE5vWVRJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SlZjMlZ5VG04aU9pSXlNVElpTENKRVpYWnBZMlZKUkNJNklsZGxZaUlzSWxOdWMxUjVjR1VpT2lJd01ESWlMQ0pCY0hCVWVYQmxJam9pTURBeklpd2laWGh3SWpveE5qUTJPVGd5TURFekxDSnBjM01pT2lKb2RIUndjem92TDIxNWQyVmlZWEJwTG1OdmJTSXNJbUYxWkNJNkltaDBkSEJ6T2k4dmJYbDNaV0poY0drdVkyOXRJbjAuRlA4dk15aFBxeWM5dHpHV2dEOXF6cW8xOXNhMzhVbVRPN0o1aFEwMThKOA==";
    // const user = "212";

    // if (!token || !user) {
    //   alert("권한이 없습니다. 두플러스 홈페이지로 이동합니다.");
    //   location.href = "https://dev-dplus-front.azurewebsites.net/";
    // }
    // else {
    //   if (user != _memberNo) {
    //     alert("잘못 된 접근입니다.");
    //     location.href = "https://dev-dplus-front.azurewebsites.net/";
    //   }
    // }

    // if (token && user) {
    //   loginCheck(token, user).then(function (result) {
    //     if (result.tokenChkYN != "Y") {
    //       alert("권한이 없습니다. 두플러스 홈페이지로 이동합니다.");
    //       location.href = "https://dev-dplus-front.azurewebsites.net/";
    //     }
    //   })
    // }

    //로그인 정보 체크 끝 =======================================

    const APP_EVENT = {
      SCROLL_MODE: {
        HORIZONTAL: 1,
        VERTICAL: 0,
        WRAPPING: 2,
      },
      VIEW_FORMAT: {
        ONE_SIDE: "oneSide",
        TWO_SIDE: "twoSide"
      },

      BACKGROUND_COLOR: {
        BACKGROUND1: "Background-1",
        BACKGROUND2: "Background-2",
        BACKGROUND3: "Background-3",
        BACKGROUND4: "Background-4",
        BACKGROUND5: "Background-5",
        BACKGROUND6: "Background-6",
        BACKGROUND7: "Background-7",
      },

      SPREAD: {
        NONE: 0,
        EVEN: 1,
        ODD: 2,
      },
      SCALE: {
        AUTO: "auto",
        PAGE_FIT: "page-fit",
        PAGE_WIDTH: "page-width",
      }
    };

    var progressBar = document.getElementById("progress-bar");

    var currentScale = "page-fit";
    var pdfResizing = false;
    var resizingTime = null;
    var tt = 0;
    // let prevPage = 0;
    let prevPage = [];
    let prevClick = false;
    function pushPage(page) {
      prevPage.push(page);
      if (prevPage.length > 30) {
        prevPage.splice(0, 1);
      }
    }
    function popPage() {
      return prevPage.pop() || null;
    }
    document.addEventListener("pdfstarted", function () {
      let param = {};
      param.MemberNo = _memberNo;
      param.ContentNo = _bookNo;
      param.BookReadingPositionValue = PDFViewerApplication.pdfViewer.currentPageNumber.toString();
      param.BookReadingProgressRate = Math.round(PDFViewerApplication.pdfViewer.currentPageNumber / PDFViewerApplication.pdfDocument.numPages * 100);

      document.getElementById("div-loading").classList.remove("show");
      document.getElementById("div-loading").getElementsByTagName("p")[0].innerHTML = "";
      PDFViewerApplication.pdfViewer.currentScaleValue = currentScale;
      changeScrollType(APP_EVENT.SCROLL_MODE.VERTICAL);

      //북마크 가져오기 
      httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo }).then(function (bookmark) {
        for (let i = 0; i < bookmark.length; i++) {
          bookmarkList.push(bookmark[i]);
        }

        //bookmark 검사 1일때 
        for (let i = 0; i < bookmarkList.length; i++) {
          if (bookmarkList[i].BookMarkPositionValue == "1") {
            changeBookmarkStatus();
          }
        }
      })
      //프로그레스 바 초기화 ==
      progressBar.style.display = "inline-block";
      progressBar.value = 1;
      progressBar.min = 1;
      progressBar.max = PDFViewerApplication.pdfDocument.numPages;

      document.getElementById("label-progress2").innerHTML = "/" + PDFViewerApplication.pdfDocument.numPages
      //======================
      // httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo });




      PDFViewerApplication.eventBus._on("pagechanging", function (e) {
        // prevPage = e.previous;
        if (!prevClick) {
          pushPage(e.previous);
        }
        prevClick = false;
        let param = {};
        param.MemberNo = _memberNo;
        param.ContentNo = _bookNo;
        param.BookReadingPositionValue = PDFViewerApplication.pdfViewer.currentPageNumber.toString();
        param.BookReadingProgressRate = Math.round(PDFViewerApplication.pdfViewer.currentPageNumber / PDFViewerApplication.pdfDocument.numPages * 100);
        httpPost("ManageRecentUseContentData", param).then(function (result) {

        })

        bookmark.style.opacity = 0;
        document.getElementById("button-bookmark").classList.remove("action-buttons__button--on");
        document.getElementById("button-bookmark").classList.add("action-buttons__button--off");
        document.getElementById("button-bookmark").getElementsByTagName("img")[0].src = "./images/bookmark.svg";

        //프로그레스 바 밸류 change=====
        progressBar.value = PDFViewerApplication.pdfViewer.currentPageNumber;
        let val = (progressBar.value - progressBar.min) / (progressBar.max - progressBar.min);
        progressBar.style.backgroundImage = '-webkit-gradient(linear, left top, right top, '
          + 'color-stop(' + val + ', #878787), '
          + 'color-stop(' + val + ', #E9E9E9)'
          + ')';

        const labelProgress = document.getElementById("label-progress");
        const labelProgress2 = document.getElementById("label-progress2");
        labelProgress.innerHTML = progressBar.value;

        //===============
        //북마크 검사 
        //펼쳐짐 없음
        for (var i = 0; i < bookmarkList.length; i++) {
          if (PDFViewerApplication.pdfViewer.spreadMode == 0) {
            if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
              changeBookmarkStatus();
            }
          }
          //짝수 펼쳐짐
          else if (PDFViewerApplication.pdfViewer.spreadMode == 2) {
            if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 0) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                changeBookmarkStatus();
              }

              else if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber + 1) {
                changeBookmarkStatus();
              }
            }
            else if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 1) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                changeBookmarkStatus();
              }
            }
          }
          // 홀수펼쳐짐
          else if (PDFViewerApplication.pdfViewer.spreadMode == 1) {
            if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 0) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                changeBookmarkStatus();
              }
            }
            else if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 1) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                changeBookmarkStatus();
              }
              else if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber + 1) {
                changeBookmarkStatus();
              }
            }
          }
        }
      })


      if (PDFViewerApplication.pdfViewer.scrollMode == APP_EVENT.SCROLL_MODE.HORIZONTAL) {
        const viewer = document.getElementById("viewer");
        viewer.style.marginTop = ((window.innerHeight - viewer.offsetHeight) / 2) - document.getElementById("toolbarContainer").clientHeight + "px";
        // const viewerContainer = document.getElementById("viewerContainer");
        // viewerContainer.style.marginLeft = ((window.innerWidth - viewer.offsetWidth + 9) / 2) + "px";
      }
      else {
        const viewer = document.getElementById("viewer");
        viewer.style.marginTop = "0";
      }
      PDFViewerApplication.eventBus.on("resize", function () {
        pdfResizing = true;
      })

      PDFViewerApplication.eventBus.on("pagerendered", function () {
        if (resizingTime) window.clearTimeout(resizingTime);
        if (pdfResizing) {
          resizingTime = window.setTimeout(function () {
            document.getElementById("div-loading").classList.remove("show");
            pdfResizing = false;
            changeViewport(false);
            changeViewport(true);
            fixLocation();
          }, 400);
        }
      })

      httpGet("GetSettingByCode", { MemberNo: _memberNo, Code: "012" }).then(function (result) {
        if (!result || !result[0]) {
          changePageMode();
          return;
        }

        if (result[0].SettingValue == "scrolled") {
          changeScrollMode();
        }
        else {
          changePageMode();
        }

        //읽고있던 페이지로 넘어가기 
        httpGet("GetRecentUseContent", { MemberNo: _memberNo, BookNo: _bookNo }).then((recentUseData) => {
          if (recentUseData && recentUseData.length > 0) {
            _completeReadYN = recentUseData[0].CompleteReadYN;
            //contentNo 저장
            _contentNo = recentUseData[0].ContentNo;
          }


          changeSpreadMode(0);
          addLeftRightTouchEventHandler();
          bindChapter();
          getSetting();

          if (!recentUseData || !recentUseData[0]) {
            PDFViewerApplication.pdfLinkService.goToPage(1);

            //처음 열때 호출해야해서 호출함
            param = {};
            param.MemberNo = _memberNo;
            param.ContentNo = _bookNo;
            param.BookReadingPositionValue = "1";
            param.BookReadingProgressRate = 1;


            httpPost("ManageRecentUseContentData", param).then(function (result) {

            })
          }
          else {
            moveToPage(recentUseData[0].BookReadingPositionValue);

            httpPost("ManageRecentUseContentData", param).then(function (result) {

            })
          }
        })
      })

      //마지막에 위치 잡아주기
      if (!_contentNo || _contentNo == 2) {
        //읽고있던 페이지로 넘어가기 
        httpGet("GetRecentUseContent", { MemberNo: _memberNo, BookNo: _bookNo }).then((recentUseData) => {
          if (recentUseData && recentUseData.length > 0) {
            _completeReadYN = recentUseData[0].CompleteReadYN;
            //contentNo 저장
            _contentNo = recentUseData[0].ContentNo;
          }
        })
      }
      fixLocation();
    })

    function swipeLeft() {
      prevClick = true;
      PDFViewerApplication.pdfViewer.previousPage();
    }

    function swipeRight() {
      if (PDFViewerApplication.pdfViewer.currentPageNumber == PDFViewerApplication.pdfViewer.pagesCount) {
        if (_completeReadYN == "N") {
          if (confirm("마지막 페이지입니다. 완독하셨습니까?")) {
            httpPost("ModifyCompleteRead", { ContentNo: _contentNo, MemberNo: _memberNo }).then(function (data) {
              if (data > 0) {
                _completeReadYN = "Y";
              }
            })
          }

        }

        else {
          alert("마지막 페이지입니다.")
        }
        return;
      }
      prevClick = true;
      PDFViewerApplication.pdfViewer.nextPage();
    }

    function changeScrollType(mode) {
      // if (mode == APP_EVENT.SCROLL_MODE.VERTICAL) {
      //   document.body.classList.remove("nonScroll");
      //   document.body.classList.remove("HORIZONTAL");
      //   document.body.classList.add("VERTICAL");

      // }
      // else if(mode ==APP_EVENT.SCROLL_MODE.HORIZONTAL){
      //   document.body.classList.add("nonScroll");
      //   document.body.classList.remove("VERTICAL");
      //   document.body.classList.add("HORIZONTAL");       
      // }

      PDFViewerApplication.pdfViewer.currentScaleValue = currentScale;
      PDFViewerApplication.pdfViewer.scrollMode = mode;

      fixLocation();
    }

    async function getChapter() {
      const chapterData = await PDFViewerApplication.pdfDocument.getOutline();
      let resultList = [];
      if (chapterData && chapterData.length > 0) {
        for (let i = 0; i < chapterData.length; i++) {
          let result = {};
          result.label = chapterData[i].title;
          if (chapterData[i].dest && chapterData[i].dest[0] && chapterData[i].dest[0].num) {
            result.href = await PDFViewerApplication.pdfDocument.getPageIndex({ num: chapterData[i].dest[0].num, gen: chapterData[i].dest[0].gen });
          }
          else {
            continue;
          }
          result.page = result.href = result.href + 1;
          result.progress = 0;
          result.firstDepth = false;
          resultList.push(result);

          if (chapterData[i].items && chapterData[i].items.length > 0) {
            for (let item of chapterData[i].items) {
              let result = {};
              result.label = item.title;
              if (item.dest && item.dest[0] && item.dest[0].num) {
                result.href = await PDFViewerApplication.pdfDocument.getPageIndex({ num: item.dest[0].num, gen: item.dest[0].gen });
              }
              else {
                continue;
              }
              result.page = result.href = result.href + 1;
              result.progress = 0;
              result.firstDepth = true;
              resultList.push(result);
            }
          }
        }
      }
      return resultList;
    }

    function moveToPage(page) {
      PDFViewerApplication.pdfLinkService.goToPage(parseInt(page));
      document.getElementById("progress-bar").value = (parseInt(page));

      var val = (progressBar.value - progressBar.min) / (progressBar.max - progressBar.min);
      progressBar.style.backgroundImage = '-webkit-gradient(linear, left top, right top, '
        + 'color-stop(' + val + ', #878787), '
        + 'color-stop(' + val + ', #E9E9E9)'
        + ')'
      document.getElementById("label-progress").innerHTML = page;
      document.getElementById("label-progress2").innerHTML = "/" + PDFViewerApplication.pdfDocument.numPages
    }

    function moveToPrevPage() {
      if (prevPage.length > 0) {
        prevClick = true;
        PDFViewerApplication.pdfLinkService.goToPage(prevPage.pop());
      }
    }

    var bookmarkList = [];
    const bookmark = document.getElementById("image-bookmark");
    bookmark.addEventListener("click", function (e) {
      e.stopPropagation();
      if (bookmark.style.opacity == 0) {
        addBookmark();
        document.getElementById("button-bookmark").getElementsByTagName("img")[0].src = "./images/bookmark_on.svg";
      }
      else {
        bookmark.style.opacity = 0;
        document.getElementById("button-bookmark").getElementsByTagName("img")[0].src = "./images/bookmark.svg";
        for (var i = 0; i < bookmarkList.length; i++) {
          //펼쳐짐 없음
          if (PDFViewerApplication.pdfViewer.spreadMode == 0) {
            if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
              bookmarkList.splice(i, 1);
              httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString() })
              break;
            }
          }
          //짝수 펼쳐짐
          else if (PDFViewerApplication.pdfViewer.spreadMode == 2) {
            if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 0) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString() })
                break;
              }

              else if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber + 1) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: (PDFViewerApplication.pdfViewer.currentPageNumber + 1).toString() })
                break;
              }
            }
            else if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 1) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString() })
                break;
              }
            }
          }
          // 홀수펼쳐짐
          else if (PDFViewerApplication.pdfViewer.spreadMode == 1) {
            if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 0) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString() })
                break;
              }
            }
            else if (PDFViewerApplication.pdfViewer.currentPageNumber % 2 == 1) {
              if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString() })
                break;
              }
              else if (bookmarkList[i].BookMarkPositionValue == PDFViewerApplication.pdfViewer.currentPageNumber + 1) {
                bookmarkList.splice(i, 1);
                httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: (PDFViewerApplication.pdfViewer.currentPageNumber + 1).toString() })
                break;
              }
            }
          }
        }
      }
    });

    function removeBookmark() {
      bookmark.click();
      document.getElementById("button-bookmark").getElementsByTagName("img")[0].src = "./images/bookmark.svg";
    }

    function addBookmark() {
      getCurrentChapter().then(function (chapter) {
        if (chapter.order == -1) {
          chapter = {};
          chapter.label = PDFViewerApplication.pdfViewer.currentPageNumber.toString() + "페이지";
        }
        httpPost("addbookmark", {
          MemberNo: _memberNo,
          BookNo: _bookNo, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString(),
          BookMarkTableContent: chapter.label, BookMarkTableContentSub: "",
          BookMarkPage: PDFViewerApplication.pdfViewer.currentPageNumber,
          BookMarkPercentage: PDFViewerApplication.pdfViewer.currentPageNumber
        }).then(function (result) {
          if (result > 0) {
            httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo }).then(function (bookmark) {
              bookmarkList = [];
              for (let i = 0; i < bookmark.length; i++) {
                bookmarkList.push(bookmark[i]);
              }
            })
          }
          else {
            alert("북마크 등록 실패 관리자에게 문의바랍니다.");
          }
        })
        bookmark.style.opacity = 1;
        // bookmarkList.push({ MemberNo: 2, BookNo: 2, BookMarkPositionValue: PDFViewerApplication.pdfViewer.currentPageNumber.toString(), BookMarkTableContent: chapter.label, BookMarkTableContentSub: "", BookMarkPage: PDFViewerApplication.pdfViewer.currentPageNumber, BookMarkPercentage: 0 });

      });


    }

    function getBookmark() {
      return bookmarkList;
    }

    function changeBackground(theme) {
      let className = document.body.className;
      let classes = className.split(' ');
      for (let i = 0; i < classes.length; i++) {
        if (classes[i].indexOf("Background") >= 0) {
          document.body.classList.remove(classes[i]);
        }
      }
      if (theme) {
        document.body.classList.add(theme);

        document.getElementById("div-loading").className = "";
        document.getElementById("div-loading").classList.add(theme);
      }
      else {
        document.getElementById("div-loading").className = "";
      }

      manageSetting("011", theme);

      //보기설정쪽 선택된 배경 바인딩
      let indicator = false;
      const buttons = document.getElementById("modal-setting").getElementsByClassName("color-label");
      for (let button of buttons) {
        button.classList.remove("on");
        if (button.getAttribute("name") == theme) {
          button.classList.add("on");
          indicator = true;
        }
      }
      if (indicator == false) {
        for (let button of buttons) {
          if (button.getAttribute("name") == "Background-0") {
            button.classList.add("on");
            return;
          }
        }
      }

    }

    function zoomIn(ticks) {
      PDFViewerApplication.zoomIn(ticks);
    }

    function zoomOut(ticks) {
      PDFViewerApplication.zoomOut(ticks);
    }

    function resetZoom() {
      PDFViewerApplication.pdfViewer.currentScaleValue = currentScale;
    }

    window.addEventListener("selectDocument", function (e) {
      //select 코드
    });

    function fixLocation() {
      if (currentScrollMode == "page") {
        let page = document.getElementsByClassName("page");
        if (((document.documentElement.clientHeight / 2) - (page[PDFViewerApplication.pdfViewer.currentPageNumber - 1].children[0].clientHeight / 2)) > 2) {
          document.getElementById("viewerContainer").style.top = ((document.documentElement.clientHeight / 2) - (page[PDFViewerApplication.pdfViewer.currentPageNumber - 1].children[0].clientHeight / 2)) + "px";
        }
        else {
          document.getElementById("viewerContainer").style.top = "1px";
        }

      }
      // else if (currentScrollMode == "scroll") {
      //   let page = document.getElementsByClassName("page");
      //   document.getElementById("viewerContainer").style.top = ((document.documentElement.clientHeight / 2) - (page[PDFViewerApplication.pdfViewer.currentPageNumber - 1].children[0].clientHeight / 2)) + "px";
      // }
      else {
        document.getElementById("viewerContainer").style.top = "";
      }
    }

    function changeSpreadMode(mode) {
      PDFViewerApplication.pdfViewer.spreadMode = mode;
      fixLocation();
    }

    function changeScale(scale) {
      currentScale = scale;
      PDFViewerApplication.pdfViewer.currentScaleValue = scale;
    }

    function toggleFindbar() {
      closeModal();
      PDFViewerApplication.findBar.toggle();
    }

    function getFindbarLocation() {
      let findbar = document.getElementByClassName("findbar");
      let location = {};
      location.width = findbar[0].clientWidth;
      location.height = findbar[0].clientHeight;
    }

    document.getElementById("findbar").addEventListener("click", function (e) {
      e.stopPropagation();
    });

    window.addEventListener("click", function (e) {
      if (e.detail > 1) {
        e.preventDefault();
      }

      if (PDFViewerApplication.findBar.opened) {
        toggleFindbar();
      }
    })

    var currentScrollMode = "scroll";
    let loadingIndicator = false;
    function changeScrollMode() {
      loadingIndicator = true;
      let beforePage = PDFViewerApplication.pdfViewer.currentPageNumber;

      let page = document.getElementsByClassName("page");
      for (let i = 0; i < page.length; i++) {
        page[i].classList.remove("paginated");
        page[i].style.border = "";
      }

      document.getElementById("viewerContainer").style.overflow = "";
      currentScrollMode = "scroll";

      fixLocation();

      document.getElementById("btn-scroll-mode").innerHTML = "스크롤";

      manageSetting("012", "scrolled");

      //페이지 가로에 맞추기
      moveToPage(beforePage);
      window.setTimeout(() => {
        loadingIndicator = false;
        changeScale("page-width");

      }, 500)

      //아이콘 변경 
      const scrollIcon = document.getElementsByClassName("setting__flow-page-")[0];
      scrollIcon.classList.add("setting__flow-scroll");
      scrollIcon.classList.remove("setting__flow-page");

    }
    //#region paginated
    function changePageMode() {
      let page = document.getElementsByClassName("page");
      for (let i = 0; i < page.length; i++) {
        page[i].classList.add("paginated");
        page[i].style.border = "0px";
      }
      document.getElementById("viewerContainer").style.overflow = "hidden";
      currentScrollMode = "page";

      document.getElementById("btn-scroll-mode").innerHTML = "페이지";

      fixLocation();

      manageSetting("012", "paginated");

      //페이지 맞추기
      window.setTimeout(() => {
        changeScale("page-fit");
      }, 500)

      //아이콘 변경 
      const scrollIcon = document.getElementsByClassName("setting__flow-page-")[0];
      scrollIcon.classList.add("setting__flow-page");
      scrollIcon.classList.remove("setting__flow-scroll");
    }

    // let moved = false;
    function addLeftRightTouchEventHandler() {
      window.removeEventListener("click", topBottomEventHandler);
      // window.addEventListener("mousedown", () => {
      //   moved = false;
      // });
      // window.addEventListener("mousemove", () => {
      //   moved = true;
      // });

      window.addEventListener("click", leftRightEventHandler)
    }

    function addTopBottomTouchEventHandler() {
      window.removeEventListener("click", leftRightEventHandler);
      // window.addEventListener("mousedown", () => {
      //   moved = false;
      // });
      // window.addEventListener("mousemove", () => {
      //   moved = true;
      // });
      window.addEventListener("click", topBottomEventHandler)
    }
    function topBottomEventHandler(e) {
      // if (moved) return;
      let documentHeight = document.documentElement.clientHeight;
      let documentWidth = document.documentElement.clientWidth;

      let nextArea = documentHeight - documentHeight * 3 / 10;
      let prevArea = documentHeight * 3 / 10;
      if (currentScrollMode == "scroll") {

        toggleTopBottomMenu();
      }
      else {
        if (e.clientY > nextArea) {
          swipeRight();
        }
        else if (e.clientY < prevArea) {
          swipeLeft();
        }
        else {
          toggleTopBottomMenu();
        }
      }
    }

    function leftRightEventHandler(e) {
      // if (moved) return;
      let documentHeight = document.documentElement.clientHeight;
      let documentWidth = document.documentElement.clientWidth;

      let nextArea = documentWidth - documentWidth * 3 / 10;
      let prevArea = documentWidth * 3 / 10;
      if (currentScrollMode == "scroll") {
        //invoke 메뉴 띄우기
        toggleTopBottomMenu();
      }
      else {
        if (e.clientX > nextArea) {
          swipeRight();
        }
        else if (e.clientX < prevArea) {
          swipeLeft();
        }
        else {
          //invoke 메뉴 띄우기
          toggleTopBottomMenu();
        }
      }
    }

    // left: 37, up: 38, right: 39, down: 40,
    // spacebar: 32, pageup: 33, pagedown: 34, end: 35, home: 36
    var keys = { 37: 1, 38: 1, 39: 1, 40: 1 };

    function preventDefault(e) {
      e.preventDefault();
    }

    function preventDefaultForScrollKeys(e) {
      if (keys[e.keyCode]) {
        preventDefault(e);
        return false;
      }
    }

    // modern Chrome requires { passive: false } when adding event
    var supportsPassive = false;
    try {
      window.addEventListener("test", null, Object.defineProperty({}, 'passive', {
        get: function () { supportsPassive = true; }
      }));
    } catch (e) { }

    var wheelOpt = supportsPassive ? { passive: false } : false;
    var wheelEvent = 'onwheel' in document.createElement('div') ? 'wheel' : 'mousewheel';

    // call this to Disable
    function disableScroll() {
      window.addEventListener('DOMMouseScroll', preventDefault, false); // older FF
      window.addEventListener(wheelEvent, preventDefault, wheelOpt); // modern desktop
      window.addEventListener('touchmove', preventDefault, wheelOpt); // mobile
      window.addEventListener('keydown', preventDefaultForScrollKeys, false);
    }

    // call this to Enable
    function enableScroll() {
      window.removeEventListener('DOMMouseScroll', preventDefault, false);
      window.removeEventListener(wheelEvent, preventDefault, wheelOpt);
      window.removeEventListener('touchmove', preventDefault, wheelOpt);
      window.removeEventListener('keydown', preventDefaultForScrollKeys, false);
    }
    //#endregion

    //#region 뷰포트 변경
    function changeViewport(isUserScale) {
      let viewport = document.querySelector("meta[name=viewport]");
      let content;
      if (!viewport) {
        let viewport = document.createElement("meta");
        viewport.name = "viewport";
        document.getElementsByTagName("head")[0].appendChild(viewport);
      }
      if (isUserScale) {
        content = "width=device-width, height=device-height, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=3.0"
      }
      else {
        content = "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=3.0"
      }
      viewport.setAttribute("content", content);
    }
    window.addEventListener("resize", function () {
      //리사이즈할때 이상한 화면 나와서 여기서함
      document.getElementById("div-loading").classList.add("show");
    })
    //#endregion

    //#region modal controll

    //#region 보기설정
    function openSettingModal() {
      closeModal();
      let setting = document.getElementById("modal-setting");
      fadeIn(setting);
      // setting.style.display = "block";
      setting.classList.add("action-buttons__button__on");
      setting.classList.remove("action-buttons__button__off");
    }

    function closeSettingModal() {
      let setting = document.getElementById("modal-setting");
      // fadeOut(setting);
      setting.style.display = "none";
      setting.classList.remove("action-buttons__button__on");
      setting.classList.add("action-buttons__button__off");
      closeModalDetail();
    }

    function toggleSettingModal() {
      let setting = document.getElementById("modal-setting");
      if (setting.style.display == "none") {
        openSettingModal();
      }
      else {
        closeSettingModal();
      }
    }
    //#endregion

    //#region 위아래 메뉴
    function openTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");
      let bottomMenu = document.getElementById("footer-ebook");
      topMenu.classList.remove("header--folded");
      topMenu.classList.add("header--fixed");
      bottomMenu.classList.remove("controller--folded");
      bottomMenu.classList.add("controller--fixed");

      // openSettingModal();
    }

    function closeTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");
      let bottomMenu = document.getElementById("footer-ebook");
      topMenu.classList.add("header--folded");
      topMenu.classList.remove("header--fixed");
      bottomMenu.classList.add("controller--folded");
      bottomMenu.classList.remove("controller--fixed");

      closeSettingModal();
    }

    function toggleTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");

      if (topMenu.classList.contains("header--folded")) {
        openTopBottomMenu();
      }
      else if (topMenu.classList.contains("header--fixed")) {
        closeTopBottomMenu();
      }

    }
    //#endregion

    //#region input range 처리
    let inputs = document.getElementsByClassName("setting__range");
    for (let i = 0; i < inputs.length; i++) {
      inputs[i].addEventListener("input", function () {
        var val = (this.value - this.min) / (this.max - this.min);

        this.style.backgroundImage = '-webkit-gradient(linear, left top, right top, '
          + 'color-stop(' + val + ', #F4CD43), '
          + 'color-stop(' + val + ', #E9E9E9)'
          + ')'
      })
    }

    progressBar.addEventListener("input", function () {
      var val = (this.value - this.min) / (this.max - this.min);
      this.style.backgroundImage = '-webkit-gradient(linear, left top, right top, '
        + 'color-stop(' + val + ', #878787), '
        + 'color-stop(' + val + ', #E9E9E9)'
        + ')'
    })
    progressBar.addEventListener("change", function (current) {
      moveToPage(this.value);

    });
    //#endregion

    //#region 한쪽보기 두쪽보기 버튼
    const oneViewButton = document.getElementById("oneviewButton");
    const twoViewButton = document.getElementById("twoviewButton");

    oneViewButton.addEventListener("click", function () {
      oneViewButton.classList.add("page-mode__button--active");
      twoViewButton.classList.remove("page-mode__button--active");
      changeSpreadMode(APP_EVENT.SPREAD.NONE);

      manageSetting("013", APP_EVENT.SPREAD.NONE.toString());
    })

    twoViewButton.addEventListener("click", function () {
      oneViewButton.classList.remove("page-mode__button--active");
      twoViewButton.classList.add("page-mode__button--active");
      changeSpreadMode(APP_EVENT.SPREAD.ODD);
      manageSetting("013", APP_EVENT.SPREAD.ODD.toString());
    })

    // function disableSpread() {
    //   oneViewButton.classList.remove("page-mode__button--active");
    //   twoViewButton.classList.remove("page-mode__button--active");

    //   oneViewButton.disabled = true;
    //   twoViewButton.disabled = true;
    //   oneViewButton.setAttribute("title", "스크롤 보기 중에는 사용할 수 없습니다.");
    //   twoViewButton.setAttribute("title", "스크롤 보기 중에는 사용할 수 없습니다.");
    // }
    // function enableSpread() {
    //   oneViewButton.classList.add("page-mode__button--active");
    //   // twoViewButton.classList.remove("page-mode__button--active");

    //   oneViewButton.disabled = false;
    //   twoViewButton.disabled = false;
    //   oneViewButton.removeAttribute("title");
    //   twoViewButton.removeAttribute("title");
    // }
    //#endregion

    //options [{label, value}]
    function openSelectModal() {
      //이전 모달 지움
      // closeModal();
      closeModalDetail();
      let paddingY = 10;
      let args = Array.from(arguments);
      let stringArgs = args.filter((x) => {
        if (typeof (x) == 'string') {
          return x;
        }
      });
      let buttonArgs = args.find((x) => {
        if (Object.prototype.toString.call(x) == "[object HTMLButtonElement]") {
          return x;
        }
      })
      let changeEventArgs = args.find((x) => {
        if (typeof (x) == "function") {
          return x;
        }
      })
      let div = document.createElement("div");
      div.classList.add("menu-more__container");
      let ul = document.createElement("ul");
      ul.classList.add("menu-more");
      ul.classList.add("menu-more--sm");
      let li;
      let button;
      for (let i = 0; i < stringArgs.length; i++) {
        li = document.createElement("li");
        button = document.createElement("button");
        li.classList.add("menu-more__item");
        button.classList.add("menu-more__button");
        button.innerHTML = stringArgs[i];
        button.addEventListener("click", function (e) {
          switch (stringArgs[i]) {
            case "스크롤": changeScrollMode();
              break;
            case "페이지":

              changePageMode();
              break;
            case "원본": changePageMode();
              break;
          }
          document.body.removeChild(div);
          buttonArgs.innerHTML = stringArgs[i];
        })
        li.appendChild(button);
        ul.appendChild(li);
      }

      div.appendChild(ul);

      let evt = args.find((x) => {
        if (Object.prototype.toString.call(x) == "[object PointerEvent]" || Object.prototype.toString.call(x) == "[object MouseEvent]") {
          return x;
        }
      })
      div.style.position = "absolute";
      div.style.left = evt.clientX + "px";
      div.style.top = evt.clientY + paddingY + "px";
      div.style.zIndex = 30;
      document.body.appendChild(div);

      evt.preventDefault();
      evt.stopPropagation();
      // div.addEventListener("focusout", function(){
      //   document.body.removeChild(div);
      // })

    }

    //파라미터 데이터 { text, handler, evt}
    function openSelectModalInReadingNote() {

      let paddingY = 10;
      let args = Array.from(arguments);

      let div = document.createElement("div");
      div.classList.add("menu-more__container");
      let ul = document.createElement("ul");
      ul.classList.add("menu-more");
      ul.classList.add("menu-more--sm");
      for (let i = 0; i < args.length; i++) {
        li = document.createElement("li");
        button = document.createElement("button");
        li.classList.add("menu-more__item");
        button.classList.add("menu-more__button");
        button.innerHTML = args[i].text;
        button.addEventListener("click", (evt) => {
          evt.stopPropagation();
          args[i].handler();

          document.body.removeChild(div);
        })
        li.appendChild(button);
        ul.appendChild(li);
      }
      div.appendChild(ul);

      div.style.position = "absolute";
      div.style.left = args[0].evt.clientX + "px";
      div.style.top = args[0].evt.clientY + paddingY + "px";
      div.style.zIndex = 30;
      document.body.appendChild(div);

      args[0].evt.preventDefault();
      args[0].evt.stopPropagation();
    }

    function closeModal() {
      let modals = document.getElementsByClassName("modal-parent");
      for (let i = 0; i < modals.length; i++) {
        modals[i].style.display = "none";
      }

      // let settingModal = document.getElementsByClassName("setting");
      // for (let i = 0; i < settingModal.length; i++) {
      //   settingModal[i].style.display = "none";
      // }
    }
    function closeModalDetail() {
      let modalSelect = document.getElementsByClassName("menu-more__container");
      for (let i = 0; i < modalSelect.length; i++) {
        document.body.removeChild(modalSelect[i]);
      }
    }

    function openChapterList() {
      closeModal();
      fadeIn(document.getElementById("modal-chapter"));
      // document.getElementById("modal-chapter").style.display = "block";

      getCurrentChapter().then(function (data) {
        if (!data) return;
        const div = document.getElementById("modal-chapter-item-frame");
        for (let i = 0; i < div.children.length; i++) {
          div.children[i].style.backgroundColor = "";
          if (div.children[i].getAttribute("order") == data.order) {
            div.children[i].style.backgroundColor = "LightGray";
          }
        }
      })
    }

    function closeChapterList() {
      // fadeOut(document.getElementById("modal-chapter"));
      document.getElementById("modal-chapter").style.display = "none";
    }

    function closeReadingNote() {
      // fadeOut(document.getElementById("modal-note"));
      document.getElementById("modal-note").style.display = "none";
    }
    function openReadingNote() {
      closeModal();
      let parentSection = document.getElementById("section-reading-note");
      parentSection.innerHTML = "";
      let template = document.createElement("template");

      httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo }).then(function (bookmark) {
        bookmarkList = [];
        for (let item of bookmark) {
          bookmarkList.push(item);
        }

        if (bookmarkList && bookmarkList.length > 0) {
          for (let i = 0; i < bookmarkList.length; i++) {
            const removeFunc = function (e) {

              httpPost("removebookmark", { BookNo: _bookNo, MemberNo: _memberNo, BookMarkPositionValue: bookmarkList[i].BookMarkPositionValue }).then((data) => {
                if (data < 1) {
                  alert("삭제 실패 관리자에게 문의하세요");
                }
                else {
                  const temp = Number(bookmarkList[i].BookMarkPositionValue) == PDFViewerApplication.pdfViewer.currentPageNumber;
                  if (temp) {
                    changeBookmarkStatus();
                  }

                  //북마크 가져오기 
                  bookmarkList = [];
                  httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo }).then(function (bookmark) {
                    for (let j = 0; j < bookmark.length; j++) {
                      bookmarkList.push(bookmark[j]);
                    }
                    closeModal();
                    window.setTimeout(() => {
                      openReadingNote();
                    }, 300);

                  })
                }
              })
            }


            let ele = `<div class="note-item" onclick="moveToPage(${(bookmarkList[i].BookMarkPositionValue)}); document.getElementById('modal-note').style.display = 'none'; ">
          <div class="note-item__label">
            <button type="button" onclick="">
              <img src="./images/ico-bookmark.svg"/></button>
          </div>
          <div class="note-item__content">
            <p>${bookmarkList[i].BookMarkTableContent}</p>
            <div class="modal-content__bottom">
              <ul class="modal-content__info">
                <li>${bookmarkList[i].BookMarkPage}페이지</li>
                <li>${noteDateFormatting(bookmarkList[i].BookMarkDatetime)}</li>
              </ul>
              <button type="button" class="button-more" onclick=""></button>
            </div>
          </div>
        </div>`;
            template.innerHTML = ele;
            template.content.firstChild.getElementsByClassName("button-more")[0].addEventListener("click", function (evt1) {
              evt1.stopPropagation();
              openSelectModalInReadingNote({ text: "삭제", handler: removeFunc, evt: evt1 })
            })
            parentSection.appendChild(template.content.firstChild);
          }
        }
        else {
          const template = document.createElement("template");
          const ele = `<div class="modal-empty" style="height:480px">
          <img src="./images/empty_note.svg" alt="empty" width="50">
            <p>아직 남겨진 독서 노트가 없습니다.</p>
          </div>`;
          template.innerHTML = ele;
          parentSection.appendChild(template.content.cloneNode(true));
        }


        fadeIn(document.getElementById("modal-note"));
      })

      // document.getElementById("modal-note").style.display = "block";
    }

    async function bindChapter() {
      let chapter = await getChapter();
      let div;
      let strong;
      let span;
      if (chapter.length > 0) {
        for (let i = 0; i < chapter.length; i++) {
          div = document.createElement("div");
          strong = document.createElement("strong");
          span = document.createElement("span");
          div.classList.add("chapter-item");
          div.onclick = function () {
            moveToPage(chapter[i].page);
            closeChapterList();
          };
          div.setAttribute("order", i);
          strong.classList.add("chapter-item__title");
          strong.classList.add("ellipsis-1");
          if (chapter[i].firstDepth) {
            strong.style.paddingLeft = "10px";
          }
          else {
            strong.style.fontWeight = "bolder";
          }

          strong.innerHTML = chapter[i].label;
          // strong.style.width = "80%";
          strong.style.display = "inline";
          span.style.marginLeft = "20px";
          span.classList.add("chapter-item__page");
          span.innerHTML = chapter[i].page + "p";
          span.style.float = "right";
          div.appendChild(span);
          div.appendChild(strong);
          document.getElementById("modal-chapter-item-frame").appendChild(div);
        }
      }
      else {
        const emptyEle = `<div class="modal-empty">
            <img src="./images/empty_note.svg" alt="empty" width="50">
            <p>목차가 없는 책입니다.</p>
          </div>`;
        const template = document.createElement("template");
        template.innerHTML = emptyEle;
        document.getElementById("modal-chapter-item-frame").innerHTML = "";
        document.getElementById("modal-chapter-item-frame").appendChild(template.content.cloneNode(true));
      }

    }

    async function getCurrentChapter() {
      let chapter = await getChapter(false);
      if (chapter && chapter.length > 0) {
        let currentChapter = chapter[chapter.length - 1];
        currentChapter.order = chapter.length - 1;
        for (let i = 0; i < chapter.length; i++) {
          if (chapter[i].page == PDFViewerApplication.pdfViewer.currentPageNumber) {
            currentChapter = chapter[i];
            currentChapter.order = i;
            break;
          }
          else if (PDFViewerApplication.pdfViewer.spreadMode == 2 && chapter[i].page == PDFViewerApplication.pdfViewer.currentPageNumber + 1) {
            currentChapter = chapter[i];
            currentChapter.order = i;
            break;
          }
          else if (chapter[i].page > PDFViewerApplication.pdfViewer.currentPageNumber) {
            if (i == 0) {
              currentChapter = {};
            }
            else {
              currentChapter = chapter[i - 1];
            }
            // currentChapter = chapter[i - 1];
            currentChapter.order = i - 1;
            break;
          }
        }
        return currentChapter;
      }
      return null;
    }

    function bookmarkButtonClick() {
      let btn = document.getElementById("button-bookmark");

      if (btn.classList.contains("action-buttons__button--off")) {
        btn.classList.remove("action-buttons__button--off");
        btn.classList.add("action-buttons__button--on");
        btn.getElementsByTagName("img")[0].src = "./images/bookmark_on.svg";
        addBookmark();
      }
      else if (btn.classList.contains("action-buttons__button--on")) {
        btn.classList.remove("action-buttons__button--on");
        btn.classList.add("action-buttons__button--off");
        btn.getElementsByTagName("img")[0].src = "./images/bookmark.svg";
        removeBookmark();
      }
    }
    function changeBookmarkStatus() {
      let btn = document.getElementById("button-bookmark");
      if (btn.classList.contains("action-buttons__button--off")) {
        btn.classList.remove("action-buttons__button--off");
        btn.classList.add("action-buttons__button--on");
        btn.getElementsByTagName("img")[0].src = "./images/bookmark_on.svg";
        bookmark.style.opacity = 1;
      }
      else {
        btn.classList.add("action-buttons__button--off");
        btn.classList.remove("action-buttons__button--on");
        btn.getElementsByTagName("img")[0].src = "./images/bookmark.svg";
        bookmark.style.opacity = 0;
      }

    }


    // window.addEventListener("load", function () {
    //   getCommonCodeByGroupCode({ GroupCode: "V01" }).then(function (data) {
    //     const ul = document.getElementById("highlight-setting");
    //     ul.innerHTML = "";
    //     for (let i = 0; i < data.length; i++) {
    //       let li = `<li>
    //         <button type="button" class="color-label size-28 highlight__button" style="background-color:${data[i].ExtraField1}; border-color:${data[i].ExtraField2}"></button>
    //       </li>`;
    //       let template = document.createElement("template");
    //       template.innerHTML = li;
    //       // template.content.firstChild.style.backgroundColor = data[i].ExtraField1;
    //       // template.content.firstChild.style.borderColor = data[i].ExtraField2;
    //       template.content.firstChild.addEventListener("click", function () {
    //         document.body.style.backgroundColor = data[i].ExtraField1;
    //         document.getElementById("div-loading").style.backgroundColor = data[i].ExtraField1;
    //       })
    //       ul.appendChild(template.content.firstChild);
    //     }


    //   })
    // })
    // window.addEventListener("load", function(){
    //   var findbar = document.getElementsByClassName("findbar");
    //   findbar[0].style.top = top;
    // })

    async function prevChapter() {
      const chapters = await getChapter();
      let currentChapter = await getCurrentChapter();
      if (currentChapter) {
        if (currentChapter.order > 0) {
          let prevChapter = chapters[currentChapter.order - 1];
          if (prevChapter.page == PDFViewerApplication.pdfViewer.currentPageNumber) {
            prevChapter = chapters[currentChapter.order - 2];
          }
          moveToPage(prevChapter.page);
        }
      }
    }

    async function nextChapter() {
      const chapters = await getChapter();
      let currentChapter = await getCurrentChapter();
      if (currentChapter) {
        if (currentChapter.order < chapters.length - 1) {
          let prevChapter = chapters[currentChapter.order + 1];
          if (prevChapter.page == PDFViewerApplication.pdfViewer.currentPageNumber) {
            prevChapter = chapters[currentChapter.order + 2];
          }
          moveToPage(prevChapter.page);
        }
      }
    }

    function resetSetting() {
      changeBackground("");

    }

    function removeBookmarkInNote(loc) {
      httpPost("removeBookmark", {
        MemberNo: _memberNo,
        BookNo: _bookNo,
        BookMarkPositionValue: loc,
      }).then(function (result) {
        if (result < 1) {
          alert("북마크 삭제 실패 관리자에게 문의바랍니다.");
        } else {
          if (loc == PDFViewerApplication.pdfViewer.currentPageNumber) {
            removeBookmark();
          }
        }
      });
    }

    const modals = document.getElementsByClassName("modal-parent");
    for (let modal of modals) {
      modal.addEventListener("click", function (e) {
        closeModal();
        closeModalDetail();
        e.stopPropagation();
        e.preventDefault();
      });
    }

    /* #region 리뷰 */
    function openReviewModal() {
      document.getElementById("span-review-length").innerHTML = "0";
      document.getElementById("textarea-review").value = '';
      document.getElementById("input-star").value = 5;
      for (let star of document.getElementsByClassName("stars--primary")[0].getElementsByTagName("img")) {
        star.src = './images/stars/star_primary_full.svg';
      }
      document.getElementById("text-starpoint").innerHTML = "내 별점 5점";
      closeModal();
      const modal = document.getElementById("modal-review");
      fadeIn(modal);
      getReview(_contentNo, getCookie("utc_time"), _memberNo).then(function (data) {
        // httpGet("GetContentFeedbackList", { ContentNo: _bookNo }).then(function (data) {
        document.getElementById("ul-review").innerHTML = "";
        document.getElementById("div-mine").innerHTML = "";

        document.getElementById("div-mine").style.display = "none";
        document.getElementById("div-write-review").style.display = "block";

        let average = data.average;
        let i = 0;
        let writeBefore = false;
        if (data.comments && data.comments.length > 0) {
          for (let item of data.comments) {
            if (item.user.id == _memberNo) {
              writeBefore = true;
              document.getElementById("div-mine").style.display = "block";
              document.getElementById("div-write-review").style.display = "none";

              let profileImage = "./images/profile.svg";
              if (item.user.avatar) {
                profileImage = item.user.avatar;
              }
              let ele = `<div class="review-item__header">
                <div class="row">
                  <div class="thumbnail">
                    <img src="${profileImage}" alt="홍길동">
                  </div>
                  <div class="row review-item__name">
                    <b>${item.user.name}</b>님
                  </div>
                  <div class="review-item__date">
                      ${(item.date)}
                  </div>
                </div>
                <div class="row">
                  <div class="stars--primary small">
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                  </div>
                </div>
              </div>
              <div id="div-review-content" class="review-item__content"><pre>${item.content}</pre></div>

              <div class="my-review__buttons">
                <button class="my-review__button edit" onclick=modifyReview(${item.id})>
                  <img alt="수정" src="./images/review_edit.svg"  />
                  수정
                </button>

                <button class="my-review__button remove" onclick="removeReview(${item.id})">
                  <img alt="삭제" src="./images/review_remove.svg" />
                  삭제
                </button>
              </div>`;

              let template = document.createElement("template");
              template.innerHTML = ele;
              document.getElementById("div-mine").appendChild(template.content.cloneNode(true));

              setStar(document.getElementById("div-mine"), item.rating);
              document.getElementById("div-mine").setAttribute("starPoint", item.rating);
              // average += Number(item.StarPoint);
              continue;
            }

            let profileImage = "./images/profile.svg";
            if (item.user.avatar) {
              profileImage = item.user.avatar;
            }
            let ele = `<li>
              <div class="review-item">
                <div class="review-item__inner">
                  <div class="review-item__header">
                    <div class="row">
                      <div class="thumbnail">
                        <img src="${profileImage}" alt="">
                      </div>
                      <div class="row review-item__name">
                        <b>${item.user.name}</b>님
                      </div>
                      <div class="review-item__date">
                        ${(item.date)}
                      </div>
                    </div>
                    <div class="row">          
                      <div class="stars--primary small">
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_half.svg" alt="">
                                    </button>
                                  </div>
                    </div>
                  </div>
                  <div class="review-item__content">${item.content}</div>
                    <div class="modal-content__bottom" style="float:right;"><button class="button-more" onclick="reviewDetailModal(event, ${item.user.id}, ${item.id},'${item.user.name}')"></button></div>
                </div>
              </div>
              <span class="dashed"></span>
            </li>`;
            let template = document.createElement("template");
            template.innerHTML = ele;
            document.getElementById("ul-review").appendChild(template.content.cloneNode(true));

            setStar(document.getElementById("ul-review").children[i], item.rating);

            if (writeBefore) {
              document.getElementById("div-mine").display = "none";
              document.getElementById("div-write-review").display = "block";
            }
            else {
              document.getElementById("div-mine").display = "block";
              document.getElementById("div-write-review").display = "none";
            }
            i++;
            // average += Number(item.StarPoint);
          }
        }

        if (!data.comments || data.comments.length == 0) {
          document.getElementById("div-review-average").innerHTML = 0;
        }
        else {
          document.getElementById("div-review-average").innerHTML = average;
        }

        const averageStars = document.getElementById("div-review-average-stars").getElementsByTagName("img");

        for (let star of averageStars) {
          star.src = './images/stars/star_average_0.svg';
        }
        const star100 = Math.floor(document.getElementById("div-review-average").innerHTML);
        for (let i = 0; i < star100; i++) {
          averageStars[i].src = "./images/stars/star_average_100.svg";
        }
        if (document.getElementById("div-review-average").innerHTML > 1) {
          if (star100 != 5) {
            if (Math.round((document.getElementById("div-review-average").innerHTML - star100) * 10) == 0) {
              averageStars[star100].src = `./images/stars/star_average_0.svg`;;
            }
            else {
              averageStars[star100].src = `./images/stars/star_average_${Math.round((document.getElementById("div-review-average").innerHTML - star100) * 10)}0.svg`;
            }
          }
        }


        if (writeBefore == true) {
          document.getElementById("div-mine").style.display = "block";
          document.getElementById("div-write-review").style.display = "none";
        }
        else {
          document.getElementById("div-mine").style.display = "none";
          document.getElementById("div-write-review").style.display = "block ";
        }

      })
      document.getElementById("btn-review-modify").style.display = "none";
      document.getElementById("btn-review-register").style.display = "block";
    }

    function setStar(ele, starPoint) {
      const halfStarImageSource = "./images/stars/star_primary_half.svg";
      const starImageSource = "./images/stars/star_primary_full.svg";
      const zeroStarImageSource = "./images/stars/star_primary_zero.svg";
      const stars = ele.getElementsByClassName("star");
      for (let star of stars) {
        star.getElementsByTagName("img")[0].src = zeroStarImageSource;
      }

      let j = 0;
      for (j = 0; j < starPoint; j++) {
        stars[j].getElementsByTagName("img")[0].src = starImageSource;

      }
      if (Number.isInteger(parseFloat(starPoint)) == false) {
        stars[j - 1].getElementsByTagName("img")[0].src = halfStarImageSource;
      }
    }

    function changeStar(sender) {
      const halfStarImageSource = "./images/stars/star_primary_half.svg";
      const starImageSource = "./images/stars/star_primary_full.svg";
      const zeroStarImageSource = "./images/stars/star_primary_zero.svg";

      const div = document.getElementById("div-write-review")
      stars = div.getElementsByClassName("star");

      for (let star of stars) {
        star.getElementsByTagName("img")[0].src = zeroStarImageSource;
      }
      const starPoint = sender.value;

      let i = 0;
      for (i = 0; i < starPoint; i++) {
        stars[i].getElementsByTagName("img")[0].src = starImageSource;
      }
      if (Number.isInteger(parseFloat(starPoint)) == false) {
        stars[i - 1].getElementsByTagName("img")[0].src = halfStarImageSource;
      }

      document.getElementById("text-starpoint").innerHTML = "내 별점 " + starPoint + "점";
    }

    function fixRangePosition(sender, evt) {
      const scrollTop = sender.scrollTop;
      const input = document.getElementById("input-star");
      input.style.transform = "translate(0, -" + scrollTop + "px)";
    }

    function registerReview() {
      if (document.getElementById("textarea-review").value.trim().length == 0) {
        alert("리뷰를 입력해 주세요.");
        return;
      }
      httpPost("addContentFeedbackByMember", {
        MemberNo: _memberNo, ContentNo: _bookNo,
        ReviewText: document.getElementById("textarea-review").value,
        StarPoint: document.getElementById("input-star").value,
        PublishYN: "Y"
      }).then(function () {
        openReviewModal();
      })
    }
    function modifyReview(ContentFeedbackNo) {
      document.getElementById("textarea-review").value = document.getElementById("div-review-content").getElementsByTagName("pre")[0].innerHTML;
      document.getElementById("input-star").value = document.getElementById("div-mine").getAttribute("starPoint");
      setStar(document.getElementById("div-write-review"), document.getElementById("div-mine").getAttribute("starPoint"));
      document.getElementById("text-starpoint").innerHTML = "내 별점 " + document.getElementById("div-mine").getAttribute("starPoint") + "점"
      document.getElementById("div-mine").setAttribute("ContentFeedbackNo", ContentFeedbackNo);
      document.getElementById("div-mine").style.display = "none";
      document.getElementById("div-write-review").style.display = "block";
      document.getElementById("btn-review-modify").style.display = "block";
      document.getElementById("btn-review-register").style.display = "none";

      changeReviewTextLength();
    }

    function modifyReviewCancel() {

      // document.getElementById("div-mine").style.display = "block";
      // document.getElementById("div-write-review").style.display = "none";

      // document.getElementById("btn-review-modify").style.display = "none";
      // document.getElementById("btn-review-register").style.display = "block";

      document.getElementById("modal-review").style.display = "none";
    }

    function modifyReviewComplete() {
      if (document.getElementById("textarea-review").value.trim().length == 0) {
        alert("리뷰를 입력해 주세요.");
        return;
      }
      httpPost("ModifyContentFeedbackByMember", {
        ContentFeedbackNo: document.getElementById("div-mine").getAttribute("ContentFeedbackNo"),
        ReviewText: document.getElementById("textarea-review").value,
        StarPoint: document.getElementById("input-star").value,
        PublishYN: "Y"
      }).then(function () {
        openReviewModal();
      })
    }

    function removeReview(contentFeedbackNo) {
      if (confirm("삭제하시겠습니까?")) {
        httpPost("removeContentFeedbackByMember", { "ContentFeedbackNo": contentFeedbackNo }).then(function (data) {
          if (data) {
            openReviewModal();
          }
          else {
            alert("삭제 실패 관리자에게 문의하세요.")
          }
        });
      }
    }

    function reviewDetailModal(e, memberNo, reviewNo, targetNickname) {
      const ele = `<div class="menu-more__container" style="position: absolute; left:${e.clientX}px; top:${e.clientY}px; z-index: 30;">
      <ul class="menu-more menu-more--sm">
      <li class="menu-more__item"><button onclick="reviewReportClick('${targetNickname}',${reviewNo})" class="menu-more__button">신고</button></li>
      <li class="menu-more__item"><button onclick="reviewBlockClick('${memberNo}',${reviewNo})" class="menu-more__button">차단</button></li>
      </ul></div>`;

      const template = document.createElement("template");
      template.innerHTML = ele;

      document.body.appendChild(template.content.cloneNode(true));

      e.stopPropagation();
    }

    function reviewBlockClick(memberNo, reviewNo) {
      if (confirm("차단하시겠어요?")) {
        blockUser(_memberNo, memberNo).then(function (data) {
          if (Number(data) > 0) {
            alert("차단되었습니다");
            openReviewModal();
          }
        });
      }
    }

    function reviewReportClick(memberNo, reviewNo) {
      //reset controll
      document.getElementById("option-report").selectedIndex = 0;
      document.getElementById("textarea-report").value = "";
      document.getElementById("div-report-text").style.display = "none";
      //
      fadeIn(document.getElementById("modal-report"));
      document.getElementById("modal-report").setAttribute("contentFeedbackNo", reviewNo);
      document.getElementById("modal-report").setAttribute("nickname", memberNo);
    }

    document.getElementById("textarea-review").addEventListener("input", function (e) {
      document.getElementById("span-review-length").innerHTML = e.target.value.length;
    })
    function changeReviewTextLength() {
      document.getElementById("span-review-length").innerHTML = document.getElementById("textarea-review").value.length;
    }
    /* #endregion */


    /* #region 세팅 저장, 불러오기  */
    function getSetting() {
      let param = {};
      param.MemberNo = _memberNo;
      httpGet("GetSetting", param).then(function (data) {
        for (let i = 0; i < data.length; i++) {
          applySetting(data[i].SettingValueKineCode, data[i].SettingValue);
        }
      })
    }

    function applySetting(code, value) {
      switch (code) {
        case '011':
          changeBackground(value)
          break;

        case '012':
          if (value == "scrolled") {
            changeScrollMode();
          }
          else {
            changePageMode();
          }
          break;

        case '013':
          if (value == APP_EVENT.SPREAD.NONE) {
            oneViewButton.click();
          }
          else if (value == APP_EVENT.SPREAD.ODD) {
            twoViewButton.click();
          }
      }
    }

    function manageSetting(code, value) {
      let param = {};
      param.MemberNo = _memberNo;
      param.Code = code;
      param.Value = value;
      httpPost("ManageSetting", param).then(function (data) {
        if (data > 0) {

        }
        else {
          alert("설정 등록 실패");
        }
      })
    }

    function removeSetting(code) {
      let param = {};
      param.MemberNo = _memberNo;
      param.Code = code;
      httpPost("RemoveSetting", param).then(function (data) {
        if (data > 0) {

        }
        else {
          // alert("설정 등록 실패");
        }
      })
    }
    /* #endregion */

    // window.visualViewport.addEventListener("resize", (e) => {
    //   alert("test");
    // })

    //마지막페이지 이벤트 시작=============================================
    let scrollLast = false;
    document.getElementById("viewerContainer").addEventListener("scroll", () => {
      if (loadingIndicator) return;
      if (!scrollLast) {

        if ((window.innerHeight + document.getElementById("viewerContainer").scrollTop) >= document.getElementById("viewerContainer").scrollHeight) {
          scrollLast = true;

          if (_completeReadYN == "N") {

            if (confirm("마지막 페이지 입니다. 완독하셨습니까?")) {
              httpPost("ModifyCompleteRead", { ContentNo: _contentNo, MemberNo: _memberNo }).then(function (data) {
                if (data > 0) {
                  _completeReadYN = "Y";
                }
              })
            }

          }
          else {
            alert("마지막 페이지입니다.");
          }
          setTimeout(function () {
            scrollLast = false;
          }, 3000)
        }
      }
    })
    //마지막페이지 이벤트 끝==============================================

    //신고하기 시작==========
    getValueByCodeGroupCode("N03").then(function (data) {
      for (let item of data) {
        const ele = `<option value=${item.code}>${item.codeNameKor}</option>`;
        const template = document.createElement("template");
        template.innerHTML = ele;
        document.getElementById("option-report").appendChild(template.content.cloneNode(true));

      }
    })

    document.getElementById("option-report").addEventListener("change", function (e) {
      if (e.target.value == "005") {
        document.getElementById("div-report-text").style.display = "block";
      }
      else {
        document.getElementById("div-report-text").style.display = "none";
      }
    })

    function reportComplete() {
      if (confirm(document.getElementById("modal-report").getAttribute("nickname") + "님의 리뷰를 신고할까요?")) {
        reportReview(document.getElementById("modal-report").getAttribute("contentFeedbackNo"), document.getElementById("option-report").value, document.getElementById("textarea-report").value, _memberNo).then(function (result) {
          if (result > 0) {
            alert("신고되었습니다.");
          }

          document.getElementById("modal-report").style.display = "none";
        })
      }

    }
    //신고하기 끝 ============


  </script>
</body>

</html>
