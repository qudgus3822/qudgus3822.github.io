<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, height=device-height, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>병현's 뷰어</title>
  <link href="//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="./css/common.css" />
  <link rel="stylesheet" href="./css/desktop-viewer.css" />

  <!-- //김병현 추가 -->
  <script src="jszpi.min.js"></script>
  <script src="../dist/epub.js"></script>
  <script src="adder.js"></script>
  <script src="common.js"></script>
  <!-- todo -->
  <!-- <script src=" timeme.min.js"></script> -->
  <link rel="stylesheet" type="text/css" href="./fonts.css" />
  <link rel="stylesheet" type="text/css" href="./hypothesis.css" />

  <style type="text/css">
    #prev {
      left: 0;
    }

    #next {
      right: 0;
    }

    .arrow {
      position: fixed;
      top: 50%;
      margin-top: -32px;
      font-size: 64px;
      color: #e2e2e2;
      font-family: arial, sans-serif;
      font-weight: bold;
      cursor: pointer;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
      text-decoration: none;
    }

    .arrow:hover {
      color: #777;
    }

    .arrow:active {
      color: #000;
    }

    #viewer {
      position: absolute;
    }

    #viewer.page {
      width: 100vw;
      height: 100vh;
      /* min-width: 100vw;
      min-height: 100vh; */
      padding: 0;
      /* position: relative; */
      top: 0;
    }

    #viewer.scroll {
      width: 100vw;
      height: 100vh;
      /* overflow: auto; */
      margin: 0 auto;
    }

    .epubjs-mk {
      content: url("http://placehold.it/350x150");
    }

    #div-loading.show {
      width: 100vw;
      height: 100vh;
      /* opacity: 0.3; */
      /* background-color: black; */
      display: block !important;
      overflow: hidden;

      /* 셀렉트 막기 */
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    /* The Modal (background) */
    .searchModal {
      display: none;
      /* Hidden by default */
      position: fixed;
      /* Stay in place */
      z-index: 10;
      /* Sit on top */
      left: 0;
      top: 0;
      width: 100%;
      /* Full width */
      height: 100%;
      /* Full height */
      overflow: auto;
      /* Enable scroll if needed */
      background-color: rgb(0, 0, 0);
      /* Fallback color */
      background-color: rgba(0, 0, 0, 0.4);
      /* Black w/ opacity */

      align-items: center;
      text-align: center;
    }

    .header__inner {
      width: 100vw;
    }

    .page-mode__button:disabled {
      border: #fff solid 1 px;
      background-color: #e1e1e1;
    }

    .modal-parent {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: none;
      /* background-color: rgba(0, 0, 0, 0.4); */
    }

    .header__title {
      width: calc(66% - 120px) !important;
    }

    .epub-view+.epub-view {
      margin-top: 5vh;
    }

    .color-label.on {
      border-color: var(--color-secondary);
      border-width: 2px;
    }

    .action-buttons {
      flex-shrink: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: flex-end !important;
      position: absolute !important;
      right: 10px !important;
      width: auto !important;
    }

    .header__title {
      flex-shrink: 0 !important;
      font-weight: 500 !important;
      font-size: 25px !important;
      position: absolute !important;
      left: 50px !important;
    }
  </style>
</head>

<body>
  <!-- header -->
  <!-- * header 접힘 클래스: header--folded-->
  <header id="header-ebook" class="header header--fixed">
    <!--<header class="header header--fixed header--folded"> -->
    <div class="header__inner">
      <button class="controller-button" onclick="window.location.replace(document.referrer)">
        <img src="./images/chapter_prev.svg" alt="뒤로가기" />
      </button>
      <h1 class="header__title ellipsis-1" id="h1-title">나단이 찾아온 날</h1>

      <div class="page-mode">
        <!-- * active 클래스: page-mode__button--active -->
        <button id="oneviewButton" class="
              page-mode__button
              page-mode__button--single
              page-mode__button--active
            ">
          <img src="./images/page_single.svg" alt="한 쪽 보기" />
        </button>
        <button id="twoviewButton" class="page-mode__button page-mode__button--double">
          <img src="./images/page_double.svg" alt="두 쪽 보기" />
        </button>
      </div>

      <ul class="action-buttons">
        <li>
          <button id="btn-chapter" class="action-buttons__button" onclick="openChapterList()">
            <img src="./images/menu_list.svg" alt="" class="action-buttons__icon" />
            <span class="action-buttons__text">목차</span>
          </button>
        </li>
        <li>
          <button class="action-buttons__button" onclick="openReadingNote()">
            <img src="./images/menu_note.svg" alt="" class="action-buttons__icon" />
            <span class="action-buttons__text">독서 노트</span>
          </button>
        </li>
        <li>
          <!--<button class="action-buttons__button action-buttons__button&#45;&#45;off">
              <img
                src="./images/menu_screensetting_on.svg"
                alt=""
                class="action-buttons__icon"
              >
              <span class="action-buttons__text">보기설정</span>
            </button>-->
          <button id="settingButton" class="action-buttons__button" onclick="openSettingModal()">
            <img src="./images/menu_screensetting.svg" alt="" class="action-buttons__icon" />
            <!-- <span class="action-buttons__text color-secondary">보기설정</span> -->
            <span class="action-buttons__text">보기 설정</span>
          </button>
        </li>
        <li>
          <button class="action-buttons__button" onclick="openReviewModal()">
            <img src="./images/menu_review.svg" alt="" class="action-buttons__icon" />
            <span class="action-buttons__text">리뷰</span>
          </button>
        </li>
        <li>
          <button class="action-buttons__button" onclick="openFindTextModal();">
            <img src="./images/menu_search.svg" alt="" class="action-buttons__icon" />
            <span class="action-buttons__text">검색</span>
          </button>
        </li>
        <li>
          <!--<button class="action-buttons__button action-buttons__button&#45;&#45;off">
              <img
                src="./images/bookmark__on.svg"
                alt=""
                class="action-buttons__icon"
              >
              <span class="action-buttons__text">북마크</span>
            </button>-->
          <button id="button-header-bookmark" class="action-buttons__button action-buttons__button--on">
            <img id="image-bookmark" src="./images/bookmark.svg" alt="" class="action-buttons__icon" />
            <span class="action-buttons__text">책갈피</span>
          </button>
        </li>
      </ul>
    </div>
  </header>

  <!-- main content -->
  <main class="content">
    <div class="content__container">
      <button id="button-content-bookmark" class="content__bookmark" style="opacity: 0; z-index: 9">
        <img src="./images/bookmark_lg.svg" alt="북마크" />
      </button>

      <div id="viewer"></div>
      <!-- <a id="prev" href="#prev" class="arrow">‹</a>
      <a id="next" href="#next" class="arrow">›</a> -->
    </div>

    <!-- controller -->
    <!-- * controller 접힘 클래스: controller--folded-->
    <div id="footer-ebook" class="controller controller--fixed">
      <!-- <div class="controller controller--fixed controller--folded"> -->
      <div class="page-slider">
        <div class="page-slider__text">
          <span id="label-progress" class="page-slider__text--current">0%</span>
          <!-- <span class="page-slider__text--total"> /301</span> -->
        </div>
      </div>
      <div class="range-slider range-slider--black">
        <!-- <span class="range-slider__bar"></span>
        <span class="range-slider__bar range-slider__bar--current" style="width: 7.3%"></span>
        <button class="range-slider__bar--pointer" style="left: 7.3%"></button> -->
        <input type="range" id="progress-bar" style="display: none;" disabled value=0; class="progress__range" />
      </div>
      <div class="controller-buttons">
        <button class="controller-button controller-button__back" onclick="if(prevPage != '')moveToPrevPage()">
          <img src="./images/back.svg" alt="" />
        </button>
        <button class="controller-button controller-button__prev" onclick="prevChapter();">
          <img src="./images/chapter_prev.svg" alt="이전 챕터" />
          이전 챕터
        </button>
        <button class="controller-button controller-button__next" onclick="nextChapter();">
          다음 챕터
          <img src="./images/chapter_next.svg" alt="다음 챕터" />
        </button>
      </div>
    </div>
  </main>

  <!-- //로딩창 -->
  <div id="div-loading" style="position: absolute;
        z-index: 9000;
        display: none;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
        text-align: center;
        align-items: center;
        top : 10px;" class="Background-1 show">
    <div style="margin: auto;top: 50%;left: 50%;position: absolute;transform: translate(-50%,-50%);">
   
      <span style="position: relative; margin: auto; text-align: center; font-size:min(1.5vh, 1.5vw); top : 10px;">정보를
        불러오고
        있습니다.</span>
    </div>
  </div>

  <!-- 보기설정 -->
  <div id="modal-setting" class="modal-parent">
    <div style="position: absolute; inset: 50% auto auto 50%; transform: translate(-50%, -50%);" class="setting modal">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onClick="closeSettingModal();">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>

      <section class="setting__section">
        <div class="setting__item setting__paint overflow-auto">
          <strong class="sc-only">배경색</strong>
          <ul class="highlight-setting">
            <li>
              <button type="button" name="Background-0" class="color-label highlight__button size-28 on"
                onClick="changeBackground('')" style="font-size:12px; line-height:1em; padding:0px;">
                원본
              </button>
            </li>
            <li>
              <button type="button" name="Background-1" class="color-label highlight__button Background-1 size-28"
                onClick="changeBackground('Background-1')"></button>
            </li>
            <li>
              <button type="button" name="Background-2" class="
                  color-label
                  highlight__button
                  Background-2
                  size-28
                " onClick="changeBackground('Background-2')"></button>
            </li>
            <li>
              <button type="button" name="Background-3" class="
                  color-label
                  highlight__button
                  Background-3
                  size-28
                " onClick="changeBackground('Background-3')"></button>
            </li>
            <li>
              <button type="button" name="Background-4" class="
                  color-label
                  highlight__button
                  Background-4
                  size-28
                " onClick="changeBackground('Background-4')"></button>
            </li>
            <li>
              <button type="button" name="Background-5" class="color-label highlight__button Background-5 size-28"
                onClick="changeBackground('Background-5')"></button>
            </li>
            <li>
              <button type="button" name="Background-6" class="
                  color-label
                  highlight__button
                  Background-6
                  size-28
                " onClick="changeBackground('Background-6')"></button>
            </li>


            <!-- <li>
            <button type="button" class="color-label highlight__button color-label--skyblue size-28"
              onClick="changeBackground('Background-7')"></button>
          </li> -->
          </ul>
        </div>
        <!-- <div class="setting__item setting__brightness">
        <strong class="sc-only">밝기</strong>
        <div class="range-slider">
          <span class="range-slider__bar"></span>
          <span class="range-slider__bar range-slider__bar--current" style="width: 34%"></span>
          <button class="range-slider__bar--pointer" style="left: 34%"></button>
        </div>
      </div> -->
      </section>

      <section class="setting__section">
        <div class="setting__item setting__font">
          <strong class="setting__title">글꼴</strong>
          <div class="setting__field">
            <button class="setting__more" id="btn-font"
              onclick="openSelectModal('원본', '코펍 바탕 L','코펍 바탕 M', '코펍 돋움','명조','본고딕' ,this, changeFont, event)">
              원본
            </button>
          </div>
        </div>

        <div class="setting__item setting__font-size">
          <strong class="setting__title">글자 크기</strong>
          <span class="setting__value" name="fontSize" id="span-font-size">원본</span>
          <div class="setting__field">
            <div style="width: 150px">
              <!-- <div class="range-slider">
              <span class="range-slider__bar"></span>
              <span class="range-slider__bar range-slider__bar--current" style="width: 100%"></span>
              <button class="range-slider__bar--pointer" style="left: 100%"></button>
            </div> -->
              <input type="range" id="range-font-size" value="0" min="0" step="1" max="10" class="setting__range"
                name="fontSize" />
            </div>
            <button class="setting__text-button" type="button" onclick="changeRangeBar(document.getElementById('range-font-size'),0);changeFontSize(''); highlightRedraw();
            document.getElementById('span-font-size').innerHTML='원본'">
              원본
            </button>
          </div>
        </div>
      </section>

      <section class=" setting__section">
        <div class="setting__item setting__line-height">
          <strong class="setting__title">줄 간격</strong>
          <span class="setting__value" name="lineHeight" id="span-line-height">원본</span>
          <div class="setting__field">
            <div style="width: 150px">
              <!-- <div class="range-slider">
              <span class="range-slider__bar"></span>
              <span class="range-slider__bar range-slider__bar--current" style="width: 34%"></span>
              <button class="range-slider__bar--pointer" style="left: 34%"></button>
            </div> -->
              <input type="range" id="range-line-height" value="0" min="0" step="1" max="6" class="setting__range"
                name="lineHeight" />
            </div>
            <button class="setting__text-button" type="button"
              onclick="changeRangeBar(document.getElementById('range-line-height'),0); changeLineHeight(''); highlightRedraw(); document.getElementById('span-line-height').innerHTML = '원본'">
              원본
            </button>
          </div>
        </div>

        <div class="setting__item setting__paragraph">
          <strong class="setting__title">문단 간격</strong>
          <span class="setting__value" name="paragraphHeight" id="span-paragraph-height">원본</span>
          <div class="setting__field">
            <div style="width: 150px">
              <!-- <div class="range-slider">
              <span class="range-slider__bar"></span>
              <span class="range-slider__bar range-slider__bar--current" style="width: 34%"></span>
              <button class="range-slider__bar--pointer" style="left: 34%"></button>
            </div> -->
              <input type="range" id="range-paragraph-height" value="0" min="0" step="1" max="6" class="setting__range"
                name="paragraphHeight" />
            </div>
            <button class="setting__text-button" type="button" onclick="changeRangeBar(document.getElementById('range-paragraph-height'),0);
               changeParagraphHeight('');
                highlightRedraw();
               document.getElementById('span-paragraph-height').innerHTML = '원본'">
              원본
            </button>
          </div>
        </div>

        <div class="setting__item setting__paragraph-width">
          <strong class="setting__title">문단 너비</strong>
          <span class="setting__value" name="paragraphWidth" id="span-paragraph-width">원본</span>
          <div class="setting__field">
            <div style="width: 150px">
              <!-- <div class="range-slider">
              <span class="range-slider__bar"></span>
              <span class="range-slider__bar range-slider__bar--current" style="width: 34%"></span>
              <button class="range-slider__bar--pointer" style="left: 34%"></button>
            </div> -->
              <input type="range" id="range-paragraph-width" value="0" min="0" step="1" max="6" class="setting__range"
                name="paragraphWidth" />
            </div>
            <button class="setting__text-button" type="button"
              onclick="changeRangeBar(document.getElementById('range-paragraph-width'),0); changeParagraphWidth(''); highlightRedraw();document.getElementById('span-paragraph-width').innerHTML = '원본'">
              원본
            </button>
          </div>
        </div>

        <div class="setting__item setting__paragraph-align">
          <strong class="setting__title">문단 정렬</strong>
          <div class="setting__field">
            <button class="setting__more" id="btn-align"
              onclick="openSelectModal('원본','왼쪽 정렬', '양쪽 정렬',this,changeAlign, event)">
              원본
            </button>
          </div>
        </div>

        <div class="setting__item setting__flow-page">
          <strong class="setting__title">넘김 설정</strong>
          <div class="setting__field">
            <button class="setting__more" id="btn-scroll"
              onclick="openSelectModal('페이지', '스크롤',this,changeScrolling, event)">
              페이지
            </button>
          </div>
        </div>
      </section>

      <div class="setting__bottom">
        <div class="row justify-between">
          <p style="margin-bottom: 13px; font-weight: 300; color: #999; font-size: 10px;">'스크롤 보기' 사용 시 두쪽 보기를 사용할 수
            없습니다.
          </p>

          <!-- <button class="button-user">사용자 설정으로 보기</button> -->
          <button class="button-reset" onclick="resetSetting()">
            <img src="./images/reset.svg" alt="" />
            <span> 설정 초기화 </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 목차 -->
  <div id="modal-chapter" class="modal-parent">
    <div class="modal" style="position: absolute; inset: 50% auto auto 50%;transform: translate(-50%, -50%);">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onClick="closeChapterList();">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>
      <div class="modal__title chapter__title">
        <h2>목차</h2>
      </div>
      <div id="modal-chapter-item-frame" class="modal__content" style="padding: 23px 0; height: 490px">
        <!-- <div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1"> Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div>
      <div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1">Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div>
      <div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1">Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div>
      <div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1">Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div>
      <div class="chapter-item" onClick="">
        <strong class="chapter-item__title ellipsis-1">Part1. 오늘을 사는 힘</strong>
        <span class="chapter-item__page">13</span>
      </div> -->
        <div class="modal-empty">
          <img src="./images/empty_note.svg" alt="empty" width="50">
          <p>목차를 불러오는 중입니다.</p>
        </div>
      </div>
    </div>
  </div>
  <!-- // 목차 -->

  <!-- 형광펜 -->
  <div id="modal-highlight" class="modal-highlight" style="display: none">
    <ul class="highlight__buttons">
      <li>
        <button type="button" class="color-label highlight__button highlight-color-1" onClick=""></button>
      </li>
      <li>
        <button type="button" class="color-label highlight__button highlight-color-2" onClick=""></button>
      </li>
      <li>
        <button type="button" class="color-label highlight__button highlight-color-3" onClick=""></button>
      </li>
      <li>
        <button type="button" class="color-label highlight__button highlight-color-4" onClick=""></button>
      </li>
      <li>
        <button type="button" class="color-label highlight__button highlight-color-5" onClick=""></button>
      </li>
      <li>
        <button type="button" class="highlight__button" onClick="">
          <img src="./images/pen_under.svg" alt="" />
        </button>
      </li>
    </ul>
    <button class="highlight__text-button" onClick="">메모 추가</button>
    <button class="highlight__text-button" onClick="">삭제</button>
  </div>
  <!-- //형광펜 -->

  <!-- 검색 -->
  <div id="modal-find-text" class="modal-parent">
    <div class="modal" style="
        position: absolute;
        inset: 50% auto auto 50%;
        transform: translate(-50%, -50%);
      ">
      <div class="modal__top-bar bd0">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onclick="closeModal();">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>
      <div class="modal__search">
        <button class="search__submit" type="button" onclick="onSearchButtonClick()">
          <img src="./images/search.svg" alt="검색" />
        </button>
        <input id="input_search" class="search_input" type="text" placeholder="검색" />
        <button class="search__clear" type="button" onclick="document.getElementById('input_search').value = '';">
          <img src="./images/search_clear.svg" alt="초기화" />
        </button>
      </div>
      <div class="modal-tab">
        <button id="btn-findtext-book" class="modal-tab__button modal-tab__button--active" type="button"
          onclick="modalTabHandler(this); event.stopPropagation();">
          본문
        </button>
        <button class="modal-tab__button" type="button" onclick="modalTabHandler(this); event.stopPropagation();">
          국어사전
        </button>
        <button class="modal-tab__button" type="button" onclick="modalTabHandler(this); event.stopPropagation();">
          영어사전
        </button>
        <button class="modal-tab__button" type="button" onclick="modalTabHandler(this); event.stopPropagation();">
          백과사전
        </button>
      </div>

      <div id="div-find-text-content" class="modal__content" style="height: 450px">

      </div>

    </div>
  </div>
  <!-- //검색 -->

  <!-- 독서노트 -->
  <div id="modal-note" class="modal-parent">
    <div class="modal" style="
       position: absolute;
        inset: 50% auto auto 50%;
        transform: translate(-50%, -50%);
      ">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onClick="closeReadingNote();">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>
      <div class="modal__title">
        <h2>독서 노트</h2>
      </div>
      <div class="modal-tab">
        <button class="modal-tab__button modal-tab__button--active" type="button"
          onclick="modalTabHandler(this); changeReadingNoteTab(this); event.stopPropagation();">
          전체
        </button>
        <button class="modal-tab__button" type="button"
          onclick="modalTabHandler(this); changeReadingNoteTab(this); event.stopPropagation();">
          형광펜
        </button>
        <button class="modal-tab__button" type="button"
          onclick="modalTabHandler(this); changeReadingNoteTab(this); event.stopPropagation();">
          메모
        </button>
        <button class="modal-tab__button" type="button"
          onclick="modalTabHandler(this); changeReadingNoteTab(this); event.stopPropagation();">
          책갈피
        </button>
      </div>
      <aside class="note-labels" id="aside-color" style="display: none">
        <button class="" onclick="highlightFilter('all'); removeSelectColor();"><strong>전체</strong></button>
        <button class="color-label highlight-color-1 size-24" onclick="highlightFilter('1')"></button>
        <button class="color-label highlight-color-2 size-24" onclick="highlightFilter('2')"></button>
        <button class="color-label highlight-color-3 size-24" onclick="highlightFilter('3')"></button>
        <button class="color-label highlight-color-4 size-24" onclick="highlightFilter('4')"></button>
        <button class="color-label highlight-color-5 size-24" onclick="highlightFilter('5')"></button>
      </aside>

      <div id="div-reading-note-content" class="modal__content">
        <section class="modal-content__section">
          <h4 class="note__chapter">Part 1. 오늘을 사는 힘</h4>
          <div class="note-item">
            <div class="note-item__label">
              <button type="button" class="color-label size-13 color-label--blue" onClick=""></button>
            </div>
            <div class="note-item__content">
              <p>우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.</p>
              <div class="memo">
                <div class="memo__inner">
                  <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12" />
                  <p class="memo__text">
                    자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니...
                  </p>
                </div>
                <button class="memo__fold-button" onClick="">
                  펼치기
                  <img alt="메모" src="./images/note_memo_more.svg" width="8" />
                </button>
                <!--<button
                class="memo__fold-button memo__fold-button__spread"
                onClick=""
              >
                접기
                <img
                  alt="메모"
                  src="./images/note_memo_more.svg"
                  width="8"
               >
              </button>-->
              </div>
              <div class="modal-content__bottom">
                <ul class="modal-content__info">
                  <li>51페이지</li>
                  <li>2021.05.23</li>
                </ul>
                <button type="button" class="button-more" onClick=""></button>
              </div>
            </div>
          </div>

          <div class="note-item">
            <div class="note-item__label">
              <button type="button" class="color-label size-13 color-label--red" onClick=""></button>
            </div>
            <div class="note-item__content">
              <p>우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.</p>
              <div class="memo">
                <div class="memo__inner">
                  <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12" />
                  <!--<p class="memo__text">자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니다.</p>-->
                  <!--메모 수정-->
                  <div class="edit-memo">
                    <textarea maxlength="1500" class="edit-memo__textarea" name="" placeholder="메모를 입력해주세요."></textarea>
                    <div class="edit-memo__bottom">
                      <div class="edit-memo__length">
                        <span>4</span>&nbsp;/&nbsp;1500자
                      </div>
                      <div class="edit-memo__buttons">
                        <div class="edit-memo__button edit-memo__button--white" onClick="">
                          취소
                        </div>
                        <div class="edit-memo__button edit-memo__button--black" onClick="">
                          완료
                        </div>
                      </div>
                    </div>
                  </div>
                  <!--//메모 수정-->
                </div>
              </div>
              <div class="modal-content__bottom">
                <ul class="modal-content__info">
                  <li>51페이지</li>
                  <li>2021.05.23</li>
                </ul>
                <button type="button" class="button-more" onClick=""></button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <!-- //독서노트 -->

  <!-- 메모 모달 -->
  <div id="modal-memo" class="modal-parent">
    <div class="modal" style="
        position: absolute;
        inset: 50% auto auto 50%;
        transform: translate(-50%, -50%);
        height: auto;
      ">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onclick="closeModal()">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>
      <section class="modal-content__section">
        <div class="note-item">
          <div class="note-item__label">
            <button type="button" id="memo-window-circle" class="color-label highlight__button color-label--yellow"
              onclick="" style="cursor: default"></button>
          </div>
          <div class="note-item__content">
            <p id="modal-memo-text" style=" overflow: hidden;
                                             text-overflow: ellipsis;
                                              display: -webkit-box;
                                            -webkit-line-clamp: 20;
                                            line-clamp: 20; 
                                           -webkit-box-orient: vertical;">
              우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.
            </p>
            <div class="memo">
              <div class="memo__inner">
                <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12" />
                <!--<p class="memo__text">자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니다.</p>-->

                <!--메모 수정-->
                <div class="edit-memo">
                  <textarea id="modal-memo-note" maxlength="1500" class="edit-memo__textarea" name=""
                    placeholder="메모를 입력해주세요."></textarea>
                  <div class="edit-memo__bottom">
                    <div class="edit-memo__length">
                      <span id="span-text-length"></span>&nbsp;/&nbsp;1500자
                    </div>
                    <div class="edit-memo__buttons">
                      <div class="edit-memo__button edit-memo__button--white" onClick="closeModal();">
                        취소
                      </div>
                      <div id="button-add-complete" class="edit-memo__button edit-memo__button--black"
                        onclick="addMemoComplete()">
                        완료
                      </div>
                      <div id="button-modify-complete" class="edit-memo__button edit-memo__button--black"
                        onclick="modifyMemoComplete()">
                        완료
                      </div>
                    </div>
                  </div>
                </div>
                <!--//메모 수정-->
              </div>
            </div>
            <!-- <div class="modal-content__bottom">
            <ul class="modal-content__info">
              <li>51페이지</li>
              <li>2021.05.23</li>
            </ul>
            <button type="button" class="button-more" onclick=""></button>
          </div> -->
          </div>
        </div>
      </section>
    </div>
  </div>

  <div id="modal-memo-view" class="modal-parent">
    <div class="modal" style="
          position: absolute;
          inset: 50% auto auto 50%;
          transform: translate(-50%, -50%);
          height: auto;
        ">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56" />
        <button class="modal__close" onclick="closeModal()">
          <img src="./images/close.svg" alt="닫기" />
        </button>
      </div>
      <section class="modal-content__section">
        <div class="note-item">
          <div class="note-item__label">
            <button type="button" id="memo-window-circle" class="color-label highlight__button color-label--yellow"
              onclick="" style="cursor: default"></button>
          </div>
          <div class="note-item__content">
            <p>
              우리 영혼의 중심에는 하나님이 임하신 장소가 있습니다.
            </p>
            <div class="memo">
              <div class="memo__inner" style="word-break: break-word;">
                <img class="memo__icon" alt="메모" src="./images/note_memo.svg" width="12" />
                <p class="memo__text" style="width:100%">자기를 묵상하며 자기에게 에너지를 집중하는 것이 아닙니다.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="edit-memo__buttons">
          <div id="memo-view-delete" class="edit-memo__button edit-memo__button--white">
            삭제
          </div>
          <div id="memo-view-modify" class="edit-memo__button edit-memo__button--black">
            수정
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- 메모 모달 -->

  <!-- 리뷰 모달 -->
  <div id="modal-review" class="modal-parent">
    <div class="modal"
      style="position: absolute;inset: 50% auto auto 50%;transform: translate(-50%, -50%); height: auto;">
      <div class="modal__top-bar">
        <img alt="duplus" src="./images/logo_text.svg" width="56">
        <button class="modal__close" onClick="closeModal();">
          <img src="./images/close.svg" alt="닫기">
        </button>
      </div>
      <div class="modal__title bdb">
        <h2>리뷰</h2>
      </div>
      <div class="modal__content" onscroll="fixRangePosition(this, event)">
        <!-- 리뷰 -->
        <section class="review__container">
          <!-- 콘텐츠 평균 별점 -->
          <dl class="review-average">
            <dt>콘텐츠 평균 별점</dt>
            <dd>
              <div id="div-review-average" class="review-average__text">0</div>
              <div id="div-review-average-stars" class="review-average__stars">
                <img src="./images/stars/star_average_0.svg" alt="">
                <img src="./images/stars/star_average_0.svg" alt="">
                <img src="./images/stars/star_average_0.svg" alt="">
                <img src="./images/stars/star_average_0.svg" alt="">
                <img src="./images/stars/star_average_0.svg" alt="">
              </div>
            </dd>
          </dl>

          <!-- 리뷰 목록 -->
          <div class="reviews" style="height: 430px;">
            <!-- 내가 남긴  리뷰 -->
            <div class="review-item my-review">
              <div id="div-mine" class="review-item__inner" style="display:none">
                <div class="review-item__header">
                  <div class="row">
                    <div class="thumbnail">
                      <img id="img-review-mine-profile" src="./images/profile.svg" alt="홍길동">
                    </div>
                    <div class="row review-item__name">
                      <b>나자신</b>님
                    </div>
                    <div class="review-item__date">
                      2021.10.15
                    </div>
                  </div>
                  <div class="row">
                    <!--<img
                              class="pin"
                              alt="고정된 리뷰"
                              title="고정된 리뷰"
                              src="/images/pin.svg"
                            />-->
                    <div class="stars--primary small">
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_full.svg" alt="">
                      </button>
                      <button class="star">
                        <img src="./images/stars/star_primary_half.svg" alt="">
                      </button>
                    </div>
                  </div>
                </div>
                <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                  2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                  이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>

                <div class="my-review__buttons">
                  <button class="my-review__button edit">
                    <img alt="수정" src="./images/review_edit.svg" />
                    수정
                  </button>

                  <button class="my-review__button remove">
                    <img alt="수정" src="./images/review_remove.svg" />
                    삭제
                  </button>
                </div>
              </div>
            </div>

            <!-- 내가 남긴  리뷰 수정 -->
            <div class="review-item my-review my-review-edit">
              <div id="div-write-review" class="review-item__inner">
                <div class="my-review-edit__score">
                  <strong id="text-starpoint">내 별점 5점</strong>

                  <div class="stars--primary">
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_full.svg" alt="">
                    </button>
                    <input id="input-star" oninput="changeStar(this)" type="range" step="1" min="1" max="5" value="5"
                      style="opacity: 0; position:absolute; height:26px;" />
                  </div>
                </div>
                <div class="my-review-edit__form">
                  <textarea id="textarea-review" maxlength="1000" placeholder="리뷰를 입력하세요" name="" id="" cols="30"
                    rows="10"></textarea>
                  <div class="edit-memo__bottom my-review">
                    <div class="edit-memo__length">
                      <span id="span-review-length">0</span>&nbsp;/&nbsp;1000자
                    </div>
                    <!-- <div></div> -->
                    <div class="edit-memo__buttons">
                      <button class="edit-memo__button edit-memo__button--white"
                        onClick="modifyReviewCancel();">취소</button>
                      <button id="btn-review-modify" class="edit-memo__button edit-memo__button--black"
                        onClick="modifyReviewComplete()">수정완료</button>
                      <button id="btn-review-register" class="edit-memo__button edit-memo__button--black"
                        onClick="registerReview()">등록</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- 타인의 리뷰 -->
            <ul id="ul-review" class="reviews-others">
              <li>
                <div class="review-item">
                  <div class="review-item__inner">
                    <div class="review-item__header">
                      <div class="row">
                        <div class="thumbnail">
                          <img src="./images/profile.svg" alt="홍길동">
                        </div>
                        <div class="row review-item__name">
                          <b>야고보</b>님
                        </div>
                        <div class="review-item__date">
                          2021.10.15
                        </div>
                      </div>
                      <div class="row">
                        <img class="pin" alt="고정된 리뷰" title="고정된 리뷰" src="./images/pin.svg" />
                        <!--<div class="stars&#45;&#45;primary small">
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_half.svg" alt="">
                                    </button>
                                  </div>-->
                      </div>
                    </div>
                    <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                      2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                      이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>
                  </div>
                </div>
                <span class="dashed"></span>
              </li>

              <li>
                <div class="review-item">
                  <div class="review-item__inner">
                    <div class="review-item__header">
                      <div class="row">
                        <div class="thumbnail">
                          <img src="./images/profile.svg" alt="홍길동">
                        </div>
                        <div class="row review-item__name">
                          <b>야고보</b>님
                        </div>
                        <div class="review-item__date">
                          2021.10.15
                        </div>
                      </div>
                      <div class="row">
                        <!-- <img
                                    alt="고정된 리뷰"
                                    title="고정된 리뷰"
                                    src="/images/pin.svg"
                                    width="22"
                                  />-->
                        <div class="stars--primary small">
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_full.svg" alt="">
                          </button>
                          <button class="star">
                            <img src="./images/stars/star_primary_half.svg" alt="">
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="review-item__content">[ 샬롬쌀롱 ]시즌 2 OPEN 기념 이벤트 당첨자 발표 안내
                      2/10부터 진행된 【 샬롬쌀롱 】 시즌 2 OPEN 기념이벤트에 참여해주신 모든 분들에게 감사드립니다 💙
                      이벤트 당첨자 명단은 커뮤니티 에서 확인해주세요:)</div>
                  </div>
                </div>
                <span class="dashed"></span>
              </li>
            </ul>
          </div>
        </section>
        <!-- // 리뷰 -->
      </div>
    </div>
  </div>
  <!-- 리뷰 모달 -->

  <!--하얀 컨테이너 -->
  <div id="modal-report" class="modal-parent"
    style="border: 1px solid #eeeeee;position: absolute; background-color:white; left:50vw; top : 50vh; width:300px; height:auto; transform: translate(-50%, -50%); padding:20px">

    <div style="margin-bottom:10px;">신고하기</div>
    <div>
      <select id="option-report" style="border-radius:5px; width:260px; height:auto">
      </select>
    </div>
    <div id="div-report-text" style="height:auto; width:auto; margin-top: 10px; display:none;">
      <textarea id="textarea-report"
        style="height:150px; width:100%; background-color:rgb(238, 238, 238); border-radius:10px;"
        placeholder="신고 사유를 입력해 주세요" maxlength="1000"></textarea>
    </div>
    </select>
    <div style="vertical-align: baseline; display: flex; float:right; margin-top:10px;">
      <button style="margin-right:20px; color: rgb(153, 153, 153);"
        onclick="document.getElementById('modal-report').style.display='none';">취소</button>
      <button style="color:rgb(28, 167, 236);" onclick="reportComplete()">전송</button>
    </div>
  </div>

  <script>
    /* #region url에서 멤버 콘텐츠 번호 가져오기 */
    let _memberNo = 1;
    let _bookNo = 1;
    let _contentNo = 1;
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get("memberNo") != null) {
      _memberNo = urlParams.get("memberNo");
    }
    if (urlParams.get("bookNo") != null) {
      _bookNo = urlParams.get("bookNo");

      // httpGet("GetBookTitleByContentNo", { ContentNo: _bookNo }).then(function (data) {
      //   document.getElementById("h1-title").innerHTML = data[0].ContentTitle;
      // })
    }
    /* #endregion */

    //로그인 정보 체크 && 읽을 수 있는 책인지 검사 ==========================================
    function getCookie(cookieName) {
      var cookieValue = null;
      if (document.cookie) {
        var array = document.cookie.split((escape(cookieName) + '='));
        if (array.length >= 2) {
          var arraySub = array[1].split(';');
          cookieValue = unescape(arraySub[0]);
        }
      }
      return cookieValue;
    }
    const token = getCookie("Token");
    const user = getCookie("user");
    // const token = "ZXlKaGJHY2lPaUpvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBeEx6QTBMM2h0YkdSemFXY3RiVzl5WlNOb2JXRmpMWE5vWVRJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SlZjMlZ5VG04aU9pSXlNVElpTENKRVpYWnBZMlZKUkNJNklsZGxZaUlzSWxOdWMxUjVjR1VpT2lJd01ESWlMQ0pCY0hCVWVYQmxJam9pTURBeklpd2laWGh3SWpveE5qUTJPVGd5TURFekxDSnBjM01pT2lKb2RIUndjem92TDIxNWQyVmlZWEJwTG1OdmJTSXNJbUYxWkNJNkltaDBkSEJ6T2k4dmJYbDNaV0poY0drdVkyOXRJbjAuRlA4dk15aFBxeWM5dHpHV2dEOXF6cW8xOXNhMzhVbVRPN0o1aFEwMThKOA==";
    // const user = "212";

    // if (!token || !user) {
    //   alert("권한이 없습니다. 두플러스 홈페이지로 이동합니다.");
    //   location.href = "https://dev-dplus-front.azurewebsites.net/";
    // }
    // else {
    //   if (user != _memberNo) {
    //     alert("잘못 된 접근입니다.");
    //     location.href = "https://dev-dplus-front.azurewebsites.net/";
    //   }
    // }

    // if (token && user) {
    //   loginCheck(token, user).then(function (result) {
    //     if (result.tokenChkYN != "Y") {
    //       alert("권한이 없습니다. 두플러스 홈페이지로 이동합니다.");
    //       location.href = "https://dev-dplus-front.azurewebsites.net/";
    //     }
    //   })
    // }

    //로그인 정보 체크 끝 =======================================

    //#region adder 영역
    var adder;
    var modifier;

    let progressBarClicked = false;
    //#endregion

    //#region 도서 이용시간
    function sendRecentUseData() {

    }
    //#endregion


    //#region 사용시간 체크
    // TimeMe.initialize({
    //   currentPageName: "my-home-page", // current page
    //   idleTimeoutInSeconds: 300 // seconds
    // });

    // window.setInterval(() => {
    //   httpPost("ModifyBookReadingTime", { BookReadingTime: Math.round(TimeMe.getTimeOnCurrentPageInSeconds()), BookNo: Number(_bookNo), MemberNo: Number(_memberNo) }).then(function (data) {
    //   });
    // }, 60 * 1000)

    // TimeMe.callAfterTimeElapsedInSeconds(function () {
    //   httpPost("ModifyBookReadingTime", { BookReadingTime: TimeMe.getTimeOnCurrentPageInSeconds(), BookNo: _bookNo, MemberNo: _memberNo }).then(function () {
    //   })
    // }, 15)

    // TimeMe.callWhenUserLeaves(function () {
    //   console.log("The user is not currently viewing the page!");
    // }, 5);

    // // Executes every time a user returns
    // TimeMe.callWhenUserReturns(function () {
    //   console.log("The user has come back!");
    // });

    //#endregion 사용시간 체크 끝


    //#region getfile
    function getEpub(fileName) {
      return ePub(fileName);
    }

    function bookChange(fileName, scrolling, spread) {
      if (book) {
        book.destroy();
        book = null;
        rendition.destroy();
        rendition = null;
      }
      book = getEpub(fileName);
      initRendition(scrolling, spread);
      //아이콘 변경 
      if (scrolling == "scrolled") {
        const scrollIcon = document.getElementsByClassName("setting__flow-page")[0];
        scrollIcon.classList.add("setting__flow-scroll");
        scrollIcon.classList.remove("setting__flow-page");
      }
      //페이지체크
      rendition.display();
    }
    //#endregion

    //#region 초기화
    const adderSize = 160;
    const viewer = document.getElementById("viewer");
    function initRendition(scrolling, spread) {
      var manager = "default";
      if (scrolling == "scrolled") {
        manager = "continuous";
        viewer.classList.add("scroll");
        viewer.classList.remove("page");
        document.getElementById("btn-scroll").innerHTML = "스크롤";
        disableSpread();
      }
      else if ((scrolling = "paginated")) {
        viewer.classList.remove("scroll");
        viewer.classList.add("page");
        document.getElementById("btn-scroll").innerHTML = "페이지";
        enableSpread();
      }
      if (rendition) {
        rendition.destroy();
      }
      rendition = book.renderTo(viewer, {
        manager: manager,
        flow: scrolling,
        spread: spread,
        width: "100vw",
        height: "100vh",
      });

      rendition.themes.register("./fonts.css");

      rendition.on("attached", () => {
        window.setTimeout(() => {
          document.getElementById("div-loading").classList.remove("show");
          //북마크 한번 더 검사해야함 시작할때 
          if (!(rendition && rendition.location && rendition.location.start && rendition.location.start.cfi)) return;
          var labelBookmark = document.getElementById("button-content-bookmark");
          for (var i = 0; i < bookmarkList.length; i++) {
            if ((book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 1 ||
              book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 0) &&
              (book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.end.cfi) == -1 ||
                book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.end.cfi) == 0)) {
              onBookmarkImage();
              break;
            }
            else {
              offBookmarkImage();
            }
          }
        }, 300);

        //터치 등록
        registerTouch(true);
        // document.getElementById("range-font-size").value = 4;
        // changeRangeBar(document.getElementById("range-font-size"), 4);
        // changeFontSize("14pt");
        // document.getElementById("range-font-size").trigger();
        // changeScrolling("scrolled")
        // changeBackground(APP_EVENT.BACKGROUND_COLOR.BACKGROUND5);
        // rendition.themes.font("CustomGungsuh");
        //최대화
        // rendition.resize("100vw", window.innerHeight);


        //북마크
        if (scrolling == "scrolled") {
          var container = document.getElementsByClassName("epub-container")[0];
          container.addEventListener("scroll", () => {
            if (!(rendition && rendition.location && rendition.location.start && rendition.location.start.cfi)) return;
            var labelBookmark = document.getElementById("button-content-bookmark");
            for (var i = 0; i < bookmarkList.length; i++) {
              if ((book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 1 ||
                book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 0) &&
                (book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.end.cfi) == -1 ||
                  book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.end.cfi) == 0)) {
                onBookmarkImage();
                break;
              }
              else {
                offBookmarkImage();
              }
            }

            // if (rendition.currentLocation()?.start?.index == 0 && container.scrollTop + document.documentElement.clientHeight == container.scrollHeight) {
            //   nextChapter();
            // }
            // else if (rendition.currentLocation()?.start?.index == 1 && container.scrollTop == 0 && viewer.classList.contains("scroll")) {
            //   prevChapter();
            // }
          });
        } else if (scrolling == "paginated") {
          rendition.on("relocated", (locations) => {
            var labelBookmark = document.getElementById("button-content-bookmark");
            for (var i = 0; i < bookmarkList.length; i++) {
              if ((book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 1 ||
                book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.start.cfi) == 0) &&
                book.locations.epubcfi.compare(bookmarkList[i].cfi, rendition.location.end.cfi) == -1) {
                onBookmarkImage();
                break;
              }
              else {
                offBookmarkImage();
              }
            }
          });
        }
      });

      rendition.on("customSelect", (range, contents, startTop, startLeft, endTop, endLeft, text, doc) => {
        if (viewer.classList.contains("page")) {

          let left;
          let top;

          left = endLeft - document.getElementsByClassName("epub-container")[0].scrollLeft;
          top = endTop - document.getElementsByClassName("epub-container")[0].scrollTop;
          if (document.documentElement.clientWidth < left) {
            left = startLeft - document.getElementsByClassName("epub-container")[0].scrollLeft;
            top = startTop - document.getElementsByClassName("epub-container")[0].scrollTop;
          }
          if (left < 0) {
            left = (document.documentElement.clientWidth / 2);
          }
          if (adderReady)
            adder.show(left, top, range, text);
        }
        else if (viewer.classList.contains("scroll")) {
          let left;
          let top;
          let views = document.getElementsByClassName("epub-view");
          let docs = rendition.getAllContents();
          for (let i = 0; i < docs.length; i++) {
            if (docs[i].contents == doc) {
              let scrollHeight = document.getElementsByClassName("epub-container")[0].scrollTop;
              let containerHeight = document.getElementsByClassName("epub-container")[0].clientHeight;
              if (i == 0) {
                left = endLeft;
                top = endTop;
                top = top - scrollHeight;
              }
              else if (i > 0) {
                let height = 0;
                for (let j = 0; j < i; j++) {
                  height += views[j].offsetHeight;
                }
                height += document.documentElement.offsetHeight * 5 / 100 * i;
                left = endLeft;
                top = endTop;
                top = top + height - scrollHeight;
              }
            }
          }
          if (adderReady)
            adder.show(left, top, range, text);
        }
      }
      );

      rendition.on("relocated", function (locations) {
        if (progressBarClicked) {
          progressBarClicked = false;
          return;
        }
        // 프로그레스 바 변경해줌
        progressBar.value = book.locations.locationFromCfi(rendition.location.start.cfi);
        document.getElementById("label-progress").innerHTML =
          Math.ceil(
            book.locations.percentageFromCfi(rendition.location.start.cfi) * 100
          ) + "%";

        var val =
          (progressBar.value - progressBar.min) /
          (progressBar.max - progressBar.min);

        progressBar.style.backgroundImage =
          "-webkit-gradient(linear, left top, right top, " +
          "color-stop(" +
          val +
          ", #878787), " +
          "color-stop(" +
          val +
          ", #E9E9E9)" +
          ")";
      });



      //A태그 클릭 이벤트 bubble up 막기
      book.rendition.hooks.content.register(function (contents) {
        let a = contents.document.getElementsByTagName("a");
        for (let i = 0; i < a.length; i++) {
          a[i].addEventListener("click", function (e) {
            prevClick = false;
            event.stopPropagation();
          });
        }
      });

      //클릭 막기
      book.rendition.hooks.content.register(function (contents) {
        // 우클릭
        contents.document.addEventListener("contextmenu", function (e) {
          e.preventDefault();
        });
        // 더블클릭
        contents.document.addEventListener("mousedown", (e) => {
          if (e.detail > 1) {
            e.preventDefault();
          }
        }, false);

      });

      //글자수 제한
      book.rendition.hooks.content.register(function (contents) {
        contents.window.addEventListener("copy", function (e) {
          var text = contents.window
            .getSelection()
            .toString()
            .replace(/[\n\r]+/g, "");
          if (text.length > 1000) {
            alert("1000자 이상 복사가 불가능합니다. 1000자까지 복사되었습니다.");
            text = text.substr(0, 1000);
          }
          e.clipboardData.setData("text/plain", text + '\n[출처 : 두플러스] 《' + document.getElementById("h1-title").innerHTML + '》의 콘텐츠는 저작권의 보호를 받고 있습니다. 무단 전재와 무단 복재를 금하며 공유시 출처를 반드시 명시하여 콘텐츠를 소중히 지켜주시기 바랍니다.');
          e.preventDefault();

        });
      });

      //스타일 등록
      book.rendition.hooks.content.register(function (contents) {
        getBackgroundData(contents.document);
      })

      rendition.on("click", () => {
        closeModal();
        closeModalDetail();
      });

      // httpGet("getnote", { MemberNo: _memberNo, BookNo: _bookNo }).then((data) => {
      //   for (let i = 0; i < data.length; i++) {
      //     if (rendition.epubcfi.checkType(data[i].NotePositionValue)) {
      //       if (data[i].NoteHighlightColorKindcode.length > 0) {
      //         httpGet("getValueByCode", {
      //           Code: data[i].NoteHighlightColorKindcode,
      //           GroupCode: "V01",
      //         }).then(function (value) {
      //           value = value[0].backgroundColor;
      //           if (data[i].NoteText.length > 0) {
      //             rendition.annotations.add(
      //               "highlight",
      //               data[i].NotePositionValue,
      //               { memo: true },
      //               undefined,
      //               undefined,
      //               undefined,
      //               value
      //             );
      //           } else {
      //             rendition.annotations.add(
      //               "highlight",
      //               data[i].NotePositionValue,
      //               undefined,
      //               undefined,
      //               undefined,
      //               undefined,
      //               value
      //             );
      //           }
      //         })
      //       }
      //     }
      //   }

      // })

      rendition.on("markClicked", function (cfi, data, content, range) {
        let loc = content.selectionObserver.getLoc(rendition.getRange(cfi));
        // httpGet("GetNoteByPosition", { MemberNo: _memberNo, BookNo: _bookNo, NotePositionValue: cfi }).then((result) => {
        //   window.setTimeout(() => {
        //     let startTop;
        //     let endTop;
        //     let startLeft;
        //     let endLeft;
        //     let top;
        //     let left;
        //     startTop = loc.startTop;
        //     endTop = loc.endTop;
        //     startLeft = loc.startLeft;
        //     endLeft = loc.endLeft;
        //     if (viewer.classList.contains("page")) {
        //       left = endLeft - document.getElementsByClassName("epub-container")[0].scrollLeft;
        //       top = endTop - document.getElementsByClassName("epub-container")[0].scrollTop;
        //       if (document.documentElement.clientWidth < left) {
        //         left = startLeft - document.getElementsByClassName("epub-container")[0].scrollLeft;
        //         top = startTop - document.getElementsByClassName("epub-container")[0].scrollTop;
        //       }
        //       if (left < 0) {
        //         left = (document.documentElement.clientWidth / 2);
        //       }
        //       modifier.show(left, top, cfi, result[0].NoteTableContent);
        //     } else if (viewer.classList.contains("scroll")) {
        //       let left;
        //       let top;
        //       let views = document.getElementsByClassName("epub-view");
        //       let docs = rendition.getAllContents();
        //       for (let i = 0; i < docs.length; i++) {
        //         if (docs[i].contents == content) {
        //           let scrollHeight =
        //             document.getElementsByClassName("epub-container")[0]
        //               .scrollTop;
        //           if (i == 0) {
        //             left = endLeft;
        //             top = endTop;
        //             top = top - scrollHeight;
        //           } else if (i > 0) {
        //             let height = 0;
        //             for (let j = 1; j < i; j++) {
        //               height += views[j].clientHeight;
        //             }
        //             left = endLeft;
        //             top = endTop;
        //             top = top + height + views[0].clientHeight - scrollHeight;
        //           }
        //         }
        //       }
        //       modifier.show(left, top, cfi, result[0].NoteTableContent);
        //     }
        //   }, 100);
        // })
      });

      rendition.on("markImageClicked", function (data) {
        let param = {};
        param.BookNo = _bookNo;
        param.MemberNo = _memberNo;
        param.NotePositionValue = data.epubcfi;
        // httpGet("GetNoteByPosition", param).then((data) => {
        //   if (data && data.length > 0) {
        //     document.getElementById("modal-memo-view").getElementsByClassName("note-item__content")[0].getElementsByTagName("p")[0].innerHTML = data[0].NoteTableContent;
        //     document.getElementById("modal-memo-view").getElementsByClassName("memo__text")[0].innerHTML = data[0].NoteText;

        //     //버튼 클릭이벤트 등록
        //     document.getElementById("memo-view-modify").addEventListener("click", () => {
        //       closeModal();
        //       modifier.cfi = param.NotePositionValue;
        //       openMemoModal(data[0].NoteTableContent, data[0].NoteText, "modify");
        //     })

        //     document.getElementById("memo-view-delete").addEventListener("click", () => {
        //       rendition.annotations.remove(param.NotePositionValue, "highlight");
        //       httpPost("removenote", {
        //         MemberNo: _memberNo,
        //         BookNo: _bookNo,
        //         NotePositionValue: param.NotePositionValue,
        //       }).then(function (result) {
        //         if (result < 1) {
        //           alert("삭제 실패 관리자에게 문의바랍니다.");
        //         }
        //         else {
        //           closeModal();
        //         }
        //       })
        //     })

        //     fadeIn(document.getElementById("modal-memo-view"));
        //   }

        // })
      })

      rendition.on("customSelectCancel", function () {
        window.setTimeout(function () {
        }, 200)
      });

      // httpGet("getbookmark", { BookNo: _bookNo, MemberNo: _memberNo }).then(function (data) {
      //   for (let i = 0; i < data.length; i++) {
      //     if (rendition.epubcfi.checkType(data[i].BookMarkPositionValue)) {
      //       var bookmarkItem = {};
      //       bookmarkItem.cfi = data[i].BookMarkPositionValue;
      //       bookmarkItem.progress = data[i].BookMarkPercentage;
      //       bookmarkItem.bookmarkString = data[i].BookMarkTableContent;
      //       bookmarkList.push(bookmarkItem);
      //     }
      //   }
      // })

      rendition.on("rendered", function () {
        if (rendition.currentLocation()?.start?.index == 0 && !viewer.classList.contains("scroll")) {
          if (document.getElementById("viewer").getElementsByTagName("iframe").length > 0 && document.getElementById("viewer").getElementsByTagName("iframe")[0].contentDocument.getElementsByTagName("img").length > 0) {
            let img = document.getElementById("viewer").getElementsByTagName("iframe")[0].contentDocument.getElementsByTagName("img")[0];
            img.style.position = "absolute";
            img.style.top = "50%";
            img.style.left = "50%";
            img.style.transform = "translate(-50%,-50%)";
          }
        }
        prevClick = false;
      })

      getSetting();
    }
    //#endregion

    //#region 파라미터가져오기
    function getParam(sname) {
      var params = location.search.substr(location.search.indexOf("?") + 1);
      var sval = "";
      params = params.split("&");
      for (var i = 0; i < params.length; i++) {
        temp = params[i].split("=");
        if ([temp[0]] == sname) {
          sval = temp[1];
        }
      }
      return decodeURIComponent(sval);
    }
    //#endregion

    //#region ebook init
    //한족보기 두쪽보기 버튼 핸들러
    const oneViewButton = document.getElementById("oneviewButton");
    const twoViewButton = document.getElementById("twoviewButton");
    oneViewButton.addEventListener("click", function () {
      oneViewButton.classList.add("page-mode__button--active");
      twoViewButton.classList.remove("page-mode__button--active");
      changeView("none");
      highlightRedraw();

    });

    twoViewButton.addEventListener("click", function () {
      oneViewButton.classList.remove("page-mode__button--active");
      twoViewButton.classList.add("page-mode__button--active");
      changeView("both");
      highlightRedraw();

    });

    //#endregion

    var ePubFileName = getParam("epub");
    var book;
    var rendition;

    let _completeReadYN = "N";

    if (ePubFileName) {
      bookChange(getParam("epub"), "paginated", "none");
    }
    else {
      bookChange("test.epub", "paginated", "none");
    }

    InitializeBook();

    //읽고있던 페이지로 넘어가기 








    /* #region 보기설정 영역 */
    const APP_EVENT = {
      SWIPE: {
        LEFT: "left",
        RIGHT: "right",
      },
      BACKGROUND_COLOR: {
        BACKGROUND1: "Background-1",
        BACKGROUND2: "Background-2",
        BACKGROUND3: "Background-3",
        BACKGROUND4: "Background-4",
        BACKGROUND5: "Background-5",
        BACKGROUND6: "Background-6",
        // BACKGROUND7: "Background-7",
      },
      FONT: {
        GUNGSUH: "CustomGungsuh",
        BATANG: "CustomBatang",
        NANUMMYEONGJO: "NanumMyeongjo",
        MALGUNGOTHIC: "MalgunGothic",
        BONGOTHIC: "BonGothic",
      },
      VIEW_FORMAT: {
        ONESIDEVIEW: "none",
        TWOSIDEVIEW: "both",
      },
      SCROLL: {
        PAGINATED: "paginated",
        SCROLLED: "scrolled",
      },
      LINE_HEIGHT: {
        ONE: "LineHeight-1",
        TWO: "LineHeight-2",
        THREE: "LineHeight-3",
        FOUR: "LineHeight-4",
        FIVE: "LineHeight-5",
        SIX: "LineHeight-6",
      },
      ALIGN: {
        LEFT: "AlignLeft",
        CENTER: "AlignCenter",
        RIGHT: "AlignRight",
        JUSTIFY: "AlignJustify",
      },
      PARAGRAPH_HEIGHT: {
        ONE: "ParagraphHeight-1",
        TWO: "ParagraphHeight-2",
        THREE: "ParagraphHeight-3",
        FOUR: "ParagraphHeight-4",
        FIVE: "ParagraphHeight-5",
        SIX: "ParagraphHeight-6",
      },
      PARAGRAPH_WIDTH: {
        ONE: "ParagraphWidth-1",
        TWO: "ParagraphWidth-2",
        THREE: "ParagraphWidth-3",
        FOUR: "ParagraphWidth-4",
        FIVE: "ParagraphWidth-5",
        SIX: "ParagraphWidth-6",
      },
    };
    //parameter White, Dark
    function changeBackground(theme) {
      var className = rendition.themes._current;
      var classes = className.split(" ");
      if (classes.length > 0) {
        className = "";
        classes.forEach((element) => {
          if (element.indexOf("Background") == -1) className += element + " ";
        });
      }
      className += theme;
      rendition.themes.select(className);
      let viewerClasses = viewer.className.split(" ");

      for (let i = 0; i < viewerClasses.length; i++) {
        if (viewerClasses[i].indexOf("Background") >= 0) {
          viewerClasses.splice(i, 1);
        }
      }
      if (theme) {
        viewerClasses.push(theme);
      }
      viewer.classList = "";
      for (let i = 0; i < viewerClasses.length; i++) {
        viewer.classList.add(viewerClasses[i]);
      }

      if (document.getElementById("div-loading").classList.contains("show")) {
        document.getElementById("div-loading").className = "show";
      }
      else {
        document.getElementById("div-loading").className = "";
      }

      if (theme) {
        document.getElementById("div-loading").classList.add(theme);
      } else {
        document.getElementById("div-loading").classList.add("Background-1");
      }


      //보기설정쪽 선택된 배경 바인딩
      let indicator = false;
      const buttons = document.getElementById("modal-setting").getElementsByClassName("color-label");
      for (let button of buttons) {
        button.classList.remove("on");
        if (button.getAttribute("name") == theme) {
          button.classList.add("on");
          indicator = true;
        }
      }
      if (indicator == false) {
        for (let button of buttons) {
          if (button.getAttribute("name") == "Background-0") {
            button.classList.add("on");
            return;
          }
        }
      }

    }
    //parameter  none, both;
    function changeView(view) {
      rendition.spread(view);
      if (iOS()) {
        updateLayout();
      }
    }

    function updateLayout() {
      rendition.resize("100vw", "99vh");
      rendition.resize("100vw", "100vh");
    }

    //paramter Gungsuh, Batang
    function changeFont(font) {
      rendition.themes.font(font);
      window.setTimeout(highlightRedraw, 100);
      // highlightRedraw();



      if (font == "CustomBatang") {
        changeSettingText(document.getElementById("btn-font"), "코펍 바탕 L");
      }
      else if (font == "CustomBatangMedium") {
        changeSettingText(document.getElementById("btn-font"), "코펍 바탕 M");
      }
      else if (font == "Dotum") {
        changeSettingText(document.getElementById("btn-font"), "코펍 돋움");
      }
      else if (font == "BonGothic") {
        changeSettingText(document.getElementById("btn-font"), "본고딕");
      }
      else if (font == "NanumMyeongjo") {
        changeSettingText(document.getElementById("btn-font"), "명조");
      }
      else {
        changeSettingText(document.getElementById("btn-font"), "원본");
      }



    }
    //parameter number(%)
    function changeFontSize(fontSize) {
      let storedLocation = "";
      if (rendition && rendition.location) {
        storedLocation = rendition.location.start.cfi;
      }
      if (fontSize) {
        rendition.themes.fontSize(fontSize);
      }
      else {
        rendition.themes.fontSize("");
      }

      if (fontSize == "12pt") {
        changeRangeBar(document.getElementById("range-font-size"), 1);
        changeSettingText(document.getElementById("span-font-size"), 1);
      }
      else if (fontSize == "14pt") {
        changeRangeBar(document.getElementById("range-font-size"), 2);
        changeSettingText(document.getElementById("span-font-size"), 2);
      }

      else if (fontSize == "16pt") {
        changeRangeBar(document.getElementById("range-font-size"), 3);
        changeSettingText(document.getElementById("span-font-size"), 3);
      }

      else if (fontSize == "20pt") {
        changeRangeBar(document.getElementById("range-font-size"), 4);
        changeSettingText(document.getElementById("span-font-size"), 4);
      }
      else if (fontSize == "26pt") {
        changeRangeBar(document.getElementById("range-font-size"), 5);
        changeSettingText(document.getElementById("span-font-size"), 5);
      }
      else if (fontSize == "34pt") {
        changeRangeBar(document.getElementById("range-font-size"), 6);
        changeSettingText(document.getElementById("span-font-size"), 6);
      }
      else if (fontSize == "44pt") {
        changeRangeBar(document.getElementById("range-font-size"), 7);
        changeSettingText(document.getElementById("span-font-size"), 7);
      }
      else if (fontSize == "52pt") {
        changeRangeBar(document.getElementById("range-font-size"), 8);
        changeSettingText(document.getElementById("span-font-size"), 8);
      }
      else if (fontSize == "58pt") {
        changeRangeBar(document.getElementById("range-font-size"), 9);
        changeSettingText(document.getElementById("span-font-size"), 9);
      }
      else if (fontSize == "64pt") {
        changeRangeBar(document.getElementById("range-font-size"), 10);
        changeSettingText(document.getElementById("span-font-size"), 10);
      }

      else if (!fontSize) {
        changeRangeBar(document.getElementById("range-font-size"), 0);
        changeSettingText(document.getElementById("span-font-size"), "원본");
      }



      if (storedLocation) {
        rendition.display(storedLocation).then(function () {
          highlightRedraw();
        });
      }

    }

    //parameter : paginated, scrolled
    function changeScrolling(scrolling) {
      let currentStartCfi;
      if (scrolling == "scrolled") {
        viewer.classList.remove("page");
        viewer.classList.add("scroll");
        if (scrolling == "scrolled" && rendition.ViewManager.name.includes("DefaultViewManager")) {
          if (rendition.currentLocation().start != null) {
            currentStartCfi = rendition.currentLocation().start.cfi;
          }
          initRendition("scrolled", rendition._layout._spread ? "both" : "none");
          rendition.display(currentStartCfi);
        } else {
          rendition.flow(scrolling);
        }
        //아이콘 변경 
        const scrollIcon = document.getElementsByClassName("setting__flow-page")[0];
        scrollIcon.classList.add("setting__flow-scroll");
        scrollIcon.classList.remove("setting__flow-page");

      }
      else if (scrolling == "paginated") {
        viewer.classList.remove("scroll");
        viewer.classList.add("page");

        if (scrolling == "paginated" && rendition.ViewManager.name.includes("ContinuousViewManager")) {
          if (rendition.currentLocation().start != null) {
            currentStartCfi = rendition.currentLocation().start.cfi;
          }
          initRendition("paginated", rendition._layout._spread ? "both" : "none");
          window.setTimeout(() => {
            rendition.display(currentStartCfi);
          }, 100)

        }
        else {
          rendition.flow(scrolling);
        }
        //아이콘 변경 
        const scrollIcon = document.getElementsByClassName("setting__flow-scroll")[0];
        scrollIcon.classList.add("setting__flow-page");
        scrollIcon.classList.remove("setting__flow-scroll");
      }


      if (scrolling == "paginated") {
        changeSettingText(document.getElementById("btn-scroll"), "페이지");
      }
      else if (scrolling == "scrolled") {
        changeSettingText(document.getElementById("btn-scroll"), "스크롤");
      }

      highlightRedraw();

    }

    //줄간격
    function changeLineHeight(lineHeight) {
      var className = rendition.themes._current;
      var classes = className.split(" ");
      if (classes.length > 0) {
        className = "";
        classes.forEach((element) => {
          if (element.indexOf("LineHeight") == -1) className += element + " ";
        });
      }
      if (lineHeight) {
        className += "LineHeight-" + lineHeight;
      }

      rendition.themes.select(className);


      // if (lineHeight) {
      changeSettingText(document.getElementById("span-line-height"), lineHeight);
      changeRangeBar(document.getElementById("range-line-height"), lineHeight);

      // }

    }

    //정렬
    function changeAlign(align) {
      var className = rendition.themes._current;
      var classes = className.split(" ");
      if (classes.length > 0) {
        className = "";
        classes.forEach((element) => {
          if (element.indexOf("Align") == -1) className += element + " ";
        });
      }
      if (align) {
        className += align;
      }

      rendition.themes.select(className);

      if (align == "AlignLeft") {
        changeSettingText(document.getElementById("btn-align"), "왼쪽 정렬");
      }
      else if (align == "AlignJustify") {
        changeSettingText(document.getElementById("btn-align"), "양쪽 정렬");
      }
      else if (align == "AlignRight") {
        changeSettingText(document.getElementById("btn-align"), "오른쪽 정렬");
      }
      else if (align == "AlignCenter") {
        changeSettingText(document.getElementById("btn-align"), "가운데 정렬");
      }

    }

    //문단간격
    function changeParagraphHeight(height) {
      var className = rendition.themes._current;
      var classes = className.split(" ");
      if (classes.length > 0) {
        className = "";
        classes.forEach((element) => {
          if (element.indexOf("ParagraphHeight") == -1)
            className += element + " ";
        });
      }
      if (height) {
        className += "ParagraphHeight-" + height;
      }

      rendition.themes.select(className);

      // if (height) {
      changeRangeBar(document.getElementById("range-paragraph-height"), height);
      changeSettingText(document.getElementById("span-paragraph-height"), height);
      // }


    }
    //문단 너비 ( ex ) 100% )
    function changeParagraphWidth(width) {
      var className = rendition.themes._current;
      var classes = className.split(" ");
      if (classes.length > 0) {
        className = "";
        classes.forEach((element) => {
          if (element.indexOf("ParagraphWidth") == -1)
            className += element + " ";
        });
      }
      if (width) {
        className += "ParagraphWidth-" + width;
      }

      rendition.themes.select(className);

      // if (width) {
      changeRangeBar(document.getElementById("range-paragraph-width"), width);
      changeSettingText(document.getElementById("span-paragraph-width"), width);
      // }


    }

    function getCurrentSetting(kind) {
      let viewerClasses = viewer.className.split(" ");

      for (let i = 0; i < viewerClasses.length; i++) {
        if (viewerClasses[i].indexOf(kind) >= 0) {
          return viewerClasses[i]
        }
      }
    }

    function resetSetting() {
      changeScrolling("paginated");

      changeFont("");
      changeFontSize("");
      changeLineHeight("");
      changeParagraphWidth("");
      changeParagraphHeight("");
      changeAlign("");
      changeBackground("");


      let settingValue = document.getElementsByClassName("setting__value");
      for (let i = 0; i < settingValue.length; i++) {
        settingValue[i].innerHTML = "원본";
      }

      let settingField = document.getElementsByClassName("setting__field");
      for (let i = 0; i < settingField.length; i++) {
        settingField[i].getElementsByTagName("button")[0].innerHTML = "원본";

        document.getElementById("btn-scroll").innerHTML = "페이지";
      }

      const settingRange = document.getElementsByClassName("setting__range");
      for (let item of settingRange) {
        item.value = 0;
      }
      highlightRedraw();
    }

    document.getElementById("input_search").addEventListener("keyup", function (e) {
      if (e.keyCode == 13) {
        onSearchButtonClick();
      }
    })
    /* #endregion */

    /* #region 페이지 이동  */
    function swipeLeft() {
      // if (rendition.currentLocation()?.start?.index == 1 && !viewer.classList.contains("scroll") && document.getElementsByClassName("epub-container").length > 0 && document.getElementsByClassName("epub-container")[0].scrollLeft == 0) {
      //   prevChapter();
      // }

      prevClick = true;
      rendition.prev();
    }

    function swipeRight() {
      // if (rendition.currentLocation()?.start?.index == 0 && !viewer.classList.contains("scroll")) {
      //   nextChapter();
      // }

      prevClick = true;
      rendition.next();
    }

    function fixSize() {
      rendition.resize("100vw", "100vh");
    }

    function moveToPage(page) {
      prevClick = false;
      rendition.display(book.locations._locations[page]);
    }
    function moveToPrevPage() {
      if (prevPage.length > 0) {
        prevClick = true;
        rendition.display(prevPage.pop());
      }
    }

    document.addEventListener(
      "keyup",
      function (e) {
        // Left Key
        if ((e.keyCode || e.which) == 37) {
          swipeLeft();
        }

        // Right Key
        if ((e.keyCode || e.which) == 39) {
          swipeRight();
        }

        // space Key
        if ((e.keyCode || e.which) == 32) {
          swipeRight();
        }


      },
    );

    document.addEventListener("keydown", function (e) {
      if ((e.keyCode || e.which) == 33) {
        e.stopPropagation();
        e.preventDefault();
      }

      if ((e.keyCode || e.which) == 34) {
        e.stopPropagation();
        e.preventDefault();
      }
    })
    /* #endregion */

    /* #region 목차 */
    async function getChapter() {
      var chapters = await book.loaded.navigation;
      var result = [];
      chapters.forEach((chapter) => {
        var item = {};
        item.href = chapter.href;
        item.label = chapter.label;
        let section = book.spine.get(chapter.href);
        let cfi = "epubcfi(" + section.cfiBase + "!/1/1)";
        let percentage = book.locations.percentageFromCfi(cfi);
        let page = book.locations.locationFromCfi(cfi);
        item.progress = percentage;
        item.page = page;
        item.cfi = chapter.href;
        result.push(item);
        if (chapter.subitems.length > 0) {
          for (let i = 0; i < chapter.subitems.length; i++) {
            item = {};
            item.href = chapter.subitems[i].href;
            item.label = chapter.subitems[i].label;
            section = book.spine.get(chapter.subitems[i].href);
            cfi = "epubcfi(" + section.cfiBase + "!/1/1)";
            percentage = book.locations.percentageFromCfi(cfi);
            page = book.locations.locationFromCfi(cfi);
            item.progress = percentage;
            item.page = page;
            item.cfi = chapter.subitems[i].href;
            item.firstDepth = true;
            result.push(item);

            if (chapter.subitems[i].subitems.length > 0) {
              for (
                let j = 0;
                j < chapter.subitems[i].subitems[j].length;
                i++
              ) {
                item = {};
                item.href = chapter.subitems[i].subitems[j].href;
                item.label = chapter.subitems[i].subitems[j].label;
                section = book.spine.get(
                  chapter.subitems[i].subitems[j].href
                );
                cfi = "epubcfi(" + section.cfiBase + "!/1/1)";
                percentage = book.locations.percentageFromCfi(cfi);
                page = book.locations.locationFromCfi(cfi);
                item.progress = percentage;
                item.page = page;
                item.cfi = chapter.subitems[i].subitems[j].href;
                result.push(item);
              }
            }
          }
        }
      });
      return result;
    }

    async function bindChapter() {
      document.getElementById("modal-chapter-item-frame").innerHTML = "";
      await book.ready;
      let chapter = getChapter();
      chapter.then((result) => {
        if (result && result.length > 0) {
          let div;
          let strong;
          let span;
          for (let i = 0; i < result.length; i++) {
            div = document.createElement("div");
            strong = document.createElement("strong");
            span = document.createElement("span");
            div.classList.add("chapter-item");
            div.onclick = function () {
              rendition.display(result[i].href);
              closeChapterList();
            };
            strong.classList.add("chapter-item__title");
            strong.classList.add("ellipsis-1");
            if (result[i].firstDepth) {
              strong.style.paddingLeft = "10px";
            }
            else {
              strong.style.fontWeight = "bolder";
            }

            strong.innerHTML = result[i].label;
            // strong.style.overflow = "hidden";
            // strong.style.textOverflow = "ellipsis";
            // strong.style.whiteSpace = "nowrap";
            strong.style.display = "inline";
            // strong.style.width = "80%";
            strong.title = result[i].label;
            span.style.marginLeft = "20px";
            span.classList.add("chapter-item__page");
            span.innerHTML = Math.ceil(result[i].progress * 100) + "%";
            span.style.float = "right";
            div.appendChild(span);
            div.appendChild(strong);
            document.getElementById("modal-chapter-item-frame").appendChild(div);
          }
        }
        else {


          const emptyEle = `<div class="modal-empty">
            <img src="./images/empty_note.svg" alt="empty" width="50">
            <p>아직 남겨진 독서 노트가 없습니다.</p>
          </div>`;
          const template = document.createElement("template");
          template.innerHTML = emptyEle;
          document.getElementById("modal-chapter").getElementsByClassName("modal__content")[0].appendChild(template.content.cloneNode(true));
        }

      });
    }


    function openChapterList() {
      closeModal();
      fadeIn(document.getElementById("modal-chapter"));
      // document.getElementById("modal-chapter").style.display = "block";
      let chapters = document.getElementById("modal-chapter-item-frame").children;
      for (let i = 0; i < chapters.length; i++) {
        chapters[i].style.backgroundColor = "";
      }
      getCurrentChapter().then(function (currentChapter) {
        if (!currentChapter) return;
        if (document.getElementById("modal-chapter-item-frame").children.length == 1) return;
        document.getElementById("modal-chapter-item-frame").children[currentChapter.order].style.backgroundColor = "LightGray";
        document.getElementById("modal-chapter-item-frame").children[currentChapter.order].scrollIntoView();
        // document.getElementById("modal-chapter-item-frame").children[currentChapter.order].backgroundColor = "bold";
      });
    }

    function closeChapterList() {
      // fadeOut(document.getElementById("modal-chapter"));
      document.getElementById("modal-chapter").style.display = "none";
    }
    /* #endregion */

    //#region 북마크=================================================
    //북마크 지우는부분
    document.getElementById("button-content-bookmark").addEventListener("click", toggleBookmark.bind(document.getElementById("button-content-bookmark")), true);
    document.getElementById("button-header-bookmark").addEventListener("click", toggleBookmark.bind(document.getElementById("button-content-bookmark")), true);

    var bookmarkList = [];
    function getBookmark() {
      return bookmarkList;
    }

    function removeBookmarkByCfi(cfi) {
      for (let i = 0; i < bookmarkList.length; i++) {
        if (bookmarkList[i].cfi == cfi) {
          bookmarkList.splice(i, 1);
        }
      }

      if (checkBookmarkThisPage(cfi)) {
        offBookmarkImage();
      }
    }

    function checkBookmarkThisPage(cfi) {
      if ((book.locations.epubcfi.compare(cfi, rendition.location.start.cfi) == 1 || book.locations.epubcfi.compare(cfi, rendition.location.start.cfi) == 0) &&
        (book.locations.epubcfi.compare(cfi, rendition.location.end.cfi) == -1 || book.locations.epubcfi.compare(cfi, rendition.location.end.cfi) == 0)) {
        return true;
      }
      else {
        return false;
      }
    }

    function onBookmarkImage() {
      document.getElementById("button-content-bookmark").style.opacity = 1;
      document.getElementById("image-bookmark").src =
        "./images/bookmark_on.svg";
    }
    function offBookmarkImage() {
      document.getElementById("button-content-bookmark").style.opacity = 0;
      document.getElementById("image-bookmark").src = "./images/bookmark.svg";
    }

    async function toggleBookmark() {
      var bookmarkProgress = book.locations.percentageFromCfi(
        rendition.currentLocation().start.cfi
      );
      let bookmarkLocation = book.locations.locationFromCfi(
        rendition.currentLocation().start.cfi
      );
      //북마크가 있는지 검사
      if (this.style.opacity == 1) {
        for (var i = 0; i < bookmarkList.length; i++) {
          if (checkBookmarkThisPage(bookmarkList[i].cfi)) {
            // httpPost("removebookmark", { MemberNo: _memberNo, BookNo: _bookNo, BookMarkPositionValue: bookmarkList[i].cfi, }).then(function (result) {
            //   if (result < 1) {
            //     alert("북마크 삭제 실패 관리자에게 문의바랍니다.");
            //   }
            // })

            bookmarkList.splice(i, 1);
            offBookmarkImage();

            return;
          }
        }
      }
      else if (this.style.opacity == 0) {
        var bookmarkProgress = book.locations.percentageFromCfi(rendition.currentLocation().start.cfi);
        var bookmarkString = location.host + location.pathname + "?epub=" + ePubFileName + "&goto=" + rendition.location.start.cfi;
        let imageBookmark = document.getElementById(
          "button-content-bookmark"
        );
        imageBookmark.style.opacity = 1;
        var bookmarkItem = {};
        bookmarkItem.cfi = rendition.location.start.cfi;
        bookmarkItem.progress = bookmarkProgress;
        bookmarkItem.bookmarkString = bookmarkString;
        bookmarkList.push(bookmarkItem);
        onBookmarkImage();
        chapterFromCfi(bookmarkItem.cfi).then((chapter) => {
          // httpPost("addbookmark", {
          //   MemberNo: _memberNo, BookNo: _bookNo, BookMarkPositionValue: bookmarkItem.cfi, BookMarkTableContent: chapter.chapter,
          //   BookMarkTableContentSub: chapter.chapterParent, BookMarkPage: 1, BookMarkPercentage: Math.round(bookmarkItem.progress * 100),
          // }).then(function (result) {
          //   if (result < 1) {
          //     alert("북마크 등록 실패 관리자에게 문의바랍니다.");
          //   }
          // })
        });
      }
      event.stopPropagation();
    }
    //#endregion

    //#region 텍스트검색
    function openFindTextModal() {
      closeModal();


      if (document.getElementById("div-find-text-book")) {

        document.getElementById("div-find-text-book").innerHTML = "";
        document.getElementById("div-find-text-korean").innerHTML = "";
        document.getElementById("div-find-text-english").innerHTML = "";
        document.getElementById("div-find-text-pedia").innerHTML = "";
        document.getElementById("btn-findtext-book").click();
      }
      document.getElementById("div-find-text-content").innerHTML = "";
      let template = document.createElement("template");
      let ele = `<div id="div-find-text-empty" class="modal-empty">
        <img src="./images/empty_note.svg" alt="empty" width="50" />
        <p>단어나 문장을 검색해보세요</p>
      </div>`;
      template.innerHTML = ele;

      document.getElementById("div-find-text-content").appendChild(template.content.cloneNode(true));

      document.getElementById("input_search").value = "";

      fadeIn(document.getElementById("modal-find-text"));
      // document.getElementById("modal-find-text").style.display = "block";
    }

    async function onSearchButtonClick() {
      let foundText = await findText(document.getElementById("input_search").value);
      let divBook = document.createElement("div");
      let divTabParent = document.getElementById("div-find-text-content");
      divTabParent.innerHTML = "";
      if (document.getElementById("div-find-text-book")) {
        divTabParent.removeChild(document.getElementById("div-find-text-book"));
      }

      divBook.id = "div-find-text-book";
      let section;
      for (let i = 0; i < foundText.length; i++) {
        section = document.createElement("section");
        section.classList.add("modal-content__section");
        let h4 = document.createElement("h4");
        h4.classList.add("note__chapter");
        h4.innerHTML = foundText[i].chapter;
        section.appendChild(h4);

        let divSearchItem = document.createElement("div");
        let divSearchResult = document.createElement("div");
        let divModalContentBottom = document.createElement("div");
        let ul = document.createElement("ul");
        let li = document.createElement("li");

        divSearchItem.classList.add("search__item");
        divSearchItem.addEventListener("click", function () {
          rendition.display(foundText[i].cfi).then(function () {
            window.setTimeout(function () {
              rendition.annotations.add(
                "highlight",
                foundText[i].cfi,
                undefined,
                undefined,
                undefined,
                undefined,
                "black"
              );
            }, 1000);
            window.setTimeout(function () {
              rendition.annotations.remove(foundText[i].cfi, "highlight");
              const index = rendition.annotations.highlights.indexOf(
                foundText[i].cfi
              );
              if (index > -1) {
                rendition.annotations.highlights.splice(index, 1);
              }
            }, 5000);
          });

          fadeOut(document.getElementById("modal-find-text"));
          //  document.getElementById("modal-find-text").style.display = "none";
        });
        divSearchResult.classList.add("search__result");
        let highlightText = "";
        let targetText = "";
        let poses = searchTextPos(foundText[i].text, document.getElementById("input_search").value);
        targetText = document.getElementById("input_search").value;
        highlightText = foundText[i].text;
        while (true) {
          if (poses.length == 0) {
            break;
          }
          let position = poses.pop();
          highlightText = [highlightText.slice(0, position + targetText.length), "</mark>", highlightText.slice(position + targetText.length)].join('');
          highlightText = [highlightText.slice(0, position), "<mark>", highlightText.slice(position)].join('');
        }
        divSearchResult.innerHTML = highlightText;

        divModalContentBottom.classList.add("modal-content__bottom");
        ul.classList.add("modal-content__info");
        li.innerHTML = Math.round(foundText[i].percentage * 100) + "%";

        section.appendChild(divSearchItem);
        divSearchItem.appendChild(divSearchResult);
        divSearchItem.appendChild(divModalContentBottom);
        divModalContentBottom.appendChild(ul);
        ul.appendChild(li);
        divBook.appendChild(section);
        // document.getElementById("div-find-text-content").innerHTML = "";
        // document.getElementById("div-find-text-content").appendChild(divBook);
      }
      let divEmpty = document.createElement("div");
      divEmpty.id = "div-find-text-empty";

      let template = document.createElement("template");
      template.innerHTML = `<div class="modal-empty" style="height:450px;">
        <img src="./images/empty_note.svg" alt="empty" width="50" />
        <p>검색 결과가 없습니다.</p>
      </div>`;
      divEmpty.appendChild(template.content.cloneNode(true));
      if (foundText.length == 0) {
        divBook.appendChild(divEmpty);
      }
      divTabParent.appendChild(divBook);
      divBook.style.display = "none";

      let divKorean = document.createElement("div");
      divKorean.id = "div-find-text-korean";

      let iframe = document.createElement("iframe");
      iframe.src = `https://m.dic.daum.net/search.do?search_first=Y&q=${document.getElementById("input_search").value}&dic=kor`;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      divKorean.appendChild(iframe);
      divTabParent.appendChild(divKorean);
      divKorean.style.display = "none";
      divKorean.style.height = "100%";

      let divEnglish = document.createElement("div");
      divEnglish.id = "div-find-text-english";
      iframe = document.createElement("iframe");
      iframe.src = "https://m.dic.daum.net/search.do?search_first=Y&dic=eng&q=" + document.getElementById("input_search").value;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      divEnglish.appendChild(iframe);
      divTabParent.appendChild(divEnglish);
      divEnglish.style.display = "none";
      divEnglish.style.height = "100%";


      let divPedia = document.createElement("div");
      divPedia.id = "div-find-text-pedia";
      iframe = document.createElement("iframe");
      iframe.src = "https://m.100.daum.net/search/entry?search_first=Y&q=" + document.getElementById("input_search").value;
      iframe.style.width = "100%";
      iframe.style.height = "100%";
      divPedia.appendChild(iframe);
      divTabParent.appendChild(divPedia);
      divPedia.style.display = "none";
      divPedia.style.height = "100%";


      let tabs = document.getElementsByClassName("modal-tab__button--active");
      for (let tab of tabs) {
        if (tab.innerHTML.trim() == "본문") {
          divBook.style.display = "block";
        }
        else if (tab.innerHTML.trim() == "국어사전") {
          divKorean.style.display = "block";
        }
        else if (tab.innerHTML.trim() == "영어사전") {
          divEnglish.style.display = "block";
        }
        else if (tab.innerHTML.trim() == "백과사전") {
          divPedia.style.display = "block";
        }
      }
    }

    function setUserAgent(window, userAgent) {
      if (window.navigator.userAgent != userAgent) {
        var userAgentProp = {
          get: function () {
            return userAgent;
          }
        };
        try {
          Object.defineProperty(window.navigator, 'userAgent', userAgentProp);
        } catch (e) {
          window.navigator = Object.create(navigator, {
            userAgent: userAgentProp
          });
        }
      }
    }

    function searchTextPos(str, searchValue) {
      let pos = 0;
      let posArr = [];
      while (true) {
        let foundPos = str.indexOf(searchValue, pos);
        if (foundPos == -1) break;
        posArr.push(foundPos);
        pos = foundPos + 1;
      }

      return posArr;
    }
    async function findText(text) {
      if (text.length < 1) return [];
      var foundText = [];
      var promises = [];
      rendition.book.spine.spineItems.forEach((spineItem) => {
        var promise = spineItem.load.call(spineItem, rendition.book.load.bind(rendition.book));
        promises.push(promise);
      });
      await Promise.all(promises);
      rendition.book.spine.spineItems.forEach((spineItem) => {
        var findResult = spineItem.find(text);
        let timeoutMethod;
        findResult.forEach(async (fr) => {
          var foundItem = {};
          foundItem.text = fr.excerpt;
          foundItem.cfi = fr.cfi;
          let chapter = await chapterFromCfi(fr.cfi);
          foundItem.chapter = chapter.chapter;
          foundItem.percentage = book.locations.percentageFromCfi(fr.cfi);
          foundText.push(foundItem);
        });
      });

      return foundText;
    }

    function changeFindTextTab(tab) {
      const total = document.getElementById("div-total");
      const highlight = document.getElementById("div-highlight");
      const memo = document.getElementById("div-memo");
      const bookmark = document.getElementById("div-bookmark");
      document.getElementById("aside-color").style.display = "none";
      switch (tab.innerHTML) {
        case "본문":
          total.style.display = "block";
          highlight.style.display = "none";
          memo.style.display = "none";
          bookmark.style.display = "none";
          break;
        case "국어사전":
          document.getElementById("aside-color").style.display = "flex";
          total.style.display = "none";
          highlight.style.display = "block";
          memo.style.display = "none";
          bookmark.style.display = "none";
          break;
        case "영어사전":
          total.style.display = "none";
          highlight.style.display = "none";
          memo.style.display = "block";
          bookmark.style.display = "none";
          break;
        case "백과사전":
          total.style.display = "none";
          highlight.style.display = "none";
          memo.style.display = "none";
          bookmark.style.display = "block";
          break;
      }
    }
    function highlightFindText(cfi) {
      rendition.annotations.highlight(cfi);
    }

    async function chapterFromCfi(cfi) {
      let chapter = {};
      let spineItem = book.spine.get(cfi);
      let navItem = book.navigation.get(spineItem.href);
      if (navItem) {
        chapter.chapter = navItem.label;
      }

      if (navItem && navItem.parent == undefined) {
        chapter.chapterParent = navItem.label;
      } else {
        while (spineItem.prev()) {
          spineItem = spineItem.prev();
          navItem = book.navigation.get(spineItem.href);
          if (navItem) {
            if (!(chapter.chapter)) chapter.chapter = navItem.label;
          }
          if (navItem && navItem.parent == undefined) {
            if (!(chapter.chapter)) chapter.chapter = navItem.label;
            chapter.chapterParent = navItem.label;
            break;
          }
        }
      }
      chapter.chapter = chapter.chapter.replace(/(\r\n|\n|\r)/gm, "");
      chapter.chapterParent = chapter.chapterParent.replace(/(\r\n|\n|\r)/gm, "");
      chapter.chapter = chapter.chapter.replace(/^\s+/, "");
      chapter.chapter = chapter.chapter.replace(/\s+$/, "");
      chapter.chapterParent = chapter.chapterParent.replace(/^\s+/, "");
      chapter.chapterParent = chapter.chapterParent.replace(/\s+$/, "");
      return chapter;
    }
    //#endregion

    //#region page 체크
    //페이지 바 초기화
    var progressBar = document.getElementById("progress-bar");
    let adderReady = false;
    // Generate location and pagination
    function InitializeBook() {
      book.ready.then(function () {
        var stored = localStorage.getItem(book.key() + "-locations");
        console.log("metadata:", book.package.metadata);
        // if (stored) {
        //   window.setTimeout(()=>{
        //     return book.locations.load(stored);
        //   },5000)

        // }
        //  else {
        return book.locations.generate(1000); // Generates CFI for every X characters (Characters per/page)
        // }
      }).then(function (location) {
        adderReady = true;
        // This promise will take a little while to return (About 20 seconds or so for Moby Dick)
        localStorage.setItem(book.key() + "-locations", book.locations.save());
        progressBar.style.display = "inline-block";
        progressBar.value = 0;
        //프로그레스 바 체인지 이벤트
        progressBar.min = 0;
        progressBar.max = book.locations.total;
        progressBar.removeAttribute("disabled");
        progressBar.addEventListener("change", function (current) {
          prevClick = false;
          progressBarClicked = true;
          if (progressBar.value == 0) {
            rendition.display();
          }
          else {
            rendition.display(book.locations._locations[progressBar.value]);
          }

        });
        //이벤트 발생하면 한번 relocated에서  하는 동작 실행해줘야함=============
        if (progressBarClicked) {
          progressBarClicked = false;
          return;
        }
        // 프로그레스 바 변경해줌
        progressBar.value = book.locations.locationFromCfi(rendition.location.start.cfi);
        document.getElementById("label-progress").innerHTML =
          Math.ceil(
            book.locations.percentageFromCfi(rendition.location.start.cfi) * 100
          ) + "%";

        var val =
          (progressBar.value - progressBar.min) /
          (progressBar.max - progressBar.min);

        progressBar.style.backgroundImage =
          "-webkit-gradient(linear, left top, right top, " +
          "color-stop(" +
          val +
          ", #878787), " +
          "color-stop(" +
          val +
          ", #E9E9E9)" +
          ")";

        //동작실행 끝 ============================================

        //챕터 바인드 시작======
        bindChapter();
        //=====================

        progressBar.addEventListener("input", function (current) {
          prevClick = true;
          let currentCfi = book.locations.cfiFromPercentage(
            progressBar.value / progressBar.max
          );
          let spineItem = book.spine.get(currentCfi);
          let navItem = book.navigation.get(spineItem.href);
          let chapter = "";
          if (navItem) {
            chapter = navItem.label;
          }
          const t = changingProgressBar(progressBar.value, progressBar.max);
          document.getElementById("label-progress").innerHTML = Math.ceil(t.progress * 100) + "%";
        });
        //현재위치 저장 처음 한번 호출해야해서 
        let param = {};
        param.MemberNo = _memberNo;
        param.ContentNo = _bookNo;
        param.BookReadingPositionValue = "";
        param.BookReadingProgressRate = 0;

        if (rendition && rendition.location) {
          param.BookReadingPositionValue = rendition.location.start.cfi;
          param.BookReadingProgressRate = Math.ceil((book.locations.percentageFromCfi(rendition.location.start.cfi) * 100));
        }

        // httpPost("ManageRecentUseContentData", param).then(function (result) {

        // })
        rendition.on("locationChanged", (e) => {
          let param = {};
          param.MemberNo = _memberNo;
          param.ContentNo = _bookNo;
          param.BookReadingPositionValue = e.start;
          param.BookReadingProgressRate = Math.ceil((book.locations.percentageFromCfi(e.start) * 100));
          // httpPost("ManageRecentUseContentData", param).then(function (result) {
          // })
        });
      });
    }

    //#endregion

    //#region 책 제목 바인딩

    //#endregion

    //#region 한쪽보기 두쪽보기 버튼

    function disableSpread() {
      oneViewButton.classList.remove("page-mode__button--active");
      twoViewButton.classList.remove("page-mode__button--active");

      oneViewButton.disabled = true;
      twoViewButton.disabled = true;
      oneViewButton.setAttribute("title", "스크롤 보기 중에는 사용할 수 없습니다.");
      twoViewButton.setAttribute("title", "스크롤 보기 중에는 사용할 수 없습니다.");
    }
    function enableSpread() {
      oneViewButton.disabled = false;
      twoViewButton.disabled = false;
      oneViewButton.removeAttribute("title");
      twoViewButton.removeAttribute("title");

      oneViewButton.click();
    }
    //#endregion

    /* #region 프로그레스 바  */
    function changingProgressBar(progressBarValue, progressBarMaxValue) {
      let currentCfi;
      if (typeof progressBarMaxValue == "undefined") {
        currentCfi = book.locations.cfiFromPercentage(progressBarValue);
      } else if (progressBarMaxValue > 1) {
        currentCfi = book.locations.cfiFromPercentage(
          progressBarValue / progressBarMaxValue
        );
      }

      let spineItem = book.spine.get(currentCfi);
      let navItem = book.navigation.get(spineItem.href);

      let chapter = {};
      chapter.label = "";
      if (navItem) {
        chapter.label = navItem.label;
      } else {
        while (spineItem.prev()) {
          spineItem = spineItem.prev();
          navItem = book.navigation.get(spineItem.href);
          if (navItem) {
            chapter.label = navItem.label;
            break;
          }
        }
      }
      if (typeof progressBarMaxValue == "undefined") {
        chapter.progress = progressBarValue;
      } else if (progressBarMaxValue > 1) {
        chapter.progress = progressBarValue / progressBarMaxValue;
      }

      return chapter;
    }
    function changedProgressBar(progressBarValue) {
      rendition.display(book.locations._locations[progressBarValue]);
    }
    /* #endregion */

    //#region 터치이벤트
    const leftRightTouch = function (contents) {
      contents.document.addEventListener("click", leftRightTouchHandler);
    };
    const leftRightTouchHandler = function (e) {
      if (this.getSelection().type == "Range") {
        return;
      }
      if (e.which != 1) {
        return;
      }
      let modals = document.getElementsByClassName("modal-highlight");
      for (let i = 0; i < modals.length; i++) {
        if (modals[i].style.display != "none") {
          adder.hide();
          modifier.hide();

          return;
        }
      }
      let documentHeight = viewer.clientHeight;
      let documentWidth = viewer.clientWidth;

      let nextArea = documentWidth - (documentWidth * 4) / 10;
      let prevArea = (documentWidth * 4) / 10;

      if (viewer.classList.contains("scroll")) {
        toggleTopBottomMenu();
      }
      else {
        const container = document.getElementsByClassName("epub-container")[0];
        let x = e.clientX - container.scrollLeft;
        if (x > nextArea) {
          swipeRight();
          closeTopBottomMenu();
        } else if (x < prevArea) {
          swipeLeft();
          closeTopBottomMenu();
        } else {
          toggleTopBottomMenu();
        }
      }
    };

    const topBottomTouch = function (contents) {
      contents.document.addEventListener("mouseup", topBottomTouchHandler);
    };
    const topBottomTouchHandler = function (e) {
      let modals = document.getElementsByClassName("modal-highlight");
      for (let i = 0; i < modals.length; i++) {
        if (modals[i].style.display != "none") {
          return;
        }
      }
      let documentHeight = viewer.clientHeight;
      let documentWidth = viewer.clientWidth;

      let nextArea = documentHeight - (documentHeight * 3) / 10;
      let prevArea = (documentHeight * 3) / 10;

      if (viewer.classList.contains("scroll")) {
        toggleTopBottomMenu();
      } else {
        if (e.clientY > nextArea) {
          swipeRight();
          closeTopBottomMenu();
        } else if (e.clientY < prevArea) {
          swipeLeft();
          closeTopBottomMenu();
        } else {
          toggleTopBottomMenu();
        }
      }
    };

    function registerTouch(identifier) {
      book.rendition.hooks.content.register((contents) => {
        contents.document.addEventListener(
          "keyup",
          (e) => {
            // Left Key
            if ((e.keyCode || e.which) == 37) {
              swipeLeft();
            }

            // Right Key
            if ((e.keyCode || e.which) == 39) {
              swipeRight();
            }

            if ((e.keyCode || e.which) == 32) {
              swipeRight();
            }
          },
          false
        );

        contents.document.addEventListener(
          "keydown",
          (e) => {
            if ((e.keyCode || e.which) == 33) {
              e.stopPropagation();
              e.preventDefault();
            }

            if ((e.keyCode || e.which) == 34) {
              e.stopPropagation();
              e.preventDefault();
            }
          },

        );
      });

      if (identifier == true) {
        book.rendition.hooks.content.register(leftRightTouch);
      } else if (identifier == false) {
        book.rendition.hooks.content.register(topBottomTouch);
      }
      for (let i = 0; i < rendition.views()._views.length; i++) {
        book.rendition.hooks.content.trigger(rendition.views()._views[i]);
      }
    }

    function deregisterTouch() {
      book.rendition.hooks.content.deregister(leftRightTouch);
      book.rendition.hooks.content.deregister(topBottomTouch);

      for (let i = 0; i < rendition.views()._views.length; i++) {
        rendition
          .views()
          ._views[i].window.removeEventListener(
            "click",
            leftRightTouchHandler
          );
        rendition
          .views()
          ._views[i].window.removeEventListener(
            "click",
            topBottomTouchHandler
          );
      }
    }
    //#endregion

    //#region 챕터이동
    function prevChapter() {
      getChapter().then(function (chapterList) {
        for (let i = 0; i < chapterList.length; i++) {
          let section = book.spine.get(chapterList[i].cfi);
          let sectionCfi = "epubcfi(" + section.cfiBase + "!/0/0/0)";
          if (rendition.location && book.locations.epubcfi.compare(rendition.location.end.cfi, sectionCfi) <= 0) {
            rendition.display(chapterList[i - 2].cfi);
            return;
          }
        }
        rendition.display(chapterList[chapterList.length - 2].cfi);

      });
    }

    function nextChapter() {
      getChapter().then(function (chapterList) {
        for (let i = 0; i < chapterList.length; i++) {
          let section = book.spine.get(chapterList[i].cfi);
          let sectionCfi = "epubcfi(" + section.cfiBase + "!/0/0/0)";
          if (rendition.location && book.locations.epubcfi.compare(rendition.location.end.cfi, sectionCfi) <= 0) {
            rendition.display(chapterList[i].cfi);
            break;
          }
        }
      });
    }

    async function getCurrentChapter() {
      let chapterList = await getChapter(false);
      for (let i = 0; i < chapterList.length; i++) {
        let section = book.spine.get(chapterList[i].cfi);
        let sectionCfi = "epubcfi(" + section.cfiBase + "!/1/0/0)";
        if (rendition.location && book.locations.epubcfi.compare(rendition.location.start.cfi, sectionCfi) <= 0) {
          return { chapterInfo: chapterList[i - 1], order: i - 1 };
        }
      }
      return { chapterInfo: chapterList[chapterList.length - 1], order: chapterList.length - 1 };
    }
    //#endregion

    //#region 보기설정
    function openSettingModal() {
      closeModal();
      let setting = document.getElementById("modal-setting");
      fadeIn(setting);
    }

    function closeSettingModal() {
      let setting = document.getElementById("modal-setting");
      fadeOut(setting);
      setting.classList.remove("action-buttons__button__on");
      setting.classList.add("action-buttons__button__off");
    }
    //#endregion

    //#region 위아래 메뉴
    function openTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");
      let bottomMenu = document.getElementById("footer-ebook");
      topMenu.classList.remove("header--folded");
      topMenu.classList.add("header--fixed");
      bottomMenu.classList.remove("controller--folded");
      bottomMenu.classList.add("controller--fixed");

      // openSettingModal();
    }

    function closeTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");
      let bottomMenu = document.getElementById("footer-ebook");
      topMenu.classList.add("header--folded");
      topMenu.classList.remove("header--fixed");
      bottomMenu.classList.add("controller--folded");
      bottomMenu.classList.remove("controller--fixed");

      closeSettingModal();
    }

    function toggleTopBottomMenu() {
      let topMenu = document.getElementById("header-ebook");

      if (topMenu.classList.contains("header--folded")) {
        openTopBottomMenu();
      } else if (topMenu.classList.contains("header--fixed")) {
        closeTopBottomMenu();
      }
    }
    //#endregion

    //#region input range 처리
    function changeSettingText(ele, value) {
      if (value == "0") {
        ele.innerHTML = "원본";
      }
      else if (value) {
        ele.innerHTML = value;
      }

    }

    function changeRangeBar(ele, value) {
      if (value == "") value = 0;
      ele.value = value;
      var val = (value - ele.min) / (ele.max - ele.min);
      ele.style.backgroundImage =
        "-webkit-gradient(linear, left top, right top, " +
        "color-stop(" +
        val +
        ", #f4cd43), " +
        "color-stop(" +
        val +
        ", #E9E9E9)" +
        ")";
    }

    document.getElementById("range-font-size").addEventListener("input", function () {
      switch (this.value) {
        case "0":
          changeFontSize("");
          break;
        case "1": ;
          changeFontSize("12pt");
          break;
        case "2":
          changeFontSize("14pt");
          break;
        case "3": ;
          changeFontSize("16pt");
          break;
        case "4":
          changeFontSize("20pt");
          break;
        case "5": ;
          changeFontSize("26pt");
          break;
        case "6":
          changeFontSize("34pt");
          break;
        case "7": ;
          changeFontSize("44pt");
          break;
        case "8":
          changeFontSize("52pt");
          break;
        case "9": ;
          changeFontSize("58pt");
          break;
        case "10":
          changeFontSize("64pt");
          break;
      }
      // changeFontSize(64 + 6 * this.value);
      highlightRedraw();
    });

    document.getElementById("range-line-height").addEventListener("input", function () {
      changeLineHeight(this.value);
      highlightRedraw();
    });

    document.getElementById("range-paragraph-height").addEventListener("input", function () {
      changeParagraphHeight(this.value);
      highlightRedraw();
    });

    document.getElementById("range-paragraph-width").addEventListener("input", function () {
      changeParagraphWidth(this.value);
      highlightRedraw();
    });

    function highlightRedraw() {
      if (rendition && rendition.manager && rendition.manager.views && rendition.manager.views._views && rendition.manager.views._views.length > 0) {
        for (let i = 0; i < rendition.manager.views._views.length; i++) {
          rendition.manager.views._views[i].removeHighlight();
          rendition.hooks.show.trigger(rendition.manager.views._views[i], rendition);
        }
      }
    }

    progressBar.addEventListener("input", function () {
      var val = (this.value - this.min) / (this.max - this.min);

      this.style.backgroundImage =
        "-webkit-gradient(linear, left top, right top, " +
        "color-stop(" +
        val +
        ", #878787), " +
        "color-stop(" +
        val +
        ", #E9E9E9)" +
        ")";
    });
    //#endregion

    /* #region 독서노트 부분 */
    function openReadingNote() {
      closeModal();
      let divParent = document.getElementById("div-reading-note-content");
      let divTotalTab = document.createElement("div");
      divTotalTab.id = "div-total";
      let divHighlightTab = document.createElement("div");
      divHighlightTab.id = "div-highlight";
      let divMemoTab = document.createElement("div");
      divMemoTab.id = "div-memo";
      let divBookmarkTab = document.createElement("div");
      divBookmarkTab.id = "div-bookmark";

      divHighlightTab.style.display = "none";
      divMemoTab.style.display = "none";
      divBookmarkTab.style.display = "none";
      divParent.innerHTML = "";

      divTotalTab.style.height = "450px";
      divHighlightTab.style.height = "400px";
      divMemoTab.style.height = "450px";
      divBookmarkTab.style.height = "450px";



      let section;
      // httpGet("getnote", { MemberNo: _memberNo, BookNo: _bookNo }).then((data) => {
      //   for (let i = 0; i < data.length; i++) {
      //     if (divTotalTab.children.length == 0 || data[i - 1].TableContentName != data[i].TableContentName) {
      //       section = document.createElement("section");
      //       section.classList.add("modal-content__section");
      //       let h4 = document.createElement("h4");
      //       h4.classList.add("note__chapter");
      //       h4.innerHTML = data[i].TableContentName;
      //       section.appendChild(h4);
      //     }
      //     else {
      //       section = divTotalTab.children[divTotalTab.children.length - 1];
      //     }

      //     let divItem = document.createElement("div");
      //     divItem.classList.add("note-item");
      //     divItem.addEventListener("click", () => {
      //       rendition.display(data[i].NotePositionValue);
      //       closeReadingNote();
      //     });
      //     let divColor = document.createElement("div");
      //     divColor.classList.add("note-item__label");
      //     let buttonColor = document.createElement("button");
      //     buttonColor.classList.add("color-label");
      //     buttonColor.classList.add("size-13");
      //     if (data[i].NoteHighlightColorKindcode.length > 0) {
      //       httpGet("getValueByCode", {
      //         Code: data[i].NoteHighlightColorKindcode,
      //         GroupCode: "V01",
      //       }).then(function (value) {
      //         buttonColor.classList.add("highlight-color-" + value[0].order);
      //       });
      //       divColor.appendChild(buttonColor);
      //       divItem.appendChild(divColor);
      //     } else {
      //       let imgBookmark = document.createElement("img");
      //       imgBookmark.src = "./images/ico-bookmark.svg";
      //       divColor.appendChild(imgBookmark);
      //       divItem.appendChild(divColor);
      //     }

      //     let divContent = document.createElement("div");
      //     divContent.classList.add("note-item__content");
      //     let pText = document.createElement("p");
      //     pText.innerHTML = data[i].NoteTableContent.replace(
      //       /(\r\n|\n|\r)/gm,
      //       ""
      //     ).trim();

      //     divContent.appendChild(pText);
      //     if (data[i].NoteText.length > 0) {
      //       let divMemo = document.createElement("div");
      //       divMemo.classList.add("memo");
      //       let divMemoInner = document.createElement("div");
      //       divMemoInner.classList.add("memo__inner");
      //       let imgMemoIcon = document.createElement("img");
      //       imgMemoIcon.src = "./images/note_memo.svg";
      //       imgMemoIcon.width = 12;
      //       imgMemoIcon.alt = "메모";
      //       imgMemoIcon.classList.add("memo__icon");
      //       let pMemo = document.createElement("p");
      //       pMemo.classList.add("memo__text");
      //       pMemo.innerHTML = data[i].NoteText;

      //       divMemo.appendChild(divMemoInner);
      //       divMemoInner.appendChild(imgMemoIcon);
      //       divMemoInner.appendChild(pMemo);

      //       divContent.appendChild(divMemo);

      //       if (data[i].NoteText.length > 20) {
      //         pMemo.style.height = "20px";
      //         pMemo.style.wordWrap = "nomal";
      //         pMemo.style.textOverflow = "ellipsis";
      //         pMemo.style.overflow = "hidden";
      //         pMemo.style.width = "355px";


      //         let buttonFold = document.createElement("button");
      //         buttonFold.classList.add("memo__fold-button");
      //         buttonFold.innerText = "펼치기";
      //         let imgFold = document.createElement("img");
      //         imgFold.alt = "메모";
      //         imgFold.src = "./images/note_memo_more.svg";
      //         imgFold.width = 8;
      //         buttonFold.appendChild(imgFold);
      //         buttonFold.onclick = (foldEvt) => {
      //           foldEvt.stopPropagation();
      //           foldEvt.preventDefault();
      //           if (
      //             !buttonFold.classList.contains("memo__fold-button__spread")
      //           ) {
      //             buttonFold.classList.add("memo__fold-button__spread");
      //             pMemo.style.height = "";
      //             pMemo.style.textOverflow = "clip";
      //             pMemo.style.overflow = "visible";
      //             pMemo.style.wordWrap = "break-word";
      //             buttonFold.innerHTML = buttonFold.innerHTML.replace("펼치기", "접기");

      //           } else {
      //             buttonFold.classList.remove("memo__fold-button__spread");
      //             pMemo.style.height = "20px";
      //             pMemo.style.textOverflow = "ellipsis";
      //             pMemo.style.overflow = "hidden";
      //             pMemo.style.wordWrap = "nomal";
      //             buttonFold.innerHTML = buttonFold.innerHTML.replace("접기", "펼치기");
      //           }
      //         };
      //         divMemo.appendChild(buttonFold);
      //       }
      //     }

      //     let divBottom = document.createElement("div");
      //     divBottom.classList.add("modal-content__bottom");
      //     let ulInfo = document.createElement("ul");
      //     ulInfo.classList.add("modal-content__info");
      //     let li = document.createElement("li");
      //     li.innerHTML = data[i].NotePercentage + "%";
      //     ulInfo.appendChild(li);
      //     li = document.createElement("li");
      //     li.innerHTML = noteDateFormatting(data[i].BookReadingNoteDatetime);
      //     ulInfo.appendChild(li);
      //     let buttonMore = document.createElement("button");
      //     buttonMore.classList.add("button-more");
      //     buttonMore.onclick = function (ea) {
      //       ea.stopPropagation();
      //       let removeFunc;
      //       if (data[i].NoteHighlightColorKindcode.length > 0) {
      //         removeFunc = function () {
      //           let evt = new CustomEvent("removeHighlight", {
      //             detail: {
      //               cfi: data[i].NotePositionValue,
      //             },
      //           });
      //           document.dispatchEvent(evt);
      //           window.setTimeout(function () {
      //             closeModal();
      //             openReadingNote();
      //           }, 300);
      //         };
      //       } else {
      //         removeFunc = function () {
      //           httpPost("removebookmark", {
      //             MemberNo: _memberNo,
      //             BookNo: _bookNo,
      //             BookMarkPositionValue: data[i].NotePositionValue,
      //           }).then(function (result) {
      //             if (result < 1) {
      //               alert("북마크 삭제 실패 관리자에게 문의바랍니다.");
      //             } else {
      //               window.setTimeout(function () {
      //                 closeModal();
      //                 openReadingNote();
      //                 removeBookmarkByCfi(data[i].NotePositionValue);
      //               }, 300);
      //             }
      //           })
      //         };
      //       }

      //       let modifyFunc = function (e) {
      //         let evt = new CustomEvent("modifyMemo", {
      //           detail: {
      //             cfi: data[i].NotePositionValue,
      //             inNote: true,
      //           },
      //         });
      //         document.dispatchEvent(evt);
      //       };
      //       if (data[i].NoteHighlightColorKindcode.length > 0) {
      //         let data1 = { text: "삭제", handler: removeFunc, evt: ea };
      //         let data2 = { text: "메모", handler: modifyFunc };
      //         openSelectModalInReadingNote(data1, data2);
      //       } else {
      //         let data1 = { text: "삭제", handler: removeFunc, evt: ea };
      //         openSelectModalInReadingNote(data1);
      //       }
      //     };
      //     divBottom.appendChild(ulInfo);
      //     divBottom.appendChild(buttonMore);
      //     divContent.appendChild(divBottom);
      //     divItem.appendChild(divContent);

      //     section.appendChild(divItem);
      //     if (data.length != 0) {
      //       divTotalTab.append(section);
      //     }


      //     //여기부터 형광펜
      //     if (data[i].NoteText.length == 0 && data[i].NoteHighlightColorKindcode.length != 0) {
      //       if (divHighlightTab.children.length == 0 || data[i - 1].TableContentName != data[i].TableContentName) {
      //         section = document.createElement("section");
      //         section.classList.add("modal-content__section");
      //         let h4 = document.createElement("h4");
      //         h4.classList.add("note__chapter");
      //         h4.innerHTML = data[i].TableContentName;
      //         section.appendChild(h4);
      //       }
      //       else {
      //         section = divHighlightTab.children[divHighlightTab.children.length - 1];
      //       }

      //       let divItem = document.createElement("div");
      //       divItem.classList.add("note-item");
      //       divItem.addEventListener("click", () => {
      //         rendition.display(data[i].NotePositionValue);
      //         closeReadingNote();
      //       });
      //       let divColor = document.createElement("div");
      //       divColor.classList.add("note-item__label");
      //       let buttonColor = document.createElement("button");
      //       buttonColor.classList.add("color-label");
      //       buttonColor.classList.add("size-13");
      //       if (data[i].NoteHighlightColorKindcode.length > 0) {
      //         httpGet("getValueByCode", {
      //           Code: data[i].NoteHighlightColorKindcode,
      //           GroupCode: "V01",
      //         }).then(function (value) {
      //           buttonColor.classList.add("highlight-color-" + value[0].order);
      //           divItem.setAttribute("color", value[0].order);
      //         });
      //         divColor.appendChild(buttonColor);
      //         divItem.appendChild(divColor);
      //       } else {
      //         let imgBookmark = document.createElement("img");
      //         imgBookmark.src = "./images/ico-bookmark.svg";

      //         divColor.appendChild(imgBookmark);
      //         divItem.appendChild(divColor);
      //       }
      //       let divContent = document.createElement("div");
      //       divContent.classList.add("note-item__content");
      //       let pText = document.createElement("p");
      //       pText.innerHTML = data[i].NoteTableContent.replace(
      //         /(\r\n|\n|\r)/gm,
      //         ""
      //       ).trim();
      //       divContent.appendChild(pText);
      //       if (data[i].NoteText.length > 0) {
      //         let divMemo = document.createElement("div");
      //         divMemo.classList.add("memo");
      //         let divMemoInner = document.createElement("div");
      //         divMemoInner.classList.add("memo__inner");
      //         let imgMemoIcon = document.createElement("img");
      //         imgMemoIcon.src = "./images/note_memo.svg";
      //         imgMemoIcon.width = 12;
      //         imgMemoIcon.alt = "메모";
      //         imgMemoIcon.classList.add("memo__icon");
      //         let pMemo = document.createElement("p");
      //         pMemo.classList.add("memo__text");
      //         pMemo.innerHTML = data[i].NoteText;

      //         divMemo.appendChild(divMemoInner);
      //         divMemoInner.appendChild(imgMemoIcon);
      //         divMemoInner.appendChild(pMemo);

      //         divContent.appendChild(divMemo);
      //       }
      //       let divBottom = document.createElement("div");
      //       divBottom.classList.add("modal-content__bottom");
      //       let ulInfo = document.createElement("ul");
      //       ulInfo.classList.add("modal-content__info");
      //       let li = document.createElement("li");
      //       li.innerHTML = data[i].NotePercentage + "%";
      //       ulInfo.appendChild(li);
      //       li = document.createElement("li");
      //       li.innerHTML = noteDateFormatting(data[i].BookReadingNoteDatetime);
      //       ulInfo.appendChild(li);
      //       let buttonMore = document.createElement("button");
      //       buttonMore.classList.add("button-more");
      //       buttonMore.onclick = function (ea) {
      //         ea.stopPropagation();
      //         let removeFunc = function () {
      //           let evt = new CustomEvent("removeHighlight", {
      //             detail: {
      //               cfi: data[i].NotePositionValue,
      //             },
      //           });
      //           document.dispatchEvent(evt);
      //           window.setTimeout(function () {
      //             closeModal();
      //             openReadingNote();
      //           }, 300);
      //         };
      //         let modifyFunc = function () {
      //           let evt = new CustomEvent("modifyMemo", {
      //             detail: {
      //               cfi: data[i].NotePositionValue,
      //               inNote: true,
      //             },
      //           });
      //           document.dispatchEvent(evt);
      //         };
      //         let data1 = { text: "삭제", handler: removeFunc, evt: ea };
      //         let data2 = { text: "메모", handler: modifyFunc };
      //         openSelectModalInReadingNote(data1, data2);
      //       };
      //       divBottom.appendChild(ulInfo);
      //       divBottom.appendChild(buttonMore);

      //       divContent.appendChild(divBottom);
      //       divItem.appendChild(divContent);

      //       section.appendChild(divItem);
      //       // divHighlightTab.innerHTML = "";
      //       divHighlightTab.appendChild(section);
      //     }
      //     ///==========================
      //     //여기부터 메모
      //     if (data[i].NoteText.length > 0) {
      //       if (
      //         divMemoTab.children.length == 0 ||
      //         data[i - 1].TableContentName != data[i].TableContentName
      //       ) {
      //         section = document.createElement("section");
      //         section.classList.add("modal-content__section");
      //         let h4 = document.createElement("h4");
      //         h4.classList.add("note__chapter");

      //         h4.innerHTML = data[i].TableContentName;
      //         section.appendChild(h4);
      //       } else {
      //         section = divMemoTab.children[divMemoTab.children.length - 1];
      //       }

      //       let divItem = document.createElement("div");
      //       divItem.classList.add("note-item");
      //       divItem.addEventListener("click", () => {
      //         rendition.display(data[i].NotePositionValue);
      //         closeReadingNote();
      //       });
      //       let divColor = document.createElement("div");
      //       divColor.classList.add("note-item__label");
      //       let buttonColor = document.createElement("button");
      //       buttonColor.classList.add("color-label");
      //       buttonColor.classList.add("size-13");
      //       if (data[i].NoteHighlightColorKindcode.length > 0) {
      //         httpGet("getValueByCode", {
      //           Code: data[i].NoteHighlightColorKindcode,
      //           GroupCode: "V01",
      //         }).then(function (value) {
      //           buttonColor.classList.add("highlight-color-" + value[0].order);
      //         })
      //       }
      //       divColor.appendChild(buttonColor);
      //       divItem.appendChild(divColor);

      //       let divContent = document.createElement("div");
      //       divContent.classList.add("note-item__content");
      //       let pText = document.createElement("p");
      //       pText.innerHTML = data[i].NoteTableContent;
      //       divContent.appendChild(pText);
      //       if (data[i].NoteText.length > 0) {
      //         let divMemo = document.createElement("div");
      //         divMemo.classList.add("memo");
      //         let divMemoInner = document.createElement("div");
      //         divMemoInner.classList.add("memo__inner");
      //         let imgMemoIcon = document.createElement("img");
      //         imgMemoIcon.src = "./images/note_memo.svg";
      //         imgMemoIcon.width = 12;
      //         imgMemoIcon.alt = "메모";
      //         imgMemoIcon.classList.add("memo__icon");
      //         let pMemo = document.createElement("p");
      //         pMemo.classList.add("memo__text");
      //         pMemo.innerHTML = data[i].NoteText;

      //         divMemo.appendChild(divMemoInner);
      //         divMemoInner.appendChild(imgMemoIcon);
      //         divMemoInner.appendChild(pMemo);

      //         divContent.appendChild(divMemo);

      //         if (data[i].NoteText.length > 20) {
      //           pMemo.style.height = "20px";
      //           pMemo.style.wordWrap = "nomal";
      //           pMemo.style.textOverflow = "ellipsis";
      //           pMemo.style.overflow = "hidden";
      //           pMemo.style.width = "355px";


      //           let buttonFold = document.createElement("button");
      //           buttonFold.classList.add("memo__fold-button");
      //           buttonFold.innerText = "펼치기";
      //           let imgFold = document.createElement("img");
      //           imgFold.alt = "메모";
      //           imgFold.src = "./images/note_memo_more.svg";
      //           imgFold.width = 8;
      //           buttonFold.appendChild(imgFold);
      //           buttonFold.onclick = (foldEvt) => {
      //             foldEvt.stopPropagation();
      //             foldEvt.preventDefault();
      //             if (
      //               !buttonFold.classList.contains("memo__fold-button__spread")
      //             ) {
      //               buttonFold.classList.add("memo__fold-button__spread");
      //               pMemo.style.height = "";
      //               pMemo.style.textOverflow = "clip";
      //               pMemo.style.overflow = "visible";
      //               pMemo.style.wordWrap = "break-word";
      //               buttonFold.innerHTML = buttonFold.innerHTML.replace("펼치기", "접기");

      //             } else {
      //               buttonFold.classList.remove("memo__fold-button__spread");
      //               pMemo.style.height = "20px";
      //               pMemo.style.textOverflow = "ellipsis";
      //               pMemo.style.overflow = "hidden";
      //               pMemo.style.wordWrap = "nomal";
      //               buttonFold.innerHTML = buttonFold.innerHTML.replace("접기", "펼치기");
      //             }
      //           };
      //           divMemo.appendChild(buttonFold);
      //         }
      //       }

      //       let divBottom = document.createElement("div");
      //       divBottom.classList.add("modal-content__bottom");
      //       let ulInfo = document.createElement("ul");
      //       ulInfo.classList.add("modal-content__info");
      //       let li = document.createElement("li");
      //       li.innerHTML = data[i].NotePercentage + "%";
      //       ulInfo.appendChild(li);
      //       li = document.createElement("li");
      //       li.innerHTML = noteDateFormatting(data[i].BookReadingNoteDatetime);
      //       ulInfo.appendChild(li);
      //       let buttonMore = document.createElement("button");
      //       buttonMore.classList.add("button-more");
      //       buttonMore.onclick = function (ea) {
      //         ea.stopPropagation();
      //         let removeFunc = function () {
      //           let evt = new CustomEvent("removeHighlight", {
      //             detail: {
      //               cfi: data[i].NotePositionValue,
      //             },
      //           });
      //           document.dispatchEvent(evt);
      //           window.setTimeout(function () {
      //             closeModal();
      //             openReadingNote();
      //           }, 300);
      //         };
      //         let modifyFunc = function () {
      //           let evt = new CustomEvent("modifyMemo", {
      //             detail: {
      //               cfi: data[i].NotePositionValue,
      //               inNote: true,
      //             },
      //           });
      //           document.dispatchEvent(evt);
      //         };
      //         let data1 = { text: "삭제", handler: removeFunc, evt: ea };
      //         let data2 = { text: "메모", handler: modifyFunc };
      //         openSelectModalInReadingNote(data1, data2);
      //       };
      //       divBottom.appendChild(ulInfo);
      //       divBottom.appendChild(buttonMore);

      //       divContent.appendChild(divBottom);
      //       divItem.appendChild(divContent);

      //       section.appendChild(divItem);
      //       // divMemoTab.innerHTML = "";
      //       divMemoTab.appendChild(section);
      //     }
      //     //=============
      //     //여기부터 북마크

      //     if (data[i].NoteHighlightColorKindcode.length == 0) {
      //       if (divBookmarkTab.children.length == 0 || data[i - 1].TableContentName != data[i].TableContentName) {
      //         section = document.createElement("section");
      //         section.classList.add("modal-content__section");
      //         let h4 = document.createElement("h4");
      //         h4.classList.add("note__chapter");
      //         h4.innerHTML = data[i].TableContentName;
      //         section.appendChild(h4);
      //       }
      //       else {
      //         section = divBookmarkTab.children[divBookmarkTab.children.length - 1];
      //       }
      //       let divItem = document.createElement("div");
      //       divItem.classList.add("note-item");
      //       divItem.addEventListener("click", () => {
      //         rendition.display(data[i].NotePositionValue);
      //         closeReadingNote();
      //       });
      //       let divColor = document.createElement("div");
      //       divColor.classList.add("note-item__label");

      //       let imgBookmark = document.createElement("img");
      //       imgBookmark.src = "./images/ico-bookmark.svg";
      //       divColor.appendChild(imgBookmark);
      //       divItem.appendChild(divColor);

      //       let divContent = document.createElement("div");
      //       divContent.classList.add("note-item__content");
      //       let pText = document.createElement("p");
      //       pText.innerHTML = data[i].NoteTableContent.replace(
      //         /(\r\n|\n|\r)/gm,
      //         ""
      //       ).trim();
      //       divContent.appendChild(pText);
      //       let divBottom = document.createElement("div");
      //       divBottom.classList.add("modal-content__bottom");
      //       let ulInfo = document.createElement("ul");
      //       ulInfo.classList.add("modal-content__info");
      //       let li = document.createElement("li");
      //       li.innerHTML = data[i].NotePercentage + "%";
      //       ulInfo.appendChild(li);
      //       li = document.createElement("li");
      //       li.innerHTML = noteDateFormatting(data[i].BookReadingNoteDatetime);
      //       ulInfo.appendChild(li);
      //       let buttonMore = document.createElement("button");
      //       buttonMore.classList.add("button-more");
      //       buttonMore.onclick = function (ea) {
      //         ea.stopPropagation();

      //         let removeFunc = function () {
      //           httpPost("removebookmark", {
      //             MemberNo: _memberNo,
      //             BookNo: _bookNo,
      //             BookMarkPositionValue: data[i].NotePositionValue,
      //           }).then(function (result) {
      //             if (result < 1) {
      //               alert("북마크 삭제 실패 관리자에게 문의바랍니다.");
      //             } else {
      //               window.setTimeout(function () {
      //                 closeModal();
      //                 openReadingNote();
      //                 removeBookmarkByCfi(data[i].NotePositionValue);
      //               }, 300);
      //             }
      //           })
      //         };
      //         let data1 = { text: "삭제", handler: removeFunc, evt: ea };
      //         openSelectModalInReadingNote(data1);
      //       };
      //       divBottom.appendChild(ulInfo);
      //       divBottom.appendChild(buttonMore);

      //       divContent.appendChild(divBottom);
      //       divItem.appendChild(divContent);

      //       section.appendChild(divItem);
      //       // divBookmarkTab.innerHTML = "";
      //       divBookmarkTab.appendChild(section);
      //     }
      //   }

      //   const emptyEle = `<div class="modal-empty">
      //       <img src="./images/empty_note.svg" alt="empty" width="50">
      //       <p>아직 남겨진 독서 노트가 없습니다.</p>
      //     </div>`;
      //   const template = document.createElement("template");
      //   template.innerHTML = emptyEle;
      //   if (!data || data.length == 0) {
      //     divTotalTab.appendChild(template.content.cloneNode(true));
      //     divHighlightTab.appendChild(template.content.cloneNode(true));
      //     divMemoTab.appendChild(template.content.cloneNode(true));
      //     divBookmarkTab.appendChild(template.content.cloneNode(true));
      //   }
      //   else {
      //     if (!(data.find(x => x.NoteText.length == 0 && x.NoteHighlightColorKindcode.length != 0))) {
      //       divHighlightTab.appendChild(template.content.cloneNode(true));
      //     }
      //     if (!(data.find(x => x.NoteText.length > 0 && x.NoteHighlightColorKindcode.length != 0))) {
      //       divMemoTab.appendChild(template.content.cloneNode(true));
      //     }
      //     if (!(data.find(x => x.NoteText.length == 0 && x.NoteHighlightColorKindcode.length == 0))) {
      //       divBookmarkTab.appendChild(template.content.cloneNode(true));
      //     }
      //   }

      //   divParent.appendChild(divBookmarkTab);
      //   divParent.appendChild(divTotalTab);
      //   divParent.appendChild(divHighlightTab);
      //   divParent.appendChild(divMemoTab);

      //   fadeIn(document.getElementById("modal-note"));
      //   // document.getElementById("modal-note").style.display = "block";
      //   let activeTabs = document.getElementsByClassName(
      //     "modal-tab__button--active"
      //   );
      //   for (let i = 0; i < activeTabs.length; i++) {
      //     activeTabs[i].click();
      //   }
      //   //형광펜 선택값 초기화
      //   const colorButtons = document.getElementById("modal-note").getElementsByClassName("color-label");
      //   for (let colorButton of colorButtons) {
      //     colorButton.classList.remove("on");
      //   }
      // })
    }
    document.getElementById("modal-memo-note").addEventListener("input", function (e) {
      document.getElementById("span-text-length").innerHTML = e.target.value.length;
    })
    function changeMemoTextLength() {
      document.getElementById("span-text-length").innerHTML = document.getElementById("modal-memo-note").value.length;
    }

    document.getElementById("textarea-review").addEventListener("input", function (e) {
      document.getElementById("span-review-length").innerHTML = e.target.value.length;
    })
    function changeReviewTextLength() {
      document.getElementById("span-review-length").innerHTML = document.getElementById("textarea-review").value.length;
    }

    function changeReadingNoteTab(tab) {
      const total = document.getElementById("div-total");
      const highlight = document.getElementById("div-highlight");
      const memo = document.getElementById("div-memo");
      const bookmark = document.getElementById("div-bookmark");
      document.getElementById("aside-color").style.display = "none";
      switch (tab.innerHTML.trim()) {
        case "전체":
          total.style.display = "block";
          highlight.style.display = "none";
          memo.style.display = "none";
          bookmark.style.display = "none";
          break;

        case "형광펜":
          document.getElementById("aside-color").style.display = "flex";
          total.style.display = "none";
          highlight.style.display = "block";
          memo.style.display = "none";
          bookmark.style.display = "none";
          break;
        case "메모":
          total.style.display = "none";
          highlight.style.display = "none";
          memo.style.display = "block";
          bookmark.style.display = "none";
          break;
        case "책갈피":
          total.style.display = "none";
          highlight.style.display = "none";
          memo.style.display = "none";
          bookmark.style.display = "block";
          break;
      }
    }

    function closeReadingNote() {
      fadeOut(document.getElementById("modal-note"));
    }

    function highlightFilter(color) {
      let items = document.getElementById("div-highlight").getElementsByClassName("note-item");
      for (let i = 0; i < items.length; i++) {
        items[i].removeAttribute("style");
        items[i].style.display = "flex";
      }
      if (color != "all") {
        for (let i = 0; i < items.length; i++) {
          if (items[i].getAttribute("color") != color) {
            items[i].style.display = "none";
          }
        }
      }
      let itemIndicator = false;
      let div = document.getElementById("div-highlight");
      for (let i = 0; i < div.children.length; i++) {
        div.children[i].style.display = "none";
        for (let j = 0; j < div.children[i].getElementsByClassName("note-item").length; j++) {
          if (div.children[i].getElementsByClassName("note-item")[j].style.display == "flex") {
            div.children[i].style.display = "block";
            div.children[i].getElementsByClassName("note-item")[j].style.borderTop = "0px";
            itemIndicator = true;
            // break;
          }
        }
      }

      //아무것도 없으면 없다고 표시
      if (itemIndicator == false) {
        const emptyEle = `<div class="modal-empty">
            <img src="./images/empty_note.svg" alt="empty" width="50">
            <p>아직 남겨진 독서 노트가 없습니다.</p>
          </div>`;
        const template = document.createElement("template");
        template.innerHTML = emptyEle;
        document.getElementById("div-highlight").prepend(template.content.cloneNode(true));
      }
      else {
        if (document.getElementById("div-highlight").getElementsByClassName("modal-empty") && document.getElementById("div-highlight").getElementsByClassName("modal-empty").length > 0) {
          document.getElementById("div-highlight").getElementsByClassName("modal-empty")[0].remove();
        }
      }

    }
    /* #endregion */

    /* #region 선택모달 부분  */
    function openSelectModal() {
      //이전 모달 지움
      const temp = closeMenuModal();
      if (temp > 0) return;
      let paddingY = 10;
      let args = Array.from(arguments);
      let stringArgs = args.filter((x) => {
        if (typeof x == "string") {
          return x;
        }
      });
      let buttonArgs = args.find((x) => {
        if (
          Object.prototype.toString.call(x) == "[object HTMLButtonElement]"
        ) {
          return x;
        }
      });
      let changeEventArgs = args.find((x) => {
        if (typeof x == "function") {
          return x;
        }
      });
      let div = document.createElement("div");
      div.classList.add("menu-more__container");
      let ul = document.createElement("ul");
      ul.classList.add("menu-more");
      ul.classList.add("menu-more--sm");
      let li;
      let button;
      for (let i = 0; i < stringArgs.length; i++) {
        li = document.createElement("li");
        button = document.createElement("button");
        li.classList.add("menu-more__item");
        button.classList.add("menu-more__button");
        button.innerHTML = stringArgs[i];
        button.addEventListener("click", function (e) {
          switch (stringArgs[i]) {
            case "코펍 바탕 L":
              changeEventArgs("CustomBatang");
              break;
            case "코펍 바탕 M":
              changeEventArgs("CustomBatangMedium");
              break;
            case "코펍 돋움":
              changeEventArgs("Dotum");
              break;
            case "본고딕":
              changeEventArgs("BonGothic");
              break;
            case "명조":
              changeEventArgs("NanumMyeongjo");
              break;

            case "좌측정렬":
              changeEventArgs(APP_EVENT.ALIGN.LEFT);
              break;
            case "중앙정렬":
              changeEventArgs(APP_EVENT.ALIGN.CENTER);
              break;
            case "우측정렬":
              changeEventArgs(APP_EVENT.ALIGN.RIGHT);
              break;
            case "양쪽정렬":
              changeEventArgs(APP_EVENT.ALIGN.JUSTIFY);
              break;

            case "왼쪽 정렬":
              changeEventArgs(APP_EVENT.ALIGN.LEFT);
              break;
            case "가운데 정렬":
              changeEventArgs(APP_EVENT.ALIGN.CENTER);
              break;
            case "오른쪽 정렬":
              changeEventArgs(APP_EVENT.ALIGN.RIGHT);
              break;
            case "양쪽 정렬":
              changeEventArgs(APP_EVENT.ALIGN.JUSTIFY);
              break;

            case "스크롤":
              changeEventArgs(APP_EVENT.SCROLL.SCROLLED);
              break;
            case "페이지":
              changeEventArgs(APP_EVENT.SCROLL.PAGINATED);
              break;

            case "원본":
              changeEventArgs("");
              break;

            case "삭제":
              changeEventArgs();
              break;
          }
          // document.body.removeChild(div);
          buttonArgs.innerHTML = stringArgs[i];
        });
        li.appendChild(button);
        ul.appendChild(li);
      }

      div.appendChild(ul);

      let evt = args.find((x) => {
        if (Object.prototype.toString.call(x) == "[object PointerEvent]" || Object.prototype.toString.call(x) == "[object MouseEvent]") {
          return x;
        }
      });
      div.style.position = "absolute";
      div.style.left = evt.clientX + "px";
      div.style.top = evt.clientY + paddingY + "px";
      div.style.zIndex = 30;
      document.body.appendChild(div);

      evt.preventDefault();
      evt.stopPropagation();
    }

    //파라미터 데이터 { text, handler, evt}
    function openSelectModalInReadingNote() {
      const temp = closeMenuModal();
      if (temp > 0) return;
      let paddingY = 10;
      let args = Array.from(arguments);

      let div = document.createElement("div");
      div.classList.add("menu-more__container");
      let ul = document.createElement("ul");
      ul.classList.add("menu-more");
      ul.classList.add("menu-more--sm");
      for (let i = 0; i < args.length; i++) {
        li = document.createElement("li");
        button = document.createElement("button");
        li.classList.add("menu-more__item");
        button.classList.add("menu-more__button");
        button.innerHTML = args[i].text;
        button.addEventListener("click", (e) => {
          e.stopPropagation();
          closeModalDetail();
          args[i].handler();
        });
        li.appendChild(button);
        ul.appendChild(li);
      }
      div.appendChild(ul);

      div.style.position = "absolute";
      div.style.left = args[0].evt.clientX + "px";
      div.style.top = args[0].evt.clientY + paddingY + "px";
      div.style.zIndex = 30;
      document.body.appendChild(div);

      args[0].evt.preventDefault();
      args[0].evt.stopPropagation();
    }
    /* #endregion */

    //#region modal handle
    function closeModalDetail() {
      let modalSelect = document.getElementsByClassName(
        "menu-more__container"
      );
      for (let i = 0; i < modalSelect.length; i++) {
        document.body.removeChild(modalSelect[i]);
      }
    }

    window.addEventListener("click", () => {
      closeModalDetail();
    });

    function modalTabHandler(btn) {
      let tabs = btn.parentNode.getElementsByClassName("modal-tab__button");
      for (let i = 0; i < tabs.length; i++) {
        tabs[i].classList.remove("modal-tab__button--active");
      }
      btn.classList.add("modal-tab__button--active");

      const book = document.getElementById("div-find-text-book");
      const korean = document.getElementById("div-find-text-korean");
      const english = document.getElementById("div-find-text-english");
      const pedia = document.getElementById("div-find-text-pedia");

      if (!book || !korean || !english || !pedia) return;
      switch (btn.innerHTML.trim()) {
        case "국어사전":
          korean.style.display = "block";
          // empty.style.display = "none";
          book.style.display = "none";
          english.style.display = "none";
          pedia.style.display = "none";
          break;
        case "본문":
          korean.style.display = "none";
          // empty.style.display = "none";
          book.style.display = "block";
          english.style.display = "none";
          pedia.style.display = "none";
          break;
        case "영어사전":
          korean.style.display = "none";
          // empty.style.display = "none";
          book.style.display = "none";
          english.style.display = "block";
          pedia.style.display = "none";
          break;
        case "백과사전":
          korean.style.display = "none";
          // empty.style.display = "none";
          book.style.display = "none";
          english.style.display = "none";
          pedia.style.display = "block";
          break;
      }
    }

    function closeModal() {
      let modals = document.getElementsByClassName("modal-parent");
      for (let i = 0; i < modals.length; i++) {
        fadeOut(modals[i]);
        modals[i].style.display = "none";
      }
      const count = modals.length;
      // let settingModal = document.getElementsByClassName("setting");
      // for (let i = 0; i < settingModal.length; i++) {
      //   settingModal[i].style.display = "none";
      // }

      let btn = document.getElementById("btn-chapter");
      let img = btn.getElementsByTagName("img")[0];
      img.src = img.src.replace("_on", "");
      let span = btn.getElementsByTagName("span")[0];
      span.classList.remove("color-secondary");
      return count;
    }

    function closeMenuModal() {
      let menuModal = document.getElementsByClassName("menu-more__container");
      const count = menuModal.length;
      for (let i = 0; i < menuModal.length; i++) {
        menuModal[i].remove();
      }
      return count;
    }

    function openMemoModal(content, memo, type) {
      let modal = document.getElementById("modal-memo");
      fadeIn(modal);
      // modal.style.display = "block";

      let modalText = document.getElementById("modal-memo-text");
      modalText.innerHTML = content;

      let modalNote = document.getElementById("modal-memo-note");
      modalNote.value = memo;

      if (type == "add") {
        document.getElementById("button-add-complete").style.display = "flex";
        document.getElementById("button-modify-complete").style.display = "none";
        document.getElementById("memo-window-circle").setAttribute("style", "");
      } else if (type == "modify") {
        // httpGet("GetNoteByPosition", {
        //   MemberNo: _memberNo,
        //   BookNo: _bookNo,
        //   NotePositionValue: modifier.cfi,
        // }).then(function (result) {
        //   httpGet("getValueByCode", {
        //     Code: result[0].NoteHighlightColorKindcode,
        //     GroupCode: "V01",
        //   }).then(function (data) {
        //     document.getElementById("memo-window-circle").style.borderColor =
        //       data[0].borderColor;
        //     document.getElementById(
        //       "memo-window-circle"
        //     ).style.backgroundColor = data[0].backgroundColor;
        //     modifier.color = data[0].backgroundColor;
        //   })
        // })
        document.getElementById("button-add-complete").style.display = "none";
        document.getElementById("button-modify-complete").style.display =
          "flex";
      }

      changeMemoTextLength();
    }



    let currentRepColor = "#FFEDA8";
    function addMemoComplete(text, note, paramCfi) {
      let noteText = "";
      let noteTableContent = "";
      if (text) {
        noteTableContent = text;
      }
      else {
        noteTableContent = document.getElementById("modal-memo-text").innerText;
      }
      if (note) {
        noteText = note;
      }
      else {
        noteText = document.getElementById("modal-memo-note").value;
      }

      let memoCfi = "";
      if (paramCfi) {
        memoCfi = paramCfi;
      }
      else {
        memoCfi = adder.cfi;
      }
      chapterFromCfi(memoCfi).then((chapter) => {
        // httpPost("addnote", {
        //   MemberNo: _memberNo,
        //   BookNo: _bookNo,
        //   NotePositionValue: memoCfi,
        //   NoteText: noteText,
        //   NoteTableContent: noteTableContent,
        //   NoteHighlightColorKindcode: "#FFEDA8",
        //   NotePage: 1,
        //   NotePercentage: Math.round(
        //     book.locations.percentageFromCfi(memoCfi) * 100
        //   ),
        //   TableContentName: chapter.chapter,
        //   TableContentNameSub: chapter.chapterParent,
        // }).then(function (result) {
        //   closeModal();
        //   if (result < 1) {
        //     alert("메모등록 실패 관리자에게 문의바랍니다.");
        //   }
        //   else {
        //     if (!rendition.annotations.highlights.includes(memoCfi)) {
        //       rendition.annotations.highlight(
        //         memoCfi,
        //         { memo: true },
        //         undefined,
        //         undefined,
        //         undefined,
        //         currentRepColor
        //       );
        //     }
        //   }
        // })
      });

    }

    function modifyMemoComplete() {
      // httpPost("modifynote", {
      //   MemberNo: _memberNo,
      //   BookNo: _bookNo,
      //   NotePositionValue: modifier.cfi,
      //   NoteText: document.getElementById("modal-memo-note").value,
      // }).then(
      //   function (result) {
      //     closeModal();
      //     if (result < 1) {
      //       alert("메모등록 실패 관리자에게 문의바랍니다.");
      //     } else {
      //       if (inNote) {
      //         openReadingNote();
      //       }
      //     }
      //   });
      // rendition.annotations.remove(modifier.cfi, "highlight");
      // rendition.annotations.highlight(
      //   modifier.cfi,
      //   { memo: true },
      //   undefined,
      //   undefined,
      //   undefined,
      //   modifier.color
      // );
    }

    //#endregion

    /* #region 메모, 하이라이트 등 DB연동부분 */
    document.addEventListener("addHighlight", (e) => {
      rendition.annotations.highlight(
        e.detail.cfi,
        undefined,
        undefined,
        undefined,
        undefined,
        e.detail.color
      );
      chapterFromCfi(e.detail.cfi).then((chapter) => {
        // httpPost("addnote", {
        //   MemberNo: _memberNo,
        //   BookNo: _bookNo,
        //   NotePositionValue: e.detail.cfi,
        //   NoteText: "",
        //   NoteTableContent: e.detail.text,
        //   NoteHighlightColorKindcode: e.detail.color,
        //   NotePage: 1,
        //   NotePercentage: Math.round(book.locations.percentageFromCfi(e.detail.cfi) * 100),
        //   TableContentName: chapter.chapter,
        //   TableContentNameSub: chapter.chapterParent,
        // }).then(function (result) {
        //   if (result < 1) {
        //     alert("메모 등록 실패 관리자에게 문의바랍니다.");
        //   }
        // })

      });
    });
    document.addEventListener("removeHighlight", (e) => {
      rendition.annotations.remove(e.detail.cfi, "highlight");
      // httpPost("removenote", {
      //   MemberNo: _memberNo,
      //   BookNo: _bookNo,
      //   NotePositionValue: e.detail.cfi,
      // }).then(function (result) {
      //   if (result < 1) {
      //     alert("삭제 실패 관리자에게 문의바랍니다.");
      //   }
      // })
    });

    document.addEventListener("modifyHighlight", (e) => {
      // httpPost("modifynotecolor", {
      //   MemberNo: _memberNo,
      //   BookNo: _bookNo,
      //   NotePositionValue: e.detail.cfi,
      //   NoteHighlightColorKindcode: e.detail.color,
      // }).then((result) => {
      //   if (result < 1) {
      //     alert("삭제 실패 관리자에게 문의바랍니다.");
      //   }
      // })

      rendition.annotations.remove(e.detail.cfi, "highlight");
      if (rendition.annotations.memos.includes(e.detail.cfi)) {
        rendition.annotations.highlight(
          e.detail.cfi,
          { memo: true },
          undefined,
          undefined,
          undefined,
          e.detail.color
        );
      } else {
        rendition.annotations.highlight(
          e.detail.cfi,
          undefined,
          undefined,
          undefined,
          undefined,
          e.detail.color
        );
      }
    });

    function modifyHighlightColor(cfi, color) {
      // httpPost("modifynotecolor", {
      //   MemberNo: _memberNo,
      //   BookNo: _bookNo,
      //   NotePositionValue: cfi,
      //   NoteHighlightColorKindcode: color,
      // }).then((result) => {
      //   if (result < 1) {
      //     alert("수정 실패 관리자에게 문의바랍니다.");
      //   }
      // })

      rendition.annotations.remove(cfi, "highlight");
      if (rendition.annotations.memos.includes(cfi)) {
        rendition.annotations.highlight(
          cfi,
          { memo: true },
          undefined,
          undefined,
          undefined,
          color
        );
      } else {
        rendition.annotations.highlight(
          cfi,
          undefined,
          undefined,
          undefined,
          undefined,
          color
        );
      }
    }

    document.addEventListener("addMemo", (e) => {
      openMemoModal(e.detail.text, "", "add");
    });
    document.addEventListener("modifyMemo", (e) => {
      inNote = e.detail.inNote;
      // httpGet("GetNoteByPosition", {
      //   MemberNo: _memberNo,
      //   BookNo: _bookNo,
      //   NotePositionValue: e.detail.cfi,
      // }).then(function (result) {
      //   modifier.cfi = e.detail.cfi;
      //   openMemoModal(
      //     result[0].NoteTableContent,
      //     result[0].NoteText,
      //     "modify"
      //   );
      // })

    });
    let inNote;
    document.addEventListener("shareContent", (e) => {
      //todo : 공유 창 띄워야함
      copyTextToClipboard(e.detail.text);
      alert("클립보드에 복사되었습니다.");

    });
    /* #endregion */

    //#region 페이지 이동 저장
    var prevPage = [];
    let prevClick = false;
    let prevMethod;
    let term = false;
    document.addEventListener("pageMoveBefore", (e) => {
      if (!prevClick && !term) {
        prevMethod = window.setTimeout(function () {
          prevPage.push(e.detail.cfi);
          if (prevPage.length > 30) {
            prevPage.splice(0, 1);
          }
          term = false;
        }, 50)
        term = true;
      }

    });
    //#endregion

    //#region reading time
    document.addEventListener("load", function () {

    })

    //#endregion

    /* #region 리뷰 */
    function openReviewModal() {


      document.getElementById("span-review-length").innerHTML = "0";
      document.getElementById("textarea-review").value = '';
      document.getElementById("input-star").value = 5;
      for (let star of document.getElementsByClassName("stars--primary")[0].getElementsByTagName("img")) {
        star.src = './images/stars/star_primary_full.svg';
      }
      document.getElementById("text-starpoint").innerHTML = "내 별점 5점";

      closeModal();
      const modal = document.getElementById("modal-review");
      fadeIn(modal);

      getReview(_contentNo, getCookie("utc_time"), _memberNo).then(function (data) {
        // httpGet("GetContentFeedbackList", { ContentNo: _bookNo }).then(function (data) {

        document.getElementById("ul-review").innerHTML = "";
        document.getElementById("div-mine").innerHTML = "";

        document.getElementById("div-mine").style.display = "none";
        document.getElementById("div-write-review").style.display = "block";
        let average = data.average;
        let i = 0;
        let writeBefore = false;
        if (!data.comments) {
          document.getElementById("div-review-average").innerHTML = "0";
        }
        else {
          for (let item of data.comments) {
            if (item.user.id == _memberNo) {
              writeBefore = true;
              document.getElementById("div-mine").style.display = "block";
              document.getElementById("div-write-review").style.display = "none";
              let profileImage = "./images/profile.svg";
              if (item.user.avatar) {
                profileImage = item.user.avatar;
              }
              let ele = `<div class="review-item__header">
                <div class="row">
                  <div class="thumbnail">
                    <img src="${profileImage}" alt="">
                  </div>
                  <div class="row review-item__name">
                    <b>${item.user.name}</b>님
                  </div>
                  <div class="review-item__date">
                    ${(item.date)}
                  </div>
                </div>
                <div class="row">
                  <div class="stars--primary small">
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                    <button class="star">
                      <img src="./images/stars/star_primary_zero.svg" alt="">
                    </button>
                  </div>
                </div>
              </div>
              <div id="div-review-content" class="review-item__content"><pre style="word-wrap: break-word; white-space: pre-wrap;">${item.content}</pre></div>

              <div class="my-review__buttons">
                <button class="my-review__button edit" onclick=modifyReview(${item.id})>
                  <img alt="수정" src="./images/review_edit.svg"  />
                  수정
                </button>

                <button class="my-review__button remove" onclick="removeReview(${item.id})">
                  <img alt="삭제" src="./images/review_remove.svg" />
                  삭제
                </button>
              </div>`;

              let template = document.createElement("template");
              template.innerHTML = ele;
              document.getElementById("div-mine").appendChild(template.content.cloneNode(true));

              setStar(document.getElementById("div-mine"), item.rating);
              document.getElementById("div-mine").setAttribute("starPoint", item.rating);
              // average += Number(item.StarPoint);
              continue;
            }

            let profileImage = "./images/profile.svg";
            if (item.user.avatar) {
              profileImage = item.user.avatar;
            }

            let ele = `<li>
              <div class="review-item">
                <div class="review-item__inner">
                  <div class="review-item__header">
                    <div class="row">
                      <div class="thumbnail">
                        <img src="${profileImage}" alt="">
                      </div>
                      <div class="row review-item__name">
                        <b>${item.user.name}</b>님
                      </div>
                      <div class="review-item__date">
                      ${(item.date)}
                      </div>
                    </div>
                    <div class="row">          
                      <div class="stars--primary small">
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_full.svg" alt="">
                                    </button>
                                    <button class="star">
                                      <img src="./images/stars/star_primary_half.svg" alt="">
                                    </button>
                                  </div>
                    </div>
                  </div>
                  <div class="review-item__content">${item.content}</div>
                  <div class="modal-content__bottom" style="float:right;"><button class="button-more" onclick="reviewDetailModal(event, ${item.user.id}, ${item.id},'${item.user.name}')"></button></div>
                </div>
              </div>
              <span class="dashed"></span>
            </li>`;
            let template = document.createElement("template");
            template.innerHTML = ele;
            document.getElementById("ul-review").appendChild(template.content.cloneNode(true));

            setStar(document.getElementById("ul-review").children[i], item.rating);

            if (writeBefore) {
              document.getElementById("div-mine").display = "none";
              document.getElementById("div-write-review").display = "block";
            }
            else {
              document.getElementById("div-mine").display = "block";
              document.getElementById("div-write-review").display = "none";
            }
            i++;
            // average += Number(item.StarPoint);
          }
        }

        if (!data.comments || data.comments.length == 0) {
          document.getElementById("div-review-average").innerHTML = 0;
        }
        else {
          document.getElementById("div-review-average").innerHTML = average;
        }

        const averageStars = document.getElementById("div-review-average-stars").getElementsByTagName("img");
        for (let star of averageStars) {
          star.src = './images/stars/star_average_0.svg';
        }
        const star100 = Math.floor(document.getElementById("div-review-average").innerHTML);
        for (let i = 0; i < star100; i++) {
          averageStars[i].src = "./images/stars/star_average_100.svg";
        }
        if (document.getElementById("div-review-average").innerHTML > 1) {
          if (star100 != 5) {
            if (Math.round((document.getElementById("div-review-average").innerHTML - star100) * 10) == 0) {
              averageStars[star100].src = `./images/stars/star_average_0.svg`;;
            }
            else {
              averageStars[star100].src = `./images/stars/star_average_${Math.round((document.getElementById("div-review-average").innerHTML - star100) * 10)}0.svg`;
            }
          }
        }


        if (writeBefore == true) {
          document.getElementById("div-mine").style.display = "block";
          document.getElementById("div-write-review").style.display = "none";
        }
        else {
          document.getElementById("div-mine").style.display = "none";
          document.getElementById("div-write-review").style.display = "block ";
        }

      })

      document.getElementById("btn-review-modify").style.display = "none";
      document.getElementById("btn-review-register").style.display = "block";
    }

    function setStar(ele, starPoint) {
      const halfStarImageSource = "./images/stars/star_primary_half.svg";
      const starImageSource = "./images/stars/star_primary_full.svg";
      const zeroStarImageSource = "./images/stars/star_primary_zero.svg";
      const stars = ele.getElementsByClassName("star");
      for (let star of stars) {
        star.getElementsByTagName("img")[0].src = zeroStarImageSource;
      }

      let j = 0;
      for (j = 0; j < starPoint; j++) {
        stars[j].getElementsByTagName("img")[0].src = starImageSource;

      }
      if (Number.isInteger(parseFloat(starPoint)) == false) {
        stars[j - 1].getElementsByTagName("img")[0].src = halfStarImageSource;
      }
    }

    function changeStar(sender) {
      const halfStarImageSource = "./images/stars/star_primary_half.svg";
      const starImageSource = "./images/stars/star_primary_full.svg";
      const zeroStarImageSource = "./images/stars/star_primary_zero.svg";

      const div = document.getElementById("div-write-review")
      stars = div.getElementsByClassName("star");

      for (let star of stars) {
        star.getElementsByTagName("img")[0].src = zeroStarImageSource;
      }
      const starPoint = sender.value;

      let i = 0;
      for (i = 0; i < starPoint; i++) {
        stars[i].getElementsByTagName("img")[0].src = starImageSource;
      }
      if (Number.isInteger(parseFloat(starPoint)) == false) {
        stars[i - 1].getElementsByTagName("img")[0].src = halfStarImageSource;
      }

      document.getElementById("text-starpoint").innerHTML = "내 별점 " + starPoint + "점";
    }

    function fixRangePosition(sender, evt) {
      const scrollTop = sender.scrollTop;
      const input = document.getElementById("input-star");
      input.style.transform = "translate(0, -" + scrollTop + "px)";
    }

    function registerReview() {
      if (document.getElementById("textarea-review").value.trim().length == 0) {
        alert("리뷰를 입력해 주세요.");
        return;
      }
      // httpPost("addContentFeedbackByMember", {
      //   MemberNo: _memberNo, ContentNo: _bookNo,
      //   ReviewText: document.getElementById("textarea-review").value,
      //   StarPoint: document.getElementById("input-star").value,
      //   PublishYN: "Y"
      // }).then(function () {
      //   openReviewModal();
      // })
    }
    function modifyReview(ContentFeedbackNo) {
      document.getElementById("textarea-review").value = document.getElementById("div-review-content").getElementsByTagName("pre")[0].innerHTML;
      document.getElementById("input-star").value = document.getElementById("div-mine").getAttribute("starPoint");
      setStar(document.getElementById("div-write-review"), document.getElementById("div-mine").getAttribute("starPoint"));
      document.getElementById("text-starpoint").innerHTML = "내 별점 " + document.getElementById("div-mine").getAttribute("starPoint") + "점"
      document.getElementById("div-mine").setAttribute("ContentFeedbackNo", ContentFeedbackNo);
      document.getElementById("div-mine").style.display = "none";
      document.getElementById("div-write-review").style.display = "block";

      document.getElementById("btn-review-modify").style.display = "block";
      document.getElementById("btn-review-register").style.display = "none";

      changeReviewTextLength();
    }

    function modifyReviewCancel() {
      // document.getElementById("div-mine").style.display = "block";
      // document.getElementById("div-write-review").style.display = "none";
      // document.getElementById("btn-review-modify").style.display = "none";
      // document.getElementById("btn-review-register").style.display = "block";

      document.getElementById("modal-review").style.display = "none";
    }

    function modifyReviewComplete() {
      if (document.getElementById("textarea-review").value.trim().length == 0) {
        alert("리뷰를 입력해 주세요.");
        return;
      }
      // httpPost("ModifyContentFeedbackByMember", {
      //   ContentFeedbackNo: document.getElementById("div-mine").getAttribute("ContentFeedbackNo"),
      //   ReviewText: document.getElementById("textarea-review").value,
      //   StarPoint: document.getElementById("input-star").value,
      //   PublishYN: "Y"
      // }).then(function () {
      //   openReviewModal();
      // })
    }

    function removeReview(contentFeedbackNo) {
      if (confirm("삭제하시겠습니까?")) {
        // httpPost("RemoveContentFeedbackByMember", { "ContentFeedbackNo": contentFeedbackNo }).then(function (data) {
        //   if (data) {
        //     openReviewModal();
        //   }
        //   else {
        //     alert("삭제 실패 관리자에게 문의하세요.")
        //   }
        // });
      }
    }

    function reviewDetailModal(e, memberNo, reviewNo, targetNickname) {
      const ele = `<div class="menu-more__container" style="position: absolute; left:${e.clientX}px; top:${e.clientY}px; z-index: 30;">
      <ul class="menu-more menu-more--sm">
      <li class="menu-more__item"><button onclick="reviewReportClick('${targetNickname}',${reviewNo})" class="menu-more__button">신고</button></li>
      <li class="menu-more__item"><button onclick="reviewBlockClick('${memberNo}',${reviewNo})" class="menu-more__button">차단</button></li>
      </ul></div>`;

      const template = document.createElement("template");
      template.innerHTML = ele;

      document.body.appendChild(template.content.cloneNode(true));

      e.stopPropagation();
    }

    function reviewBlockClick(memberNo, reviewNo) {
      if (confirm("차단하시겠어요?")) {
        blockUser(_memberNo, memberNo).then(function (data) {
          if (Number(data) > 0) {
            alert("차단되었습니다");
            openReviewModal();
          }
        });
      }
    }

    function reviewReportClick(memberNo, reviewNo) {
      //reset controll
      document.getElementById("option-report").selectedIndex = 0;
      document.getElementById("textarea-report").value = "";
      document.getElementById("div-report-text").style.display = "none";
      //
      fadeIn(document.getElementById("modal-report"));
      document.getElementById("modal-report").setAttribute("contentFeedbackNo", reviewNo);
      document.getElementById("modal-report").setAttribute("nickname", memberNo);
    }

    /* #endregion */

    /* #region 입력창에서 이벤트 버블링 막기 */
    document.getElementById("modal-memo-note").addEventListener("keyup", function (e) {
      e.stopPropagation();
    })
    document.getElementById("input_search").addEventListener("keyup", function (e) {
      e.stopPropagation();
    })

    document.getElementById("textarea-review").addEventListener("keyup", function (e) {
      e.stopPropagation();
    })
    /* #endregion */

    //#region 공유하기 
    function fallbackCopyTextToClipboard(text) {
      var textArea = document.createElement("textarea");
      textArea.value = text;

      // Avoid scrolling to bottom
      textArea.style.top = "0";
      textArea.style.left = "0";
      textArea.style.position = "fixed";

      document.body.appendChild(textArea);
      $(textArea).focus();
      $(textArea).select();

      try {
        var successful = document.execCommand('copy');
        var msg = successful ? 'successful' : 'unsuccessful';
        if (text.length > 1000) {
          alert("1000자 이상 복사가 불가능합니다. 1000자까지 복사되었습니다.");
        }
      } catch (err) {
      }

      document.body.removeChild(textArea);
    }
    function copyTextToClipboard(text) {
      if (!navigator.clipboard) {
        fallbackCopyTextToClipboard(text + '\n[출처 : 두플러스] 《' + document.getElementById("h1-title").innerHTML + '》의 콘텐츠는 저작권의 보호를 받고 있습니다. 무단 전재와 무단 복재를 금하며 공유시 출처를 반드시 명시하여 콘텐츠를 소중히 지켜주시기 바랍니다.');
        return;
      }
      navigator.clipboard.writeText(text + '\n[출처 : 두플러스] 《' + document.getElementById("h1-title").innerHTML + '》의 콘텐츠는 저작권의 보호를 받고 있습니다. 무단 전재와 무단 복재를 금하며 공유시 출처를 반드시 명시하여 콘텐츠를 소중히 지켜주시기 바랍니다.').then(() => {
        if (text.length > 1000) {
          alert("1000자 이상 복사가 불가능합니다. 1000자까지 복사되었습니다.");
        }
      }, function (err) {
        fallbackCopyTextToClipboard(text + '\n[출처 : 두플러스] 《' + document.getElementById("h1-title").innerHTML + '》의 콘텐츠는 저작권의 보호를 받고 있습니다. 무단 전재와 무단 복재를 금하며 공유시 출처를 반드시 명시하여 콘텐츠를 소중히 지켜주시기 바랍니다.');
      });
    }
    //#endregion 

    /* #region 모달창 떠있을때 모달 이외에 다른곳 누르면 닫게 함 */
    const modalParents = document.getElementsByClassName("modal-parent");
    for (let modalParent of modalParents) {
      modalParent.addEventListener("click", function (e) {
        if (!e.target.classList.contains("modal-parent")) {
          return;
        }
        closeModal();
        closeModalDetail();
        e.stopPropagation();
        e.preventDefault();
      });
    }
    /* #endregion */

    /* #region 설정저장 */
    function saveSetting() {
      // httpPost("")
    }
    /* #endregion */

    /* #region 스크롤시 선택창 닫기 */
    document.getElementById("div-reading-note-content").addEventListener("scroll", () => {
      closeModalDetail();
    })
    /* #endregion */

    //#region 우클릭 막기
    document.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });
    //#endregion

    //#region 프린트스크린 막기
    // document.addEventListener("keyup", function (e) {
    //   var keyCode = e.keyCode ? e.keyCode : e.which;
    //   if (keyCode == 44) {
    //     stopPrntScr();
    //   }
    // });

    // function stopPrntScr() {
    //   var inpFld = document.createElement("input");
    //   inpFld.setAttribute("value", ".");
    //   inpFld.setAttribute("width", "0");
    //   inpFld.style.height = "0px";
    //   inpFld.style.width = "0px";
    //   inpFld.style.border = "0px";
    //   document.body.appendChild(inpFld);
    //   inpFld.select();
    //   document.execCommand("copy");
    //   inpFld.remove(inpFld);
    // }
    // function AccessClipboardData() {
    //   try {
    //     window.clipboardData.setData('text', "Access   Restricted");
    //   } catch (err) {
    //   }
    // }
    // setInterval("AccessClipboardData()", 300);
    //#endregion

    /* #region 배경색 현재 클릭한 거 바인딩 */
    const colorbuttons = document.getElementById("modal-note").getElementsByClassName("color-label");
    for (let button of colorbuttons) {
      button.addEventListener("click", function () {
        const temps = colorbuttons;
        for (let temp of temps) {
          temp.classList.remove("on");
        }
        this.classList.add("on");
      })
    }

    function removeSelectColor() {
      const colorbuttons = document.getElementById("modal-note").getElementsByClassName("color-label");
      for (let button of colorbuttons) {
        button.classList.remove("on");
      }
    }
    /* #endregion */

    /* #region 설정 불러오기 */
    function getSetting() {
      let param = {};
      param.MemberNo = _memberNo;
      // httpGet("GetSetting", param).then(function (data) {
      //   for (let i = 0; i < data.length; i++) {
      //     applySetting(data[i].SettingValueKineCode, data[i].SettingValue);
      //   }
      // })
    }

    function applySetting(code, value) {
      switch (code) {
        case '008':
          changeBackground(value);
          break;
        case '001':
          changeFont(value);
          break;
        case '002':
          changeFontSize(value)
          break;
        case '003':
          changeLineHeight(value);
          break;
        case '004':
          changeParagraphHeight(value);
          break;
        case '005':
          changeParagraphWidth(value)
          break;
        case '006':
          changeAlign(value);
          break;
        case '009':
          if (value == "both") {
            window.setTimeout(function () {
              twoViewButton.click();
            }, 100)

          }
          else {
            window.setTimeout(function () {
              oneViewButton.click();
            }, 100)

          }
      }
    }



    /* #endregion */

    /* #region 상하단 누를때 adder끄기  */
    document.addEventListener("click", function () {
      let adder = document.getElementsByClassName("modal-highlight");

      for (let item of adder) {
        item.style.display = "none";
      }
    })
    /* #endregion */

    document.addEventListener("reportEvent", function () {
      prevClick = true;
      rendition.reportLocation();
    })

    /* #region CSS 다이나믹 바인딩  */

    function getColorData() {
      // httpGet("GetCommonCodeByCodeGroup", { GroupCode: "V01" }).then(function (colorData) {
      //   if (colorData && colorData.length > 0) {
      //     for (let i = 0; i < colorData.length; i++) {
      //       const style = document.createElement("style");
      //       style.type = "text/css";
      //       style.innerHTML = `.highlight-color-${(i + 1)} { border-color: ${colorData[i].ExtraField2}; background-color: ${colorData[i].ExtraField1};}`;
      //       document.getElementsByTagName("head")[0].appendChild(style);
      //     }
      //   }

      //   var textButtons = [];
      //   var textButton = {};
      //   textButton.text = "메모";
      //   textButtons.push(textButton);
      //   textButton = {};
      //   textButton.text = "공유";
      //   textButtons.push(textButton);
      //   adder = new Adder(textButtons, "adder");

      //   //modifier
      //   textButtons = [];
      //   textButton = {};
      //   textButton.text = "삭제";
      //   textButtons.push(textButton);
      //   textButton = {};
      //   textButton.text = "메모 수정";
      //   textButtons.push(textButton);
      //   modifier = new Adder(textButtons, "modifier");
      // })

      var textButtons = [];
      var textButton = {};
      textButton.text = "메모";
      textButtons.push(textButton);
      textButton = {};
      textButton.text = "공유";
      textButtons.push(textButton);
      adder = new Adder(textButtons, "adder");

      //modifier
      textButtons = [];
      textButton = {};
      textButton.text = "삭제";
      textButtons.push(textButton);
      textButton = {};
      textButton.text = "메모 수정";
      textButtons.push(textButton);
      modifier = new Adder(textButtons, "modifier");
    }
    getColorData();

    function getBackgroundData(doc) {
      for (let i = 1; i <= 6; i++) {
        // httpGet("GetValueByCode", { GroupCode: "V02", Code: "00" + i }).then(function (data) {
        //   if (i < 4) {
        //     const style = document.createElement("style");
        //     style.innerHTML = `.${data[0].value} {background-color : ${data[0].backgroundColor}; color : ${data[0].order}; 
        //   border-color:${data[0].borderColor};}`;
        //     doc.getElementsByTagName("head")[0].appendChild(style);
        //   }
        //   else {
        //     const style = document.createElement("style");
        //     style.innerHTML = `.${data[0].value},  .${data[0].value} *:not(svg) {background-color : ${data[0].backgroundColor}; color : ${data[0].order};
        //   border-color:${data[0].borderColor};}`;
        //     doc.getElementsByTagName("head")[0].appendChild(style);
        //   }

        // })
      }
    }
    getBackgroundData(document);


    /* #endregion */


    function iOS() {
      return [
        'iPad Simulator',
        'iPhone Simulator',
        'iPod Simulator',
        'iPad',
        'iPhone',
        'iPod'
      ].includes(navigator.platform)
        || (navigator.userAgent.includes("Mac"))
    }


    //마지막페이지 이벤트....=======================
    let lastScroll = false;
    document.addEventListener("lastPage", () => {
      if (!lastScroll) {
        lastScroll = true;
        if (_completeReadYN == "N") {
          if (confirm("마지막 페이지 입니다. 완독하셨습니까?")) {
            // httpPost("ModifyCompleteRead", { ContentNo: _contentNo, MemberNo: _memberNo }).then(function (data) {
            //   if (data > 0) {
            //     _completeReadYN = "Y";
            //   }
            // })
          }

        }
        else {
          alert("마지막 페이지입니다.");
        }

        setTimeout(function () {
          lastScroll = false;
        }, 3000)
      }
    })
    //마지막 페이지 이벤트 =========================


    //신고하기 시작==========
    getValueByCodeGroupCode("N03").then(function (data) {
      for (let item of data) {
        const ele = `<option value=${item.code}>${item.codeNameKor}</option>`;
        const template = document.createElement("template");
        template.innerHTML = ele;
        document.getElementById("option-report").appendChild(template.content.cloneNode(true));

      }
    })

    document.getElementById("option-report").addEventListener("change", function (e) {
      if (e.target.value == "005") {
        document.getElementById("div-report-text").style.display = "block";
      }
      else {
        document.getElementById("div-report-text").style.display = "none";
      }
    })

    function reportComplete() {
      if (confirm(document.getElementById("modal-report").getAttribute("nickname") + "님의 리뷰를 신고할까요?")) {
        reportReview(document.getElementById("modal-report").getAttribute("contentFeedbackNo"), document.getElementById("option-report").value, document.getElementById("textarea-report").value, _memberNo).then(function (result) {
          if (result > 0) {
            alert("신고되었습니다.");
          }

          document.getElementById("modal-report").style.display = "none";
        })
      }

    }
    //신고하기 끝 ============
  </script>
</body>

</html>