{"version":3,"sources":["webpack://ePub/webpack/universalModuleDefinition","webpack://ePub/webpack/bootstrap","webpack://ePub/./src/utils/core.js","webpack://ePub/./src/utils/constants.js","webpack://ePub/./src/epubcfi.js","webpack://ePub/./node_modules/event-emitter/index.js","webpack://ePub/./src/utils/path.js","webpack://ePub/./src/utils/url.js","webpack://ePub/./src/utils/hook.js","webpack://ePub/./node_modules/path-webpack/path.js","webpack://ePub/./src/utils/replacements.js","webpack://ePub/./src/utils/queue.js","webpack://ePub/./src/utils/scrolltype.js","webpack://ePub/./src/managers/helpers/stage.js","webpack://ePub/./src/managers/helpers/views.js","webpack://ePub/./src/managers/default/index.js","webpack://ePub/./src/mapping.js","webpack://ePub/./node_modules/lodash/debounce.js","webpack://ePub/./src/layout.js","webpack://ePub/./src/themes.js","webpack://ePub/./src/annotations.js","webpack://ePub/./src/rendition.js","webpack://ePub/./src/utils/range-util.js","webpack://ePub/./src/selectionObserver.js","webpack://ePub/./src/contents.js","webpack://ePub/./node_modules/marks-pane/lib/marks.js","webpack://ePub/external \"xmldom\"","webpack://ePub/(webpack)/buildin/global.js","webpack://ePub/./node_modules/es5-ext/object/is-value.js","webpack://ePub/./node_modules/lodash/isObject.js","webpack://ePub/./src/managers/views/iframe.js","webpack://ePub/./src/managers/helpers/snap.js","webpack://ePub/./src/managers/continuous/index.js","webpack://ePub/./node_modules/localforage/dist/localforage.js","webpack://ePub/./src/utils/request.js","webpack://ePub/./src/section.js","webpack://ePub/./src/spine.js","webpack://ePub/./src/locations.js","webpack://ePub/./src/container.js","webpack://ePub/./src/packaging.js","webpack://ePub/./src/navigation.js","webpack://ePub/./src/utils/mime.js","webpack://ePub/./src/resources.js","webpack://ePub/./src/pagelist.js","webpack://ePub/./src/archive.js","webpack://ePub/./src/store.js","webpack://ePub/./src/displayoptions.js","webpack://ePub/./src/book.js","webpack://ePub/./node_modules/type/value/is.js","webpack://ePub/./node_modules/lodash/_root.js","webpack://ePub/./node_modules/lodash/_Symbol.js","webpack://ePub/./node_modules/lodash/throttle.js","webpack://ePub/external \"JSZip\"","webpack://ePub/./src/epub.js","webpack://ePub/./node_modules/d/index.js","webpack://ePub/./node_modules/type/plain-function/is.js","webpack://ePub/./node_modules/type/function/is.js","webpack://ePub/./node_modules/type/prototype/is.js","webpack://ePub/./node_modules/type/object/is.js","webpack://ePub/./node_modules/es5-ext/object/assign/index.js","webpack://ePub/./node_modules/es5-ext/object/assign/is-implemented.js","webpack://ePub/./node_modules/es5-ext/object/assign/shim.js","webpack://ePub/./node_modules/es5-ext/object/keys/index.js","webpack://ePub/./node_modules/es5-ext/object/keys/is-implemented.js","webpack://ePub/./node_modules/es5-ext/object/keys/shim.js","webpack://ePub/./node_modules/es5-ext/function/noop.js","webpack://ePub/./node_modules/es5-ext/object/valid-value.js","webpack://ePub/./node_modules/es5-ext/object/normalize-options.js","webpack://ePub/./node_modules/es5-ext/string/#/contains/index.js","webpack://ePub/./node_modules/es5-ext/string/#/contains/is-implemented.js","webpack://ePub/./node_modules/es5-ext/string/#/contains/shim.js","webpack://ePub/./node_modules/es5-ext/object/valid-callable.js","webpack://ePub/./node_modules/marks-pane/lib/svg.js","webpack://ePub/./node_modules/marks-pane/lib/events.js","webpack://ePub/./node_modules/lodash/now.js","webpack://ePub/./node_modules/lodash/_freeGlobal.js","webpack://ePub/./node_modules/lodash/toNumber.js","webpack://ePub/./node_modules/lodash/_baseTrim.js","webpack://ePub/./node_modules/lodash/_trimmedEndIndex.js","webpack://ePub/./node_modules/lodash/isSymbol.js","webpack://ePub/./node_modules/lodash/_baseGetTag.js","webpack://ePub/./node_modules/lodash/_getRawTag.js","webpack://ePub/./node_modules/lodash/_objectToString.js","webpack://ePub/./node_modules/lodash/isObjectLike.js"],"names":["requestAnimationFrame","window","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","DOCUMENT_NODE","_URL","URL","webkitURL","mozURL","undefined","uuid","d","Date","getTime","replace","c","r","Math","random","floor","toString","documentHeight","max","document","documentElement","clientHeight","body","scrollHeight","offsetHeight","isElement","obj","nodeType","isNumber","n","isNaN","parseFloat","isFinite","isFloat","f","indexOf","prefixed","unprefixed","vendors","prefixes","lower","toLowerCase","length","style","i","defaults","arguments","source","prop","extend","target","sources","slice","call","forEach","Object","getOwnPropertyNames","propName","defineProperty","getOwnPropertyDescriptor","insert","item","array","compareFunction","location","locationOf","splice","_start","_end","start","end","pivot","parseInt","compared","a","b","indexOfSorted","bounds","el","getComputedStyle","widthProps","heightProps","width","height","borders","nodeBounds","node","elPos","doc","ownerDocument","Node","elRange","createRange","selectNodeContents","getBoundingClientRect","windowBounds","clientWidth","top","left","right","bottom","indexOfNode","typeId","parent","parentNode","children","childNodes","sib","index","indexOfTextNode","textNode","indexOfElementNode","elementNode","isXml","ext","createBlob","content","mime","Blob","type","createBlobUrl","tempUrl","blob","createObjectURL","revokeBlobUrl","url","revokeObjectURL","createBase64Url","data","datauri","btoa","encodeURIComponent","prototype","parse","markup","forceXMLDom","Parser","DOMParser","XMLDOMParser","charCodeAt","parseFromString","qs","sel","elements","Error","querySelector","getElementsByTagName","qsa","querySelectorAll","qsp","props","q","filtered","Array","filter","getAttribute","sprint","root","func","createTreeWalker","treeWalker","NodeFilter","SHOW_TEXT","walk","nextNode","callback","firstChild","walked","nextSibling","blob2base64","Promise","resolve","reject","reader","FileReader","readAsDataURL","onloadend","result","defer","id","promise","freeze","querySelectorByType","html","element","query","getAttributeNS","findChildren","push","parents","nodes","unshift","filterChildren","nodeName","single","getParentByTagName","tagname","tagName","RangeObject","constructor","collapsed","commonAncestorContainer","endContainer","endOffset","startContainer","startOffset","setStart","startNode","collapse","_commonAncestorContainer","_checkCollapsed","setEnd","endNode","toStart","selectNode","referenceNode","endIndex","textContent","startParents","endParents","EPUBJS_VERSION","DOM_EVENTS","EVENTS","BOOK","OPEN_FAILED","CONTENTS","EXPAND","RESIZE","SELECTED","SELECTED_RANGE","LINK_CLICKED","LOCATIONS","CHANGED","MANAGERS","RESIZED","ORIENTATION_CHANGE","ADDED","SCROLL","SCROLLED","REMOVED","VIEWS","AXIS","WRITING_MODE","LOAD_ERROR","RENDERED","DISPLAYED","SHOWN","HIDDEN","MARK_CLICKED","MARK_IMAGE_CLICKED","RENDITION","STARTED","ATTACHED","DISPLAY_ERROR","LOCATION_CHANGED","RELOCATED","LAYOUT","UPDATED","ANNOTATION","ATTACH","DETACH","EpubCFI","cfiFrom","base","ignoreClass","str","spinePos","range","path","parseComponent","steps","checkType","fromRange","fromNode","TypeError","cfi","isCfiString","cfiStr","baseComponent","pathComponent","getChapterComponent","getPathComponent","getRange","componentStr","component","terminal","offset","assertion","parts","split","parseTerminal","shift","map","step","parseStep","bind","stepStr","num","has_brackets","match","termialStr","characterOffset","textLocationAssertion","indirection","ranges","getCharecterOffsetComponent","splitStr","joinSteps","part","segment","join","segmentString","cfiString","compare","cfiOne","cfiTwo","stepsA","stepsB","terminalA","terminalB","rangeAStartSteps","rangeAEndSteps","rangeBEndSteps","rangeAStartTerminal","rangeAEndTerminal","rangeBStartTerminal","rangeBEndTerminal","concat","position","filteredStep","filteredNode","filteredPosition","pathTo","currentNode","equalStep","stepA","stepB","needsIgnoring","patchOffset","len","anchor","sibling","previousSibling","isText","classList","contains","curr","totalOffset","normalizedMap","output","prevIndex","currNodeType","prevNodeType","textNodes","stepsToXpath","xpath","stepsToQuerySelector","container","walkToNode","_doc","getElementById","findNode","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","fixMiss","child","lastStepIndex","childIndex","hasOwnProperty","toRange","startSteps","endSteps","missed","e","console","log","generateChapterComponent","_spineNodeIndex","_pos","pos","spineNodeIndex","getElementOrder","arr","Path","pathString","protocol","parsed","pathname","isDirectory","directory","dir","filename","extension","what","isAbsolute","charAt","relative","splitPath","splitPathRe","exec","Url","urlString","baseString","absolute","basePath","href","origin","hash","search","fullpath","Hook","context","hooks","register","j","deregister","hook","trigger","args","promises","task","executing","apply","err","all","list","clear","replaceBase","section","head","createElement","insertBefore","setAttribute","replaceCanonical","link","canonical","appendChild","replaceMeta","meta","idref","replaceLinks","contents","fn","links","replaceLink","linkUrl","error","onclick","substitute","urls","replacements","RegExp","Queue","_q","tick","running","paused","enqueue","deferred","queued","run","dequeue","inwait","then","dump","defered","flush","pause","stop","Task","toApply","value","scrollType","definer","createDefiner","scrollLeft","Element","scrollIntoView","removeChild","overflow","innerDiv","spanA","display","spanB","Stage","_options","settings","create","hidden","wrapper","wrap","options","axis","direction","marginLeft","marginRight","add","wordSpacing","lineHeight","verticalAlign","flexDirection","flexWrap","fullsize","visibility","getElement","_element","attachTo","getContainer","onResize","resizeFunc","throttle","addEventListener","onOrientationChange","orientationChangeFunc","size","_width","_height","containerStyles","containerPadding","_windowBounds","bodyStyles","bodyPadding","box","getSheet","createTextNode","sheet","addStyleRules","selector","rulesArray","scope","rules","set","insertRule","destroy","removeEventListener","Views","_views","first","last","view","get","append","prepend","remove","displayed","find","show","hide","DefaultViewManager","name","optsSettings","View","request","renditionQueue","queue","infinite","writingMode","flow","viewSettings","layout","method","forceEvenPages","rendered","render","tag","rtlScrollType","stage","views","_bounds","_stageSize","onResized","addEventListeners","updateLayout","scroller","_onScroll","onScroll","removeEventListeners","clearTimeout","orientationTimeout","resizeTimeout","afterScrolled","orientation","resizeOnOrientationChange","resize","setTimeout","emit","epubcfi","stageSize","winBounds","createView","forceRight","handleNextPrePaginated","action","next","divisor","properties","includes","displaying","visible","scrollTo","moveTo","reportEvent","CustomEvent","dispatchEvent","afterDisplayed","afterResized","distX","distY","isPaginated","delta","scrollWidth","onDisplayed","on","updateAxis","mode","updateWritingMode","getElementsByClassName","counter","scrollBy","heightDelta","widthDelta","offsetWidth","scrollTop","prev","current","currentLocation","paginatedLocation","scrolledLocation","pageHeight","pageWidth","vertical","rtl","used","scrollY","scrollX","sections","startPos","endPos","stopPos","totalPages","count","pages","currPage","ceil","endPage","tempStartPage","pg","mapping","page","cfiBase","min","abs","startPage","isVisible","offsetPrev","offsetNext","_container","viewsLength","x","y","silent","ignore","scrolled","scrollBy2","applyLayout","calculate","gap","setLayout","Mapping","forceUpdate","spread","updateFlow","defaultScrolledOverflow","getContents","viewContents","getAllContents","isRendered","EventEmitter","dev","horizontal","_dev","findRanges","rangeListToCfiList","rangePairToCfiPair","findStart","findEnd","startRange","endRange","selection","defaultView","getSelection","removeAllRanges","addRange","acceptNode","trim","FILTER_ACCEPT","FILTER_REJECT","safeFilter","columns","spreads","spreadWidth","columnWidth","stack","$el","found","$prev","findTextStartRange","round","findTextEndRange","splitTextNodeIntoRanges","_splitter","text","splitter","rangePair","startCfi","endCfi","cifPair","Layout","_spread","_minSpreadWidth","minSpreadWidth","_evenSpreads","evenSpreads","_flow","update","_gap","format","formating","fit","totalLength","pageLength","keys","newProps","Themes","rendition","_themes","_overrides","_current","_injected","inject","overrides","registerThemes","default","registerUrl","registerRules","theme","themes","registerCss","css","input","select","removeClass","addClass","addStylesheet","serialized","addStylesheetCss","injected","addStylesheetRules","override","priority","changeChildCss","removeOverride","rule","fontSize","font","Annotations","highlights","memos","underlines","marks","_annotations","_annotationsBySectionIndex","unloaded","cfiRange","cb","className","styles","color","memo","encodeURI","sectionIndex","annotation","Annotation","attach","_removeFromAnnotationBySectionIndex","detach","_annotationsAt","h","highlight","removeAllHighlight","underline","mark","each","annotations","unhighlight","ununderline","unmark","Rendition","book","manager","stylesheet","script","snap","defaultDirection","serialize","handleLinks","passEvents","adjustImages","spine","injectIdentifier","injectStylesheet","injectScript","opened","starting","started","setManager","requireManager","viewManager","ContinuousViewManager","requireView","IframeView","package","metadata","displayOptions","fixedLayout","ViewManager","load","globalLayoutProperties","determineLayoutProperties","afterRemoved","debounce","reportLocation","_display","locations","cfiFromPercentage","triggerMarkEvent","triggerMarkImageEvent","loadingDiv","fixSize","viewport","_layout","changed","evt","detail","reportedLocation","reportedLocationAfterRAF","located","percentage","total","locationStart","locationFromCfi","locationEnd","percentageFromLocation","pageStart","pageList","pageFromCfi","pageEnd","atEnd","atStart","ev","triggerViewEvent","triggerSelectedEvent","startTop","startLeft","endTop","endLeft","triggerCustomSelectedEvent","triggerCustomSelectedCancelEvent","cfirange","_cfi","computed","paddingTop","paddingBottom","horizontalPadding","paddingLeft","paddingRight","ident","packaging","identifier","isSelectionBackwards","focusNode","anchorNode","focusOffset","anchorOffset","getRangeAt","isNodeInRange","nodeValue","comparePoint","forEachNodeInRange","nodeIter","createNodeIterator","SHOW_ALL","getTextBoundingBoxes","whitespaceOnly","rects","nodeRange","viewportRects","from","getClientRects","selectionFocusRect","isCollapsed","textBoxes","loc","itemsForRange","itemForNode","checkedNodes","Set","items","has","SelectionObserver","eventHandler","iosChecker","calculateTarget","rangeUtil","preventDefault","addListener","removeListener","getLoc","selectionRect","hasNavigator","navigator","isChrome","test","userAgent","isWebkit","Contents","_size","epubReadingSystem","called","active","selectionObserver","listeners","listenedEvents","w","frame","contentWidth","contentHeight","textWidth","rect","border","textHeight","overflowX","overflowY","property","setProperty","removeProperty","allElement","_scale","_minimum","_maximum","_scalable","$viewport","newContent","hasAttribute","scale","minimum","maximum","scalable","expand","imageLoadListeners","mediaQueryListeners","addSelectionListeners","ResizeObserver","resizeListeners","visibilityListeners","resizeObservers","linksHandler","removeListeners","removeSelectionListeners","observer","disconnect","expanding","resizeCheck","visibilityState","transitionListeners","_resizeCheck","sheets","styleSheets","mediaChangeHandler","m","matches","_expanding","cssRules","media","mql","matchMedia","mediaText","observe","mutationObservers","MutationObserver","mutations","config","attributes","childList","characterData","subtree","images","img","naturalWidth","onload","fontLoadListeners","fonts","ready","targetPos","newRange","Range","substring","src","$stylesheet","rel","onreadystatechange","readyState","_getStylesheetNode","key","styleEl","serializedCss","innerHTML","styleSheet","rl","propStr","pl","selectors","definition","isArray","_rules","addScript","$script","async","classes","t","_triggerEvent","triggerEvent","eventName","passive","_onSelectionChange","onSelectionChange","selectionEndTimeout","rangeCount","cfiFromRange","cfiFromNode","layoutStyle","COLUMN_AXIS","COLUMN_GAP","COLUMN_WIDTH","COLUMN_FILL","scaler","offsetX","offsetY","scaleStr","translateStr","viewportWidth","viewportHeight","widthScale","heightScale","mapPage","_layoutStyle","version","hasFeature","feature","added","fixedWidth","fixedHeight","pane","icons","panes","flex","iframe","createContainer","scrolling","seamless","resizing","elementBounds","supportsSrcdoc","sectionRender","setAxis","setWritingMode","addListeners","reset","_textWidth","_contentWidth","_textHeight","_contentHeight","_needsReframe","lock","elBorders","iframeBorders","lockedWidth","lockedHeight","force","reframe","prevBounds","placeMark","loading","loaded","event","onLoad","blobUrl","srcdoc","contentDocument","open","MSApp","execUnsafeLocalFunction","outerThis","write","close","contentWindow","rendering","layoutFunc","transform","stopExpanding","offsetTop","offsetLeft","parentPos","assign","emitter","Pane","Highlight","addMark","firstRect","imageLeft","imageTop","imageTag","pop","userSelect","webkitUserSelect","stopPropagation","empty","pointerEvents","Underline","dataset","l","item2","removeMark","removeHighlight","PI_D2","PI","EASING_EQUATIONS","easeOutSine","sin","easeInOutSine","cos","easeInOutQuint","pow","easeInCubic","Snap","duration","minVelocity","minDistance","easing","supportsTouch","setup","disableScroll","afterScrolledTimeout","isVertical","touchCanceler","resizeCanceler","snapping","startTouchX","startTouchY","startTime","endTouchX","endTouchY","endTime","DocumentTouch","enableScroll","_onResize","_onTouchStart","onTouchStart","_onTouchMove","onTouchMove","_onTouchEnd","onTouchEnd","_afterDisplayed","off","screenX","screenY","touches","now","deltaY","swipped","wasSwiped","snapWidth","distance","time","velocity","needsSnap","howMany","snapTo","smoothScrollTo","destination","timeFunction","scroll","performance","offsetDelta","fill","_full","full","check","removeShownListeners","expanded","_offset","updating","trimTimeout","catch","_offsetLeft","_offsetTop","checking","newViews","visibleLength","contentLength","firstIndex","lastIndex","above","below","erase","prevTop","prevLeft","addScrollListeners","snapper","scrollDeltaVert","scrollDeltaHorz","_scrolled","didScroll","prevScrollTop","prevScrollLeft","scrollTimeout","withCredentials","headers","supportsURL","BLOB_RESPONSE","xhr","XMLHttpRequest","xhrPrototype","header","xmlHttpRequestOverrideMimeType","handler","onerror","setRequestHeader","responseType","overrideMimeType","send","DONE","responseXML","status","response","message","JSON","platform","maxTouchPoints","isAndroid","isIOS","alert","Section","linear","_request","Request","xml","isIE","Serializer","XMLSerializer","XMLDOMSerializer","serializer","serializeToString","_query","excerpt","limit","chapter","maxSeqEle","excerptLimit","nodeList","textWithCase","reduce","acc","startNodeIndex","endNodeIndex","beforeEndLengthCount","reconcileLayoutSettings","globalLayout","_range","cfiFromElement","unload","Spine","spineItems","spineByHref","spineById","manifest","baseUrl","unpack","_package","resolver","manifestItem","spineItem","nextIndex","decodeURI","Locations","_locations","_locationsWords","break","_wordCounter","_currentCfi","processingTimeout","generate","chars","process","completed","_break","parser","dist","generateFromWords","wordCount","processWords","parseWords","remainingCount","countWords","s","foundStartNode","percentageFromCfi","cfiFromLocation","warn","save","stringify","getCurrent","setCurrent","Container","containerDocument","packagePath","encoding","rootfile","dirname","xmlEncoding","Packaging","packageDocument","navPath","ncxPath","coverPath","metadataNode","manifestNode","spineNode","parseManifest","findNavPath","findNcxPath","findCoverPath","parseSpine","uniqueIdentifier","findUniqueIdentifier","parseMetadata","title","getElementText","creator","description","pubdate","publisher","language","rights","modified_date","getPropertyText","media_active_class","manifestXml","selected","overlay","spineXml","propArray","itemref","packageXml","uniqueIdentifierId","localName","namespaceURI","tocId","pkg","epubVersion","metaCover","coverId","cover","getElementsByTagNameNS","json","readingOrder","resources","toc","label","Navigation","tocByHref","tocById","landmarks","landmarksByType","ncx","parseNav","parseLandmarks","parseNcx","subitems","getByIndex","navItems","landmark","navHtml","navElement","navList","parseNavList","navListHtml","navItem","nested","landmarkItem","tocXml","navPoints","ncxItem","navLabel","table","mimeTypes","subtype","val","defaultValue","lookup","Resources","archive","replacementUrls","assets","cssUrls","splitUrls","createUrl","parsedUrl","mimeType","replaceCss","replaced","replacement","createCssFile","replacementUrl","indexInUrls","newUrl","textResponse","getText","relUrls","assetHref","resolved","relativeTo","PageList","firstPage","lastPage","navXml","pageTargets","navLabelText","pageText","isCfi","packageUrl","cfiFromPage","pageFromPercentage","percent","percentageFromPage","Archive","zip","urlCache","checkRequirements","JSZip","isBase64","loadAsync","openUrl","zipUrl","getBlob","handleResponse","decodededUrl","decodeURIComponent","substr","entry","file","uint8array","getBase64","useBase64","base64","revokeUrl","fromCache","Store","requester","storage","httpRequest","online","store","localforage","createInstance","_status","onLine","mapped","encodedUrl","getItem","setItem","put","retrieve","readAsText","DisplayOptions","displayOptionsDocument","interactive","openToSpread","orientationLock","displayOptionsNode","CONTAINER_PATH","IBOOKS_DISPLAY_OPTIONS_PATH","INPUT_TYPE","BINARY","BASE64","EPUB","OPF","MANIFEST","DIRECTORY","Book","ArrayBuffer","requestMethod","requestCredentials","requestHeaders","openAs","opening","isOpen","navigation","archived","determineType","openEpub","openPackaging","openManifest","openContainer","unarchive","loadNavigation","renderTo","setRequestCredentials","credentials","setRequestHeaders","replacementsSetting","originalUrl","substituteResources","coverUrl","ePub","VERSION","global","CFI","utils"],"mappings":"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IAAI,CAACF,IAAI,CAACiB,QAAQ,GAAG,IAAI,CAACxN,KAAK,CAACwN,QAAQ;IACzC,CAAC,MAAM;MACN,IAAI,CAACjB,IAAI,CAACE,KAAK,GAAG,IAAI,CAACF,IAAI,CAACE,KAAK,CAACyD,MAAM,CAAC,IAAI,CAACjQ,GAAG,CAACwM,KAAK,CAAC;MACxD,IAAI,CAACF,IAAI,CAACiB,QAAQ,GAAG,IAAI,CAACvN,GAAG,CAACuN,QAAQ;IACvC;EAGD;EAEAkG,eAAeA,CAAA,EAAE;IAEhB,IAAIC,GAAG,GAAG,IAAI,CAACvH,GAAG,CAACwB,KAAK,CAAC,GAAG,CAAC;IAC7B,OAAO+F,GAAG,CAAC,CAAC,CAAC;EACd;AACD;AAEe3H,gEAAO,E;;;;;;;AChiCT;;AAEb,eAAe,mBAAO,CAAC,EAAG;AAC1B,eAAe,mBAAO,CAAC,EAA+B;;AAEtD;AACA;AACA;AACA;AACA,kBAAkB;;AAElB;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,aAAa,4BAA4B;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa,OAAO;;AAEpB;AACA,aAAa,2BAA2B;AACxC;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,0BAA0B;;AAE1B;AACA;AACA;AACA;;;;;;;;ACnIA;AAAA;AAAgC;;AAEhC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM4H,IA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CA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,sCAAsC,8BAA8B;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA,mBAAmB,sBAAsB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,UAAU,yBAAyB;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU,qBAAqB;AAC/B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,UAAU,aAAa;AACvB;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,WAAW;AACX;AACA,qCAAqC;AACrC;AACA;AACA,SAAS;AACT;AACA;AACA,gDAAgD;AAChD;AACA,WAAW;AACX;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA2C,cAAc;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,+BAA+B,QAAQ;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC,QAAQ;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;;AAGH;AACA;;AAEA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,UAAU,YAAY;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,GAAG;;;AAGH;AACA;AACA;AACA;;;AAGA;;;;;;;;ACziBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiC;AACT;AACE;AAEnB,SAASiB,WAAWA,CAACrV,GAAG,EAAEsV,OAAO,EAAC;EACxC,IAAIvK,IAAI;EACR,IAAIwK,IAAI;EACR,IAAIlT,GAAG,GAAGiT,OAAO,CAACjT,GAAG;EACrB,IAAIwR,QAAQ,GAAIxR,GAAG,CAAC1F,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAE;EAExC,IAAG,CAACqD,GAAG,EAAC;IACP;EACD;EAEAuV,IAAI,GAAGlS,gDAAE,CAACrD,GAAG,EAAE,MAAM,CAAC;EACtB+K,IAAI,GAAG1H,gDAAE,CAACkS,IAAI,EAAE,MAAM,CAAC;EAEvB,IAAG,CAACxK,IAAI,EAAE;IACTA,IAAI,GAAG/K,GAAG,CAACwV,aAAa,CAAC,MAAM,CAAC;IAChCD,IAAI,CAACE,YAAY,CAAC1K,IAAI,EAAEwK,IAAI,CAACzQ,UAAU,CAAC;EACzC;;EAEA;EACA,IAAI,CAAC+O,QAAQ,IAAI5Z,MAAM,IAAIA,MAAM,CAACuE,QAAQ,EAAE;IAC3C6D,GAAG,GAAGpI,MAAM,CAACuE,QAAQ,CAACwV,MAAM,GAAG3R,GAAG;EACnC;EAEA0I,IAAI,CAAC2K,YAAY,CAAC,MAAM,EAAErT,GAAG,CAAC;AAC/B;AAEO,SAASsT,gBAAgBA,CAAC3V,GAAG,EAAEsV,OAAO,EAAC;EAC7C,IAAIC,IAAI;EACR,IAAIK,IAAI;EACR,IAAIvT,GAAG,GAAGiT,OAAO,CAACO,SAAS;EAE3B,IAAG,CAAC7V,GAAG,EAAC;IACP;EACD;EAEAuV,IAAI,GAAGlS,gDAAE,CAACrD,GAAG,EAAE,MAAM,CAAC;EACtB4V,IAAI,GAAGvS,gDAAE,CAACkS,IAAI,EAAE,uBAAuB,CAAC;EAExC,IAAIK,IAAI,EAAE;IACTA,IAAI,CAACF,YAAY,CAAC,MAAM,EAAErT,GAAG,CAAC;EAC/B,CAAC,MAAM;IACNuT,IAAI,GAAG5V,GAAG,CAACwV,aAAa,CAAC,MAAM,CAAC;IAChCI,IAAI,CAACF,YAAY,CAAC,KAAK,EAAE,WAAW,CAAC;IACrCE,IAAI,CAACF,YAAY,CAAC,MAAM,EAAErT,GAAG,CAAC;IAC9BkT,IAAI,CAACO,WAAW,CAACF,IAAI,CAAC;EACvB;AACD;AAEO,SAASG,WAAWA,CAAC/V,GAAG,EAAEsV,OAAO,EAAC;EACxC,IAAIC,IAAI;EACR,IAAIS,IAAI;EACR,IAAIrQ,EAAE,GAAG2P,OAAO,CAACW,KAAK;EACtB,IAAG,CAACjW,GAAG,EAAC;IACP;EACD;EAEAuV,IAAI,GAAGlS,gDAAE,CAACrD,GAAG,EAAE,MAAM,CAAC;EACtBgW,IAAI,GAAG3S,gDAAE,CAACkS,IAAI,EAAE,gCAAgC,CAAC;EAEjD,IAAIS,IAAI,EAAE;IACTA,IAAI,CAACN,YAAY,CAAC,SAAS,EAAE/P,EAAE,CAAC;EACjC,CAAC,MAAM;IACNqQ,IAAI,GAAGhW,GAAG,CAACwV,aAAa,CAAC,MAAM,CAAC;IAChCQ,IAAI,CAACN,YAAY,CAAC,MAAM,EAAE,eAAe,CAAC;IAC1CM,IAAI,CAACN,YAAY,CAAC,SAAS,EAAE/P,EAAE,CAAC;IAChC4P,IAAI,CAACO,WAAW,CAACE,IAAI,CAAC;EACvB;AACD;;AAEA;AACO,SAASE,YAAYA,CAACC,QAAQ,EAAEC,EAAE,EAAE;EAE1C,IAAIC,KAAK,GAAGF,QAAQ,CAACvS,gBAAgB,CAAC,SAAS,CAAC;EAEhD,IAAI,CAACyS,KAAK,CAACnZ,MAAM,EAAE;IAClB;EACD;EAEA,IAAI6N,IAAI,GAAG1H,gDAAE,CAAC8S,QAAQ,CAAClW,aAAa,EAAE,MAAM,CAAC;EAC7C,IAAIzB,QAAQ,GAAGuM,IAAI,GAAGA,IAAI,CAAC5G,YAAY,CAAC,MAAM,CAAC,GAAGtJ,SAAS;EAC3D,IAAIyb,WAAW,GAAG,UAASV,IAAI,EAAC;IAC/B,IAAI7B,IAAI,GAAG6B,IAAI,CAACzR,YAAY,CAAC,MAAM,CAAC;IAEpC,IAAG4P,IAAI,CAACpX,OAAO,CAAC,SAAS,CAAC,KAAK,CAAC,EAAC;MAChC;IACD;IAEA,IAAIkX,QAAQ,GAAIE,IAAI,CAACpX,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAE;IAEzC,IAAGkX,QAAQ,EAAC;MAEX+B,IAAI,CAACF,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC;IAEtC,CAAC,MAAI;MACJ,IAAIa,OAAO;MACX,IAAI;QACHA,OAAO,GAAG,IAAI7C,oDAAG,CAACK,IAAI,EAAEvV,QAAQ,CAAC;MAClC,CAAC,CAAC,OAAMgY,KAAK,EAAE;QACd;MAAA;MAGDZ,IAAI,CAACa,OAAO,GAAG,YAAU;QAExB,IAAGF,OAAO,IAAIA,OAAO,CAACtC,IAAI,EAAE;UAC3BmC,EAAE,CAACG,OAAO,CAAC9D,IAAI,CAACrH,IAAI,GAAGmL,OAAO,CAACtC,IAAI,CAAC;QACrC,CAAC,MAAM,IAAGsC,OAAO,EAAC;UACjBH,EAAE,CAACG,OAAO,CAAC9D,IAAI,CAACrH,IAAI,CAAC;QACtB,CAAC,MAAM;UACNgL,EAAE,CAACrC,IAAI,CAAC;QACT;QAEA,OAAO,KAAK;MACb,CAAC;IACF;EACD,CAAC,CAAChH,IAAI,CAAC,IAAI,CAAC;EAEZ,KAAK,IAAI3P,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGiZ,KAAK,CAACnZ,MAAM,EAAEE,CAAC,EAAE,EAAE;IACtCkZ,WAAW,CAACD,KAAK,CAACjZ,CAAC,CAAC,CAAC;EACtB;AAGD;AAEO,SAASsZ,UAAUA,CAAC9U,OAAO,EAAE+U,IAAI,EAAEC,YAAY,EAAE;EACvDD,IAAI,CAAC7Y,OAAO,CAAC,UAASuE,GAAG,EAAEjF,CAAC,EAAC;IAC5B,IAAIiF,GAAG,IAAIuU,YAAY,CAACxZ,CAAC,CAAC,EAAE;MAC3B;MACA;MACAiF,GAAG,GAAGA,GAAG,CAACnH,OAAO,CAAC,0BAA0B,EAAE,MAAM,CAAC;MACrD0G,OAAO,GAAGA,OAAO,CAAC1G,OAAO,CAAC,IAAI2b,MAAM,CAACxU,GAAG,EAAE,GAAG,CAAC,EAAEuU,YAAY,CAACxZ,CAAC,CAAC,CAAC;IACjE;EACD,CAAC,CAAC;EACF,OAAOwE,OAAO;AACf,C;;;;;;;ACzIA;AAAA;AAAoD;;AAEpD;AACA;AACA;AACA;AACA;AACA,MAAMkV,KAAK,CAAC;EACX/P,WAAWA,CAACsN,OAAO,EAAC;IACnB,IAAI,CAAC0C,EAAE,GAAG,EAAE;IACZ,IAAI,CAAC1C,OAAO,GAAGA,OAAO;IACtB,IAAI,CAAC2C,IAAI,GAAGhd,2DAAqB;IACjC,IAAI,CAACid,OAAO,GAAG,KAAK;IACpB,IAAI,CAACC,MAAM,GAAG,KAAK;EACpB;;EAEA;AACD;AACA;AACA;EACCC,OAAOA,CAAA,EAAG;IACT,IAAIC,QAAQ,EAAExR,OAAO;IACrB,IAAIyR,MAAM;IACV,IAAIvC,IAAI,GAAG,EAAE,CAACnI,KAAK,CAAC9O,IAAI,CAACP,SAAS,CAAC;IACnC,IAAIsX,IAAI,GAAGtX,SAAS;;IAEpB;IACA;IACA;IACA;IACA,IAAG,CAACwX,IAAI,EAAE;MACT,MAAM,IAAItR,KAAK,CAAC,kBAAkB,CAAC;IACpC;IAEA,IAAG,OAAOsR,IAAI,KAAK,UAAU,EAAC;MAE7BsC,QAAQ,GAAG,IAAI1R,2CAAK,CAAC,CAAC;MACtBE,OAAO,GAAGwR,QAAQ,CAACxR,OAAO;MAE1ByR,MAAM,GAAG;QACR,MAAM,EAAGvC,IAAI;QACb,MAAM,EAAOF,IAAI;QACjB;QACA,UAAU,EAAGwC,QAAQ;QACrB,SAAS,EAAGxR;MACb,CAAC;IAEF,CAAC,MAAM;MACN;MACAyR,MAAM,GAAG;QACR,SAAS,EAAGvC;MACb,CAAC;IAEF;IAEA,IAAI,CAACiC,EAAE,CAAC3Q,IAAI,CAACiR,MAAM,CAAC;;IAEpB;IACA,IAAI,IAAI,CAACH,MAAM,IAAI,KAAK,IAAI,CAAC,IAAI,CAACD,OAAO,EAAE;MAC1C;MACA;MACA,IAAI,CAACK,GAAG,CAAC,CAAC;IACX;IAEA,OAAOD,MAAM,CAACzR,OAAO;EACtB;;EAEA;AACD;AACA;AACA;EACC2R,OAAOA,CAAA,EAAE;IACR,IAAIC,MAAM,EAAE1C,IAAI,EAAErP,MAAM;IAExB,IAAG,IAAI,CAACsR,EAAE,CAAC7Z,MAAM,IAAI,CAAC,IAAI,CAACga,MAAM,EAAE;MAClCM,MAAM,GAAG,IAAI,CAACT,EAAE,CAACpK,KAAK,CAAC,CAAC;MACxBmI,IAAI,GAAG0C,MAAM,CAAC1C,IAAI;MAClB,IAAGA,IAAI,EAAC;QACP;;QAEArP,MAAM,GAAGqP,IAAI,CAACE,KAAK,CAAC,IAAI,CAACX,OAAO,EAAEmD,MAAM,CAAC5C,IAAI,CAAC;QAE9C,IAAGnP,MAAM,IAAI,OAAOA,MAAM,CAAC,MAAM,CAAC,KAAK,UAAU,EAAE;UAClD;UACA,OAAOA,MAAM,CAACgS,IAAI,CAAC,YAAU;YAC5BD,MAAM,CAACJ,QAAQ,CAACjS,OAAO,CAAC6P,KAAK,CAAC,IAAI,CAACX,OAAO,EAAE/W,SAAS,CAAC;UACvD,CAAC,CAACyP,IAAI,CAAC,IAAI,CAAC,EAAE,YAAW;YACxByK,MAAM,CAACJ,QAAQ,CAAChS,MAAM,CAAC4P,KAAK,CAAC,IAAI,CAACX,OAAO,EAAE/W,SAAS,CAAC;UACtD,CAAC,CAACyP,IAAI,CAAC,IAAI,CAAC,CAAC;QACd,CAAC,MAAM;UACN;UACAyK,MAAM,CAACJ,QAAQ,CAACjS,OAAO,CAAC6P,KAAK,CAAC,IAAI,CAACX,OAAO,EAAE5O,MAAM,CAAC;UACnD,OAAO+R,MAAM,CAAC5R,OAAO;QACtB;MAID,CAAC,MAAM,IAAG4R,MAAM,CAAC5R,OAAO,EAAE;QACzB;QACA,OAAO4R,MAAM,CAAC5R,OAAO;MACtB;IAED,CAAC,MAAM;MACN4R,MAAM,GAAG,IAAI9R,2CAAK,CAAC,CAAC;MACpB8R,MAAM,CAACJ,QAAQ,CAACjS,OAAO,CAAC,CAAC;MACzB,OAAOqS,MAAM,CAAC5R,OAAO;IACtB;EAED;;EAEA;EACA8R,IAAIA,CAAA,EAAE;IACL,OAAM,IAAI,CAACX,EAAE,CAAC7Z,MAAM,EAAE;MACrB,IAAI,CAACqa,OAAO,CAAC,CAAC;IACf;EACD;;EAEA;AACD;AACA;AACA;EACCD,GAAGA,CAAA,EAAE;IAEJ,IAAG,CAAC,IAAI,CAACL,OAAO,EAAC;MAChB,IAAI,CAACA,OAAO,GAAG,IAAI;MACnB,IAAI,CAACU,OAAO,GAAG,IAAIjS,2CAAK,CAAC,CAAC;IAC3B;IAEA,IAAI,CAACsR,IAAI,CAACnZ,IAAI,CAAC5D,MAAM,EAAE,MAAM;MAE5B,IAAG,IAAI,CAAC8c,EAAE,CAAC7Z,MAAM,EAAE;QAElB,IAAI,CAACqa,OAAO,CAAC,CAAC,CACZE,IAAI,CAAC,YAAU;UACf,IAAI,CAACH,GAAG,CAAC,CAAC;QACX,CAAC,CAACvK,IAAI,CAAC,IAAI,CAAC,CAAC;MAEf,CAAC,MAAM;QACN,IAAI,CAAC4K,OAAO,CAACxS,OAAO,CAAC,CAAC;QACtB,IAAI,CAAC8R,OAAO,GAAGpc,SAAS;MACzB;IAED,CAAC,CAAC;;IAEF;IACA,IAAG,IAAI,CAACqc,MAAM,IAAI,IAAI,EAAE;MACvB,IAAI,CAACA,MAAM,GAAG,KAAK;IACpB;IAEA,OAAO,IAAI,CAACS,OAAO,CAAC/R,OAAO;EAC5B;;EAEA;AACD;AACA;AACA;EACCgS,KAAKA,CAAA,EAAE;IAEN,IAAG,IAAI,CAACX,OAAO,EAAC;MACf,OAAO,IAAI,CAACA,OAAO;IACpB;IAEA,IAAG,IAAI,CAACF,EAAE,CAAC7Z,MAAM,EAAE;MAClB,IAAI,CAAC+Z,OAAO,GAAG,IAAI,CAACM,OAAO,CAAC,CAAC,CAC3BE,IAAI,CAAC,YAAU;QACf,IAAI,CAACR,OAAO,GAAGpc,SAAS;QACxB,OAAO,IAAI,CAAC+c,KAAK,CAAC,CAAC;MACpB,CAAC,CAAC7K,IAAI,CAAC,IAAI,CAAC,CAAC;MAEd,OAAO,IAAI,CAACkK,OAAO;IACpB;EAED;;EAEA;AACD;AACA;EACC7B,KAAKA,CAAA,EAAE;IACN,IAAI,CAAC2B,EAAE,GAAG,EAAE;EACb;;EAEA;AACD;AACA;AACA;EACC7Z,MAAMA,CAAA,EAAE;IACP,OAAO,IAAI,CAAC6Z,EAAE,CAAC7Z,MAAM;EACtB;;EAEA;AACD;AACA;EACC2a,KAAKA,CAAA,EAAE;IACN,IAAI,CAACX,MAAM,GAAG,IAAI;EACnB;;EAEA;AACD;AACA;EACCY,IAAIA,CAAA,EAAE;IACL,IAAI,CAACf,EAAE,GAAG,EAAE;IACZ,IAAI,CAACE,OAAO,GAAG,KAAK;IACpB,IAAI,CAACC,MAAM,GAAG,IAAI;EACnB;AACD;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMa,IAAI,CAAC;EACVhR,WAAWA,CAAC+N,IAAI,EAAEF,IAAI,EAAEP,OAAO,EAAC;IAE/B,OAAO,YAAU;MAChB,IAAI2D,OAAO,GAAG1a,SAAS,IAAI,EAAE;MAE7B,OAAO,IAAI4H,OAAO,CAAE,CAACC,OAAO,EAAEC,MAAM,KAAK;QACxC,IAAIP,QAAQ,GAAG,SAAAA,CAASoT,KAAK,EAAEhD,GAAG,EAAC;UAClC,IAAI,CAACgD,KAAK,IAAIhD,GAAG,EAAE;YAClB7P,MAAM,CAAC6P,GAAG,CAAC;UACZ,CAAC,MAAM;YACN9P,OAAO,CAAC8S,KAAK,CAAC;UACf;QACD,CAAC;QACD;QACAD,OAAO,CAAC5R,IAAI,CAACvB,QAAQ,CAAC;;QAEtB;QACAiQ,IAAI,CAACE,KAAK,CAACX,OAAO,IAAI,IAAI,EAAE2D,OAAO,CAAC;MAErC,CAAC,CAAC;IAEH,CAAC;EAEF;AACD;AAGelB,8DAAK,EAAC;;;;;;;;;;;;;;;;;ACpPrB;AACA;AACe,SAASoB,UAAUA,CAAA,EAAG;EACpC,IAAInW,IAAI,GAAG,SAAS;EACpB,IAAIoW,OAAO,GAAGC,aAAa,CAAC,CAAC;EAC7Bzc,QAAQ,CAACG,IAAI,CAACga,WAAW,CAACqC,OAAO,CAAC;EAElC,IAAIA,OAAO,CAACE,UAAU,GAAG,CAAC,EAAE;IAC3BtW,IAAI,GAAG,SAAS;EACjB,CAAC,MAAM;IACN,IAAI,OAAOuW,OAAO,KAAK,WAAW,IAAIA,OAAO,CAAC1V,SAAS,CAAC2V,cAAc,EAAE;MACvEJ,OAAO,CAAClX,QAAQ,CAAC,CAAC,CAAC,CAACA,QAAQ,CAAC,CAAC,CAAC,CAACsX,cAAc,CAAC,CAAC;MAChD,IAAIJ,OAAO,CAACE,UAAU,GAAG,CAAC,EAAE;QAC3BtW,IAAI,GAAG,UAAU;MAClB;IACD,CAAC,MAAM;MACNoW,OAAO,CAACE,UAAU,GAAG,CAAC;MACtB,IAAIF,OAAO,CAACE,UAAU,KAAK,CAAC,EAAE;QAC7BtW,IAAI,GAAG,UAAU;MAClB;IACD;EACD;EAEApG,QAAQ,CAACG,IAAI,CAAC0c,WAAW,CAACL,OAAO,CAAC;EAClC,OAAOpW,IAAI;AACZ;AAEO,SAASqW,aAAaA,CAAA,EAAG;EAC/B,IAAID,OAAO,GAAGxc,QAAQ,CAAC6Z,aAAa,CAAC,KAAK,CAAC;EAC3C2C,OAAO,CAACnF,GAAG,GAAC,KAAK;EAEjBmF,OAAO,CAAChb,KAAK,CAAC6R,QAAQ,GAAG,OAAO;EAChCmJ,OAAO,CAAChb,KAAK,CAACuC,KAAK,GAAG,KAAK;EAC3ByY,OAAO,CAAChb,KAAK,CAACwC,MAAM,GAAG,KAAK;EAC5BwY,OAAO,CAAChb,KAAK,CAACsD,GAAG,GAAG,KAAK;EACzB0X,OAAO,CAAChb,KAAK,CAACuD,IAAI,GAAG,KAAK;EAC1ByX,OAAO,CAAChb,KAAK,CAACsb,QAAQ,GAAG,QAAQ;EAEjC,IAAIC,QAAQ,GAAG/c,QAAQ,CAAC6Z,aAAa,CAAC,KAAK,CAAC;EAC5CkD,QAAQ,CAACvb,KAAK,CAACuC,KAAK,GAAG,KAAK;EAE5B,IAAIiZ,KAAK,GAAGhd,QAAQ,CAAC6Z,aAAa,CAAC,MAAM,CAAC;EAC1CmD,KAAK,CAACxb,KAAK,CAACuC,KAAK,GAAG,KAAK;EACzBiZ,KAAK,CAACxb,KAAK,CAACyb,OAAO,GAAG,cAAc;EAEpC,IAAIC,KAAK,GAAGld,QAAQ,CAAC6Z,aAAa,CAAC,MAAM,CAAC;EAC1CqD,KAAK,CAAC1b,KAAK,CAACuC,KAAK,GAAG,KAAK;EACzBmZ,KAAK,CAAC1b,KAAK,CAACyb,OAAO,GAAG,cAAc;EAEpCF,QAAQ,CAAC5C,WAAW,CAAC6C,KAAK,CAAC;EAC3BD,QAAQ,CAAC5C,WAAW,CAAC+C,KAAK,CAAC;EAC3BV,OAAO,CAACrC,WAAW,CAAC4C,QAAQ,CAAC;EAE7B,OAAOP,OAAO;AACf,C;;;;;;;;;;;;ACtDiF;AAC3C;AAEtC,MAAMW,WAAK,CAAC;EACX/R,WAAWA,CAACgS,QAAQ,EAAE;IACrB,IAAI,CAACC,QAAQ,GAAGD,QAAQ,IAAI,CAAC,CAAC;IAC9B,IAAI,CAACpT,EAAE,GAAG,mBAAmB,GAAG7K,oBAAI,CAAC,CAAC;IAEtC,IAAI,CAAC+V,SAAS,GAAG,IAAI,CAACoI,MAAM,CAAC,IAAI,CAACD,QAAQ,CAAC;IAE3C,IAAG,IAAI,CAACA,QAAQ,CAACE,MAAM,EAAE;MACxB,IAAI,CAACC,OAAO,GAAG,IAAI,CAACC,IAAI,CAAC,IAAI,CAACvI,SAAS,CAAC;IACzC;EAED;;EAEA;AACD;AACA;AACA;EACCoI,MAAMA,CAACI,OAAO,EAAC;IACd,IAAI1Z,MAAM,GAAI0Z,OAAO,CAAC1Z,MAAM,CAAC;IAC7B,IAAID,KAAK,GAAK2Z,OAAO,CAAC3Z,KAAK,CAAC;IAC5B,IAAI+Y,QAAQ,GAAIY,OAAO,CAACZ,QAAQ,IAAI,KAAK;IACzC,IAAIa,IAAI,GAAGD,OAAO,CAACC,IAAI,IAAI,UAAU;IACrC,IAAIC,SAAS,GAAGF,OAAO,CAACE,SAAS;IAEjC9b,sBAAM,CAAC,IAAI,CAACub,QAAQ,EAAEK,OAAO,CAAC;IAE9B,IAAGA,OAAO,CAAC1Z,MAAM,IAAIvD,wBAAQ,CAACid,OAAO,CAAC1Z,MAAM,CAAC,EAAE;MAC9CA,MAAM,GAAG0Z,OAAO,CAAC1Z,MAAM,GAAG,IAAI;IAC/B;IAEA,IAAG0Z,OAAO,CAAC3Z,KAAK,IAAItD,wBAAQ,CAACid,OAAO,CAAC3Z,KAAK,CAAC,EAAE;MAC5CA,KAAK,GAAG2Z,OAAO,CAAC3Z,KAAK,GAAG,IAAI;IAC7B;;IAEA;IACA,IAAImR,SAAS,GAAGlV,QAAQ,CAAC6Z,aAAa,CAAC,KAAK,CAAC;IAE7C3E,SAAS,CAAC1T,KAAK,CAACqc,UAAU,GAAG,MAAM;IACnC3I,SAAS,CAAC1T,KAAK,CAACsc,WAAW,GAAC,MAAM;IAElC5I,SAAS,CAAClL,EAAE,GAAG,IAAI,CAACA,EAAE;IACtBkL,SAAS,CAACb,SAAS,CAAC0J,GAAG,CAAC,gBAAgB,CAAC;;IAEzC;IACA;IACA7I,SAAS,CAAC1T,KAAK,CAACwc,WAAW,GAAG,GAAG;IACjC9I,SAAS,CAAC1T,KAAK,CAACyc,UAAU,GAAG,GAAG;IAChC/I,SAAS,CAAC1T,KAAK,CAAC0c,aAAa,GAAG,KAAK;IACrChJ,SAAS,CAAC1T,KAAK,CAAC6R,QAAQ,GAAG,UAAU;IAErC,IAAGsK,IAAI,KAAK,YAAY,EAAE;MACzB;MACAzI,SAAS,CAAC1T,KAAK,CAACyb,OAAO,GAAG,MAAM;MAChC/H,SAAS,CAAC1T,KAAK,CAAC2c,aAAa,GAAG,KAAK;MACrCjJ,SAAS,CAAC1T,KAAK,CAAC4c,QAAQ,GAAG,QAAQ;IACpC;IAEA,IAAGra,KAAK,EAAC;MACRmR,SAAS,CAAC1T,KAAK,CAACuC,KAAK,GAAGA,KAAK;IAC9B;IAEA,IAAGC,MAAM,EAAC;MACTkR,SAAS,CAAC1T,KAAK,CAACwC,MAAM,GAAGA,MAAM;IAChC;IAEA,IAAI8Y,QAAQ,EAAE;MACb,IAAIA,QAAQ,KAAK,QAAQ,IAAIa,IAAI,KAAK,UAAU,EAAE;QACjDzI,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAGsb,QAAQ;QACxC5H,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAG,QAAQ;MACzC,CAAC,MAAM,IAAIsb,QAAQ,KAAK,QAAQ,IAAIa,IAAI,KAAK,YAAY,EAAE;QAC1DzI,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAG,QAAQ;QACxC0T,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAGsb,QAAQ;MACzC,CAAC,MAAM;QACN5H,SAAS,CAAC1T,KAAK,CAAC,UAAU,CAAC,GAAGsb,QAAQ;MACvC;IACD;IAEA,IAAIc,SAAS,EAAE;MACd;MACA;IAAA;IAGD,IAAIA,SAAS,IAAI,IAAI,CAACP,QAAQ,CAACgB,QAAQ,EAAE;MACxCre,QAAQ,CAACG,IAAI,CAACqB,KAAK,CAAC,WAAW,CAAC,GAAGoc,SAAS;IAC7C;IACA,OAAO1I,SAAS;EACjB;EAEAuI,IAAIA,CAACvI,SAAS,EAAE;IACf,IAAIsI,OAAO,GAAGxd,QAAQ,CAAC6Z,aAAa,CAAC,KAAK,CAAC;IAE3C2D,OAAO,CAAChc,KAAK,CAAC8c,UAAU,GAAG,QAAQ;IACnCd,OAAO,CAAChc,KAAK,CAACsb,QAAQ,GAAG,QAAQ;IACjCU,OAAO,CAAChc,KAAK,CAACuC,KAAK,GAAG,GAAG;IACzByZ,OAAO,CAAChc,KAAK,CAACwC,MAAM,GAAG,GAAG;IAE1BwZ,OAAO,CAACrD,WAAW,CAACjF,SAAS,CAAC;IAC9B,OAAOsI,OAAO;EACf;EAGAe,UAAUA,CAACC,QAAQ,EAAC;IACnB,IAAInU,OAAO;IAEX,IAAG/J,yBAAS,CAACke,QAAQ,CAAC,EAAE;MACvBnU,OAAO,GAAGmU,QAAQ;IACnB,CAAC,MAAM,IAAI,OAAOA,QAAQ,KAAK,QAAQ,EAAE;MACxCnU,OAAO,GAAGrK,QAAQ,CAACqV,cAAc,CAACmJ,QAAQ,CAAC;IAC5C;IAEA,IAAG,CAACnU,OAAO,EAAC;MACX,MAAM,IAAIxC,KAAK,CAAC,gBAAgB,CAAC;IAClC;IAEA,OAAOwC,OAAO;EACf;EAEAoU,QAAQA,CAACjH,IAAI,EAAC;IAEb,IAAInN,OAAO,GAAG,IAAI,CAACkU,UAAU,CAAC/G,IAAI,CAAC;IACnC,IAAIpI,IAAI;IAER,IAAG,CAAC/E,OAAO,EAAC;MACX;IACD;IAEA,IAAG,IAAI,CAACgT,QAAQ,CAACE,MAAM,EAAE;MACxBnO,IAAI,GAAG,IAAI,CAACoO,OAAO;IACpB,CAAC,MAAM;MACNpO,IAAI,GAAG,IAAI,CAAC8F,SAAS;IACtB;IAEA7K,OAAO,CAAC8P,WAAW,CAAC/K,IAAI,CAAC;IAEzB,IAAI,CAAC/E,OAAO,GAAGA,OAAO;IAEtB,OAAOA,OAAO;EAEf;EAEAqU,YAAYA,CAAA,EAAG;IACd,OAAO,IAAI,CAACxJ,SAAS;EACtB;EAEAyJ,QAAQA,CAAChW,IAAI,EAAC;IAEb;IACA;IACA,IAAG,CAAClI,wBAAQ,CAAC,IAAI,CAAC4c,QAAQ,CAACtZ,KAAK,CAAC,IAC/B,CAACtD,wBAAQ,CAAC,IAAI,CAAC4c,QAAQ,CAACrZ,MAAM,CAAC,EAAG;MACjC;MACF,IAAI,CAAC4a,UAAU,GAAGC,kBAAQ,CAAClW,IAAI,EAAE,EAAE,CAAC;MACpCrK,MAAM,CAACwgB,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAACF,UAAU,EAAE,KAAK,CAAC;IAE1D;EAED;EAEAG,mBAAmBA,CAACpW,IAAI,EAAC;IACxB,IAAI,CAACqW,qBAAqB,GAAGrW,IAAI;IACjCrK,MAAM,CAACwgB,gBAAgB,CAAC,mBAAmB,EAAE,IAAI,CAACE,qBAAqB,EAAE,KAAK,CAAC;EAChF;EAEAC,IAAIA,CAAClb,KAAK,EAAEC,MAAM,EAAC;IAClB,IAAIN,MAAM;IACV,IAAIwb,MAAM,GAAGnb,KAAK,IAAI,IAAI,CAACsZ,QAAQ,CAACtZ,KAAK;IACzC,IAAIob,OAAO,GAAGnb,MAAM,IAAI,IAAI,CAACqZ,QAAQ,CAACrZ,MAAM;;IAE5C;IACA,IAAGD,KAAK,KAAK,IAAI,EAAE;MAClBL,MAAM,GAAG,IAAI,CAAC2G,OAAO,CAAC1F,qBAAqB,CAAC,CAAC;MAE7C,IAAGjB,MAAM,CAACK,KAAK,EAAE;QAChBA,KAAK,GAAGrE,IAAI,CAACE,KAAK,CAAC8D,MAAM,CAACK,KAAK,CAAC;QAChC,IAAI,CAACmR,SAAS,CAAC1T,KAAK,CAACuC,KAAK,GAAGA,KAAK,GAAG,IAAI;MAC1C;IACD,CAAC,MAAM;MACN,IAAItD,wBAAQ,CAACsD,KAAK,CAAC,EAAE;QACpB,IAAI,CAACmR,SAAS,CAAC1T,KAAK,CAACuC,KAAK,GAAGA,KAAK,GAAG,IAAI;MAC1C,CAAC,MAAM;QACN,IAAI,CAACmR,SAAS,CAAC1T,KAAK,CAACuC,KAAK,GAAGA,KAAK;MACnC;IACD;IAEA,IAAGC,MAAM,KAAK,IAAI,EAAE;MACnBN,MAAM,GAAGA,MAAM,IAAI,IAAI,CAAC2G,OAAO,CAAC1F,qBAAqB,CAAC,CAAC;MAEvD,IAAGjB,MAAM,CAACM,MAAM,EAAE;QACjBA,MAAM,GAAGN,MAAM,CAACM,MAAM;QACtB,IAAI,CAACkR,SAAS,CAAC1T,KAAK,CAACwC,MAAM,GAAGA,MAAM,GAAG,IAAI;MAC5C;IAED,CAAC,MAAM;MACN,IAAIvD,wBAAQ,CAACuD,MAAM,CAAC,EAAE;QACrB,IAAI,CAACkR,SAAS,CAAC1T,KAAK,CAACwC,MAAM,GAAGA,MAAM,GAAG,IAAI;MAC5C,CAAC,MAAM;QACN,IAAI,CAACkR,SAAS,CAAC1T,KAAK,CAACwC,MAAM,GAAGA,MAAM;MACrC;IACD;IAEA,IAAG,CAACvD,wBAAQ,CAACsD,KAAK,CAAC,EAAE;MACpBA,KAAK,GAAG,IAAI,CAACmR,SAAS,CAACrQ,WAAW;IACnC;IAEA,IAAG,CAACpE,wBAAQ,CAACuD,MAAM,CAAC,EAAE;MACrBA,MAAM,GAAG,IAAI,CAACkR,SAAS,CAAChV,YAAY;IACrC;IAEA,IAAI,CAACkf,eAAe,GAAG9gB,MAAM,CAACsF,gBAAgB,CAAC,IAAI,CAACsR,SAAS,CAAC;IAE9D,IAAI,CAACmK,gBAAgB,GAAG;MACvBta,IAAI,EAAEnE,UAAU,CAAC,IAAI,CAACwe,eAAe,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC;MAC3Dpa,KAAK,EAAEpE,UAAU,CAAC,IAAI,CAACwe,eAAe,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC;MAC7Dta,GAAG,EAAElE,UAAU,CAAC,IAAI,CAACwe,eAAe,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC;MACzDna,MAAM,EAAErE,UAAU,CAAC,IAAI,CAACwe,eAAe,CAAC,gBAAgB,CAAC,CAAC,IAAI;IAC/D,CAAC;;IAED;IACA,IAAIE,aAAa,GAAG1a,4BAAY,CAAC,CAAC;IAClC,IAAI2a,UAAU,GAAGjhB,MAAM,CAACsF,gBAAgB,CAAC5D,QAAQ,CAACG,IAAI,CAAC;IACvD,IAAIqf,WAAW,GAAG;MACjBza,IAAI,EAAEnE,UAAU,CAAC2e,UAAU,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC;MACjDva,KAAK,EAAEpE,UAAU,CAAC2e,UAAU,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC;MACnDza,GAAG,EAAElE,UAAU,CAAC2e,UAAU,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC;MAC/Cta,MAAM,EAAErE,UAAU,CAAC2e,UAAU,CAAC,gBAAgB,CAAC,CAAC,IAAI;IACrD,CAAC;IAED,IAAI,CAACL,MAAM,EAAE;MACZnb,KAAK,GAAGub,aAAa,CAACvb,KAAK,GACtByb,WAAW,CAACza,IAAI,GAChBya,WAAW,CAACxa,KAAK;IACvB;IAEA,IAAK,IAAI,CAACqY,QAAQ,CAACgB,QAAQ,IAAI,CAACc,OAAO,IAAK,CAACA,OAAO,EAAE;MACrDnb,MAAM,GAAGsb,aAAa,CAACtb,MAAM,GACxBwb,WAAW,CAAC1a,GAAG,GACf0a,WAAW,CAACva,MAAM;IACxB;IAEA,OAAO;MACNlB,KAAK,EAAEA,KAAK,GACR,IAAI,CAACsb,gBAAgB,CAACta,IAAI,GAC1B,IAAI,CAACsa,gBAAgB,CAACra,KAAK;MAC/BhB,MAAM,EAAEA,MAAM,GACV,IAAI,CAACqb,gBAAgB,CAACva,GAAG,GACzB,IAAI,CAACua,gBAAgB,CAACpa;IAC3B,CAAC;EAEF;EAEAvB,MAAMA,CAAA,EAAE;IACP,IAAI+b,GAAG;IACP,IAAI,IAAI,CAACvK,SAAS,CAAC1T,KAAK,CAACsb,QAAQ,KAAK,SAAS,EAAE;MAChD2C,GAAG,GAAG,IAAI,CAACvK,SAAS,IAAI,IAAI,CAACA,SAAS,CAACvQ,qBAAqB,CAAC,CAAC;IAC/D;IAEA,IAAG,CAAC8a,GAAG,IAAI,CAACA,GAAG,CAAC1b,KAAK,IAAI,CAAC0b,GAAG,CAACzb,MAAM,EAAE;MACrC,OAAOY,4BAAY,CAAC,CAAC;IACtB,CAAC,MAAM;MACN,OAAO6a,GAAG;IACX;EAED;EAEAC,QAAQA,CAAA,EAAE;IACT,IAAIle,KAAK,GAAGxB,QAAQ,CAAC6Z,aAAa,CAAC,OAAO,CAAC;;IAE3C;IACArY,KAAK,CAAC2Y,WAAW,CAACna,QAAQ,CAAC2f,cAAc,CAAC,EAAE,CAAC,CAAC;IAE9C3f,QAAQ,CAAC4Z,IAAI,CAACO,WAAW,CAAC3Y,KAAK,CAAC;IAEhC,OAAOA,KAAK,CAACoe,KAAK;EACnB;EAEAC,aAAaA,CAACC,QAAQ,EAAEC,UAAU,EAAC;IAClC,IAAIC,KAAK,GAAG,GAAG,GAAG,IAAI,CAAChW,EAAE,GAAG,GAAG;IAC/B,IAAIiW,KAAK,GAAG,EAAE;IAEd,IAAG,CAAC,IAAI,CAACL,KAAK,EAAC;MACd,IAAI,CAACA,KAAK,GAAG,IAAI,CAACF,QAAQ,CAAC,CAAC;IAC7B;IAEAK,UAAU,CAAC5d,OAAO,CAAC,UAAS+d,GAAG,EAAE;MAChC,KAAK,IAAIre,IAAI,IAAIqe,GAAG,EAAE;QACrB,IAAGA,GAAG,CAACnK,cAAc,CAAClU,IAAI,CAAC,EAAE;UAC5Boe,KAAK,IAAIpe,IAAI,GAAG,GAAG,GAAGqe,GAAG,CAACre,IAAI,CAAC,GAAG,GAAG;QACtC;MACD;IACD,CAAC,CAAC;IAEF,IAAI,CAAC+d,KAAK,CAACO,UAAU,CAACH,KAAK,GAAGF,QAAQ,GAAG,IAAI,GAAGG,KAAK,GAAG,GAAG,EAAE,CAAC,CAAC;EAChE;EAEAtC,IAAIA,CAACA,IAAI,EAAE;IACV,IAAGA,IAAI,KAAK,YAAY,EAAE;MACzB,IAAI,CAACzI,SAAS,CAAC1T,KAAK,CAACyb,OAAO,GAAG,MAAM;MACrC,IAAI,CAAC/H,SAAS,CAAC1T,KAAK,CAAC2c,aAAa,GAAG,KAAK;MAC1C,IAAI,CAACjJ,SAAS,CAAC1T,KAAK,CAAC4c,QAAQ,GAAG,QAAQ;IACzC,CAAC,MAAM;MACN,IAAI,CAAClJ,SAAS,CAAC1T,KAAK,CAACyb,OAAO,GAAG,OAAO;IACvC;IACA,IAAI,CAACI,QAAQ,CAACM,IAAI,GAAGA,IAAI;EAC1B;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEAC,SAASA,CAACvG,GAAG,EAAE;IACd,IAAI,IAAI,CAACnC,SAAS,EAAE;MACnB,IAAI,CAACA,SAAS,CAACmC,GAAG,GAAGA,GAAG;MACxB,IAAI,CAACnC,SAAS,CAAC1T,KAAK,CAAC,WAAW,CAAC,GAAG6V,GAAG;IACxC;IAEA,IAAI,IAAI,CAACgG,QAAQ,CAACgB,QAAQ,EAAE;MAC3Bre,QAAQ,CAACG,IAAI,CAACqB,KAAK,CAAC,WAAW,CAAC,GAAG6V,GAAG;IACvC;IACA,IAAI,CAACgG,QAAQ,CAAChG,GAAG,GAAGA,GAAG;EACxB;EAEAyF,QAAQA,CAACA,QAAQ,EAAE;IAClB,IAAI,IAAI,CAAC5H,SAAS,EAAE;MACnB,IAAI4H,QAAQ,KAAK,QAAQ,IAAI,IAAI,CAACO,QAAQ,CAACM,IAAI,KAAK,UAAU,EAAE;QAC/D,IAAI,CAACzI,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAGsb,QAAQ;QAC7C,IAAI,CAAC5H,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAG,QAAQ;MAC9C,CAAC,MAAM,IAAIsb,QAAQ,KAAK,QAAQ,IAAI,IAAI,CAACO,QAAQ,CAACM,IAAI,KAAK,YAAY,EAAE;QACxE,IAAI,CAACzI,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAG,QAAQ;QAC7C,IAAI,CAAC0T,SAAS,CAAC1T,KAAK,CAAC,YAAY,CAAC,GAAGsb,QAAQ;MAC9C,CAAC,MAAM;QACN,IAAI,CAAC5H,SAAS,CAAC1T,KAAK,CAAC,UAAU,CAAC,GAAGsb,QAAQ;MAC5C;IACD;IACA,IAAI,CAACO,QAAQ,CAACP,QAAQ,GAAGA,QAAQ;EAClC;EAEAsD,OAAOA,CAAA,EAAG;IACT,IAAIhR,IAAI;IAER,IAAI,IAAI,CAAC/E,OAAO,EAAE;MAEjB,IAAG,IAAI,CAACgT,QAAQ,CAACE,MAAM,EAAE;QACxBnO,IAAI,GAAG,IAAI,CAACoO,OAAO;MACpB,CAAC,MAAM;QACNpO,IAAI,GAAG,IAAI,CAAC8F,SAAS;MACtB;MAEA,IAAG,IAAI,CAAC7K,OAAO,CAACiK,QAAQ,CAAC,IAAI,CAACY,SAAS,CAAC,EAAE;QACzC,IAAI,CAAC7K,OAAO,CAACwS,WAAW,CAAC,IAAI,CAAC3H,SAAS,CAAC;MACzC;MAEA5W,MAAM,CAAC+hB,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAACzB,UAAU,CAAC;MACrDtgB,MAAM,CAAC+hB,mBAAmB,CAAC,mBAAmB,EAAE,IAAI,CAACrB,qBAAqB,CAAC;IAE5E;EACD;AACD;AAEe7B,qDAAK,E;;AC/WpB,MAAMmD,KAAK,CAAC;EACXlV,WAAWA,CAAC8J,SAAS,EAAE;IACtB,IAAI,CAACA,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACqL,MAAM,GAAG,EAAE;IAChB,IAAI,CAAChf,MAAM,GAAG,CAAC;IACf,IAAI,CAACgc,MAAM,GAAG,KAAK;EACpB;EAEAhE,GAAGA,CAAA,EAAG;IACL,OAAO,IAAI,CAACgH,MAAM;EACnB;EAEAC,KAAKA,CAAA,EAAG;IACP,OAAO,IAAI,CAACD,MAAM,CAAC,CAAC,CAAC;EACtB;EAEAE,IAAIA,CAAA,EAAG;IACN,OAAO,IAAI,CAACF,MAAM,CAAC,IAAI,CAACA,MAAM,CAAChf,MAAM,GAAC,CAAC,CAAC;EACzC;EAEAP,OAAOA,CAAC0f,IAAI,EAAE;IACb,OAAO,IAAI,CAACH,MAAM,CAACvf,OAAO,CAAC0f,IAAI,CAAC;EACjC;EAEAze,KAAKA,CAAA,EAAG;IACP,OAAO,IAAI,CAACse,MAAM,CAACte,KAAK,CAACoX,KAAK,CAAC,IAAI,CAACkH,MAAM,EAAE5e,SAAS,CAAC;EACvD;EAEAgf,GAAGA,CAAClf,CAAC,EAAE;IACN,OAAO,IAAI,CAAC8e,MAAM,CAAC9e,CAAC,CAAC;EACtB;EAEAmf,MAAMA,CAACF,IAAI,EAAC;IACX,IAAI,CAACH,MAAM,CAAC9V,IAAI,CAACiW,IAAI,CAAC;IACtB,IAAG,IAAI,CAACxL,SAAS,EAAC;MAEjB,IAAI,CAACA,SAAS,CAACiF,WAAW,CAACuG,IAAI,CAACrW,OAAO,CAAC;IACzC;IACA,IAAI,CAAC9I,MAAM,EAAE;IACb,OAAOmf,IAAI;EACZ;EAEAG,OAAOA,CAACH,IAAI,EAAC;IACZ,IAAI,CAACH,MAAM,CAAC3V,OAAO,CAAC8V,IAAI,CAAC;IACzB,IAAG,IAAI,CAACxL,SAAS,EAAC;MACjB,IAAI,CAACA,SAAS,CAAC4E,YAAY,CAAC4G,IAAI,CAACrW,OAAO,EAAE,IAAI,CAAC6K,SAAS,CAAC/L,UAAU,CAAC;IACrE;IACA,IAAI,CAAC5H,MAAM,EAAE;IACb,OAAOmf,IAAI;EACZ;EAEAje,MAAMA,CAACie,IAAI,EAAEjb,KAAK,EAAE;IACnB,IAAI,CAAC8a,MAAM,CAACxd,MAAM,CAAC0C,KAAK,EAAE,CAAC,EAAEib,IAAI,CAAC;IAElC,IAAG,IAAI,CAACxL,SAAS,EAAC;MACjB,IAAGzP,KAAK,GAAG,IAAI,CAACyP,SAAS,CAAC5P,QAAQ,CAAC/D,MAAM,EAAC;QACzC,IAAI,CAAC2T,SAAS,CAAC4E,YAAY,CAAC4G,IAAI,CAACrW,OAAO,EAAE,IAAI,CAAC6K,SAAS,CAAC5P,QAAQ,CAACG,KAAK,CAAC,CAAC;MAC1E,CAAC,MAAM;QACN,IAAI,CAACyP,SAAS,CAACiF,WAAW,CAACuG,IAAI,CAACrW,OAAO,CAAC;MACzC;IACD;IAEA,IAAI,CAAC9I,MAAM,EAAE;IACb,OAAOmf,IAAI;EACZ;EAEAI,MAAMA,CAACJ,IAAI,EAAE;IACZ,IAAIjb,KAAK,GAAG,IAAI,CAAC8a,MAAM,CAACvf,OAAO,CAAC0f,IAAI,CAAC;IAErC,IAAGjb,KAAK,GAAG,CAAC,CAAC,EAAE;MACd,IAAI,CAAC8a,MAAM,CAACxd,MAAM,CAAC0C,KAAK,EAAE,CAAC,CAAC;IAC7B;IAGA,IAAI,CAAC2a,OAAO,CAACM,IAAI,CAAC;IAElB,IAAI,CAACnf,MAAM,EAAE;EACd;EAEA6e,OAAOA,CAACM,IAAI,EAAE;IACb,IAAGA,IAAI,CAACK,SAAS,EAAC;MACjBL,IAAI,CAACN,OAAO,CAAC,CAAC;IACf;IAEA,IAAG,IAAI,CAAClL,SAAS,EAAC;MAChB,IAAI,CAACA,SAAS,CAAC2H,WAAW,CAAC6D,IAAI,CAACrW,OAAO,CAAC;IAC1C;IACAqW,IAAI,GAAG,IAAI;EACZ;;EAEA;;EAEAve,OAAOA,CAAA,EAAG;IACT,OAAO,IAAI,CAACoe,MAAM,CAACpe,OAAO,CAACkX,KAAK,CAAC,IAAI,CAACkH,MAAM,EAAE5e,SAAS,CAAC;EACzD;EAEA8X,KAAKA,CAAA,EAAE;IACN;IACA,IAAIiH,IAAI;IACR,IAAI1M,GAAG,GAAG,IAAI,CAACzS,MAAM;IAErB,IAAG,CAAC,IAAI,CAACA,MAAM,EAAE;IAEjB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuS,GAAG,EAAEvS,CAAC,EAAE,EAAE;MAC7Bif,IAAI,GAAG,IAAI,CAACH,MAAM,CAAC9e,CAAC,CAAC;MACrB,IAAI,CAAC2e,OAAO,CAACM,IAAI,CAAC;IACnB;IAEA,IAAI,CAACH,MAAM,GAAG,EAAE;IAChB,IAAI,CAAChf,MAAM,GAAG,CAAC;EAChB;EAEAyf,IAAIA,CAACrH,OAAO,EAAC;IAEZ,IAAI+G,IAAI;IACR,IAAI1M,GAAG,GAAG,IAAI,CAACzS,MAAM;IAErB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuS,GAAG,EAAEvS,CAAC,EAAE,EAAE;MAC7Bif,IAAI,GAAG,IAAI,CAACH,MAAM,CAAC9e,CAAC,CAAC;MACrB,IAAGif,IAAI,CAACK,SAAS,IAAIL,IAAI,CAAC/G,OAAO,CAAClU,KAAK,IAAIkU,OAAO,CAAClU,KAAK,EAAE;QACzD,OAAOib,IAAI;MACZ;IACD;EAED;EAEAK,SAASA,CAAA,EAAE;IACV,IAAIA,SAAS,GAAG,EAAE;IAClB,IAAIL,IAAI;IACR,IAAI1M,GAAG,GAAG,IAAI,CAACzS,MAAM;IAErB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuS,GAAG,EAAEvS,CAAC,EAAE,EAAE;MAC7Bif,IAAI,GAAG,IAAI,CAACH,MAAM,CAAC9e,CAAC,CAAC;MACrB,IAAGif,IAAI,CAACK,SAAS,EAAC;QACjBA,SAAS,CAACtW,IAAI,CAACiW,IAAI,CAAC;MACrB;IACD;IACA,OAAOK,SAAS;EACjB;EAEAE,IAAIA,CAAA,EAAE;IACL,IAAIP,IAAI;IACR,IAAI1M,GAAG,GAAG,IAAI,CAACzS,MAAM;IAErB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuS,GAAG,EAAEvS,CAAC,EAAE,EAAE;MAC7Bif,IAAI,GAAG,IAAI,CAACH,MAAM,CAAC9e,CAAC,CAAC;MACrB,IAAGif,IAAI,CAACK,SAAS,EAAC;QACjBL,IAAI,CAACO,IAAI,CAAC,CAAC;MACZ;IACD;IACA,IAAI,CAAC1D,MAAM,GAAG,KAAK;EACpB;EAEA2D,IAAIA,CAAA,EAAE;IACL,IAAIR,IAAI;IACR,IAAI1M,GAAG,GAAG,IAAI,CAACzS,MAAM;IAErB,KAAK,IAAIE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGuS,GAAG,EAAEvS,CAAC,EAAE,EAAE;MAC7Bif,IAAI,GAAG,IAAI,CAACH,MAAM,CAAC9e,CAAC,CAAC;MACrB,IAAGif,IAAI,CAACK,SAAS,EAAC;QACjBL,IAAI,CAACQ,IAAI,CAAC,CAAC;MACZ;IACD;IACA,IAAI,CAAC3D,MAAM,GAAG,IAAI;EACnB;AACD;AAEe+C,+CAAK,E;;;;;;;;ACvKqB;AACgC;AACzB;AACZ;AACE;AACD;AACA;AACU;AACP;AAExC,MAAMa,0BAAkB,CAAC;EACxB/V,WAAWA,CAACsS,OAAO,EAAE;IAEpB,IAAI,CAAC0D,IAAI,GAAG,SAAS;IACrB,IAAI,CAACC,YAAY,GAAG3D,OAAO,CAACL,QAAQ;IACpC,IAAI,CAACiE,IAAI,GAAG5D,OAAO,CAACgD,IAAI;IACxB,IAAI,CAACa,OAAO,GAAG7D,OAAO,CAAC6D,OAAO;IAC9B,IAAI,CAACC,cAAc,GAAG9D,OAAO,CAAC+D,KAAK;IACnC,IAAI,CAACrZ,CAAC,GAAG,IAAI+S,wBAAK,CAAC,IAAI,CAAC;IAExB,IAAI,CAACkC,QAAQ,GAAGvb,sBAAM,CAAC,IAAI,CAACub,QAAQ,IAAI,CAAC,CAAC,EAAE;MAC3CqE,QAAQ,EAAE,IAAI;MACdnE,MAAM,EAAE,KAAK;MACbxZ,KAAK,EAAE7E,SAAS;MAChB8E,MAAM,EAAE9E,SAAS;MACjBye,IAAI,EAAEze,SAAS;MACfyiB,WAAW,EAAEziB,SAAS;MACtB0iB,IAAI,EAAE,UAAU;MAChBvS,WAAW,EAAE,EAAE;MACfgP,QAAQ,EAAEnf;IACX,CAAC,CAAC;IAEF4C,sBAAM,CAAC,IAAI,CAACub,QAAQ,EAAEK,OAAO,CAACL,QAAQ,IAAI,CAAC,CAAC,CAAC;IAE7C,IAAI,CAACwE,YAAY,GAAG;MACnBxS,WAAW,EAAE,IAAI,CAACgO,QAAQ,CAAChO,WAAW;MACtCsO,IAAI,EAAE,IAAI,CAACN,QAAQ,CAACM,IAAI;MACxBiE,IAAI,EAAE,IAAI,CAACvE,QAAQ,CAACuE,IAAI;MACxBE,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBC,MAAM,EAAE,IAAI,CAAC1E,QAAQ,CAAC0E,MAAM;MAAE;MAC9Bhe,KAAK,EAAE,CAAC;MACRC,MAAM,EAAE,CAAC;MACTge,cAAc,EAAE;IACjB,CAAC;IAED,IAAI,CAACC,QAAQ,GAAG,KAAK;EAEtB;EAEAC,MAAMA,CAAC7X,OAAO,EAAE4U,IAAI,EAAE;IACrB,IAAIkD,GAAG,GAAG9X,OAAO,CAACa,OAAO;IAEzB,IAAI,OAAO,IAAI,CAACmS,QAAQ,CAACgB,QAAQ,KAAK,WAAW,IAChD8D,GAAG,KAAKA,GAAG,CAAC7gB,WAAW,CAAC,CAAC,IAAI,MAAM,IAClC6gB,GAAG,CAAC7gB,WAAW,CAAC,CAAC,IAAI,MAAM,CAAC,EAAE;MAC/B,IAAI,CAAC+b,QAAQ,CAACgB,QAAQ,GAAG,IAAI;IAC9B;IAEA,IAAI,IAAI,CAAChB,QAAQ,CAACgB,QAAQ,EAAE;MAC3B,IAAI,CAAChB,QAAQ,CAACP,QAAQ,GAAG,SAAS;MAClC,IAAI,CAACA,QAAQ,GAAG,IAAI,CAACO,QAAQ,CAACP,QAAQ;IACvC;IAEA,IAAI,CAACO,QAAQ,CAAC4B,IAAI,GAAGA,IAAI;IAEzB,IAAI,CAAC5B,QAAQ,CAAC+E,aAAa,GAAG7F,UAAU,CAAC,CAAC;;IAE1C;IACA,IAAI,CAAC8F,KAAK,GAAG,IAAIlF,KAAK,CAAC;MACtBpZ,KAAK,EAAEkb,IAAI,CAAClb,KAAK;MACjBC,MAAM,EAAEib,IAAI,CAACjb,MAAM;MACnB8Y,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBS,MAAM,EAAE,IAAI,CAACF,QAAQ,CAACE,MAAM;MAC5BI,IAAI,EAAE,IAAI,CAACN,QAAQ,CAACM,IAAI;MACxBU,QAAQ,EAAE,IAAI,CAAChB,QAAQ,CAACgB,QAAQ;MAChCT,SAAS,EAAE,IAAI,CAACP,QAAQ,CAACO;IAC1B,CAAC,CAAC;IAEF,IAAI,CAACyE,KAAK,CAAC5D,QAAQ,CAACpU,OAAO,CAAC;;IAE5B;IACA,IAAI,CAAC6K,SAAS,GAAG,IAAI,CAACmN,KAAK,CAAC3D,YAAY,CAAC,CAAC;;IAE1C;IACA,IAAI,CAAC4D,KAAK,GAAG,IAAIhC,KAAK,CAAC,IAAI,CAACpL,SAAS,CAAC;;IAEtC;IACA,IAAI,CAACqN,OAAO,GAAG,IAAI,CAAC7e,MAAM,CAAC,CAAC;IAC5B,IAAI,CAAC8e,UAAU,GAAG,IAAI,CAACH,KAAK,CAACpD,IAAI,CAAC,CAAC;;IAEnC;IACA,IAAI,CAAC4C,YAAY,CAAC9d,KAAK,GAAG,IAAI,CAACye,UAAU,CAACze,KAAK;IAC/C,IAAI,CAAC8d,YAAY,CAAC7d,MAAM,GAAG,IAAI,CAACwe,UAAU,CAACxe,MAAM;;IAEjD;IACA;IACA,IAAI,CAACqe,KAAK,CAAC1D,QAAQ,CAAC,IAAI,CAAC8D,SAAS,CAACrR,IAAI,CAAC,IAAI,CAAC,CAAC;IAE9C,IAAI,CAACiR,KAAK,CAACtD,mBAAmB,CAAC,IAAI,CAACA,mBAAmB,CAAC3N,IAAI,CAAC,IAAI,CAAC,CAAC;;IAEnE;IACA,IAAI,CAACsR,iBAAiB,CAAC,CAAC;;IAExB;IACA;IACA,IAAI,IAAI,CAACZ,MAAM,EAAE;MAChB,IAAI,CAACa,YAAY,CAAC,CAAC;IACpB;IAEA,IAAI,CAACV,QAAQ,GAAG,IAAI;EAErB;EAEAS,iBAAiBA,CAAA,EAAG;IACnB,IAAIE,QAAQ;IAEZtkB,MAAM,CAACwgB,gBAAgB,CAAC,QAAQ,EAAE,UAAU1I,CAAC,EAAE;MAC9C,IAAI,CAACgK,OAAO,CAAC,CAAC;IACf,CAAC,CAAChP,IAAI,CAAC,IAAI,CAAC,CAAC;IAEb,IAAI,CAAC,IAAI,CAACiM,QAAQ,CAACgB,QAAQ,EAAE;MAC5BuE,QAAQ,GAAG,IAAI,CAAC1N,SAAS;IAC1B,CAAC,MAAM;MACN0N,QAAQ,GAAGtkB,MAAM;IAClB;IAEA,IAAI,CAACukB,SAAS,GAAG,IAAI,CAACC,QAAQ,CAAC1R,IAAI,CAAC,IAAI,CAAC;IACzCwR,QAAQ,CAAC9D,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC+D,SAAS,CAAC;EACpD;EAEAE,oBAAoBA,CAAA,EAAG;IACtB,IAAIH,QAAQ;IAEZ,IAAI,CAAC,IAAI,CAACvF,QAAQ,CAACgB,QAAQ,EAAE;MAC5BuE,QAAQ,GAAG,IAAI,CAAC1N,SAAS;IAC1B,CAAC,MAAM;MACN0N,QAAQ,GAAGtkB,MAAM;IAClB;IAEAskB,QAAQ,CAACvC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAACwC,SAAS,CAAC;IACtD,IAAI,CAACA,SAAS,GAAG3jB,SAAS;EAC3B;EAEAkhB,OAAOA,CAAA,EAAG;IACT4C,YAAY,CAAC,IAAI,CAACC,kBAAkB,CAAC;IACrCD,YAAY,CAAC,IAAI,CAACE,aAAa,CAAC;IAChCF,YAAY,CAAC,IAAI,CAACG,aAAa,CAAC;IAEhC,IAAI,CAAC1J,KAAK,CAAC,CAAC;IAEZ,IAAI,CAACsJ,oBAAoB,CAAC,CAAC;IAE3B,IAAI,CAACV,KAAK,CAACjC,OAAO,CAAC,CAAC;IAEpB,IAAI,CAAC6B,QAAQ,GAAG,KAAK;;IAErB;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EAEC;EAEAlD,mBAAmBA,CAAC3I,CAAC,EAAE;IACtB,IAAI;MAAEgN;IAAY,CAAC,GAAG9kB,MAAM;IAE5B,IAAI,IAAI,CAAC+iB,YAAY,CAACgC,yBAAyB,EAAE;MAChD,IAAI,CAACC,MAAM,CAAC,CAAC;IACd;;IAEA;IACA;IACA;IACA;IACA;IACAN,YAAY,CAAC,IAAI,CAACC,kBAAkB,CAAC;IACrC,IAAI,CAACA,kBAAkB,GAAGM,UAAU,CAAC,YAAY;MAChD,IAAI,CAACN,kBAAkB,GAAG/jB,SAAS;MAEnC,IAAI,IAAI,CAACmiB,YAAY,CAACgC,yBAAyB,EAAE;QAChD,IAAI,CAACC,MAAM,CAAC,CAAC;MACd;MAEA,IAAI,CAACE,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACE,kBAAkB,EAAE4V,WAAW,CAAC;IAC3D,CAAC,CAAChS,IAAI,CAAC,IAAI,CAAC,EAAE,GAAG,CAAC;EAEnB;EAEAqR,SAASA,CAACrM,CAAC,EAAE;IAEZ,IAAI,CAACkN,MAAM,CAAC,CAAC;EACd;EAEAA,MAAMA,CAACvf,KAAK,EAAEC,MAAM,EAAEyf,OAAO,EAAE;IAC9B,IAAIC,SAAS,GAAG,IAAI,CAACrB,KAAK,CAACpD,IAAI,CAAClb,KAAK,EAAEC,MAAM,CAAC;;IAE9C;IACA;IACA,IAAI,CAAC2f,SAAS,GAAG/e,4BAAY,CAAC,CAAC;IAC/B,IAAI,IAAI,CAACqe,kBAAkB,IAC1B,IAAI,CAACU,SAAS,CAAC5f,KAAK,KAAK,IAAI,CAAC4f,SAAS,CAAC3f,MAAM,EAAE;MAChD;MACA,IAAI,CAACwe,UAAU,GAAGtjB,SAAS;MAC3B;IACD;IAEA,IAAI,IAAI,CAACsjB,UAAU,IAClB,IAAI,CAACA,UAAU,CAACze,KAAK,KAAK2f,SAAS,CAAC3f,KAAK,IACzC,IAAI,CAACye,UAAU,CAACxe,MAAM,KAAK0f,SAAS,CAAC1f,MAAM,EAAE;MAC7C;MACA;IACD;IAEA,IAAI,CAACwe,UAAU,GAAGkB,SAAS;IAE3B,IAAI,CAACnB,OAAO,GAAG,IAAI,CAAC7e,MAAM,CAAC,CAAC;;IAE5B;IACA,IAAI,CAAC+V,KAAK,CAAC,CAAC;;IAEZ;IACA,IAAI,CAACoI,YAAY,CAAC9d,KAAK,GAAG,IAAI,CAACye,UAAU,CAACze,KAAK;IAC/C,IAAI,CAAC8d,YAAY,CAAC7d,MAAM,GAAG,IAAI,CAACwe,UAAU,CAACxe,MAAM;IAEjD,IAAI,CAAC2e,YAAY,CAAC,CAAC;IAEnB,IAAI,CAACa,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACC,OAAO,EAAE;MAClCxJ,KAAK,EAAE,IAAI,CAACye,UAAU,CAACze,KAAK;MAC5BC,MAAM,EAAE,IAAI,CAACwe,UAAU,CAACxe;IACzB,CAAC,EAAEyf,OAAO,CAAC;EACZ;EAEAG,UAAUA,CAACjK,OAAO,EAAEkK,UAAU,EAAE;IAC/B,OAAO,IAAI,IAAI,CAACvC,IAAI,CAAC3H,OAAO,EAAE7X,sBAAM,CAAC,IAAI,CAAC+f,YAAY,EAAE;MAAEgC;IAAW,CAAC,CAAC,CAAC;EACzE;EAEAC,sBAAsBA,CAACD,UAAU,EAAElK,OAAO,EAAEoK,MAAM,EAAE;IACnD,IAAIC,IAAI;IAER,IAAI,IAAI,CAAClC,MAAM,CAACV,IAAI,KAAK,eAAe,IAAI,IAAI,CAACU,MAAM,CAACmC,OAAO,GAAG,CAAC,EAAE;MACpE,IAAIJ,UAAU,IAAIlK,OAAO,CAAClU,KAAK,KAAK,CAAC,EAAE;QACtC;QACA;MACD;MACAue,IAAI,GAAGrK,OAAO,CAACqK,IAAI,CAAC,CAAC;MACrB,IAAIA,IAAI,IAAI,CAACA,IAAI,CAACE,UAAU,CAACC,QAAQ,CAAC,kBAAkB,CAAC,EAAE;QAC1D,OAAOJ,MAAM,CAAC7hB,IAAI,CAAC,IAAI,EAAE8hB,IAAI,CAAC;MAC/B;IACD;EACD;EAEA/G,OAAOA,CAACtD,OAAO,EAAE5X,MAAM,EAAE;IAExB;IACA,IAAIqiB,UAAU,GAAG,IAAIra,aAAK,CAAC,CAAC;IAC5B,IAAIgX,SAAS,GAAGqD,UAAU,CAACna,OAAO;;IAElC;IACA,IAAIlI,MAAM,KAAK4X,OAAO,CAACvB,IAAI,IAAI3X,wBAAQ,CAACsB,MAAM,CAAC,EAAE;MAChDA,MAAM,GAAG7C,SAAS;IACnB;;IAEA;IACA,IAAImlB,OAAO,GAAG,IAAI,CAAC/B,KAAK,CAACtB,IAAI,CAACrH,OAAO,CAAC;;IAEtC;IACA,IAAI0K,OAAO,IAAI1K,OAAO,IAAI,IAAI,CAACmI,MAAM,CAACV,IAAI,KAAK,eAAe,EAAE;MAC/D,IAAIzQ,MAAM,GAAG0T,OAAO,CAAC1T,MAAM,CAAC,CAAC;MAE7B,IAAI,IAAI,CAAC0M,QAAQ,CAACO,SAAS,KAAK,KAAK,EAAE;QACtC,IAAI,CAAC0G,QAAQ,CAAC3T,MAAM,CAAC5L,IAAI,EAAE4L,MAAM,CAAC7L,GAAG,EAAE,IAAI,CAAC;MAC7C,CAAC,MAAM;QACN,IAAIf,KAAK,GAAGsgB,OAAO,CAACtgB,KAAK,CAAC,CAAC;QAC3B,IAAI,CAACugB,QAAQ,CAAC3T,MAAM,CAAC5L,IAAI,GAAGhB,KAAK,EAAE4M,MAAM,CAAC7L,GAAG,EAAE,IAAI,CAAC;MACrD;MACAxG,MAAM,CAACilB,UAAU,CAAC,MAAM;QACvB,IAAIxhB,MAAM,EAAE;UACX,IAAI4O,MAAM,GAAG0T,OAAO,CAACvhB,UAAU,CAACf,MAAM,CAAC;UACvC,IAAIgC,KAAK,GAAGsgB,OAAO,CAACtgB,KAAK,CAAC,CAAC;UAC3B,IAAI,CAACwgB,MAAM,CAAC5T,MAAM,EAAE5M,KAAK,CAAC;UAC1B,IAAIygB,WAAW,GAAG,IAAIC,WAAW,CAAC,aAAa,CAAC;UAChDzkB,QAAQ,CAAC0kB,aAAa,CAACF,WAAW,CAAC;QACpC;MACD,CAAC,EAAE,GAAG,CAAC;MACPJ,UAAU,CAAC5a,OAAO,CAAC,CAAC;MACpB,OAAOuX,SAAS;IACjB;;IAEA;IACA,IAAI,CAACtH,KAAK,CAAC,CAAC;IAEZ,IAAIoK,UAAU,GAAG,KAAK;IACtB,IAAI,IAAI,CAAC/B,MAAM,CAACV,IAAI,KAAK,eAAe,IAAI,IAAI,CAACU,MAAM,CAACmC,OAAO,KAAK,CAAC,IAAItK,OAAO,CAACuK,UAAU,CAACC,QAAQ,CAAC,mBAAmB,CAAC,EAAE;MAC1HN,UAAU,GAAG,IAAI;IAClB;IAEA,IAAI,CAAC9F,GAAG,CAACpE,OAAO,EAAEkK,UAAU,CAAC,CAC3B/H,IAAI,CAAC,UAAU4E,IAAI,EAAE;MACrB;;MAEA;;MAEApiB,MAAM,CAACilB,UAAU,CAAC,MAAM;QACvB,IAAIxhB,MAAM,EAAE;UACX,IAAI4O,MAAM,GAAG+P,IAAI,CAAC5d,UAAU,CAACf,MAAM,CAAC;UACpC,IAAIgC,KAAK,GAAG2c,IAAI,CAAC3c,KAAK,CAAC,CAAC;UACxB,IAAI,CAACwgB,MAAM,CAAC5T,MAAM,EAAE5M,KAAK,CAAC;UAE1B,IAAIygB,WAAW,GAAG,IAAIC,WAAW,CAAC,aAAa,CAAC;UAChDzkB,QAAQ,CAAC0kB,aAAa,CAACF,WAAW,CAAC;QACpC;MACD,CAAC,EAAE,GAAG,CAAC;IACR,CAAC,CAACpT,IAAI,CAAC,IAAI,CAAC,EAAGkI,GAAG,IAAK;MACtB8K,UAAU,CAAC3a,MAAM,CAAC6P,GAAG,CAAC;IACvB,CAAC,CAAC,CACDwC,IAAI,CAAC,YAAY;MACjB,OAAO,IAAI,CAACgI,sBAAsB,CAACD,UAAU,EAAElK,OAAO,EAAE,IAAI,CAACoE,GAAG,CAAC;IAClE,CAAC,CAAC3M,IAAI,CAAC,IAAI,CAAC,CAAC,CACZ0K,IAAI,CAAC,YAAY;MAEjB,IAAI,CAACwG,KAAK,CAACrB,IAAI,CAAC,CAAC;MAEjBmD,UAAU,CAAC5a,OAAO,CAAC,CAAC;IAErB,CAAC,CAAC4H,IAAI,CAAC,IAAI,CAAC,CAAC;IACd;IACA;IACA;IACA;IACA;IACA;IACA,OAAO2P,SAAS;EACjB;EAEA4D,cAAcA,CAACjE,IAAI,EAAE;IACpB,IAAI,CAAC8C,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACG,KAAK,EAAEiT,IAAI,CAAC;EACvC;EAEAkE,YAAYA,CAAClE,IAAI,EAAE;IAClB,IAAI,CAAC8C,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACN,MAAM,EAAE0T,IAAI,CAAC/G,OAAO,CAAC;EAChD;EAEA4K,MAAMA,CAAC5T,MAAM,EAAE5M,KAAK,EAAE;IACrB,IAAI8gB,KAAK,GAAG,CAAC;MACZC,KAAK,GAAG,CAAC;IAEV,IAAI,CAAC,IAAI,CAACC,WAAW,EAAE;MACtBD,KAAK,GAAGnU,MAAM,CAAC7L,GAAG;IACnB,CAAC,MAAM;MACN+f,KAAK,GAAGnlB,IAAI,CAACE,KAAK,CAAC+Q,MAAM,CAAC5L,IAAI,GAAG,IAAI,CAAC+c,MAAM,CAACkD,KAAK,CAAC,GAAG,IAAI,CAAClD,MAAM,CAACkD,KAAK;MAEvE,IAAIH,KAAK,GAAG,IAAI,CAAC/C,MAAM,CAACkD,KAAK,GAAG,IAAI,CAAC9P,SAAS,CAAC+P,WAAW,EAAE;QAC3DJ,KAAK,GAAG,IAAI,CAAC3P,SAAS,CAAC+P,WAAW,GAAG,IAAI,CAACnD,MAAM,CAACkD,KAAK;MACvD;MAEAF,KAAK,GAAGplB,IAAI,CAACE,KAAK,CAAC+Q,MAAM,CAAC7L,GAAG,GAAG,IAAI,CAACgd,MAAM,CAACkD,KAAK,CAAC,GAAG,IAAI,CAAClD,MAAM,CAACkD,KAAK;MAEtE,IAAIF,KAAK,GAAG,IAAI,CAAChD,MAAM,CAACkD,KAAK,GAAG,IAAI,CAAC9P,SAAS,CAAC9U,YAAY,EAAE;QAC5D0kB,KAAK,GAAG,IAAI,CAAC5P,SAAS,CAAC9U,YAAY,GAAG,IAAI,CAAC0hB,MAAM,CAACkD,KAAK;MACxD;IACD;IACA,IAAI,IAAI,CAAC3H,QAAQ,CAACO,SAAS,KAAK,KAAK,EAAE;MACtC;AACH;AACA;AACA;AACA;MACGiH,KAAK,GAAGA,KAAK,GAAG,IAAI,CAAC/C,MAAM,CAACkD,KAAK;MACjCH,KAAK,GAAGA,KAAK,GAAG9gB,KAAK;IACtB;IACA,IAAI,CAACugB,QAAQ,CAACO,KAAK,EAAEC,KAAK,EAAE,IAAI,CAAC;EAClC;EAEA/G,GAAGA,CAACpE,OAAO,EAAEkK,UAAU,EAAE;IACxB,IAAInD,IAAI,GAAG,IAAI,CAACkD,UAAU,CAACjK,OAAO,EAAEkK,UAAU,CAAC;IAE/C,IAAI,CAACvB,KAAK,CAACzB,OAAO,CAACH,IAAI,CAAC;;IAExB;IACAA,IAAI,CAACwE,WAAW,GAAG,IAAI,CAACP,cAAc,CAACvT,IAAI,CAAC,IAAI,CAAC;IACjDsP,IAAI,CAAC/B,QAAQ,GAAG,IAAI,CAACiG,YAAY,CAACxT,IAAI,CAAC,IAAI,CAAC;IAE5CsP,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACC,IAAI,EAAG6P,IAAI,IAAK;MACpC,IAAI,CAACyH,UAAU,CAACzH,IAAI,CAAC;IACtB,CAAC,CAAC;IAEF+C,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACE,YAAY,EAAGsX,IAAI,IAAK;MAC5C,IAAI,CAACC,iBAAiB,CAACD,IAAI,CAAC;IAC7B,CAAC,CAAC;IAEF,OAAO3E,IAAI,CAACzD,OAAO,CAAC,IAAI,CAACsE,OAAO,CAAC;EAClC;EAEAX,MAAMA,CAACjH,OAAO,EAAEkK,UAAU,EAAE;IAC3B,IAAInD,IAAI,GAAG,IAAI,CAACkD,UAAU,CAACjK,OAAO,EAAEkK,UAAU,CAAC;IAC/C,IAAI,CAACvB,KAAK,CAACzB,OAAO,CAACH,IAAI,CAAC;IAExBA,IAAI,CAACwE,WAAW,GAAG,IAAI,CAACP,cAAc,CAACvT,IAAI,CAAC,IAAI,CAAC;IACjDsP,IAAI,CAAC/B,QAAQ,GAAG,IAAI,CAACiG,YAAY,CAACxT,IAAI,CAAC,IAAI,CAAC;IAE5CsP,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACC,IAAI,EAAG6P,IAAI,IAAK;MACpC,IAAI,CAACyH,UAAU,CAACzH,IAAI,CAAC;IACtB,CAAC,CAAC;IAEF+C,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACE,YAAY,EAAGsX,IAAI,IAAK;MAC5C,IAAI,CAACC,iBAAiB,CAACD,IAAI,CAAC;IAC7B,CAAC,CAAC;IAEF,OAAO3E,IAAI,CAACzD,OAAO,CAAC,IAAI,CAACsE,OAAO,CAAC;EAClC;EAEAV,OAAOA,CAAClH,OAAO,EAAEkK,UAAU,EAAE;IAE5B,IAAInD,IAAI,GAAG,IAAI,CAACkD,UAAU,CAACjK,OAAO,EAAEkK,UAAU,CAAC;IAE/CnD,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACN,OAAO,EAAG7J,MAAM,IAAK;MACzC;MACA,IAAI1D,QAAQ,CAACulB,sBAAsB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAClR,SAAS,CAACC,QAAQ,CAAC,eAAe,CAAC,EAAE;MAC9F,IAAI,CAACkR,OAAO,CAAC9hB,MAAM,CAAC;IACrB,CAAC,CAAC;IAEF,IAAI,CAAC4e,KAAK,CAACzB,OAAO,CAACH,IAAI,CAAC;IAExBA,IAAI,CAACwE,WAAW,GAAG,IAAI,CAACP,cAAc,CAACvT,IAAI,CAAC,IAAI,CAAC;IACjDsP,IAAI,CAAC/B,QAAQ,GAAG,IAAI,CAACiG,YAAY,CAACxT,IAAI,CAAC,IAAI,CAAC;IAE5CsP,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACC,IAAI,EAAG6P,IAAI,IAAK;MACpC,IAAI,CAACyH,UAAU,CAACzH,IAAI,CAAC;IACtB,CAAC,CAAC;IAEF+C,IAAI,CAACyE,EAAE,CAACxY,2BAAM,CAACkB,KAAK,CAACE,YAAY,EAAGsX,IAAI,IAAK;MAC5C,IAAI,CAACC,iBAAiB,CAACD,IAAI,CAAC;IAC7B,CAAC,CAAC;IAEF,OAAO3E,IAAI,CAACzD,OAAO,CAAC,IAAI,CAACsE,OAAO,CAAC;EAClC;EAEAiE,OAAOA,CAAC9hB,MAAM,EAAE;IACf,IAAI,IAAI,CAAC2Z,QAAQ,CAACM,IAAI,KAAK,UAAU,EAAE;MACtC,IAAI,CAAC8H,QAAQ,CAAC,CAAC,EAAE/hB,MAAM,CAACgiB,WAAW,EAAE,IAAI,CAAC;IAC3C,CAAC,MAAM;MACN,IAAI,CAACD,QAAQ,CAAC/hB,MAAM,CAACiiB,UAAU,EAAE,CAAC,EAAE,IAAI,CAAC;IAC1C;EAED;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA3B,IAAIA,CAAA,EAAG;IACN,IAAIA,IAAI;IACR,IAAIjf,IAAI;IAER,IAAIsS,GAAG,GAAG,IAAI,CAACgG,QAAQ,CAACO,SAAS;IAEjC,IAAI,CAAC,IAAI,CAAC0E,KAAK,CAAC/gB,MAAM,EAAE;IAExB,IAAI,IAAI,CAACwjB,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,KAAK,CAACtG,GAAG,IAAIA,GAAG,KAAK,KAAK,CAAC,EAAE;MAEvF,IAAI,CAACqF,UAAU,GAAG,IAAI,CAACxH,SAAS,CAACwH,UAAU;MAE3C3X,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU,GAAG,IAAI,CAACxH,SAAS,CAAC0Q,WAAW,GAAG,IAAI,CAAC9D,MAAM,CAACkD,KAAK;MAEjF,IAAIjgB,IAAI,IAAI,IAAI,CAACmQ,SAAS,CAAC+P,WAAW,EAAE;QACvC,IAAI,CAACQ,QAAQ,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;MAC1C,CAAC,MAAM;QACNhB,IAAI,GAAG,IAAI,CAAC1B,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAAC9G,OAAO,CAACqK,IAAI,CAAC,CAAC;MACxC;IACD,CAAC,MAAM,IAAI,IAAI,CAACe,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,IAAItG,GAAG,KAAK,KAAK,EAAE;MAEpF,IAAI,CAACqF,UAAU,GAAG,IAAI,CAACxH,SAAS,CAACwH,UAAU;MAE3C,IAAI,IAAI,CAACW,QAAQ,CAAC+E,aAAa,KAAK,SAAS,EAAE;QAC9Crd,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU;QAEhC,IAAI3X,IAAI,GAAG,CAAC,EAAE;UACb,IAAI,CAAC0gB,QAAQ,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;QAC1C,CAAC,MAAM;UACNhB,IAAI,GAAG,IAAI,CAAC1B,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAAC9G,OAAO,CAACqK,IAAI,CAAC,CAAC;QACxC;MACD,CAAC,MAAM;QACNjf,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU,GAAI,IAAI,CAACoF,MAAM,CAACkD,KAAK,GAAG,CAAC,CAAE;QAE3D,IAAIjgB,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAAC+P,WAAW,GAAG,CAAC,CAAC,EAAE;UAC3C,IAAI,CAACQ,QAAQ,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;QAC1C,CAAC,MAAM;UACNhB,IAAI,GAAG,IAAI,CAAC1B,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAAC9G,OAAO,CAACqK,IAAI,CAAC,CAAC;QACxC;MACD;IAED,CAAC,MAAM,IAAI,IAAI,CAACe,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,UAAU,EAAE;MAEjE,IAAI,CAACkI,SAAS,GAAG,IAAI,CAAC3Q,SAAS,CAAC2Q,SAAS;MAEzC,IAAI/gB,GAAG,GAAG,IAAI,CAACoQ,SAAS,CAAC2Q,SAAS,GAAG,IAAI,CAAC3Q,SAAS,CAAC7U,YAAY;MAEhE,IAAIyE,GAAG,GAAG,IAAI,CAACoQ,SAAS,CAAC9U,YAAY,EAAE;QACtC,IAAI,CAACqlB,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC3D,MAAM,CAAC9d,MAAM,EAAE,IAAI,CAAC;MAC3C,CAAC,MAAM;QACNggB,IAAI,GAAG,IAAI,CAAC1B,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAAC9G,OAAO,CAACqK,IAAI,CAAC,CAAC;MACxC;IAED,CAAC,MAAM;MACNA,IAAI,GAAG,IAAI,CAAC1B,KAAK,CAAC7B,IAAI,CAAC,CAAC,CAAC9G,OAAO,CAACqK,IAAI,CAAC,CAAC;IACxC;IAEA,IAAIA,IAAI,EAAE;MACT,IAAI,CAACvK,KAAK,CAAC,CAAC;MACZ;MACA,IAAI,CAACkJ,YAAY,CAAC,CAAC;MAEnB,IAAIkB,UAAU,GAAG,KAAK;MACtB,IAAI,IAAI,CAAC/B,MAAM,CAACV,IAAI,KAAK,eAAe,IAAI,IAAI,CAACU,MAAM,CAACmC,OAAO,KAAK,CAAC,IAAID,IAAI,CAACE,UAAU,CAACC,QAAQ,CAAC,mBAAmB,CAAC,EAAE;QACvHN,UAAU,GAAG,IAAI;MAClB;MAEA,OAAO,IAAI,CAACjD,MAAM,CAACoD,IAAI,EAAEH,UAAU,CAAC,CAClC/H,IAAI,CAAC,YAAY;QACjB,OAAO,IAAI,CAACgI,sBAAsB,CAACD,UAAU,EAAEG,IAAI,EAAE,IAAI,CAACpD,MAAM,CAAC;MAClE,CAAC,CAACxP,IAAI,CAAC,IAAI,CAAC,EAAGkI,GAAG,IAAK;QACtB,OAAOA,GAAG;MACX,CAAC,CAAC,CACDwC,IAAI,CAAC,YAAY;QACjB;QACA,IAAI,CAAC,IAAI,CAACiJ,WAAW,IACpB,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,IACnC,IAAI,CAACN,QAAQ,CAACO,SAAS,KAAK,KAAK,IACjC,IAAI,CAACP,QAAQ,CAAC+E,aAAa,KAAK,SAAS,EAAE;UAE3C,IAAI,CAACkC,QAAQ,CAAC,IAAI,CAACpP,SAAS,CAAC+P,WAAW,EAAE,CAAC,EAAE,IAAI,CAAC;QACnD;QACA;QACA;MACD,CAAC,CAAC7T,IAAI,CAAC,IAAI,CAAC,CAAC;IACf,CAAC,MACI,CACL;EACD;EAEA0U,IAAIA,CAAA,EAAG;IACN,IAAIA,IAAI;IACR,IAAI/gB,IAAI;IACR,IAAIsS,GAAG,GAAG,IAAI,CAACgG,QAAQ,CAACO,SAAS;IAEjC,IAAI,CAAC,IAAI,CAAC0E,KAAK,CAAC/gB,MAAM,EAAE;IAExB,IAAI,IAAI,CAACwjB,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,KAAK,CAACtG,GAAG,IAAIA,GAAG,KAAK,KAAK,CAAC,EAAE;MAEvF,IAAI,CAACqF,UAAU,GAAG,IAAI,CAACxH,SAAS,CAACwH,UAAU;MAE3C3X,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU;MAEhC,IAAI3X,IAAI,GAAG,CAAC,EAAE;QACb,IAAI,CAAC0gB,QAAQ,CAAC,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;MAC3C,CAAC,MAAM;QACNc,IAAI,GAAG,IAAI,CAACxD,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAACmM,IAAI,CAAC,CAAC;MACzC;IAED,CAAC,MAAM,IAAI,IAAI,CAACf,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,IAAItG,GAAG,KAAK,KAAK,EAAE;MAEpF,IAAI,CAACqF,UAAU,GAAG,IAAI,CAACxH,SAAS,CAACwH,UAAU;MAE3C,IAAI,IAAI,CAACW,QAAQ,CAAC+E,aAAa,KAAK,SAAS,EAAE;QAC9Crd,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU,GAAG,IAAI,CAACxH,SAAS,CAAC0Q,WAAW;QAE7D,IAAI7gB,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAAC+P,WAAW,EAAE;UACtC,IAAI,CAACQ,QAAQ,CAAC,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;QAC3C,CAAC,MAAM;UACNc,IAAI,GAAG,IAAI,CAACxD,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAACmM,IAAI,CAAC,CAAC;QACzC;MACD,CAAC,MACI;QACJ/gB,IAAI,GAAG,IAAI,CAACmQ,SAAS,CAACwH,UAAU;QAEhC,IAAI3X,IAAI,GAAG,CAAC,EAAE;UACb,IAAI,CAAC0gB,QAAQ,CAAC,CAAC,IAAI,CAAC3D,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;QAC3C,CAAC,MAAM;UACNc,IAAI,GAAG,IAAI,CAACxD,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAACmM,IAAI,CAAC,CAAC;QACzC;MACD;IAED,CAAC,MAAM,IAAI,IAAI,CAACf,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,UAAU,EAAE;MAEjE,IAAI,CAACkI,SAAS,GAAG,IAAI,CAAC3Q,SAAS,CAAC2Q,SAAS;MAEzC,IAAI/gB,GAAG,GAAG,IAAI,CAACoQ,SAAS,CAAC2Q,SAAS;MAElC,IAAI/gB,GAAG,GAAG,CAAC,EAAE;QACZ,IAAI,CAAC2gB,QAAQ,CAAC,CAAC,EAAE,CAAE,IAAI,CAAC3D,MAAM,CAAC9d,MAAO,EAAE,IAAI,CAAC;MAC9C,CAAC,MAAM;QACN8hB,IAAI,GAAG,IAAI,CAACxD,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAACmM,IAAI,CAAC,CAAC;MACzC;IAED,CAAC,MAAM;MAENA,IAAI,GAAG,IAAI,CAACxD,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAACmM,IAAI,CAAC,CAAC;IAEzC;IAEA,IAAIA,IAAI,EAAE;MACT,IAAI,CAACrM,KAAK,CAAC,CAAC;MACZ;MACA,IAAI,CAACkJ,YAAY,CAAC,CAAC;MAEnB,IAAIkB,UAAU,GAAG,KAAK;MACtB,IAAI,IAAI,CAAC/B,MAAM,CAACV,IAAI,KAAK,eAAe,IAAI,IAAI,CAACU,MAAM,CAACmC,OAAO,KAAK,CAAC,IAAI,OAAO6B,IAAI,CAACA,IAAI,CAAC,CAAC,KAAK,QAAQ,EAAE;QACzGjC,UAAU,GAAG,IAAI;MAClB;MAEA,OAAO,IAAI,CAAChD,OAAO,CAACiF,IAAI,EAAEjC,UAAU,CAAC,CACnC/H,IAAI,CAAC,YAAY;QACjB,IAAI/W,IAAI;QACR,IAAI,IAAI,CAAC+c,MAAM,CAACV,IAAI,KAAK,eAAe,IAAI,IAAI,CAACU,MAAM,CAACmC,OAAO,GAAG,CAAC,EAAE;UACpElf,IAAI,GAAG+gB,IAAI,CAACA,IAAI,CAAC,CAAC;UAClB,IAAI/gB,IAAI,EAAE;YACT,OAAO,IAAI,CAAC8b,OAAO,CAAC9b,IAAI,CAAC;UAC1B;QACD;MAED,CAAC,CAACqM,IAAI,CAAC,IAAI,CAAC,EAAGkI,GAAG,IAAK;QACtB,OAAOA,GAAG;MACX,CAAC,CAAC,CACDwC,IAAI,CAAC,YAAY;QACjB;;QAEA,IAAI,IAAI,CAACiJ,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,EAAE;UAC5D,IAAI,IAAI,CAACN,QAAQ,CAACO,SAAS,KAAK,KAAK,EAAE;YACtC,IAAI,IAAI,CAACP,QAAQ,CAAC+E,aAAa,KAAK,SAAS,EAAE;cAC9C,IAAI,CAACkC,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAE,IAAI,CAAC;YAC1B,CAAC,MACI;cACJ,IAAI,CAACA,QAAQ,CAAE,IAAI,CAACpP,SAAS,CAAC+P,WAAW,GAAG,CAAC,CAAC,GAAI,IAAI,CAACnD,MAAM,CAACkD,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC;YAC9E;UACD,CAAC,MAAM;YACN,IAAI,CAACV,QAAQ,CAAC,IAAI,CAACpP,SAAS,CAAC+P,WAAW,EAAE,CAAC,EAAE,IAAI,CAAC;YAClD;UACD;QACD;;QAEA;;QAEA,IAAI,CAAC/P,SAAS,CAAC4Q,IAAI,GAAG,IAAI;QAC1B;MAED,CAAC,CAAC1U,IAAI,CAAC,IAAI,CAAC,CAAC;IACf;EACD;EAEA2U,OAAOA,CAAA,EAAG;IACT,IAAI1B,OAAO,GAAG,IAAI,CAACA,OAAO,CAAC,CAAC;IAC5B,IAAIA,OAAO,CAAC9iB,MAAM,EAAE;MACnB;MACA,OAAO8iB,OAAO,CAACA,OAAO,CAAC9iB,MAAM,GAAG,CAAC,CAAC;IACnC;IACA,OAAO,IAAI;EACZ;EAEAkY,KAAKA,CAAA,EAAG;IAEP;;IAEA,IAAI,IAAI,CAAC6I,KAAK,EAAE;MACf,IAAI,CAACA,KAAK,CAACpB,IAAI,CAAC,CAAC;MACjB;MACA;MACA,IAAI,CAACoB,KAAK,CAAC7I,KAAK,CAAC,CAAC;IACnB;EACD;EAEAuM,eAAeA,CAAA,EAAG;IAEjB,IAAI,CAACrD,YAAY,CAAC,CAAC;IACnB,IAAI,IAAI,CAACoC,WAAW,IAAI,IAAI,CAAC1H,QAAQ,CAACM,IAAI,KAAK,YAAY,EAAE;MAC5D,IAAI,CAAC9a,QAAQ,GAAG,IAAI,CAACojB,iBAAiB,CAAC,CAAC;IACzC,CAAC,MAAM;MACN,IAAI,CAACpjB,QAAQ,GAAG,IAAI,CAACqjB,gBAAgB,CAAC,CAAC;IACxC;IACA,OAAO,IAAI,CAACrjB,QAAQ;EACrB;EAEAqjB,gBAAgBA,CAAA,EAAG;IAClB,IAAI7B,OAAO,GAAG,IAAI,CAACA,OAAO,CAAC,CAAC;IAC5B,IAAInP,SAAS,GAAG,IAAI,CAACA,SAAS,CAACvQ,qBAAqB,CAAC,CAAC;IACtD,IAAIwhB,UAAU,GAAIjR,SAAS,CAAClR,MAAM,GAAGhE,QAAQ,CAACC,eAAe,CAACC,YAAY,GAAIgV,SAAS,CAAClR,MAAM,GAAGhE,QAAQ,CAACC,eAAe,CAACC,YAAY;IACtI,IAAIkmB,SAAS,GAAIlR,SAAS,CAACnR,KAAK,GAAG/D,QAAQ,CAACC,eAAe,CAAC4E,WAAW,GAAIqQ,SAAS,CAACnR,KAAK,GAAG/D,QAAQ,CAACC,eAAe,CAAC4E,WAAW;IACjI,IAAIwhB,QAAQ,GAAI,IAAI,CAAChJ,QAAQ,CAACM,IAAI,KAAK,UAAW;IAClD,IAAI2I,GAAG,GAAI,IAAI,CAACjJ,QAAQ,CAACO,SAAS,KAAK,KAAM;IAE7C,IAAIjN,MAAM,GAAG,CAAC;IACd,IAAI4V,IAAI,GAAG,CAAC;IAEZ,IAAI,IAAI,CAAClJ,QAAQ,CAACgB,QAAQ,EAAE;MAC3B1N,MAAM,GAAG0V,QAAQ,GAAG/nB,MAAM,CAACkoB,OAAO,GAAGloB,MAAM,CAACmoB,OAAO;IACpD;IAEA,IAAIC,QAAQ,GAAGrC,OAAO,CAACpT,GAAG,CAAEyP,IAAI,IAAK;MACpC,IAAI;QAAEjb,KAAK;QAAE2S;MAAK,CAAC,GAAGsI,IAAI,CAAC/G,OAAO;MAClC,IAAItG,QAAQ,GAAGqN,IAAI,CAACrN,QAAQ,CAAC,CAAC;MAC9B,IAAItP,KAAK,GAAG2c,IAAI,CAAC3c,KAAK,CAAC,CAAC;MACxB,IAAIC,MAAM,GAAG0c,IAAI,CAAC1c,MAAM,CAAC,CAAC;MAE1B,IAAI2iB,QAAQ;MACZ,IAAIC,MAAM;MACV,IAAIC,OAAO;MACX,IAAIC,UAAU;MAEd,IAAIT,QAAQ,EAAE;QACbM,QAAQ,GAAGhW,MAAM,GAAGuE,SAAS,CAACpQ,GAAG,GAAGuO,QAAQ,CAACvO,GAAG,GAAGyhB,IAAI;QACvDK,MAAM,GAAGD,QAAQ,GAAGR,UAAU,GAAGI,IAAI;QACrCO,UAAU,GAAG,IAAI,CAAChF,MAAM,CAACiF,KAAK,CAAC/iB,MAAM,EAAEmiB,UAAU,CAAC,CAACa,KAAK;QACxDH,OAAO,GAAGV,UAAU;MACrB,CAAC,MAAM;QACNQ,QAAQ,GAAGhW,MAAM,GAAGuE,SAAS,CAACnQ,IAAI,GAAGsO,QAAQ,CAACtO,IAAI,GAAGwhB,IAAI;QACzDK,MAAM,GAAGD,QAAQ,GAAGP,SAAS,GAAGG,IAAI;QACpCO,UAAU,GAAG,IAAI,CAAChF,MAAM,CAACiF,KAAK,CAAChjB,KAAK,EAAEqiB,SAAS,CAAC,CAACY,KAAK;QACtDH,OAAO,GAAGT,SAAS;MACpB;MAEA,IAAIa,QAAQ,GAAGvnB,IAAI,CAACwnB,IAAI,CAACP,QAAQ,GAAGE,OAAO,CAAC;MAC5C,IAAIG,KAAK,GAAG,EAAE;MACd,IAAIG,OAAO,GAAGznB,IAAI,CAACwnB,IAAI,CAACN,MAAM,GAAGC,OAAO,CAAC;;MAEzC;MACA,IAAI,IAAI,CAACxJ,QAAQ,CAACO,SAAS,KAAK,KAAK,IAAI,CAACyI,QAAQ,EAAE;QACnD,IAAIe,aAAa,GAAGH,QAAQ;QAC5BA,QAAQ,GAAGH,UAAU,GAAGK,OAAO;QAC/BA,OAAO,GAAGL,UAAU,GAAGM,aAAa;MACrC;MAEAJ,KAAK,GAAG,EAAE;MACV,KAAK,IAAIvlB,CAAC,GAAGwlB,QAAQ,EAAExlB,CAAC,IAAI0lB,OAAO,EAAE1lB,CAAC,EAAE,EAAE;QACzC,IAAI4lB,EAAE,GAAG5lB,CAAC,GAAG,CAAC;QACdulB,KAAK,CAACvc,IAAI,CAAC4c,EAAE,CAAC;MACf;MAEA,IAAIC,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,IAAI,CAAC7G,IAAI,CAAClG,QAAQ,EAAEkG,IAAI,CAAC/G,OAAO,CAAC6N,OAAO,EAAEb,QAAQ,EAAEC,MAAM,CAAC;MAEtF,OAAO;QACNnhB,KAAK;QACL2S,IAAI;QACJ4O,KAAK;QACLF,UAAU;QACVQ;MACD,CAAC;IACF,CAAC,CAAC;IAEF,OAAOZ,QAAQ;EAChB;EAEAT,iBAAiBA,CAAA,EAAG;IACnB,IAAI5B,OAAO,GAAG,IAAI,CAACA,OAAO,CAAC,CAAC;IAC5B,IAAInP,SAAS,GAAG,IAAI,CAACA,SAAS,CAACvQ,qBAAqB,CAAC,CAAC;IAEtD,IAAII,IAAI,GAAG,CAAC;IACZ,IAAIwhB,IAAI,GAAG,CAAC;IAEZ,IAAI,IAAI,CAAClJ,QAAQ,CAACgB,QAAQ,EAAE;MAC3BtZ,IAAI,GAAGzG,MAAM,CAACmoB,OAAO;IACtB;IAEA,IAAIC,QAAQ,GAAGrC,OAAO,CAACpT,GAAG,CAAEyP,IAAI,IAAK;MACpC,IAAI;QAAEjb,KAAK;QAAE2S;MAAK,CAAC,GAAGsI,IAAI,CAAC/G,OAAO;MAClC,IAAIhJ,MAAM;MACV,IAAI0C,QAAQ,GAAGqN,IAAI,CAACrN,QAAQ,CAAC,CAAC;MAC9B,IAAItP,KAAK,GAAG2c,IAAI,CAAC3c,KAAK,CAAC,CAAC;;MAExB;MACA,IAAIb,KAAK;MACT,IAAIC,GAAG;MACP,IAAIijB,SAAS;MAEb,IAAI,IAAI,CAAC/I,QAAQ,CAACO,SAAS,KAAK,KAAK,EAAE;QACtCjN,MAAM,GAAGuE,SAAS,CAAClQ,KAAK,GAAGD,IAAI;QAC/BqhB,SAAS,GAAG1mB,IAAI,CAAC+nB,GAAG,CAAC/nB,IAAI,CAACgoB,GAAG,CAAC/W,MAAM,GAAG0C,QAAQ,CAACtO,IAAI,CAAC,EAAE,IAAI,CAAC+c,MAAM,CAAC/d,KAAK,CAAC,GAAGwiB,IAAI;QAChFpjB,GAAG,GAAGkQ,QAAQ,CAACtP,KAAK,IAAIsP,QAAQ,CAACrO,KAAK,GAAG2L,MAAM,CAAC,GAAG4V,IAAI;QACvDrjB,KAAK,GAAGC,GAAG,GAAGijB,SAAS;MACxB,CAAC,MAAM;QACNzV,MAAM,GAAGuE,SAAS,CAACnQ,IAAI,GAAGA,IAAI;QAC9BqhB,SAAS,GAAG1mB,IAAI,CAAC+nB,GAAG,CAACpU,QAAQ,CAACrO,KAAK,GAAG2L,MAAM,EAAE,IAAI,CAACmR,MAAM,CAAC/d,KAAK,CAAC,GAAGwiB,IAAI;QACvErjB,KAAK,GAAGyN,MAAM,GAAG0C,QAAQ,CAACtO,IAAI,GAAGwhB,IAAI;QACrCpjB,GAAG,GAAGD,KAAK,GAAGkjB,SAAS;MACxB;MAEAG,IAAI,IAAIH,SAAS;MAEjB,IAAIkB,OAAO,GAAG,IAAI,CAACA,OAAO,CAACC,IAAI,CAAC7G,IAAI,CAAClG,QAAQ,EAAEkG,IAAI,CAAC/G,OAAO,CAAC6N,OAAO,EAAEtkB,KAAK,EAAEC,GAAG,CAAC;MAEhF,IAAI2jB,UAAU,GAAG,IAAI,CAAChF,MAAM,CAACiF,KAAK,CAAChjB,KAAK,CAAC,CAACijB,KAAK;MAC/C,IAAIW,SAAS,GAAGjoB,IAAI,CAACE,KAAK,CAACsD,KAAK,GAAG,IAAI,CAAC4e,MAAM,CAACsE,SAAS,CAAC;MACzD,IAAIY,KAAK,GAAG,EAAE;MACd,IAAIG,OAAO,GAAGznB,IAAI,CAACE,KAAK,CAACuD,GAAG,GAAG,IAAI,CAAC2e,MAAM,CAACsE,SAAS,CAAC;;MAErD;MACA,IAAIuB,SAAS,GAAG,CAAC,EAAE;QAClBA,SAAS,GAAG,CAAC;QACbR,OAAO,GAAGA,OAAO,GAAG,CAAC;MACtB;;MAEA;MACA,IAAI,IAAI,CAAC9J,QAAQ,CAACO,SAAS,KAAK,KAAK,EAAE;QACtC,IAAIwJ,aAAa,GAAGO,SAAS;QAC7BA,SAAS,GAAGb,UAAU,GAAGK,OAAO;QAChCA,OAAO,GAAGL,UAAU,GAAGM,aAAa;MACrC;MAGA,KAAK,IAAI3lB,CAAC,GAAGkmB,SAAS,GAAG,CAAC,EAAElmB,CAAC,IAAI0lB,OAAO,EAAE1lB,CAAC,EAAE,EAAE;QAC9C,IAAI4lB,EAAE,GAAG5lB,CAAC;QACVulB,KAAK,CAACvc,IAAI,CAAC4c,EAAE,CAAC;MACf;MAEA,OAAO;QACN5hB,KAAK;QACL2S,IAAI;QACJ4O,KAAK;QACLF,UAAU;QACVQ;MACD,CAAC;IACF,CAAC,CAAC;IAEF,OAAOZ,QAAQ;EAChB;EAEAkB,SAASA,CAAClH,IAAI,EAAEmH,UAAU,EAAEC,UAAU,EAAEC,UAAU,EAAE;IACnD,IAAI1U,QAAQ,GAAGqN,IAAI,CAACrN,QAAQ,CAAC,CAAC;IAC9B,IAAI6B,SAAS,GAAG6S,UAAU,IAAI,IAAI,CAACrkB,MAAM,CAAC,CAAC;IAE3C,IAAI,IAAI,CAAC2Z,QAAQ,CAACM,IAAI,KAAK,YAAY,IACtCtK,QAAQ,CAACrO,KAAK,GAAGkQ,SAAS,CAACnQ,IAAI,GAAG8iB,UAAU,IAC5CxU,QAAQ,CAACtO,IAAI,GAAGmQ,SAAS,CAAClQ,KAAK,GAAG8iB,UAAU,EAAE;MAE9C,OAAO,IAAI;IAEZ,CAAC,MAAM,IAAI,IAAI,CAACzK,QAAQ,CAACM,IAAI,KAAK,UAAU,IAC3CtK,QAAQ,CAACpO,MAAM,GAAGiQ,SAAS,CAACpQ,GAAG,GAAG+iB,UAAU,IAC5CxU,QAAQ,CAACvO,GAAG,GAAGoQ,SAAS,CAACjQ,MAAM,GAAG6iB,UAAU,EAAE;MAE9C,OAAO,IAAI;IACZ;IAEA,OAAO,KAAK;EAEb;EAEAzD,OAAOA,CAAA,EAAG;IACT,IAAInP,SAAS,GAAG,IAAI,CAACxR,MAAM,CAAC,CAAC;IAC7B,IAAI4e,KAAK,GAAG,IAAI,CAACA,KAAK,CAACvB,SAAS,CAAC,CAAC;IAClC,IAAIiH,WAAW,GAAG1F,KAAK,CAAC/gB,MAAM;IAC9B,IAAI8iB,OAAO,GAAG,EAAE;IAChB,IAAIuD,SAAS;IACb,IAAIlH,IAAI;IAER,KAAK,IAAIjf,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGumB,WAAW,EAAEvmB,CAAC,EAAE,EAAE;MACrCif,IAAI,GAAG4B,KAAK,CAAC7gB,CAAC,CAAC;MACfmmB,SAAS,GAAG,IAAI,CAACA,SAAS,CAAClH,IAAI,EAAE,CAAC,EAAE,CAAC,EAAExL,SAAS,CAAC;MAEjD,IAAI0S,SAAS,KAAK,IAAI,EAAE;QACvBvD,OAAO,CAAC5Z,IAAI,CAACiW,IAAI,CAAC;MACnB;IAED;IACA,OAAO2D,OAAO;EACf;EAEAoB,QAAQA,CAACwC,CAAC,EAAEC,CAAC,EAAEC,MAAM,EAAE;IACtB,IAAI9Q,GAAG,GAAG,IAAI,CAACgG,QAAQ,CAACO,SAAS,KAAK,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC;IAEpD,IAAIuK,MAAM,EAAE;MACX,IAAI,CAACC,MAAM,GAAG,IAAI;IACnB;IAEA,IAAI,CAAC,IAAI,CAAC/K,QAAQ,CAACgB,QAAQ,EAAE;MAC5B,IAAI4J,CAAC,EAAE,IAAI,CAAC/S,SAAS,CAACwH,UAAU,IAAIuL,CAAC,GAAG5Q,GAAG;MAC3C,IAAI6Q,CAAC,EAAE;QACN,IAAI,IAAI,CAAChT,SAAS,CAAC2Q,SAAS,IAAI,IAAI,CAACxI,QAAQ,CAAC1M,MAAM,EAAE;UACrD,IAAI,CAACuE,SAAS,CAAC2Q,SAAS,IAAIqC,CAAC;QAC9B;MACD;IACD,CAAC,MACI;MACJ5pB,MAAM,CAACmnB,QAAQ,CAACwC,CAAC,GAAG5Q,GAAG,EAAE6Q,CAAC,GAAG7Q,GAAG,CAAC;IAClC;IACA,IAAI,CAACgR,QAAQ,GAAG,IAAI;EACrB;EAEAC,SAASA,CAACL,CAAC,EAAEC,CAAC,EAAEC,MAAM,EAAE;IACvB,IAAI9Q,GAAG,GAAG,IAAI,CAACgG,QAAQ,CAACO,SAAS,KAAK,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC;IAEpD,IAAIuK,MAAM,EAAE;MACX,IAAI,CAACC,MAAM,GAAG,IAAI;IACnB;IAEA,IAAI,CAAC,IAAI,CAAC/K,QAAQ,CAACgB,QAAQ,EAAE;MAC5B,IAAI4J,CAAC,EAAE,IAAI,CAAC/S,SAAS,CAACwH,UAAU,IAAIuL,CAAC,GAAG5Q,GAAG;MAC3C,IAAI6Q,CAAC,EAAE;QAEN,IAAI,CAAChT,SAAS,CAAC2Q,SAAS,IAAIqC,CAAC;MAE9B;IACD,CAAC,MACI;MACJ5pB,MAAM,CAACmnB,QAAQ,CAACwC,CAAC,GAAG5Q,GAAG,EAAE6Q,CAAC,GAAG7Q,GAAG,CAAC;IAClC;IACA,IAAI,CAACgR,QAAQ,GAAG,IAAI;EACrB;EAEA/D,QAAQA,CAAC2D,CAAC,EAAEC,CAAC,EAAEC,MAAM,EAAE;IAEtB,IAAIA,MAAM,EAAE;MACX,IAAI,CAACC,MAAM,GAAG,IAAI;IACnB;IAEA,IAAI,CAAC,IAAI,CAAC/K,QAAQ,CAACgB,QAAQ,EAAE;MAC5B,IAAI,CAACnJ,SAAS,CAACwH,UAAU,GAAGuL,CAAC;MAC7B,IAAI,CAAC/S,SAAS,CAAC2Q,SAAS,GAAGqC,CAAC;IAC7B,CAAC,MACI;MACJ5pB,MAAM,CAACgmB,QAAQ,CAAC2D,CAAC,EAAEC,CAAC,CAAC;IACtB;IACA,IAAI,CAACG,QAAQ,GAAG,IAAI;EACrB;EAEAvF,QAAQA,CAAA,EAAG;IACV,IAAI+C,SAAS;IACb,IAAInJ,UAAU;IAEd,IAAI,CAAC,IAAI,CAACW,QAAQ,CAACgB,QAAQ,EAAE;MAC5BwH,SAAS,GAAG,IAAI,CAAC3Q,SAAS,CAAC2Q,SAAS;MACpCnJ,UAAU,GAAG,IAAI,CAACxH,SAAS,CAACwH,UAAU;IACvC,CAAC,MAAM;MACNmJ,SAAS,GAAGvnB,MAAM,CAACkoB,OAAO;MAC1B9J,UAAU,GAAGpe,MAAM,CAACmoB,OAAO;IAC5B;IAEA,IAAI,CAACZ,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACnJ,UAAU,GAAGA,UAAU;IAE5B,IAAI,CAAC,IAAI,CAAC0L,MAAM,EAAE;MACjB,IAAI,CAAC5E,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACI,MAAM,EAAE;QACjC5I,GAAG,EAAE+gB,SAAS;QACd9gB,IAAI,EAAE2X;MACP,CAAC,CAAC;MAEFsG,YAAY,CAAC,IAAI,CAACG,aAAa,CAAC;MAChC,IAAI,CAACA,aAAa,GAAGI,UAAU,CAAC,YAAY;QAC3C,IAAI,CAACC,IAAI,CAAC7W,2BAAM,CAACW,QAAQ,CAACK,QAAQ,EAAE;UACnC7I,GAAG,EAAE,IAAI,CAAC+gB,SAAS;UACnB9gB,IAAI,EAAE,IAAI,CAAC2X;QACZ,CAAC,CAAC;MACH,CAAC,CAACtL,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC;IAIlB,CAAC,MAAM;MACN,IAAI,CAACgX,MAAM,GAAG,KAAK;IACpB;EAED;EAEA1kB,MAAMA,CAAA,EAAG;IACR,IAAIA,MAAM;IAEVA,MAAM,GAAG,IAAI,CAAC2e,KAAK,CAAC3e,MAAM,CAAC,CAAC;IAE5B,OAAOA,MAAM;EACd;EAEA6kB,WAAWA,CAACzG,MAAM,EAAE;IAEnB,IAAI,CAACA,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACa,YAAY,CAAC,CAAC;IACnB,IAAI,IAAI,CAACL,KAAK,IAAI,IAAI,CAACA,KAAK,CAAC/gB,MAAM,GAAG,CAAC,IAAI,IAAI,CAACugB,MAAM,CAACV,IAAI,KAAK,eAAe,EAAE;MAChF,IAAI,CAACnE,OAAO,CAAC,IAAI,CAACqF,KAAK,CAAC9B,KAAK,CAAC,CAAC,CAAC7G,OAAO,CAAC;IACzC;IACA;EACD;EAEAgJ,YAAYA,CAAA,EAAG;IAEd,IAAI,CAAC,IAAI,CAACN,KAAK,EAAE;MAChB;IACD;IAEA,IAAI,CAACG,UAAU,GAAG,IAAI,CAACH,KAAK,CAACpD,IAAI,CAAC,CAAC;IAEnC,IAAI,CAAC,IAAI,CAAC8F,WAAW,EAAE;MACtB,IAAI,CAACjD,MAAM,CAAC0G,SAAS,CAAC,IAAI,CAAChG,UAAU,CAACze,KAAK,EAAE,IAAI,CAACye,UAAU,CAACxe,MAAM,CAAC;IACrE,CAAC,MAAM;MACN,IAAI,CAAC8d,MAAM,CAAC0G,SAAS,CACpB,IAAI,CAAChG,UAAU,CAACze,KAAK,EACrB,IAAI,CAACye,UAAU,CAACxe,MAAM,EACtB,IAAI,CAACqZ,QAAQ,CAACoL,GACf,CAAC;;MAED;MACA,IAAI,CAACpL,QAAQ,CAAC1M,MAAM,GAAG,IAAI,CAACmR,MAAM,CAACkD,KAAK,GAAG,IAAI,CAAClD,MAAM,CAACmC,OAAO;;MAE9D;IAED;;IAEA;IACA,IAAI,CAACpC,YAAY,CAAC9d,KAAK,GAAG,IAAI,CAAC+d,MAAM,CAAC/d,KAAK;IAC3C,IAAI,CAAC8d,YAAY,CAAC7d,MAAM,GAAG,IAAI,CAAC8d,MAAM,CAAC9d,MAAM;IAE7C,IAAI,CAAC0kB,SAAS,CAAC,IAAI,CAAC5G,MAAM,CAAC;EAE5B;EAEA4G,SAASA,CAAC5G,MAAM,EAAE;IAEjB,IAAI,CAACD,YAAY,CAACC,MAAM,GAAGA,MAAM;IAEjC,IAAI,CAACwF,OAAO,GAAG,IAAIqB,0BAAO,CAAC7G,MAAM,CAAC3Z,KAAK,EAAE,IAAI,CAACkV,QAAQ,CAACO,SAAS,EAAE,IAAI,CAACP,QAAQ,CAACM,IAAI,CAAC;IAErF,IAAI,IAAI,CAAC2E,KAAK,EAAE;MAEf,IAAI,CAACA,KAAK,CAACngB,OAAO,CAAC,UAAUue,IAAI,EAAE;QAClC,IAAIA,IAAI,EAAE;UACTA,IAAI,CAACgI,SAAS,CAAC5G,MAAM,CAAC;QACvB;MACD,CAAC,CAAC;IAEH;EAED;EAEAwD,iBAAiBA,CAACD,IAAI,EAAE;IACvB,IAAI,CAAC1D,WAAW,GAAG0D,IAAI;EACxB;EAEAD,UAAUA,CAACzH,IAAI,EAAEiL,WAAW,EAAE;IAE7B,IAAI,CAACA,WAAW,IAAIjL,IAAI,KAAK,IAAI,CAACN,QAAQ,CAACM,IAAI,EAAE;MAChD;IACD;IAEA,IAAI,CAACN,QAAQ,CAACM,IAAI,GAAGA,IAAI;IAEzB,IAAI,CAAC0E,KAAK,IAAI,IAAI,CAACA,KAAK,CAAC1E,IAAI,CAACA,IAAI,CAAC;IAEnC,IAAI,CAACkE,YAAY,CAAClE,IAAI,GAAGA,IAAI;IAE7B,IAAI,IAAI,CAAC2J,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,GAAG,IAAIqB,0BAAO,CAAC,IAAI,CAAC7G,MAAM,CAAC3Z,KAAK,EAAE,IAAI,CAACkV,QAAQ,CAACO,SAAS,EAAE,IAAI,CAACP,QAAQ,CAACM,IAAI,CAAC;IAC3F;IAEA,IAAI,IAAI,CAACmE,MAAM,EAAE;MAChB,IAAInE,IAAI,KAAK,UAAU,EAAE;QACxB,IAAI,CAACmE,MAAM,CAAC+G,MAAM,CAAC,MAAM,CAAC;MAC3B,CAAC,MAAM;QACN,IAAI,CAAC/G,MAAM,CAAC+G,MAAM,CAAC,IAAI,CAAC/G,MAAM,CAACzE,QAAQ,CAACwL,MAAM,CAAC;MAChD;IACD;EACD;EAEAC,UAAUA,CAAClH,IAAI,EAAEmH,uBAAuB,GAAG,MAAM,EAAE;IAClD,IAAIhE,WAAW,GAAInD,IAAI,KAAK,WAAW,IAAIA,IAAI,KAAK,MAAO;IAE3D,IAAI,CAACmD,WAAW,GAAGA,WAAW;IAE9B,IAAInD,IAAI,KAAK,cAAc,IAC1BA,IAAI,KAAK,qBAAqB,IAC9BA,IAAI,KAAK,UAAU,EAAE;MACrB,IAAI,CAACwD,UAAU,CAAC,UAAU,CAAC;IAC5B,CAAC,MAAM;MACN,IAAI,CAACA,UAAU,CAAC,YAAY,CAAC;IAC9B;IAEA,IAAI,CAACvD,YAAY,CAACD,IAAI,GAAGA,IAAI;IAE7B,IAAI,CAAC,IAAI,CAACvE,QAAQ,CAACP,QAAQ,EAAE;MAC5B,IAAI,CAACA,QAAQ,GAAGiI,WAAW,GAAG,QAAQ,GAAGgE,uBAAuB;IACjE,CAAC,MAAM;MACN,IAAI,CAACjM,QAAQ,GAAG,IAAI,CAACO,QAAQ,CAACP,QAAQ;IACvC;IAEA,IAAI,CAACuF,KAAK,IAAI,IAAI,CAACA,KAAK,CAACvF,QAAQ,CAAC,IAAI,CAACA,QAAQ,CAAC;IAEhD,IAAI,CAAC6F,YAAY,CAAC,CAAC;EAEpB;EAEAqG,WAAWA,CAAA,EAAG;IAEb,IAAIxO,QAAQ,GAAG,EAAE;IACjB,IAAI,CAAC,IAAI,CAAC8H,KAAK,EAAE;MAChB,OAAO9H,QAAQ;IAChB;IACA,IAAI,CAAC8H,KAAK,CAACngB,OAAO,CAAC,UAAUue,IAAI,EAAE;MAClC,MAAMuI,YAAY,GAAGvI,IAAI,IAAIA,IAAI,CAAClG,QAAQ;MAC1C,IAAIyO,YAAY,EAAE;QACjBzO,QAAQ,CAAC/P,IAAI,CAACwe,YAAY,CAAC;MAC5B;IACD,CAAC,CAAC;IACF,OAAOzO,QAAQ;EAChB;EAEA0O,cAAcA,CAAA,EAAG;IAEhB,IAAI1O,QAAQ,GAAG,EAAE;IAEjB,IAAI,CAAC8H,KAAK,CAACngB,OAAO,CAAC,UAAUue,IAAI,EAAE;MAGlClG,QAAQ,CAAC/P,IAAI,CAACiW,IAAI,CAAC;IAEpB,CAAC,CAAC;IACF,OAAOlG,QAAQ;EAChB;EAEAoD,SAASA,CAACvG,GAAG,GAAG,KAAK,EAAE;IACtB,IAAI,CAACgG,QAAQ,CAACO,SAAS,GAAGvG,GAAG;IAE7B,IAAI,CAACgL,KAAK,IAAI,IAAI,CAACA,KAAK,CAACzE,SAAS,CAACvG,GAAG,CAAC;IAEvC,IAAI,CAACwK,YAAY,CAACjE,SAAS,GAAGvG,GAAG;IAEjC,IAAI,CAACsL,YAAY,CAAC,CAAC;EACpB;EAEAwG,UAAUA,CAAA,EAAG;IACZ,OAAO,IAAI,CAAClH,QAAQ;EACrB;AACD;;AAEA;AACAmH,uBAAY,CAACjI,0BAAkB,CAACla,SAAS,CAAC;AAE3Bka,0GAAkB,E;;;;;;;ACpnCjC;AAAA;AAAgC;AACU;;AAE1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMwH,OAAO,CAAC;EACbvd,WAAWA,CAAC0W,MAAM,EAAElE,SAAS,EAAED,IAAI,EAAE0L,GAAG,GAAC,KAAK,EAAE;IAC/C,IAAI,CAACvH,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACwH,UAAU,GAAI3L,IAAI,KAAK,YAAY,GAAI,IAAI,GAAG,KAAK;IACxD,IAAI,CAACC,SAAS,GAAGA,SAAS,IAAI,KAAK;IACnC,IAAI,CAAC2L,IAAI,GAAGF,GAAG;EAChB;;EAEA;AACD;AACA;EACC1P,OAAOA,CAAC+G,IAAI,EAAE;IACb,IAAI7O,MAAM,GAAG,IAAI,CAAC2X,UAAU,CAAC9I,IAAI,CAAC;IAClC,IAAIzP,GAAG,GAAG,IAAI,CAACwY,kBAAkB,CAAC/I,IAAI,CAAC/G,OAAO,CAAC6N,OAAO,EAAE3V,MAAM,CAAC;IAE/D,OAAOZ,GAAG;EACX;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACCsW,IAAIA,CAAC/M,QAAQ,EAAEgN,OAAO,EAAEtkB,KAAK,EAAEC,GAAG,EAAE;IACnC,IAAIuF,IAAI,GAAG8R,QAAQ,IAAIA,QAAQ,CAACxa,QAAQ,GAAGwa,QAAQ,CAACxa,QAAQ,CAACG,IAAI,GAAG,KAAK;IACzE,IAAI2J,MAAM;IAEV,IAAI,CAACpB,IAAI,EAAE;MACV;IACD;IAEAoB,MAAM,GAAG,IAAI,CAAC4f,kBAAkB,CAAClC,OAAO,EAAE;MACzCtkB,KAAK,EAAE,IAAI,CAACymB,SAAS,CAACjhB,IAAI,EAAExF,KAAK,EAAEC,GAAG,CAAC;MACvCA,GAAG,EAAE,IAAI,CAACymB,OAAO,CAAClhB,IAAI,EAAExF,KAAK,EAAEC,GAAG;IACnC,CAAC,CAAC;IAEF,IAAI,IAAI,CAAComB,IAAI,KAAK,IAAI,EAAE;MACvB,IAAIllB,GAAG,GAAGmW,QAAQ,CAACxa,QAAQ;MAC3B,IAAI6pB,UAAU,GAAG,IAAI3a,wDAAO,CAACpF,MAAM,CAAC5G,KAAK,CAAC,CAAC8S,OAAO,CAAC3R,GAAG,CAAC;MACvD,IAAIylB,QAAQ,GAAG,IAAI5a,wDAAO,CAACpF,MAAM,CAAC3G,GAAG,CAAC,CAAC6S,OAAO,CAAC3R,GAAG,CAAC;MAEnD,IAAI0lB,SAAS,GAAG1lB,GAAG,CAAC2lB,WAAW,CAACC,YAAY,CAAC,CAAC;MAC9C,IAAIxqB,CAAC,GAAG4E,GAAG,CAACI,WAAW,CAAC,CAAC;MACzBslB,SAAS,CAACG,eAAe,CAAC,CAAC;MAC3BzqB,CAAC,CAACkM,QAAQ,CAACke,UAAU,CAACpe,cAAc,EAAEoe,UAAU,CAACne,WAAW,CAAC;MAC7DjM,CAAC,CAACuM,MAAM,CAAC8d,QAAQ,CAACve,YAAY,EAAEue,QAAQ,CAACte,SAAS,CAAC;MACnDue,SAAS,CAACI,QAAQ,CAAC1qB,CAAC,CAAC;IACtB;IAEA,OAAOqK,MAAM;EACd;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACCd,IAAIA,CAACN,IAAI,EAAEC,IAAI,EAAE;IAChB;IACA;IACA;IACA,IAAGD,IAAI,IAAIA,IAAI,CAAClI,QAAQ,KAAK+D,IAAI,CAAC5F,SAAS,EAAE;MAC5C;IACD;IACA;IACA;IACA,IAAI4J,MAAM,GAAG;MACZ6hB,UAAU,EAAE,SAAAA,CAASjmB,IAAI,EAAE;QAC1B,IAAIA,IAAI,CAAC0C,IAAI,CAACwjB,IAAI,CAAC,CAAC,CAAC9oB,MAAM,GAAG,CAAC,EAAE;UAChC,OAAOuH,UAAU,CAACwhB,aAAa;QAChC,CAAC,MAAM;UACN,OAAOxhB,UAAU,CAACyhB,aAAa;QAChC;MACD;IACD,CAAC;IACD,IAAIC,UAAU,GAAGjiB,MAAM,CAAC6hB,UAAU;IAClCI,UAAU,CAACJ,UAAU,GAAG7hB,MAAM,CAAC6hB,UAAU;IAEzC,IAAIvhB,UAAU,GAAG7I,QAAQ,CAAC4I,gBAAgB,CAACF,IAAI,EAAEI,UAAU,CAACC,SAAS,EAAEyhB,UAAU,EAAE,KAAK,CAAC;IACzF,IAAIrmB,IAAI;IACR,IAAI2F,MAAM;IACV,OAAQ3F,IAAI,GAAG0E,UAAU,CAACI,QAAQ,CAAC,CAAC,EAAG;MACtCa,MAAM,GAAGnB,IAAI,CAACxE,IAAI,CAAC;MACnB,IAAG2F,MAAM,EAAE;IACZ;IAEA,OAAOA,MAAM;EACd;EAEA0f,UAAUA,CAAC9I,IAAI,EAAC;IACf,IAAI+J,OAAO,GAAG,EAAE;IAChB,IAAIxF,WAAW,GAAGvE,IAAI,CAAClG,QAAQ,CAACyK,WAAW,CAAC,CAAC;IAC7C,IAAIyF,OAAO,GAAGhrB,IAAI,CAACwnB,IAAI,CAAEjC,WAAW,GAAG,IAAI,CAACnD,MAAM,CAAC6I,WAAW,CAAC;IAC/D,IAAI5D,KAAK,GAAG2D,OAAO,GAAG,IAAI,CAAC5I,MAAM,CAACmC,OAAO;IACzC,IAAI2G,WAAW,GAAG,IAAI,CAAC9I,MAAM,CAAC8I,WAAW;IACzC,IAAInC,GAAG,GAAG,IAAI,CAAC3G,MAAM,CAAC2G,GAAG;IACzB,IAAIvlB,KAAK,EAAEC,GAAG;IAEd,KAAK,IAAI1B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGslB,KAAK,CAACC,KAAK,EAAEvlB,CAAC,EAAE,EAAE;MACrCyB,KAAK,GAAG,CAAC0nB,WAAW,GAAGnC,GAAG,IAAIhnB,CAAC;MAC/B0B,GAAG,GAAIynB,WAAW,IAAInpB,CAAC,GAAC,CAAC,CAAC,GAAKgnB,GAAG,GAAGhnB,CAAE;MACvCgpB,OAAO,CAAChgB,IAAI,CAAC;QACZvH,KAAK,EAAE,IAAI,CAACymB,SAAS,CAACjJ,IAAI,CAAC1gB,QAAQ,CAACG,IAAI,EAAE+C,KAAK,EAAEC,GAAG,CAAC;QACrDA,GAAG,EAAE,IAAI,CAACymB,OAAO,CAAClJ,IAAI,CAAC1gB,QAAQ,CAACG,IAAI,EAAE+C,KAAK,EAAEC,GAAG;MACjD,CAAC,CAAC;IACH;IAEA,OAAOsnB,OAAO;EACf;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCd,SAASA,CAACjhB,IAAI,EAAExF,KAAK,EAAEC,GAAG,EAAC;IAC1B,IAAI0nB,KAAK,GAAG,CAACniB,IAAI,CAAC;IAClB,IAAIoiB,GAAG;IACP,IAAIC,KAAK;IACT,IAAIC,KAAK,GAAGtiB,IAAI;IAEhB,OAAOmiB,KAAK,CAACtpB,MAAM,EAAE;MAEpBupB,GAAG,GAAGD,KAAK,CAAC7Z,KAAK,CAAC,CAAC;MAEnB+Z,KAAK,GAAG,IAAI,CAAC/hB,IAAI,CAAC8hB,GAAG,EAAG3mB,IAAI,IAAK;QAChC,IAAIY,IAAI,EAAEC,KAAK,EAAEF,GAAG,EAAEG,MAAM;QAC5B,IAAIb,KAAK;QACT,IAAII,OAAO;QAGXJ,KAAK,GAAGF,8DAAU,CAACC,IAAI,CAAC;QAExB,IAAI,IAAI,CAACmlB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;UAEhD7Y,IAAI,GAAG,IAAI,CAACukB,UAAU,GAAGllB,KAAK,CAACW,IAAI,GAAGX,KAAK,CAACU,GAAG;UAC/CE,KAAK,GAAG,IAAI,CAACskB,UAAU,GAAGllB,KAAK,CAACY,KAAK,GAAGZ,KAAK,CAACa,MAAM;UAEpD,IAAIF,IAAI,IAAI7B,KAAK,IAAI6B,IAAI,IAAI5B,GAAG,EAAG;YAClC,OAAOgB,IAAI;UACZ,CAAC,MAAM,IAAIa,KAAK,GAAG9B,KAAK,EAAE;YACzB,OAAOiB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED,CAAC,MAAM,IAAI,IAAI,CAACmlB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;UAEvD7Y,IAAI,GAAGX,KAAK,CAACW,IAAI;UACjBC,KAAK,GAAGZ,KAAK,CAACY,KAAK;UAEnB,IAAIA,KAAK,IAAI7B,GAAG,IAAI6B,KAAK,IAAI9B,KAAK,EAAG;YACpC,OAAOiB,IAAI;UACZ,CAAC,MAAM,IAAIY,IAAI,GAAG5B,GAAG,EAAE;YACtB,OAAOgB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED,CAAC,MAAM;UAENW,GAAG,GAAGV,KAAK,CAACU,GAAG;UACfG,MAAM,GAAGb,KAAK,CAACa,MAAM;UAErB,IAAIH,GAAG,IAAI5B,KAAK,IAAI4B,GAAG,IAAI3B,GAAG,EAAG;YAChC,OAAOgB,IAAI;UACZ,CAAC,MAAM,IAAIc,MAAM,GAAG/B,KAAK,EAAE;YAC1B,OAAOiB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED;MAGD,CAAC,CAAC;MAEF,IAAG4mB,KAAK,EAAE;QAET,OAAO,IAAI,CAACE,kBAAkB,CAACF,KAAK,EAAE7nB,KAAK,EAAEC,GAAG,CAAC;MAClD;IAED;;IAEA;IACA,OAAO,IAAI,CAAC8nB,kBAAkB,CAACD,KAAK,EAAE9nB,KAAK,EAAEC,GAAG,CAAC;EAClD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCymB,OAAOA,CAAClhB,IAAI,EAAExF,KAAK,EAAEC,GAAG,EAAC;IACxB,IAAI0nB,KAAK,GAAG,CAACniB,IAAI,CAAC;IAClB,IAAIoiB,GAAG;IACP,IAAIE,KAAK,GAAGtiB,IAAI;IAChB,IAAIqiB,KAAK;IAET,OAAOF,KAAK,CAACtpB,MAAM,EAAE;MAEpBupB,GAAG,GAAGD,KAAK,CAAC7Z,KAAK,CAAC,CAAC;MAEnB+Z,KAAK,GAAG,IAAI,CAAC/hB,IAAI,CAAC8hB,GAAG,EAAG3mB,IAAI,IAAK;QAEhC,IAAIY,IAAI,EAAEC,KAAK,EAAEF,GAAG,EAAEG,MAAM;QAC5B,IAAIb,KAAK;QACT,IAAII,OAAO;QAEXJ,KAAK,GAAGF,8DAAU,CAACC,IAAI,CAAC;QAExB,IAAI,IAAI,CAACmlB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;UAEhD7Y,IAAI,GAAGrF,IAAI,CAACwrB,KAAK,CAAC9mB,KAAK,CAACW,IAAI,CAAC;UAC7BC,KAAK,GAAGtF,IAAI,CAACwrB,KAAK,CAAC9mB,KAAK,CAACY,KAAK,CAAC;UAE/B,IAAGD,IAAI,GAAG5B,GAAG,IAAI6nB,KAAK,EAAE;YACvB,OAAOA,KAAK;UACb,CAAC,MAAM,IAAGhmB,KAAK,GAAG7B,GAAG,EAAE;YACtB,OAAOgB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED,CAAC,MAAM,IAAI,IAAI,CAACmlB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;UAEvD7Y,IAAI,GAAGrF,IAAI,CAACwrB,KAAK,CAAC,IAAI,CAAC5B,UAAU,GAAGllB,KAAK,CAACW,IAAI,GAAGX,KAAK,CAACU,GAAG,CAAC;UAC3DE,KAAK,GAAGtF,IAAI,CAACwrB,KAAK,CAAC,IAAI,CAAC5B,UAAU,GAAGllB,KAAK,CAACY,KAAK,GAAGZ,KAAK,CAACa,MAAM,CAAC;UAEhE,IAAGD,KAAK,GAAG9B,KAAK,IAAI8nB,KAAK,EAAE;YAC1B,OAAOA,KAAK;UACb,CAAC,MAAM,IAAGjmB,IAAI,GAAG7B,KAAK,EAAE;YACvB,OAAOiB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED,CAAC,MAAM;UAENW,GAAG,GAAGpF,IAAI,CAACwrB,KAAK,CAAC9mB,KAAK,CAACU,GAAG,CAAC;UAC3BG,MAAM,GAAGvF,IAAI,CAACwrB,KAAK,CAAC9mB,KAAK,CAACa,MAAM,CAAC;UAEjC,IAAGH,GAAG,GAAG3B,GAAG,IAAI6nB,KAAK,EAAE;YACtB,OAAOA,KAAK;UACb,CAAC,MAAM,IAAG/lB,MAAM,GAAG9B,GAAG,EAAE;YACvB,OAAOgB,IAAI;UACZ,CAAC,MAAM;YACN6mB,KAAK,GAAG7mB,IAAI;YACZ0mB,KAAK,CAACpgB,IAAI,CAACtG,IAAI,CAAC;UACjB;QAED;MAED,CAAC,CAAC;MAGF,IAAG4mB,KAAK,EAAC;QACR,OAAO,IAAI,CAACI,gBAAgB,CAACJ,KAAK,EAAE7nB,KAAK,EAAEC,GAAG,CAAC;MAChD;IAED;;IAEA;IACA,OAAO,IAAI,CAACgoB,gBAAgB,CAACH,KAAK,EAAE9nB,KAAK,EAAEC,GAAG,CAAC;EAChD;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACC8nB,kBAAkBA,CAAC9mB,IAAI,EAAEjB,KAAK,EAAEC,GAAG,EAAC;IACnC,IAAI0O,MAAM,GAAG,IAAI,CAACuZ,uBAAuB,CAACjnB,IAAI,CAAC;IAC/C,IAAIqL,KAAK;IACT,IAAIkH,GAAG;IACP,IAAI3R,IAAI,EAAED,GAAG,EAAEE,KAAK;IAEpB,KAAK,IAAIvD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoQ,MAAM,CAACtQ,MAAM,EAAEE,CAAC,EAAE,EAAE;MACvC+N,KAAK,GAAGqC,MAAM,CAACpQ,CAAC,CAAC;MAEjBiV,GAAG,GAAGlH,KAAK,CAAC7K,qBAAqB,CAAC,CAAC;MAEnC,IAAI,IAAI,CAAC2kB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;QAEhD7Y,IAAI,GAAG2R,GAAG,CAAC3R,IAAI;QACf,IAAIA,IAAI,IAAI7B,KAAK,EAAG;UACnB,OAAOsM,KAAK;QACb;MAED,CAAC,MAAM,IAAI,IAAI,CAAC8Z,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;QAEvD5Y,KAAK,GAAG0R,GAAG,CAAC1R,KAAK;QACjB,IAAIA,KAAK,IAAI7B,GAAG,EAAG;UAClB,OAAOqM,KAAK;QACb;MAED,CAAC,MAAM;QAEN1K,GAAG,GAAG4R,GAAG,CAAC5R,GAAG;QACb,IAAIA,GAAG,IAAI5B,KAAK,EAAG;UAClB,OAAOsM,KAAK;QACb;MAED;;MAEA;IAED;IAEA,OAAOqC,MAAM,CAAC,CAAC,CAAC;EACjB;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;AACA;EACCsZ,gBAAgBA,CAAChnB,IAAI,EAAEjB,KAAK,EAAEC,GAAG,EAAC;IACjC,IAAI0O,MAAM,GAAG,IAAI,CAACuZ,uBAAuB,CAACjnB,IAAI,CAAC;IAC/C,IAAI2hB,IAAI;IACR,IAAItW,KAAK;IACT,IAAIkH,GAAG;IACP,IAAI3R,IAAI,EAAEC,KAAK,EAAEF,GAAG,EAAEG,MAAM;IAE5B,KAAK,IAAIxD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGoQ,MAAM,CAACtQ,MAAM,EAAEE,CAAC,EAAE,EAAE;MACvC+N,KAAK,GAAGqC,MAAM,CAACpQ,CAAC,CAAC;MAEjBiV,GAAG,GAAGlH,KAAK,CAAC7K,qBAAqB,CAAC,CAAC;MAEnC,IAAI,IAAI,CAAC2kB,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;QAEhD7Y,IAAI,GAAG2R,GAAG,CAAC3R,IAAI;QACfC,KAAK,GAAG0R,GAAG,CAAC1R,KAAK;QAEjB,IAAGD,IAAI,GAAG5B,GAAG,IAAI2iB,IAAI,EAAE;UACtB,OAAOA,IAAI;QACZ,CAAC,MAAM,IAAG9gB,KAAK,GAAG7B,GAAG,EAAE;UACtB,OAAOqM,KAAK;QACb;MAED,CAAC,MAAM,IAAI,IAAI,CAAC8Z,UAAU,IAAI,IAAI,CAAC1L,SAAS,KAAK,KAAK,EAAE;QAEvD7Y,IAAI,GAAG2R,GAAG,CAAC3R,IAAI;QACfC,KAAK,GAAG0R,GAAG,CAAC1R,KAAK;QAEjB,IAAGA,KAAK,GAAG9B,KAAK,IAAI4iB,IAAI,EAAE;UACzB,OAAOA,IAAI;QACZ,CAAC,MAAM,IAAG/gB,IAAI,GAAG7B,KAAK,EAAE;UACvB,OAAOsM,KAAK;QACb;MAED,CAAC,MAAM;QAEN1K,GAAG,GAAG4R,GAAG,CAAC5R,GAAG;QACbG,MAAM,GAAGyR,GAAG,CAACzR,MAAM;QAEnB,IAAGH,GAAG,GAAG3B,GAAG,IAAI2iB,IAAI,EAAE;UACrB,OAAOA,IAAI;QACZ,CAAC,MAAM,IAAG7gB,MAAM,GAAG9B,GAAG,EAAE;UACvB,OAAOqM,KAAK;QACb;MAED;MAGAsW,IAAI,GAAGtW,KAAK;IAEb;;IAEA;IACA,OAAOqC,MAAM,CAACA,MAAM,CAACtQ,MAAM,GAAC,CAAC,CAAC;EAE/B;;EAEA;AACD;AACA;AACA;AACA;AACA;AACA;EACC6pB,uBAAuBA,CAACjnB,IAAI,EAAEknB,SAAS,EAAC;IACvC,IAAIxZ,MAAM,GAAG,EAAE;IACf,IAAIvF,WAAW,GAAGnI,IAAI,CAACmI,WAAW,IAAI,EAAE;IACxC,IAAIgf,IAAI,GAAGhf,WAAW,CAAC+d,IAAI,CAAC,CAAC;IAC7B,IAAI7a,KAAK;IACT,IAAInL,GAAG,GAAGF,IAAI,CAACG,aAAa;IAC5B,IAAIinB,QAAQ,GAAGF,SAAS,IAAI,GAAG;IAE/B,IAAI3U,GAAG,GAAG4U,IAAI,CAACtqB,OAAO,CAACuqB,QAAQ,CAAC;IAEhC,IAAG7U,GAAG,KAAK,CAAC,CAAC,IAAIvS,IAAI,CAAC3D,QAAQ,IAAI+D,IAAI,CAAC5F,SAAS,EAAE;MACjD6Q,KAAK,GAAGnL,GAAG,CAACI,WAAW,CAAC,CAAC;MACzB+K,KAAK,CAAC9K,kBAAkB,CAACP,IAAI,CAAC;MAC9B,OAAO,CAACqL,KAAK,CAAC;IACf;IAEAA,KAAK,GAAGnL,GAAG,CAACI,WAAW,CAAC,CAAC;IACzB+K,KAAK,CAAC7D,QAAQ,CAACxH,IAAI,EAAE,CAAC,CAAC;IACvBqL,KAAK,CAACxD,MAAM,CAAC7H,IAAI,EAAEuS,GAAG,CAAC;IACvB7E,MAAM,CAACpH,IAAI,CAAC+E,KAAK,CAAC;IAClBA,KAAK,GAAG,KAAK;IAEb,OAAQkH,GAAG,IAAI,CAAC,CAAC,EAAG;MAEnBA,GAAG,GAAG4U,IAAI,CAACtqB,OAAO,CAACuqB,QAAQ,EAAE7U,GAAG,GAAG,CAAC,CAAC;MACrC,IAAGA,GAAG,GAAG,CAAC,EAAE;QAEX,IAAGlH,KAAK,EAAE;UACTA,KAAK,CAACxD,MAAM,CAAC7H,IAAI,EAAEuS,GAAG,CAAC;UACvB7E,MAAM,CAACpH,IAAI,CAAC+E,KAAK,CAAC;QACnB;QAEAA,KAAK,GAAGnL,GAAG,CAACI,WAAW,CAAC,CAAC;QACzB+K,KAAK,CAAC7D,QAAQ,CAACxH,IAAI,EAAEuS,GAAG,GAAC,CAAC,CAAC;MAC5B;IACD;IAEA,IAAGlH,KAAK,EAAE;MACTA,KAAK,CAACxD,MAAM,CAAC7H,IAAI,EAAEmnB,IAAI,CAAC/pB,MAAM,CAAC;MAC/BsQ,MAAM,CAACpH,IAAI,CAAC+E,KAAK,CAAC;IACnB;IAEA,OAAOqC,MAAM;EACd;;EAGA;AACD;AACA;AACA;AACA;AACA;AACA;EACC6X,kBAAkBA,CAAClC,OAAO,EAAEgE,SAAS,EAAC;IAErC,IAAI3B,UAAU,GAAG2B,SAAS,CAACtoB,KAAK;IAChC,IAAI4mB,QAAQ,GAAG0B,SAAS,CAACroB,GAAG;IAE5B0mB,UAAU,CAAChe,QAAQ,CAAC,IAAI,CAAC;IACzBie,QAAQ,CAACje,QAAQ,CAAC,KAAK,CAAC;IAExB,IAAI4f,QAAQ,GAAG,IAAIvc,wDAAO,CAAC2a,UAAU,EAAErC,OAAO,CAAC,CAAC3nB,QAAQ,CAAC,CAAC;IAC1D,IAAI6rB,MAAM,GAAG,IAAIxc,wDAAO,CAAC4a,QAAQ,EAAEtC,OAAO,CAAC,CAAC3nB,QAAQ,CAAC,CAAC;IAEtD,OAAO;MACNqD,KAAK,EAAEuoB,QAAQ;MACftoB,GAAG,EAAEuoB;IACN,CAAC;EAEF;EAEAjC,kBAAkBA,CAACjC,OAAO,EAAEiD,OAAO,EAAC;IACnC,IAAIxZ,GAAG,GAAG,EAAE;IACZ,IAAI0a,OAAO;IAEX,KAAK,IAAIlqB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGgpB,OAAO,CAAClpB,MAAM,EAAEE,CAAC,EAAE,EAAE;MACxCkqB,OAAO,GAAG,IAAI,CAACjC,kBAAkB,CAAClC,OAAO,EAAEiD,OAAO,CAAChpB,CAAC,CAAC,CAAC;MAEtDwP,GAAG,CAACxG,IAAI,CAACkhB,OAAO,CAAC;IAElB;IAEA,OAAO1a,GAAG;EACX;;EAEA;AACD;AACA;AACA;AACA;EACC0M,IAAIA,CAACA,IAAI,EAAE;IACV,IAAIA,IAAI,EAAE;MACT,IAAI,CAAC2L,UAAU,GAAI3L,IAAI,KAAK,YAAY,GAAI,IAAI,GAAG,KAAK;IACzD;IACA,OAAO,IAAI,CAAC2L,UAAU;EACvB;AACD;AAEeX,gEAAO,E;;;;;;AC/ftB,eAAe,mBAAO,CAAC,EAAY;AACnC,UAAU,mBAAO,CAAC,EAAO;AACzB,eAAe,mBAAO,CAAC,EAAY;;AAEnC;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB,WAAW,OAAO;AAClB,WAAW,OAAO,YAAY;AAC9B,WAAW,QAAQ;AACnB;AACA,WAAW,OAAO;AAClB;AACA,WAAW,QAAQ;AACnB;AACA,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,8CAA8C,kBAAkB;AAChE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAC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Aa,uFAAuF,EAAE,uFAAuF;;AAE9O,0CAA0C,+DAA+D,qGAAqG,EAAE,yEAAyE,eAAe,yEAAyE,EAAE,EAAE,uHAAuH;;AAE5e,iDAAiD,0CAA0C,0DAA0D,EAAE;;AAEvJ;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,0EAA0E,gEAAgE;AAC1I;;AAEA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA,+BAA+B,kBAAkB;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,KAAK;;AAEL;AACA,CAAC;;AAED;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,kDAAkD,SAAS;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;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T,KAAK,CAACA,OAAO,CAAC,CAAC;IAEf,IAAI,IAAI,CAAC6qB,OAAO,EAAE;MACjB,IAAI,CAACA,OAAO,CAAC7qB,OAAO,CAAC,CAAC;IACvB;EACD;AAED;AAEe6R,0GAAqB,E;;;;;;ACnlBpC;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,GAAG,IAAsD,EAAE,mBAAmB,KAAK,UAAoO,CAAC,aAAa,0BAA0B,0BAA0B,gBAAgB,UAAU,UAAU,0CAA0C,gBAAgB,OAAC,OAAO,oBAAoB,8CAA8C,qCAAqC,YAAY,YAAY,mCAAmC,iBAAiB,gBAAgB,sBAAsB,oBAAoB,0CAA0C,YAAY,WAAW,YAAY,SAAS,GAAG;AAClzB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA,mCAAmC;AACnC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC,qIAAqI;AACtI,CAAC,GAAG;AACJ;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA,CAAC,EAAE,MAAM;AACT;AACA;AACA;AACA;AACA;;AAEA,CAAC,qIAAqI;AACtI,CAAC,EAAE,MAAM;AACT;;AAEA,oGAAoG,mBAAmB,EAAE,mBAAmB,8HAA8H;;AAE1Q,iDAAiD,0CAA0C,0DAA0D,EAAE;;AAEvJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;;AAEA;AACA;AACA,gCAAgC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,uBAAuB,kBAAkB;AACzC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,qBAAqB;AACrB,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,oCAAoC,yBAAyB;AAC7D;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,8BAA8B;AACjD;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,uBAAuB,oBAAoB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA,yBAAyB;AACzB;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,2BAA2B,oBAAoB;AAC/C;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;;AAEA;AACA,+BAA+B,oBAAoB;AACnD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA,mCAAmC,oBAAoB;AACvD;AACA;AACA;AACA,iBAAiB;AACjB,mGAAmG;AACnG;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA,+BAA+B,oBAAoB;AACnD;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;;AAEjB;AACA;AACA,mCAAmC,oBAAoB;AACvD;AACA;AACA;AACA;AACA,iBAAiB;AACjB,mGAAmG;AACnG;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,eAAe,SAAS;AACxB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,eAAe,kBAAkB;AACjC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;;AAEA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyC,iBAAiB;AAC1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,mCAAmC,YAAY;AAC/C;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,yBAAyB;AACzB;AACA,yBAAyB;AACzB,qBAAqB;AACrB,kDAAkD;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA,yCAAyC;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,mCAAmC,yBAAyB;AAC5D;AACA;;AAEA;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,+BAA+B,yBAAyB;AACxD;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,aAAa;AACb,SAAS;AACT;AACA,SAAS;AACT,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA,iBAAiB;AACjB;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,6BAA6B;AAC7B,yBAAyB;AACzB;;AAEA;AACA,0EAA0E,SAAS;AACnF;AACA;;AAEA;AACA;AACA,qBAAqB;AACrB;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA,iBAAiB;AACjB,aAAa;AACb,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,6CAA6C,QAAQ;AACrD;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,YAAY;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,YAAY;AACnC;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT,iDAAiD,QAAQ;AACzD;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA,mBAAmB,sBAAsB;AACzC;;AAEA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,uCAAuC;AACvC,gCAAgC;AAChC;AACA;AACA;AACA;;AAEA;AACA,mEAAmE;AACnE;;AAEA,6CAA6C;AAC7C;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA,6EAA6E;;AAE7E;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2DAA2D,SAAS;AACpE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,yEAAyE,WAAW;AACpF;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,iBAAiB;AACjB;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,6CAA6C,SAAS;AACtD;AACA;AACA;AACA;AACA;AACA;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b;AACA;;;;;;;;ACHa;;AAEb,cAAc,mBAAO,CAAC,EAAY;;AAElC;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb,cAAc,mBAAO,CAAC,EAAY;;AAElC;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;;;;;;;ACnBa;;AAEb,iBAAiB,mBAAO,CAAC,EAAkB,kCAAkC,mBAAO,CAAC,EAAQ;;;;;;;;ACFhF;;AAEb;;AAEA;AACA;AACA;AACA;;;;;;;;ACPa;;AAEb;;AAEA;AACA;AACA;;;;;;;;ACNa;;AAEb;AACA;AACA;AACA;;;;;;;;ACLa;;AAEb;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;;ACZa;;AAEb;AACA;AACA,CAAC;AACD;AACA;AACA,8BAA8B;;AAE9B;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,KAAK;AACvB,mBAAmB,OAAO;AAC1B;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC,QAAQ;AAChD;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA,oBAAoB,kBAAkB;AACtC;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA,aAAa,WAAW;AACxB,aAAa;AACb;AACA;AACA,+BAA+B,MAAM,iBAAiB;AACtD;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA,aAAa;AACb,aAAa;AACb,aAAa;AACb;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,uCAAuC,SAAS;AAChD;AACA;AACA;AACA;AACA;AACA;;;;;;;AC/HA,WAAW,mBAAO,CAAC,EAAS;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;;AAEA;;;;;;;ACtBA;AACA;;AAEA;;;;;;;;ACHA,eAAe,mBAAO,CAAC,EAAa;AACpC,eAAe,mBAAO,CAAC,EAAY;AACnC,eAAe,mBAAO,CAAC,EAAY;;AAEnC;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC/DA,sBAAsB,mBAAO,CAAC,EAAoB;;AAElD;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AClBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa,OAAO;AACpB;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;;;;;;AClBA,iBAAiB,mBAAO,CAAC,EAAe;AACxC,mBAAmB,mBAAO,CAAC,EAAgB;;AAE3C;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC5BA,aAAa,mBAAO,CAAC,EAAW;AAChC,gBAAgB,mBAAO,CAAC,EAAc;AACtC,qBAAqB,mBAAO,CAAC,EAAmB;;AAEhD;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC3BA,aAAa,mBAAO,CAAC,EAAW;;AAEhC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;;;;;;AC7CA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,OAAO;AACpB;AACA;AACA;AACA;;AAEA;;;;;;;ACrBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,EAAE;AACb,aAAa,QAAQ;AACrB;AACA;AACA,oBAAoB;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"epub.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"xmldom\"), require(\"JSZip\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"xmldom\", \"JSZip\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ePub\"] = factory(require(\"xmldom\"), require(\"JSZip\"));\n\telse\n\t\troot[\"ePub\"] = factory(root[\"xmldom\"], root[\"JSZip\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__16__, __WEBPACK_EXTERNAL_MODULE__28__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n","/**\r\n * Core Utilities and Helpers\r\n * @module Core\r\n*/\r\nimport { DOMParser as XMLDOMParser } from \"xmldom\";\r\n\r\n/**\r\n * Vendor prefixed requestAnimationFrame\r\n * @returns {function} requestAnimationFrame\r\n * @memberof Core\r\n */\r\nexport const requestAnimationFrame = (typeof window != \"undefined\") ? (window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame) : false;\r\nconst ELEMENT_NODE = 1;\r\nconst TEXT_NODE = 3;\r\nconst COMMENT_NODE = 8;\r\nconst DOCUMENT_NODE = 9;\r\nconst _URL = typeof URL != \"undefined\" ? URL : (typeof window != \"undefined\" ? (window.URL || window.webkitURL || window.mozURL) : undefined);\r\n\r\n/**\r\n * Generates a UUID\r\n * based on: http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\r\n * @returns {string} uuid\r\n * @memberof Core\r\n */\r\nexport function uuid() {\r\n\tvar d = new Date().getTime();\r\n\tvar uuid = \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function(c) {\r\n\t\tvar r = (d + Math.random()*16)%16 | 0;\r\n\t\td = Math.floor(d/16);\r\n\t\treturn (c==\"x\" ? r : (r&0x7|0x8)).toString(16);\r\n\t});\r\n\treturn uuid;\r\n}\r\n\r\n/**\r\n * Gets the height of a document\r\n * @returns {number} height\r\n * @memberof Core\r\n */\r\nexport function documentHeight() {\r\n\treturn Math.max(\r\n\t\t\tdocument.documentElement.clientHeight,\r\n\t\t\tdocument.body.scrollHeight,\r\n\t\t\tdocument.documentElement.scrollHeight,\r\n\t\t\tdocument.body.offsetHeight,\r\n\t\t\tdocument.documentElement.offsetHeight\r\n\t);\r\n}\r\n\r\n/**\r\n * Checks if a node is an element\r\n * @param {object} obj\r\n * @returns {boolean}\r\n * @memberof Core\r\n */\r\nexport function isElement(obj) {\r\n\treturn !!(obj && obj.nodeType == 1);\r\n}\r\n\r\n/**\r\n * @param {any} n\r\n * @returns {boolean}\r\n * @memberof Core\r\n */\r\nexport function isNumber(n) {\r\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\r\n}\r\n\r\n/**\r\n * @param {any} n\r\n * @returns {boolean}\r\n * @memberof Core\r\n */\r\nexport function isFloat(n) {\r\n\tlet f = parseFloat(n);\r\n\r\n\tif (isNumber(n) === false) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tif (typeof n === \"string\" && n.indexOf(\".\") > -1) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn Math.floor(f) !== f;\r\n}\r\n\r\n/**\r\n * Get a prefixed css property\r\n * @param {string} unprefixed\r\n * @returns {string}\r\n * @memberof Core\r\n */\r\nexport function prefixed(unprefixed) {\r\n\tvar vendors = [\"Webkit\", \"webkit\", \"Moz\", \"O\", \"ms\" ];\r\n\tvar prefixes = [\"-webkit-\", \"-webkit-\", \"-moz-\", \"-o-\", \"-ms-\"];\r\n\tvar lower = unprefixed.toLowerCase();\r\n\tvar length = vendors.length;\r\n\r\n\tif (typeof(document) === \"undefined\" || typeof(document.body.style[lower]) != \"undefined\") {\r\n\t\treturn unprefixed;\r\n\t}\r\n\r\n\tfor (var i = 0; i < length; i++) {\r\n\t\tif (typeof(document.body.style[prefixes[i] + lower]) != \"undefined\") {\r\n\t\t\treturn prefixes[i] + lower;\r\n\t\t}\r\n\t}\r\n\r\n\treturn unprefixed;\r\n}\r\n\r\n/**\r\n * Apply defaults to an object\r\n * @param {object} obj\r\n * @returns {object}\r\n * @memberof Core\r\n */\r\nexport function defaults(obj) {\r\n\tfor (var i = 1, length = arguments.length; i < length; i++) {\r\n\t\tvar source = arguments[i];\r\n\t\tfor (var prop in source) {\r\n\t\t\tif (obj[prop] === void 0) obj[prop] = source[prop];\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n}\r\n\r\n/**\r\n * Extend properties of an object\r\n * @param {object} target\r\n * @returns {object}\r\n * @memberof Core\r\n */\r\nexport function extend(target) {\r\n\tvar sources = [].slice.call(arguments, 1);\r\n\tsources.forEach(function (source) {\r\n\t\tif(!source) return;\r\n\t\tObject.getOwnPropertyNames(source).forEach(function(propName) {\r\n\t\t\tObject.defineProperty(target, propName, Object.getOwnPropertyDescriptor(source, propName));\r\n\t\t});\r\n\t});\r\n\treturn target;\r\n}\r\n\r\n/**\r\n * Fast quicksort insert for sorted array -- based on:\r\n *  http://stackoverflow.com/questions/1344500/efficient-way-to-insert-a-number-into-a-sorted-array-of-numbers\r\n * @param {any} item\r\n * @param {array} array\r\n * @param {function} [compareFunction]\r\n * @returns {number} location (in array)\r\n * @memberof Core\r\n */\r\nexport function insert(item, array, compareFunction) {\r\n\tvar location = locationOf(item, array, compareFunction);\r\n\tarray.splice(location, 0, item);\r\n\r\n\treturn location;\r\n}\r\n\r\n/**\r\n * Finds where something would fit into a sorted array\r\n * @param {any} item\r\n * @param {array} array\r\n * @param {function} [compareFunction]\r\n * @param {function} [_start]\r\n * @param {function} [_end]\r\n * @returns {number} location (in array)\r\n * @memberof Core\r\n */\r\nexport function locationOf(item, array, compareFunction, _start, _end) {\r\n\tvar start = _start || 0;\r\n\tvar end = _end || array.length;\r\n\tvar pivot = parseInt(start + (end - start) / 2);\r\n\tvar compared;\r\n\tif(!compareFunction){\r\n\t\tcompareFunction = function(a, b) {\r\n\t\t\tif(a > b) return 1;\r\n\t\t\tif(a < b) return -1;\r\n\t\t\tif(a == b) return 0;\r\n\t\t};\r\n\t}\r\n\tif(end-start <= 0) {\r\n\t\treturn pivot;\r\n\t}\r\n\r\n\tcompared = compareFunction(array[pivot], item);\r\n\tif(end-start === 1) {\r\n\t\treturn compared >= 0 ? pivot : pivot + 1;\r\n\t}\r\n\tif(compared === 0) {\r\n\t\treturn pivot;\r\n\t}\r\n\tif(compared === -1) {\r\n\t\treturn locationOf(item, array, compareFunction, pivot, end);\r\n\t} else{\r\n\t\treturn locationOf(item, array, compareFunction, start, pivot);\r\n\t}\r\n}\r\n\r\n/**\r\n * Finds index of something in a sorted array\r\n * Returns -1 if not found\r\n * @param {any} item\r\n * @param {array} array\r\n * @param {function} [compareFunction]\r\n * @param {function} [_start]\r\n * @param {function} [_end]\r\n * @returns {number} index (in array) or -1\r\n * @memberof Core\r\n */\r\nexport function indexOfSorted(item, array, compareFunction, _start, _end) {\r\n\tvar start = _start || 0;\r\n\tvar end = _end || array.length;\r\n\tvar pivot = parseInt(start + (end - start) / 2);\r\n\tvar compared;\r\n\tif(!compareFunction){\r\n\t\tcompareFunction = function(a, b) {\r\n\t\t\tif(a > b) return 1;\r\n\t\t\tif(a < b) return -1;\r\n\t\t\tif(a == b) return 0;\r\n\t\t};\r\n\t}\r\n\tif(end-start <= 0) {\r\n\t\treturn -1; // Not found\r\n\t}\r\n\r\n\tcompared = compareFunction(array[pivot], item);\r\n\tif(end-start === 1) {\r\n\t\treturn compared === 0 ? pivot : -1;\r\n\t}\r\n\tif(compared === 0) {\r\n\t\treturn pivot; // Found\r\n\t}\r\n\tif(compared === -1) {\r\n\t\treturn indexOfSorted(item, array, compareFunction, pivot, end);\r\n\t} else{\r\n\t\treturn indexOfSorted(item, array, compareFunction, start, pivot);\r\n\t}\r\n}\r\n/**\r\n * Find the bounds of an element\r\n * taking padding and margin into account\r\n * @param {element} el\r\n * @returns {{ width: Number, height: Number}}\r\n * @memberof Core\r\n */\r\nexport function bounds(el) {\r\n\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar widthProps = [\"width\", \"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\r\n\tvar heightProps = [\"height\", \"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\r\n\r\n\tvar width = 0;\r\n\tvar height = 0;\r\n\r\n\twidthProps.forEach(function(prop){\r\n\t\twidth += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\theightProps.forEach(function(prop){\r\n\t\theight += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\treturn {\r\n\t\theight: height,\r\n\t\twidth: width\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Find the bounds of an element\r\n * taking padding, margin and borders into account\r\n * @param {element} el\r\n * @returns {{ width: Number, height: Number}}\r\n * @memberof Core\r\n */\r\nexport function borders(el) {\r\n\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar widthProps = [\"paddingRight\", \"paddingLeft\", \"marginRight\", \"marginLeft\", \"borderRightWidth\", \"borderLeftWidth\"];\r\n\tvar heightProps = [\"paddingTop\", \"paddingBottom\", \"marginTop\", \"marginBottom\", \"borderTopWidth\", \"borderBottomWidth\"];\r\n\r\n\tvar width = 0;\r\n\tvar height = 0;\r\n\r\n\twidthProps.forEach(function(prop){\r\n\t\twidth += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\theightProps.forEach(function(prop){\r\n\t\theight += parseFloat(style[prop]) || 0;\r\n\t});\r\n\r\n\treturn {\r\n\t\theight: height,\r\n\t\twidth: width\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Find the bounds of any node\r\n * allows for getting bounds of text nodes by wrapping them in a range\r\n * @param {node} node\r\n * @returns {BoundingClientRect}\r\n * @memberof Core\r\n */\r\nexport function nodeBounds(node) {\r\n\tlet elPos;\r\n\tlet doc = node.ownerDocument;\r\n\tif(node.nodeType == Node.TEXT_NODE){\r\n\t\tlet elRange = doc.createRange();\r\n\t\telRange.selectNodeContents(node);\r\n\t\telPos = elRange.getBoundingClientRect();\r\n\t} else {\r\n\t\telPos = node.getBoundingClientRect();\r\n\t}\r\n\treturn elPos;\r\n}\r\n\r\n/**\r\n * Find the equivelent of getBoundingClientRect of a browser window\r\n * @returns {{ width: Number, height: Number, top: Number, left: Number, right: Number, bottom: Number }}\r\n * @memberof Core\r\n */\r\nexport function windowBounds() {\r\n\r\n\tvar width =document.documentElement.clientWidth;\r\n\tvar height = document.documentElement.clientHeight;\r\n\r\n\treturn {\r\n\t\ttop: 0,\r\n\t\tleft: 0,\r\n\t\tright: width,\r\n\t\tbottom: height,\r\n\t\twidth: width,\r\n\t\theight: height\r\n\t};\r\n\r\n}\r\n\r\n/**\r\n * Gets the index of a node in its parent\r\n * @param {Node} node\r\n * @param {string} typeId\r\n * @return {number} index\r\n * @memberof Core\r\n */\r\nexport function indexOfNode(node, typeId) {\r\n\tvar parent = node.parentNode;\r\n\tvar children = parent.childNodes;\r\n\tvar sib;\r\n\tvar index = -1;\r\n\tfor (var i = 0; i < children.length; i++) {\r\n\t\tsib = children[i];\r\n\t\tif (sib.nodeType === typeId) {\r\n\t\t\tindex++;\r\n\t\t}\r\n\t\tif (sib == node) break;\r\n\t}\r\n\r\n\treturn index;\r\n}\r\n\r\n/**\r\n * Gets the index of a text node in its parent\r\n * @param {node} textNode\r\n * @returns {number} index\r\n * @memberof Core\r\n */\r\nexport function indexOfTextNode(textNode) {\r\n\treturn indexOfNode(textNode, TEXT_NODE);\r\n}\r\n\r\n/**\r\n * Gets the index of an element node in its parent\r\n * @param {element} elementNode\r\n * @returns {number} index\r\n * @memberof Core\r\n */\r\nexport function indexOfElementNode(elementNode) {\r\n\treturn indexOfNode(elementNode, ELEMENT_NODE);\r\n}\r\n\r\n/**\r\n * Check if extension is xml\r\n * @param {string} ext\r\n * @returns {boolean}\r\n * @memberof Core\r\n */\r\nexport function isXml(ext) {\r\n\treturn [\"xml\", \"opf\", \"ncx\"].indexOf(ext) > -1;\r\n}\r\n\r\n/**\r\n * Create a new blob\r\n * @param {any} content\r\n * @param {string} mime\r\n * @returns {Blob}\r\n * @memberof Core\r\n */\r\nexport function createBlob(content, mime){\r\n\treturn new Blob([content], {type : mime });\r\n}\r\n\r\n/**\r\n * Create a new blob url\r\n * @param {any} content\r\n * @param {string} mime\r\n * @returns {string} url\r\n * @memberof Core\r\n */\r\nexport function createBlobUrl(content, mime){\r\n\tvar tempUrl;\r\n\tvar blob = createBlob(content, mime);\r\n\r\n\ttempUrl = _URL.createObjectURL(blob);\r\n\r\n\treturn tempUrl;\r\n}\r\n\r\n/**\r\n * Remove a blob url\r\n * @param {string} url\r\n * @memberof Core\r\n */\r\nexport function revokeBlobUrl(url){\r\n\treturn _URL.revokeObjectURL(url);\r\n}\r\n\r\n/**\r\n * Create a new base64 encoded url\r\n * @param {any} content\r\n * @param {string} mime\r\n * @returns {string} url\r\n * @memberof Core\r\n */\r\nexport function createBase64Url(content, mime){\r\n\tvar data;\r\n\tvar datauri;\r\n\r\n\tif (typeof(content) !== \"string\") {\r\n\t\t// Only handles strings\r\n\t\treturn;\r\n\t}\r\n\r\n\tdata = btoa(encodeURIComponent(content));\r\n\r\n\tdatauri = \"data:\" + mime + \";base64,\" + data;\r\n\r\n\treturn datauri;\r\n}\r\n\r\n/**\r\n * Get type of an object\r\n * @param {object} obj\r\n * @returns {string} type\r\n * @memberof Core\r\n */\r\nexport function type(obj){\r\n\treturn Object.prototype.toString.call(obj).slice(8, -1);\r\n}\r\n\r\n/**\r\n * Parse xml (or html) markup\r\n * @param {string} markup\r\n * @param {string} mime\r\n * @param {boolean} forceXMLDom force using xmlDom to parse instead of native parser\r\n * @returns {document} document\r\n * @memberof Core\r\n */\r\nexport function parse(markup, mime, forceXMLDom) {\r\n\tvar doc;\r\n\tvar Parser;\r\n\r\n\tif (typeof DOMParser === \"undefined\" || forceXMLDom) {\r\n\t\tParser = XMLDOMParser;\r\n\t} else {\r\n\t\tParser = DOMParser;\r\n\t}\r\n\r\n\t// Remove byte order mark before parsing\r\n\t// https://www.w3.org/International/questions/qa-byte-order-mark\r\n\tif(markup.charCodeAt(0) === 0xFEFF) {\r\n\t\tmarkup = markup.slice(1);\r\n\t}\r\n\r\n\tdoc = new Parser().parseFromString(markup, mime);\r\n\r\n\treturn doc;\r\n}\r\n\r\n/**\r\n * querySelector polyfill\r\n * @param {element} el\r\n * @param {string} sel selector string\r\n * @returns {element} element\r\n * @memberof Core\r\n */\r\nexport function qs(el, sel) {\r\n\tvar elements;\r\n\tif (!el) {\r\n\t\tthrow new Error(\"No Element Provided\");\r\n\t}\r\n\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\treturn el.querySelector(sel);\r\n\t} else {\r\n\t\telements = el.getElementsByTagName(sel);\r\n\t\tif (elements.length) {\r\n\t\t\treturn elements[0];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * querySelectorAll polyfill\r\n * @param {element} el\r\n * @param {string} sel selector string\r\n * @returns {element[]} elements\r\n * @memberof Core\r\n */\r\nexport function qsa(el, sel) {\r\n\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\treturn el.querySelectorAll(sel);\r\n\t} else {\r\n\t\treturn el.getElementsByTagName(sel);\r\n\t}\r\n}\r\n\r\n/**\r\n * querySelector by property\r\n * @param {element} el\r\n * @param {string} sel selector string\r\n * @param {object[]} props\r\n * @returns {element[]} elements\r\n * @memberof Core\r\n */\r\nexport function qsp(el, sel, props) {\r\n\tvar q, filtered;\r\n\tif (typeof el.querySelector != \"undefined\") {\r\n\t\tsel += \"[\";\r\n\t\tfor (var prop in props) {\r\n\t\t\tsel += prop + \"~='\" + props[prop] + \"'\";\r\n\t\t}\r\n\t\tsel += \"]\";\r\n\t\treturn el.querySelector(sel);\r\n\t} else {\r\n\t\tq = el.getElementsByTagName(sel);\r\n\t\tfiltered = Array.prototype.slice.call(q, 0).filter(function(el) {\r\n\t\t\tfor (var prop in props) {\r\n\t\t\t\tif(el.getAttribute(prop) === props[prop]){\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t});\r\n\r\n\t\tif (filtered) {\r\n\t\t\treturn filtered[0];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Sprint through all text nodes in a document\r\n * @memberof Core\r\n * @param  {element} root element to start with\r\n * @param  {function} func function to run on each element\r\n */\r\nexport function sprint(root, func) {\r\n\tvar doc = root.ownerDocument || root;\r\n\tif (typeof(doc.createTreeWalker) !== \"undefined\") {\r\n\t\ttreeWalker(root, func, NodeFilter.SHOW_TEXT);\r\n\t} else {\r\n\t\twalk(root, function(node) {\r\n\t\t\tif (node && node.nodeType === 3) { // Node.TEXT_NODE\r\n\t\t\t\tfunc(node);\r\n\t\t\t}\r\n\t\t}, true);\r\n\t}\r\n}\r\n\r\n/**\r\n * Create a treeWalker\r\n * @memberof Core\r\n * @param  {element} root element to start with\r\n * @param  {function} func function to run on each element\r\n * @param  {function | object} filter funtion or object to filter with\r\n */\r\nexport function treeWalker(root, func, filter) {\r\n\tvar treeWalker = document.createTreeWalker(root, filter, null, false);\r\n\tlet node;\r\n\twhile ((node = treeWalker.nextNode())) {\r\n\t\tfunc(node);\r\n\t}\r\n}\r\n\r\n/**\r\n * @memberof Core\r\n * @param {node} node\r\n * @param {callback} return false for continue,true for break inside callback\r\n */\r\nexport function walk(node,callback){\r\n\tif(callback(node)){\r\n\t\treturn true;\r\n\t}\r\n\tnode = node.firstChild;\r\n\tif(node){\r\n\t\tdo{\r\n\t\t\tlet walked = walk(node,callback);\r\n\t\t\tif(walked){\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tnode = node.nextSibling;\r\n\t\t} while(node);\r\n\t}\r\n}\r\n\r\n/**\r\n * Convert a blob to a base64 encoded string\r\n * @param {Blog} blob\r\n * @returns {string}\r\n * @memberof Core\r\n */\r\nexport function blob2base64(blob) {\r\n\treturn new Promise(function(resolve, reject) {\r\n\t\tvar reader = new FileReader();\r\n\t\treader.readAsDataURL(blob);\r\n\t\treader.onloadend = function() {\r\n\t\t\tresolve(reader.result);\r\n\t\t};\r\n\t});\r\n}\r\n\r\n\r\n/**\r\n * Creates a new pending promise and provides methods to resolve or reject it.\r\n * From: https://developer.mozilla.org/en-US/docs/Mozilla/JavaScript_code_modules/Promise.jsm/Deferred#backwards_forwards_compatible\r\n * @memberof Core\r\n */\r\nexport function defer() {\r\n\t/* A method to resolve the associated Promise with the value passed.\r\n\t * If the promise is already settled it does nothing.\r\n\t *\r\n\t * @param {anything} value : This value is used to resolve the promise\r\n\t * If the value is a Promise then the associated promise assumes the state\r\n\t * of Promise passed as value.\r\n\t */\r\n\tthis.resolve = null;\r\n\r\n\t/* A method to reject the assocaited Promise with the value passed.\r\n\t * If the promise is already settled it does nothing.\r\n\t *\r\n\t * @param {anything} reason: The reason for the rejection of the Promise.\r\n\t * Generally its an Error object. If however a Promise is passed, then the Promise\r\n\t * itself will be the reason for rejection no matter the state of the Promise.\r\n\t */\r\n\tthis.reject = null;\r\n\r\n\tthis.id = uuid();\r\n\r\n\t/* A newly created Pomise object.\r\n\t * Initially in pending state.\r\n\t */\r\n\tthis.promise = new Promise((resolve, reject) => {\r\n\t\tthis.resolve = resolve;\r\n\t\tthis.reject = reject;\r\n\t});\r\n\tObject.freeze(this);\r\n}\r\n\r\n/**\r\n * querySelector with filter by epub type\r\n * @param {element} html\r\n * @param {string} element element type to find\r\n * @param {string} type epub type to find\r\n * @returns {element[]} elements\r\n * @memberof Core\r\n */\r\nexport function querySelectorByType(html, element, type){\r\n\tvar query;\r\n\tif (typeof html.querySelector != \"undefined\") {\r\n\t\tquery = html.querySelector(`${element}[*|type=\"${type}\"]`);\r\n\t}\r\n\t// Handle IE not supporting namespaced epub:type in querySelector\r\n\tif(!query || query.length === 0) {\r\n\t\tquery = qsa(html, element);\r\n\t\tfor (var i = 0; i < query.length; i++) {\r\n\t\t\tif(query[i].getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") === type ||\r\n\t\t\t\t query[i].getAttribute(\"epub:type\") === type) {\r\n\t\t\t\treturn query[i];\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\treturn query;\r\n\t}\r\n}\r\n\r\n/**\r\n * Find direct decendents of an element\r\n * @param {element} el\r\n * @returns {element[]} children\r\n * @memberof Core\r\n */\r\nexport function findChildren(el) {\r\n\tvar result = [];\r\n\tvar childNodes = el.childNodes;\r\n\tfor (var i = 0; i < childNodes.length; i++) {\r\n\t\tlet node = childNodes[i];\r\n\t\tif (node.nodeType === 1) {\r\n\t\t\tresult.push(node);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n/**\r\n * Find all parents (ancestors) of an element\r\n * @param {element} node\r\n * @returns {element[]} parents\r\n * @memberof Core\r\n */\r\nexport function parents(node) {\r\n\tvar nodes = [node];\r\n\tfor (; node; node = node.parentNode) {\r\n\t\tnodes.unshift(node);\r\n\t}\r\n\treturn nodes\r\n}\r\n\r\n/**\r\n * Find all direct decendents of a specific type\r\n * @param {element} el\r\n * @param {string} nodeName\r\n * @param {boolean} [single]\r\n * @returns {element[]} children\r\n * @memberof Core\r\n */\r\nexport function filterChildren(el, nodeName, single) {\r\n\tvar result = [];\r\n\tvar childNodes = el.childNodes;\r\n\tfor (var i = 0; i < childNodes.length; i++) {\r\n\t\tlet node = childNodes[i];\r\n\t\tif (node.nodeType === 1 && node.nodeName.toLowerCase() === nodeName) {\r\n\t\t\tif (single) {\r\n\t\t\t\treturn node;\r\n\t\t\t} else {\r\n\t\t\t\tresult.push(node);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (!single) {\r\n\t\treturn result;\r\n\t}\r\n}\r\n\r\n/**\r\n * Filter all parents (ancestors) with tag name\r\n * @param {element} node\r\n * @param {string} tagname\r\n * @returns {element[]} parents\r\n * @memberof Core\r\n */\r\nexport function getParentByTagName(node, tagname) {\r\n\tlet parent;\r\n\tif (node === null || tagname === '') return;\r\n\tparent = node.parentNode;\r\n\twhile (parent.nodeType === 1) {\r\n\t\tif (parent.tagName.toLowerCase() === tagname) {\r\n\t\t\treturn parent;\r\n\t\t}\r\n\t\tparent = parent.parentNode;\r\n\t}\r\n}\r\n\r\n/**\r\n * Lightweight Polyfill for DOM Range\r\n * @class\r\n * @memberof Core\r\n */\r\nexport class RangeObject {\r\n\tconstructor() {\r\n\t\tthis.collapsed = false;\r\n\t\tthis.commonAncestorContainer = undefined;\r\n\t\tthis.endContainer = undefined;\r\n\t\tthis.endOffset = undefined;\r\n\t\tthis.startContainer = undefined;\r\n\t\tthis.startOffset = undefined;\r\n\t}\r\n\r\n\tsetStart(startNode, startOffset) {\r\n\t\tthis.startContainer = startNode;\r\n\t\tthis.startOffset = startOffset;\r\n\r\n\t\tif (!this.endContainer) {\r\n\t\t\tthis.collapse(true);\r\n\t\t} else {\r\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\r\n\t\t}\r\n\r\n\t\tthis._checkCollapsed();\r\n\t}\r\n\r\n\tsetEnd(endNode, endOffset) {\r\n\t\tthis.endContainer = endNode;\r\n\t\tthis.endOffset = endOffset;\r\n\r\n\t\tif (!this.startContainer) {\r\n\t\t\tthis.collapse(false);\r\n\t\t} else {\r\n\t\t\tthis.collapsed = false;\r\n\t\t\tthis.commonAncestorContainer = this._commonAncestorContainer();\r\n\t\t}\r\n\r\n\t\tthis._checkCollapsed();\r\n\t}\r\n\r\n\tcollapse(toStart) {\r\n\t\tthis.collapsed = true;\r\n\t\tif (toStart) {\r\n\t\t\tthis.endContainer = this.startContainer;\r\n\t\t\tthis.endOffset = this.startOffset;\r\n\t\t\tthis.commonAncestorContainer = this.startContainer.parentNode;\r\n\t\t} else {\r\n\t\t\tthis.startContainer = this.endContainer;\r\n\t\t\tthis.startOffset = this.endOffset;\r\n\t\t\tthis.commonAncestorContainer = this.endOffset.parentNode;\r\n\t\t}\r\n\t}\r\n\r\n\tselectNode(referenceNode) {\r\n\t\tlet parent = referenceNode.parentNode;\r\n\t\tlet index = Array.prototype.indexOf.call(parent.childNodes, referenceNode);\r\n\t\tthis.setStart(parent, index);\r\n\t\tthis.setEnd(parent, index + 1);\r\n\t}\r\n\r\n\tselectNodeContents(referenceNode) {\r\n\t\tlet end = referenceNode.childNodes[referenceNode.childNodes - 1];\r\n\t\tlet endIndex = (referenceNode.nodeType === 3) ?\r\n\t\t\t\treferenceNode.textContent.length : parent.childNodes.length;\r\n\t\tthis.setStart(referenceNode, 0);\r\n\t\tthis.setEnd(referenceNode, endIndex);\r\n\t}\r\n\r\n\t_commonAncestorContainer(startContainer, endContainer) {\r\n\t\tvar startParents = parents(startContainer || this.startContainer);\r\n\t\tvar endParents = parents(endContainer || this.endContainer);\r\n\r\n\t\tif (startParents[0] != endParents[0]) return undefined;\r\n\r\n\t\tfor (var i = 0; i < startParents.length; i++) {\r\n\t\t\tif (startParents[i] != endParents[i]) {\r\n\t\t\t\treturn startParents[i - 1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t_checkCollapsed() {\r\n\t\tif (this.startContainer === this.endContainer &&\r\n\t\t\t\tthis.startOffset === this.endOffset) {\r\n\t\t\tthis.collapsed = true;\r\n\t\t} else {\r\n\t\t\tthis.collapsed = false;\r\n\t\t}\r\n\t}\r\n\r\n\ttoString() {\r\n\t\t// TODO: implement walking between start and end to find text\r\n\t}\r\n}\r\n","export const EPUBJS_VERSION = \"0.3\";\r\n\r\n// Dom events to listen for\r\nexport const DOM_EVENTS = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"mousemove\", \"click\", \"touchend\", \"touchstart\", \"touchmove\"];\r\n\r\nexport const EVENTS = {\r\n  BOOK: {\r\n    OPEN_FAILED: \"openFailed\"\r\n  },\r\n  CONTENTS: {\r\n    EXPAND: \"expand\",\r\n    RESIZE: \"resize\",\r\n    SELECTED: \"selected\",\r\n    SELECTED_RANGE: \"selectedRange\",\r\n    LINK_CLICKED: \"linkClicked\"\r\n  },\r\n  LOCATIONS: {\r\n    CHANGED: \"changed\"\r\n  },\r\n  MANAGERS: {\r\n    RESIZE: \"resize\",\r\n    RESIZED: \"resized\",\r\n    ORIENTATION_CHANGE: \"orientationchange\",\r\n    ADDED: \"added\",\r\n    SCROLL: \"scroll\",\r\n    SCROLLED: \"scrolled\",\r\n    REMOVED: \"removed\",\r\n  },\r\n  VIEWS: {\r\n    AXIS: \"axis\",\r\n    WRITING_MODE: \"writingMode\",\r\n    LOAD_ERROR: \"loaderror\",\r\n    RENDERED: \"rendered\",\r\n    RESIZED: \"resized\",\r\n    DISPLAYED: \"displayed\",\r\n    SHOWN: \"shown\",\r\n    HIDDEN: \"hidden\",\r\n    MARK_CLICKED: \"markClicked\",\r\n    MARK_IMAGE_CLICKED: \"markImageClicked\"\r\n  },\r\n  RENDITION: {\r\n    STARTED: \"started\",\r\n    ATTACHED: \"attached\",\r\n    DISPLAYED: \"displayed\",\r\n    DISPLAY_ERROR: \"displayerror\",\r\n    RENDERED: \"rendered\",\r\n    REMOVED: \"removed\",\r\n    RESIZED: \"resized\",\r\n    ORIENTATION_CHANGE: \"orientationchange\",\r\n    LOCATION_CHANGED: \"locationChanged\",\r\n    RELOCATED: \"relocated\",\r\n    MARK_CLICKED: \"markClicked\",\r\n    MARK_IMAGE_CLICKED: \"markImageClicked\",\r\n    SELECTED: \"selected\",\r\n    LAYOUT: \"layout\"\r\n  },\r\n  LAYOUT: {\r\n    UPDATED: \"updated\"\r\n  },\r\n  ANNOTATION: {\r\n    ATTACH: \"attach\",\r\n    DETACH: \"detach\"\r\n  }\r\n}\r\n","import {extend, type, findChildren, RangeObject, isNumber} from \"./utils/core\";\r\n\r\nconst ELEMENT_NODE = 1;\r\nconst TEXT_NODE = 3;\r\nconst COMMENT_NODE = 8;\r\nconst DOCUMENT_NODE = 9;\r\n\r\n/**\r\n\t* Parsing and creation of EpubCFIs: http://www.idpf.org/epub/linking/cfi/epub-cfi.html\r\n\r\n\t* Implements:\r\n\t* - Character Offset: epubcfi(/6/4[chap01ref]!/4[body01]/10[para05]/2/1:3)\r\n\t* - Simple Ranges : epubcfi(/6/4[chap01ref]!/4[body01]/10[para05],/2/1:1,/3:4)\r\n\r\n\t* Does Not Implement:\r\n\t* - Temporal Offset (~)\r\n\t* - Spatial Offset (@)\r\n\t* - Temporal-Spatial Offset (~ + @)\r\n\t* - Text Location Assertion ([)\r\n\t* @class\r\n\t@param {string | Range | Node } [cfiFrom]\r\n\t@param {string | object} [base]\r\n\t@param {string} [ignoreClass] class to ignore when parsing DOM\r\n*/\r\nclass EpubCFI {\r\n\tconstructor(cfiFrom, base, ignoreClass){\r\n\t\tvar type;\r\n\r\n\t\tthis.str = \"\";\r\n\r\n\t\tthis.base = {};\r\n\t\tthis.spinePos = 0; // For compatibility\r\n\r\n\t\tthis.range = false; // true || false;\r\n\r\n\t\tthis.path = {};\r\n\t\tthis.start = null;\r\n\t\tthis.end = null;\r\n\r\n\t\t// Allow instantiation without the \"new\" keyword\r\n\t\tif (!(this instanceof EpubCFI)) {\r\n\t\t\treturn new EpubCFI(cfiFrom, base, ignoreClass);\r\n\t\t}\r\n\r\n\t\tif(typeof base === \"string\") {\r\n\t\t\tthis.base = this.parseComponent(base);\r\n\t\t} else if(typeof base === \"object\" && base.steps) {\r\n\t\t\tthis.base = base;\r\n\t\t}\r\n\r\n\t\ttype = this.checkType(cfiFrom);\r\n\r\n\r\n\t\tif(type === \"string\") {\r\n\t\t\tthis.str = cfiFrom;\r\n\t\t\treturn extend(this, this.parse(cfiFrom));\r\n\t\t} else if (type === \"range\") {\r\n\t\t\treturn extend(this, this.fromRange(cfiFrom, this.base, ignoreClass));\r\n\t\t} else if (type === \"node\") {\r\n\t\t\treturn extend(this, this.fromNode(cfiFrom, this.base, ignoreClass));\r\n\t\t} else if (type === \"EpubCFI\" && cfiFrom.path) {\r\n\t\t\treturn cfiFrom;\r\n\t\t} else if (!cfiFrom) {\r\n\t\t\treturn this;\r\n\t\t} else {\r\n\t\t\tthrow new TypeError(\"not a valid argument for EpubCFI\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Check the type of constructor input\r\n\t * @private\r\n\t */\r\n\tcheckType(cfi) {\r\n\r\n\t\tif (this.isCfiString(cfi)) {\r\n\t\t\treturn \"string\";\r\n\t\t// Is a range object\r\n\t\t} else if (cfi && typeof cfi === \"object\" && (type(cfi) === \"Range\" || typeof(cfi.startContainer) != \"undefined\")){\r\n\t\t\treturn \"range\";\r\n\t\t} else if (cfi && typeof cfi === \"object\" && typeof(cfi.nodeType) != \"undefined\" ){ // || typeof cfi === \"function\"\t\t\t\r\n\t\t\treturn \"node\";\r\n\t\t} else if (cfi && typeof cfi === \"object\" && cfi instanceof EpubCFI){\r\n\t\t\treturn \"EpubCFI\";\r\n\t\t} else {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse a cfi string to a CFI object representation\r\n\t * @param {string} cfiStr\r\n\t * @returns {object} cfi\r\n\t */\r\n\tparse(cfiStr) {\r\n\t\tvar cfi = {\r\n\t\t\tspinePos: -1,\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\t\tvar baseComponent, pathComponent, range;\r\n\r\n\t\tif(typeof cfiStr !== \"string\") {\r\n\t\t\treturn {spinePos: -1};\r\n\t\t}\r\n\r\n\t\tif(cfiStr.indexOf(\"epubcfi(\") === 0 && cfiStr[cfiStr.length-1] === \")\") {\r\n\t\t\t// Remove intial epubcfi( and ending )\r\n\t\t\tcfiStr = cfiStr.slice(8, cfiStr.length-1);\r\n\t\t}\r\n\r\n\t\tbaseComponent = this.getChapterComponent(cfiStr);\r\n\r\n\t\t// Make sure this is a valid cfi or return\r\n\t\tif(!baseComponent) {\r\n\t\t\treturn {spinePos: -1};\r\n\t\t}\r\n\r\n\t\tcfi.base = this.parseComponent(baseComponent);\r\n\r\n\t\tpathComponent = this.getPathComponent(cfiStr);\r\n\t\tcfi.path = this.parseComponent(pathComponent);\r\n\t\r\n\t\trange = this.getRange(cfiStr);\r\n\r\n\t\tif(range) {\r\n\t\t\tcfi.range = true;\r\n\t\t\tcfi.start = this.parseComponent(range[0]);\r\n\t\t\tcfi.end = this.parseComponent(range[1]);\r\n\t\t}\r\n\r\n\t\t// Get spine node position\r\n\t\t// cfi.spineSegment = cfi.base.steps[1];\r\n\r\n\t\t// Chapter segment is always the second step\r\n\t\tcfi.spinePos = cfi.base.steps[1].index;\r\n\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\tparseComponent(componentStr){\r\n\t\tvar component = {\r\n\t\t\tsteps: [],\r\n\t\t\tterminal: {\r\n\t\t\t\toffset: null,\r\n\t\t\t\tassertion: null\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar parts = componentStr.split(\":\");\r\n\t\tvar steps = parts[0].split(\"/\");\r\n\t\tvar terminal;\r\n\r\n\t\tif(parts.length > 1) {\r\n\t\t\tterminal = parts[1];\r\n\t\t\tcomponent.terminal = this.parseTerminal(terminal);\r\n\t\t}\r\n\r\n\t\tif (steps[0] === \"\") {\r\n\t\t\tsteps.shift(); // Ignore the first slash\r\n\t\t}\r\n\r\n\t\tcomponent.steps = steps.map(function(step){\r\n\t\t\treturn this.parseStep(step);\r\n\t\t}.bind(this));\r\n\r\n\t\treturn component;\r\n\t}\r\n\r\n\tparseStep(stepStr){\r\n\t\tvar type, num, index, has_brackets, id;\r\n\r\n\t\thas_brackets = stepStr.match(/\\[(.*)\\]/);\r\n\t\tif(has_brackets && has_brackets[1]){\r\n\t\t\tid = has_brackets[1];\r\n\t\t}\r\n\r\n\t\t//-- Check if step is a text node or element\r\n\t\tnum = parseInt(stepStr);\r\n\r\n\t\tif(isNaN(num)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(num % 2 === 0) { // Even = is an element\r\n\t\t\ttype = \"element\";\r\n\t\t\tindex = num / 2 - 1;\r\n\t\t} else {\r\n\t\t\ttype = \"text\";\r\n\t\t\tindex = (num - 1 ) / 2;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"type\" : type,\r\n\t\t\t\"index\" : index,\r\n\t\t\t\"id\" : id || null\r\n\t\t};\r\n\t}\r\n\r\n\tparseTerminal(termialStr){\r\n\t\tvar characterOffset, textLocationAssertion;\r\n\t\tvar assertion = termialStr.match(/\\[(.*)\\]/);\r\n\r\n\t\tif(assertion && assertion[1]){\r\n\t\t\tcharacterOffset = parseInt(termialStr.split(\"[\")[0]);\r\n\t\t\ttextLocationAssertion = assertion[1];\r\n\t\t} else {\r\n\t\t\tcharacterOffset = parseInt(termialStr);\r\n\t\t}\r\n\r\n\t\tif (!isNumber(characterOffset)) {\r\n\t\t\tcharacterOffset = null;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"offset\": characterOffset,\r\n\t\t\t\"assertion\": textLocationAssertion\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tgetChapterComponent(cfiStr) {\r\n\r\n\t\tvar indirection = cfiStr.split(\"!\");\r\n\r\n\t\treturn indirection[0];\r\n\t}\r\n\r\n\tgetPathComponent(cfiStr) {\r\n\r\n\t\tvar indirection = cfiStr.split(\"!\");\r\n\r\n\t\tif(indirection[1]) {\r\n\t\t\tlet ranges = indirection[1].split(\",\");\r\n\t\t\treturn ranges[0];\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetRange(cfiStr) {\r\n\r\n\t\tvar ranges = cfiStr.split(\",\");\r\n\r\n\t\tif(ranges.length === 3){\r\n\t\t\treturn [\r\n\t\t\t\tranges[1],\r\n\t\t\t\tranges[2]\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgetCharecterOffsetComponent(cfiStr) {\r\n\t\tvar splitStr = cfiStr.split(\":\");\r\n\t\treturn splitStr[1] || \"\";\r\n\t}\r\n\r\n\tjoinSteps(steps) {\r\n\t\tif(!steps) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\treturn steps.map(function(part){\r\n\t\t\tvar segment = \"\";\r\n\r\n\t\t\tif(part.type === \"element\") {\r\n\t\t\t\tsegment += (part.index + 1) * 2;\r\n\t\t\t}\r\n\r\n\t\t\tif(part.type === \"text\") {\r\n\t\t\t\tsegment += 1 + (2 * part.index); // TODO: double check that this is odd\r\n\t\t\t}\r\n\r\n\t\t\tif(part.id) {\r\n\t\t\t\tsegment += \"[\" + part.id + \"]\";\r\n\t\t\t}\r\n\r\n\t\t\treturn segment;\r\n\r\n\t\t}).join(\"/\");\r\n\r\n\t}\r\n\r\n\tsegmentString(segment) {\r\n\t\tvar segmentString = \"/\";\r\n\r\n\t\tsegmentString += this.joinSteps(segment.steps);\r\n\r\n\t\tif(segment.terminal && segment.terminal.offset != null){\r\n\t\t\tsegmentString += \":\" + segment.terminal.offset;\r\n\t\t}\r\n\r\n\t\tif(segment.terminal && segment.terminal.assertion != null){\r\n\t\t\tsegmentString += \"[\" + segment.terminal.assertion + \"]\";\r\n\t\t}\r\n\r\n\t\treturn segmentString;\r\n\t}\r\n\r\n\t/**\r\n\t * Convert CFI to a epubcfi(...) string\r\n\t * @returns {string} epubcfi\r\n\t */\r\n\ttoString() {\r\n\t\tvar cfiString = \"epubcfi(\";\r\n\r\n\t\tcfiString += this.segmentString(this.base);\r\n\r\n\t\tcfiString += \"!\";\r\n\t\tcfiString += this.segmentString(this.path);\r\n\r\n\t\t// Add Range, if present\r\n\t\tif(this.range && this.start) {\r\n\t\t\tcfiString += \",\";\r\n\t\t\tcfiString += this.segmentString(this.start);\r\n\t\t}\r\n\r\n\t\tif(this.range && this.end) {\r\n\t\t\tcfiString += \",\";\r\n\t\t\tcfiString += this.segmentString(this.end);\r\n\t\t}\r\n\r\n\t\tcfiString += \")\";\r\n\r\n\t\treturn cfiString;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Compare which of two CFIs is earlier in the text\r\n\t * @returns {number} First is earlier = -1, Second is earlier = 1, They are equal = 0\r\n\t */\r\n\tcompare(cfiOne, cfiTwo) {\r\n\t\tvar stepsA, stepsB;\r\n\t\tvar terminalA, terminalB;\r\n\r\n\t\tvar rangeAStartSteps, rangeAEndSteps;\r\n\t\tvar rangeBEndSteps, rangeBEndSteps;\r\n\t\tvar rangeAStartTerminal, rangeAEndTerminal;\r\n\t\tvar rangeBStartTerminal, rangeBEndTerminal;\r\n\r\n\t\tif(typeof cfiOne === \"string\") {\r\n\t\t\tcfiOne = new EpubCFI(cfiOne);\r\n\t\t}\r\n\t\tif(typeof cfiTwo === \"string\") {\r\n\t\t\tcfiTwo = new EpubCFI(cfiTwo);\r\n\t\t}\r\n\t\t// Compare Spine Positions\r\n\t\tif(cfiOne.spinePos > cfiTwo.spinePos) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(cfiOne.spinePos < cfiTwo.spinePos) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tif (cfiOne.range) {\r\n\t\t\tstepsA = cfiOne.path.steps.concat(cfiOne.start.steps);\r\n\t\t\tterminalA = cfiOne.start.terminal;\r\n\t\t} else {\r\n\t\t\tstepsA = cfiOne.path.steps;\r\n\t\t\tterminalA = cfiOne.path.terminal;\r\n\t\t}\r\n\r\n\t\tif (cfiTwo.range) {\r\n\t\t\tstepsB = cfiTwo.path.steps.concat(cfiTwo.start.steps);\r\n\t\t\tterminalB = cfiTwo.start.terminal;\r\n\t\t} else {\r\n\t\t\tstepsB = cfiTwo.path.steps;\r\n\t\t\tterminalB = cfiTwo.path.terminal;\r\n\t\t}\r\n\r\n\t\t// Compare Each Step in the First item\r\n\t\tfor (var i = 0; i < stepsA.length; i++) {\r\n\t\t\tif(!stepsA[i]) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\tif(!stepsB[i]) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\tif(stepsA[i].index > stepsB[i].index) {\r\n\t\t\t\treturn 1;\r\n\t\t\t}\r\n\t\t\tif(stepsA[i].index < stepsB[i].index) {\r\n\t\t\t\treturn -1;\r\n\t\t\t}\r\n\t\t\t// Otherwise continue checking\r\n\t\t}\r\n\r\n\t\t// All steps in First equal to Second and First is Less Specific\r\n\t\tif(stepsA.length < stepsB.length) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t// Compare the charecter offset of the text node\r\n\t\tif(terminalA.offset > terminalB.offset) {\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t\tif(terminalA.offset < terminalB.offset) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t// CFI's are equal\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tstep(node) {\r\n\t\tvar nodeType = (node.nodeType === TEXT_NODE) ? \"text\" : \"element\";\r\n\r\n\t\treturn {\r\n\t\t\t\"id\" : node.id,\r\n\t\t\t\"tagName\" : node.tagName,\r\n\t\t\t\"type\" : nodeType,\r\n\t\t\t\"index\" : this.position(node)\r\n\t\t};\r\n\t}\r\n\r\n\tfilteredStep(node, ignoreClass) {\r\n\t\tvar filteredNode = this.filter(node, ignoreClass);\r\n\t\tvar nodeType;\r\n\r\n\t\t// Node filtered, so ignore\r\n\t\tif (!filteredNode) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Otherwise add the filter node in\r\n\t\tnodeType = (filteredNode.nodeType === TEXT_NODE) ? \"text\" : \"element\";\r\n\r\n\t\treturn {\r\n\t\t\t\"id\" : filteredNode.id,\r\n\t\t\t\"tagName\" : filteredNode.tagName,\r\n\t\t\t\"type\" : nodeType,\r\n\t\t\t\"index\" : this.filteredPosition(filteredNode, ignoreClass)\r\n\t\t};\r\n\t}\r\n\r\n\tpathTo(node, offset, ignoreClass) {\r\n\t\tvar segment = {\r\n\t\t\tsteps: [],\r\n\t\t\tterminal: {\r\n\t\t\t\toffset: null,\r\n\t\t\t\tassertion: null\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar currentNode = node;\r\n\t\tvar step;\r\n\r\n\t\twhile(currentNode && currentNode.parentNode &&\r\n\t\t\t\t\tcurrentNode.parentNode.nodeType != DOCUMENT_NODE) {\r\n\r\n\t\t\tif (ignoreClass) {\r\n\t\t\t\tstep = this.filteredStep(currentNode, ignoreClass);\r\n\t\t\t} else {\r\n\t\t\t\tstep = this.step(currentNode);\r\n\t\t\t}\r\n\r\n\t\t\tif (step) {\r\n\t\t\t\tsegment.steps.unshift(step);\r\n\t\t\t}\r\n\r\n\t\t\tcurrentNode = currentNode.parentNode;\r\n\r\n\t\t}\r\n\r\n\t\tif (offset != null && offset >= 0) {\r\n\r\n\t\t\tsegment.terminal.offset = offset;\r\n\r\n\t\t\t// Make sure we are getting to a textNode if there is an offset\r\n\t\t\tif(segment.steps[segment.steps.length-1].type != \"text\") {\r\n\t\t\t\tsegment.steps.push({\r\n\t\t\t\t\t\"type\" : \"text\",\r\n\t\t\t\t\t\"index\" : 0\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\treturn segment;\r\n\t}\r\n\r\n\tequalStep(stepA, stepB) {\r\n\t\tif (!stepA || !stepB) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tif(stepA.index === stepB.index &&\r\n\t\t\t stepA.id === stepB.id &&\r\n\t\t\t stepA.type === stepB.type) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a CFI object from a Range\r\n\t * @param {Range} range\r\n\t * @param {string | object} base\r\n\t * @param {string} [ignoreClass]\r\n\t * @returns {object} cfi\r\n\t */\r\n\tfromRange(range, base, ignoreClass) {\r\n\t\tvar cfi = {\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\r\n\t\tvar start = range.startContainer;\r\n\t\tvar end = range.endContainer;\r\n\r\n\t\tvar startOffset = range.startOffset;\r\n\t\tvar endOffset = range.endOffset;\r\n\r\n\t\tvar needsIgnoring = false;\r\n\r\n\t\tif (ignoreClass) {\r\n\t\t\t// Tell pathTo if / what to ignore\r\n\t\t\tneedsIgnoring = (start.ownerDocument.querySelector(\".\" + ignoreClass) != null);\r\n\t\t}\r\n\r\n\r\n\t\tif (typeof base === \"string\") {\r\n\t\t\tcfi.base = this.parseComponent(base);\r\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\r\n\t\t} else if (typeof base === \"object\") {\r\n\t\t\tcfi.base = base;\r\n\t\t}\r\n\r\n\t\tif (range.collapsed) {\r\n\t\t\tif (needsIgnoring) {\r\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\r\n\t\t\t}\r\n\t\t\tcfi.path = this.pathTo(start, startOffset, ignoreClass);\r\n\t\t} else {\r\n\t\t\tcfi.range = true;\r\n\r\n\t\t\tif (needsIgnoring) {\r\n\t\t\t\tstartOffset = this.patchOffset(start, startOffset, ignoreClass);\r\n\t\t\t}\r\n\r\n\t\t\tcfi.start = this.pathTo(start, startOffset, ignoreClass);\r\n\t\t\tif (needsIgnoring) {\r\n\t\t\t\tendOffset = this.patchOffset(end, endOffset, ignoreClass);\r\n\t\t\t}\r\n\r\n\t\t\tcfi.end = this.pathTo(end, endOffset, ignoreClass);\r\n\r\n\t\t\t// Create a new empty path\r\n\t\t\tcfi.path = {\r\n\t\t\t\tsteps: [],\r\n\t\t\t\tterminal: null\r\n\t\t\t};\r\n\r\n\t\t\t// Push steps that are shared between start and end to the common path\r\n\t\t\tvar len = cfi.start.steps.length;\r\n\t\t\tvar i;\r\n\r\n\t\t\tfor (i = 0; i < len; i++) {\r\n\t\t\t\tif (this.equalStep(cfi.start.steps[i], cfi.end.steps[i])) {\r\n\t\t\t\t\tif(i === len-1) {\r\n\t\t\t\t\t\t// Last step is equal, check terminals\r\n\t\t\t\t\t\tif(cfi.start.terminal === cfi.end.terminal) {\r\n\t\t\t\t\t\t\t// CFI's are equal\r\n\t\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\r\n\t\t\t\t\t\t\t// Not a range\r\n\t\t\t\t\t\t\tcfi.range = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcfi.path.steps.push(cfi.start.steps[i]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcfi.start.steps = cfi.start.steps.slice(cfi.path.steps.length);\r\n\t\t\tcfi.end.steps = cfi.end.steps.slice(cfi.path.steps.length);\r\n\r\n\t\t\t// TODO: Add Sanity check to make sure that the end if greater than the start\r\n\t\t}\r\n\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a CFI object from a Node\r\n\t * @param {Node} anchor\r\n\t * @param {string | object} base\r\n\t * @param {string} [ignoreClass]\r\n\t * @returns {object} cfi\r\n\t */\r\n\tfromNode(anchor, base, ignoreClass) {\r\n\t\tvar cfi = {\r\n\t\t\trange: false,\r\n\t\t\tbase: {},\r\n\t\t\tpath: {},\r\n\t\t\tstart: null,\r\n\t\t\tend: null\r\n\t\t};\r\n\r\n\t\tif (typeof base === \"string\") {\r\n\t\t\tcfi.base = this.parseComponent(base);\r\n\t\t\tcfi.spinePos = cfi.base.steps[1].index;\r\n\t\t} else if (typeof base === \"object\") {\r\n\t\t\tcfi.base = base;\r\n\t\t}\r\n\r\n\t\tcfi.path = this.pathTo(anchor, null, ignoreClass);\r\n\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\tfilter(anchor, ignoreClass) {\r\n\t\tvar needsIgnoring;\r\n\t\tvar sibling; // to join with\r\n\t\tvar parent, previousSibling, nextSibling;\r\n\t\tvar isText = false;\r\n\r\n\t\tif (anchor.nodeType === TEXT_NODE) {\r\n\t\t\tisText = true;\r\n\t\t\tparent = anchor.parentNode;\r\n\t\t\tneedsIgnoring = anchor.parentNode.classList.contains(ignoreClass);\r\n\t\t} else {\r\n\t\t\tisText = false;\r\n\t\t\tneedsIgnoring = anchor.classList.contains(ignoreClass);\r\n\t\t}\r\n\r\n\t\tif (needsIgnoring && isText) {\r\n\t\t\tpreviousSibling = parent.previousSibling;\r\n\t\t\tnextSibling = parent.nextSibling;\r\n\r\n\t\t\t// If the sibling is a text node, join the nodes\r\n\t\t\tif (previousSibling && previousSibling.nodeType === TEXT_NODE) {\r\n\t\t\t\tsibling = previousSibling;\r\n\t\t\t} else if (nextSibling && nextSibling.nodeType === TEXT_NODE) {\r\n\t\t\t\tsibling = nextSibling;\r\n\t\t\t}\r\n\r\n\t\t\tif (sibling) {\r\n\t\t\t\treturn sibling;\r\n\t\t\t} else {\r\n\t\t\t\t// Parent will be ignored on next step\r\n\t\t\t\treturn anchor;\r\n\t\t\t}\r\n\r\n\t\t} else if (needsIgnoring && !isText) {\r\n\t\t\t// Otherwise just skip the element node\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\t// No need to filter\r\n\t\t\treturn anchor;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpatchOffset(anchor, offset, ignoreClass) {\r\n\t\tif (anchor.nodeType != TEXT_NODE) {\r\n\t\t\tthrow new Error(\"Anchor must be a text node\");\r\n\t\t}\r\n\r\n\t\tvar curr = anchor;\r\n\t\tvar totalOffset = offset;\r\n\r\n\t\t// If the parent is a ignored node, get offset from it's start\r\n\t\tif (anchor.parentNode.classList.contains(ignoreClass)) {\r\n\t\t\tcurr = anchor.parentNode;\r\n\t\t}\r\n\r\n\t\twhile (curr.previousSibling) {\r\n\t\t\tif(curr.previousSibling.nodeType === ELEMENT_NODE) {\r\n\t\t\t\t// Originally a text node, so join\r\n\t\t\t\tif(curr.previousSibling.classList.contains(ignoreClass)){\r\n\t\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak; // Normal node, dont join\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// If the previous sibling is a text node, join the nodes\r\n\t\t\t\ttotalOffset += curr.previousSibling.textContent.length;\r\n\t\t\t}\r\n\r\n\t\t\tcurr = curr.previousSibling;\r\n\t\t}\r\n\r\n\t\treturn totalOffset;\r\n\r\n\t}\r\n\r\n\tnormalizedMap(children, nodeType, ignoreClass) {\r\n\t\tvar output = {};\r\n\t\tvar prevIndex = -1;\r\n\t\tvar i, len = children.length;\r\n\t\tvar currNodeType;\r\n\t\tvar prevNodeType;\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\r\n\t\t\tcurrNodeType = children[i].nodeType;\r\n\r\n\t\t\t// Check if needs ignoring\r\n\t\t\tif (currNodeType === ELEMENT_NODE &&\r\n\t\t\t\t\tchildren[i].classList.contains(ignoreClass)) {\r\n\t\t\t\tcurrNodeType = TEXT_NODE;\r\n\t\t\t}\r\n\r\n\t\t\tif (i > 0 &&\r\n\t\t\t\t\tcurrNodeType === TEXT_NODE &&\r\n\t\t\t\t\tprevNodeType === TEXT_NODE) {\r\n\t\t\t\t// join text nodes\r\n\t\t\t\toutput[i] = prevIndex;\r\n\t\t\t} else if (nodeType === currNodeType){\r\n\t\t\t\tprevIndex = prevIndex + 1;\r\n\t\t\t\toutput[i] = prevIndex;\r\n\t\t\t}\r\n\r\n\t\t\tprevNodeType = currNodeType;\r\n\r\n\t\t}\r\n\r\n\t\treturn output;\r\n\t}\r\n\r\n\tposition(anchor) {\r\n\t\tvar children, index;\r\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\r\n\t\t\tchildren = anchor.parentNode.children;\r\n\t\t\tif (!children) {\r\n\t\t\t\tchildren = findChildren(anchor.parentNode);\r\n\t\t\t}\r\n\t\t\tindex = Array.prototype.indexOf.call(children, anchor);\r\n\t\t} else {\r\n\t\t\tchildren = this.textNodes(anchor.parentNode);\r\n\t\t\tindex = children.indexOf(anchor);\r\n\t\t}\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\tfilteredPosition(anchor, ignoreClass) {\r\n\t\tvar children, index, map;\r\n\r\n\t\tif (anchor.nodeType === ELEMENT_NODE) {\r\n\t\t\tchildren = anchor.parentNode.children;\r\n\t\t\tmap = this.normalizedMap(children, ELEMENT_NODE, ignoreClass);\r\n\t\t} else {\r\n\t\t\tchildren = anchor.parentNode.childNodes;\r\n\t\t\t// Inside an ignored node\r\n\t\t\tif(anchor.parentNode.classList.contains(ignoreClass)) {\r\n\t\t\t\tanchor = anchor.parentNode;\r\n\t\t\t\tchildren = anchor.parentNode.childNodes;\r\n\t\t\t}\r\n\t\t\tmap = this.normalizedMap(children, TEXT_NODE, ignoreClass);\r\n\t\t}\r\n\r\n\r\n\t\tindex = Array.prototype.indexOf.call(children, anchor);\r\n\r\n\t\treturn map[index];\r\n\t}\r\n\r\n\tstepsToXpath(steps) {\r\n\t\t\r\n\t\tvar xpath = [\".\", \"*\"];\r\n\r\n\t\tsteps.forEach(function(step){\r\n\t\t\tvar position = step.index + 1;\r\n\r\n\t\t\tif(step.id){\r\n\t\t\t\txpath.push(\"*[position()=\" + position + \" and @id='\" + step.id + \"']\");\r\n\t\t\t} else if(step.type === \"text\") {\r\n\t\t\t\txpath.push(\"text()[\" + position + \"]\");\r\n\t\t\t} else {\r\n\t\t\t\txpath.push(\"*[\" + position + \"]\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn xpath.join(\"/\");\r\n\t}\r\n\r\n\r\n\t/*\r\n\r\n\tTo get the last step if needed:\r\n\r\n\t// Get the terminal step\r\n\tlastStep = steps[steps.length-1];\r\n\t// Get the query string\r\n\tquery = this.stepsToQuery(steps);\r\n\t// Find the containing element\r\n\tstartContainerParent = doc.querySelector(query);\r\n\t// Find the text node within that element\r\n\tif(startContainerParent && lastStep.type == \"text\") {\r\n\t\tcontainer = startContainerParent.childNodes[lastStep.index];\r\n\t}\r\n\t*/\r\n\tstepsToQuerySelector(steps) {\r\n\t\tvar query = [\"html\"];\r\n\r\n\t\tsteps.forEach(function(step){\r\n\t\t\tvar position = step.index + 1;\r\n\r\n\t\t\tif(step.id){\r\n\t\t\t\tquery.push(\"#\" + step.id);\r\n\t\t\t} else if(step.type === \"text\") {\r\n\t\t\t\t// unsupported in querySelector\r\n\t\t\t\t// query.push(\"text()[\" + position + \"]\");\r\n\t\t\t} else {\r\n\t\t\t\tquery.push(\"*:nth-child(\" + position + \")\");\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn query.join(\">\");\r\n\r\n\t}\r\n\r\n\ttextNodes(container, ignoreClass) {\r\n\t\treturn Array.prototype.slice.call(container.childNodes).\r\n\t\t\tfilter(function (node) {\r\n\t\t\t\tif (node.nodeType === TEXT_NODE) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t} else if (ignoreClass && node.classList.contains(ignoreClass)) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t});\r\n\t}\r\n\r\n\twalkToNode(steps, _doc, ignoreClass) {\r\n\t\tvar doc = _doc || document;\r\n\t\tvar container = doc.documentElement;\r\n\t\tvar children;\r\n\t\tvar step;\r\n\t\tvar len = steps.length;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < len; i++) {\r\n\t\t\tstep = steps[i];\r\n\r\n\t\t\tif(step.type === \"element\") {\r\n\t\t\t\t//better to get a container using id as some times step.index may not be correct\r\n\t\t\t\t//For ex.https://github.com/futurepress/epub.js/issues/561\r\n\t\t\t\tif(step.id) {\r\n\t\t\t\t\tcontainer = doc.getElementById(step.id);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tchildren = container.children || findChildren(container);\r\n\t\t\t\t\tcontainer = children[step.index];\r\n\t\t\t\t}\r\n\t\t\t} else if(step.type === \"text\") {\r\n\t\t\t\tcontainer = this.textNodes(container, ignoreClass)[step.index];\r\n\t\t\t}\r\n\t\t\tif(!container) {\r\n\t\t\t\t//Break the for loop as due to incorrect index we can get error if\r\n\t\t\t\t//container is undefined so that other functionailties works fine\r\n\t\t\t\t//like navigation\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfindNode(steps, _doc, ignoreClass) {\r\n\t\tvar doc = _doc || document;\r\n\t\tvar container;\r\n\t\tvar xpath;\r\n\r\n\t\tif(!ignoreClass && typeof doc.evaluate != \"undefined\") {\r\n\t\t\txpath = this.stepsToXpath(steps);\r\n\t\t\tcontainer = doc.evaluate(xpath, doc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\r\n\t\t} else if(ignoreClass) {\r\n\t\t\tcontainer = this.walkToNode(steps, doc, ignoreClass);\r\n\t\t} else {\r\n\t\t\tcontainer = this.walkToNode(steps, doc);\r\n\t\t}\r\n\r\n\t\treturn container;\r\n\t}\r\n\r\n\tfixMiss(steps, offset, _doc, ignoreClass) {\r\n\t\tvar container = this.findNode(steps.slice(0,-1), _doc, ignoreClass);\r\n\t\tvar children = container.childNodes;\r\n\t\tvar map = this.normalizedMap(children, TEXT_NODE, ignoreClass);\r\n\t\tvar child;\r\n\t\tvar len;\r\n\t\tvar lastStepIndex = steps[steps.length-1].index;\r\n\r\n\t\tfor (let childIndex in map) {\r\n\t\t\tif (!map.hasOwnProperty(childIndex)) return;\r\n\r\n\t\t\tif(map[childIndex] === lastStepIndex) {\r\n\t\t\t\tchild = children[childIndex];\r\n\t\t\t\tlen = child.textContent.length;\r\n\t\t\t\tif(offset > len) {\r\n\t\t\t\t\toffset = offset - len;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (child.nodeType === ELEMENT_NODE) {\r\n\t\t\t\t\t\tcontainer = child.childNodes[0];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcontainer = child;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tcontainer: container,\r\n\t\t\toffset: offset\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a DOM range representing a CFI\r\n\t * @param {document} _doc document referenced in the base\r\n\t * @param {string} [ignoreClass]\r\n\t * @return {Range}\r\n\t */\r\n\ttoRange(_doc, ignoreClass) {\r\n\t\t\r\n\t\tvar doc = _doc || document;\r\n\t\tvar range;\r\n\t\tvar start, end, startContainer, endContainer;\r\n\t\tvar cfi = this;\r\n\t\tvar startSteps, endSteps;\r\n\t\tvar needsIgnoring = ignoreClass ? (doc.querySelector(\".\" + ignoreClass) != null) : false;\r\n\t\tvar missed;\r\n\r\n\t\tif (typeof(doc.createRange) !== \"undefined\") {\r\n\t\t\trange = doc.createRange();\r\n\t\t} else {\r\n\t\t\trange = new RangeObject();\r\n\t\t}\r\n\r\n\t\tif (cfi.range) {\r\n\t\t\tstart = cfi.start;\r\n\t\t\tstartSteps = cfi.path.steps.concat(start.steps);\r\n\t\t\tstartContainer = this.findNode(startSteps, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t\tend = cfi.end;\r\n\t\t\tendSteps = cfi.path.steps.concat(end.steps);\r\n\t\t\tendContainer = this.findNode(endSteps, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t} else {\r\n\t\t\tstart = cfi.path;\r\n\t\t\tstartSteps = cfi.path.steps;\r\n\t\t\tstartContainer = this.findNode(cfi.path.steps, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t}\r\n\r\n\t\tif(startContainer) {\r\n\t\t\ttry {\r\n\r\n\t\t\t\tif(start.terminal.offset != null) {\r\n\t\t\t\t\trange.setStart(startContainer, start.terminal.offset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trange.setStart(startContainer, 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t} catch (e) {\r\n\t\t\t\tmissed = this.fixMiss(startSteps, start.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t\t\trange.setStart(missed.container, missed.offset);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.log(\"No startContainer found for\", this.toString());\r\n\t\t\t// No start found\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tif (endContainer) {\r\n\t\t\ttry {\r\n\r\n\t\t\t\tif(end.terminal.offset != null) {\r\n\t\t\t\t\trange.setEnd(endContainer, end.terminal.offset);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trange.setEnd(endContainer, 0);\r\n\t\t\t\t}\r\n\r\n\t\t\t} catch (e) {\r\n\t\t\t\tmissed = this.fixMiss(endSteps, cfi.end.terminal.offset, doc, needsIgnoring ? ignoreClass : null);\r\n\t\t\t\trange.setEnd(missed.container, missed.offset);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\t// doc.defaultView.getSelection().addRange(range);\r\n\t\treturn range;\r\n\t}\r\n\r\n\t/**\r\n\t * Check if a string is wrapped with \"epubcfi()\"\r\n\t * @param {string} str\r\n\t * @returns {boolean}\r\n\t */\r\n\tisCfiString(str) {\r\n\t\tif(typeof str === \"string\" &&\r\n\t\t\tstr.indexOf(\"epubcfi(\") === 0 &&\r\n\t\t\tstr[str.length-1] === \")\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tgenerateChapterComponent(_spineNodeIndex, _pos, id) {\r\n\t\tvar pos = parseInt(_pos),\r\n\t\t\t\tspineNodeIndex = (_spineNodeIndex + 1) * 2,\r\n\t\t\t\tcfi = \"/\"+spineNodeIndex+\"/\";\r\n\r\n\t\tcfi += (pos + 1) * 2;\r\n\r\n\t\tif(id) {\r\n\t\t\tcfi += \"[\" + id + \"]\";\r\n\t\t}\r\n\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\t/**\r\n\t * Collapse a CFI Range to a single CFI Position\r\n\t * @param {boolean} [toStart=false]\r\n\t */\r\n\tcollapse(toStart) {\r\n\t\tif (!this.range) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.range = false;\r\n\r\n\t\tif (toStart) {\r\n\t\t\tthis.path.steps = this.path.steps.concat(this.start.steps);\r\n\t\t\tthis.path.terminal = this.start.terminal;\r\n\t\t} else {\r\n\t\t\tthis.path.steps = this.path.steps.concat(this.end.steps);\r\n\t\t\tthis.path.terminal = this.end.terminal;\r\n\t\t}\r\n\t\t\r\n\r\n\t}\r\n\r\n\tgetElementOrder(){\r\n\t\t\r\n\t\tlet arr = this.str.split('/');\r\n\t\treturn arr[4];\r\n\t}\r\n}\r\n\r\nexport default EpubCFI;\r\n","'use strict';\n\nvar d        = require('d')\n  , callable = require('es5-ext/object/valid-callable')\n\n  , apply = Function.prototype.apply, call = Function.prototype.call\n  , create = Object.create, defineProperty = Object.defineProperty\n  , defineProperties = Object.defineProperties\n  , hasOwnProperty = Object.prototype.hasOwnProperty\n  , descriptor = { configurable: true, enumerable: false, writable: true }\n\n  , on, once, off, emit, methods, descriptors, base;\n\non = function (type, listener) {\n\tvar data;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) {\n\t\tdata = descriptor.value = create(null);\n\t\tdefineProperty(this, '__ee__', descriptor);\n\t\tdescriptor.value = null;\n\t} else {\n\t\tdata = this.__ee__;\n\t}\n\tif (!data[type]) data[type] = listener;\n\telse if (typeof data[type] === 'object') data[type].push(listener);\n\telse data[type] = [data[type], listener];\n\n\treturn this;\n};\n\nonce = function (type, listener) {\n\tvar once, self;\n\n\tcallable(listener);\n\tself = this;\n\ton.call(this, type, once = function () {\n\t\toff.call(self, type, once);\n\t\tapply.call(listener, this, arguments);\n\t});\n\n\tonce.__eeOnceListener__ = listener;\n\treturn this;\n};\n\noff = function (type, listener) {\n\tvar data, listeners, candidate, i;\n\n\tcallable(listener);\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return this;\n\tdata = this.__ee__;\n\tif (!data[type]) return this;\n\tlisteners = data[type];\n\n\tif (typeof listeners === 'object') {\n\t\tfor (i = 0; (candidate = listeners[i]); ++i) {\n\t\t\tif ((candidate === listener) ||\n\t\t\t\t\t(candidate.__eeOnceListener__ === listener)) {\n\t\t\t\tif (listeners.length === 2) data[type] = listeners[i ? 0 : 1];\n\t\t\t\telse listeners.splice(i, 1);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tif ((listeners === listener) ||\n\t\t\t\t(listeners.__eeOnceListener__ === listener)) {\n\t\t\tdelete data[type];\n\t\t}\n\t}\n\n\treturn this;\n};\n\nemit = function (type) {\n\tvar i, l, listener, listeners, args;\n\n\tif (!hasOwnProperty.call(this, '__ee__')) return;\n\tlisteners = this.__ee__[type];\n\tif (!listeners) return;\n\n\tif (typeof listeners === 'object') {\n\t\tl = arguments.length;\n\t\targs = new Array(l - 1);\n\t\tfor (i = 1; i < l; ++i) args[i - 1] = arguments[i];\n\n\t\tlisteners = listeners.slice();\n\t\tfor (i = 0; (listener = listeners[i]); ++i) {\n\t\t\tapply.call(listener, this, args);\n\t\t}\n\t} else {\n\t\tswitch (arguments.length) {\n\t\tcase 1:\n\t\t\tcall.call(listeners, this);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcall.call(listeners, this, arguments[1]);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tcall.call(listeners, this, arguments[1], arguments[2]);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tl = arguments.length;\n\t\t\targs = new Array(l - 1);\n\t\t\tfor (i = 1; i < l; ++i) {\n\t\t\t\targs[i - 1] = arguments[i];\n\t\t\t}\n\t\t\tapply.call(listeners, this, args);\n\t\t}\n\t}\n};\n\nmethods = {\n\ton: on,\n\tonce: once,\n\toff: off,\n\temit: emit\n};\n\ndescriptors = {\n\ton: d(on),\n\tonce: d(once),\n\toff: d(off),\n\temit: d(emit)\n};\n\nbase = defineProperties({}, descriptors);\n\nmodule.exports = exports = function (o) {\n\treturn (o == null) ? create(base) : defineProperties(Object(o), descriptors);\n};\nexports.methods = methods;\n","import path from \"path-webpack\";\r\n\r\n/**\r\n * Creates a Path object for parsing and manipulation of a path strings\r\n *\r\n * Uses a polyfill for Nodejs path: https://nodejs.org/api/path.html\r\n * @param\t{string} pathString\ta url string (relative or absolute)\r\n * @class\r\n */\r\nclass Path {\r\n\tconstructor(pathString) {\r\n\t\tvar protocol;\r\n\t\tvar parsed;\r\n\r\n\t\tprotocol = pathString.indexOf(\"://\");\r\n\t\tif (protocol > -1) {\r\n\t\t\tpathString = new URL(pathString).pathname;\r\n\t\t}\r\n\r\n\t\tparsed = this.parse(pathString);\r\n\r\n\t\tthis.path = pathString;\r\n\r\n\t\tif (this.isDirectory(pathString)) {\r\n\t\t\tthis.directory = pathString;\r\n\t\t} else {\r\n\t\t\tthis.directory = parsed.dir + \"/\";\r\n\t\t}\r\n\r\n\t\tthis.filename = parsed.base;\r\n\t\tthis.extension = parsed.ext.slice(1);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Parse the path: https://nodejs.org/api/path.html#path_path_parse_path\r\n\t * @param\t{string} what\r\n\t * @returns {object}\r\n\t */\r\n\tparse (what) {\r\n\t\treturn path.parse(what);\r\n\t}\r\n\r\n\t/**\r\n\t * @param\t{string} what\r\n\t * @returns {boolean}\r\n\t */\r\n\tisAbsolute (what) {\r\n\t\treturn path.isAbsolute(what || this.path);\r\n\t}\r\n\r\n\t/**\r\n\t * Check if path ends with a directory\r\n\t * @param\t{string} what\r\n\t * @returns {boolean}\r\n\t */\r\n\tisDirectory (what) {\r\n\t\treturn (what.charAt(what.length-1) === \"/\");\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a path against the directory of the Path\r\n\t *\r\n\t * https://nodejs.org/api/path.html#path_path_resolve_paths\r\n\t * @param\t{string} what\r\n\t * @returns {string} resolved\r\n\t */\r\n\tresolve (what) {\r\n\t\treturn path.resolve(this.directory, what);\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a path relative to the directory of the Path\r\n\t *\r\n\t * https://nodejs.org/api/path.html#path_path_relative_from_to\r\n\t * @param\t{string} what\r\n\t * @returns {string} relative\r\n\t */\r\n\trelative (what) {\r\n\t\tvar isAbsolute = what && (what.indexOf(\"://\") > -1);\r\n\r\n\t\tif (isAbsolute) {\r\n\t\t\treturn what;\r\n\t\t}\r\n\r\n\t\treturn path.relative(this.directory, what);\r\n\t}\r\n\r\n\tsplitPath(filename) {\r\n\t\treturn this.splitPathRe.exec(filename).slice(1);\r\n\t}\r\n\r\n\t/**\r\n\t * Return the path string\r\n\t * @returns {string} path\r\n\t */\r\n\ttoString () {\r\n\t\treturn this.path;\r\n\t}\r\n}\r\n\r\nexport default Path;\r\n","import Path from \"./path\";\r\nimport path from \"path-webpack\";\r\n\r\n/**\r\n * creates a Url object for parsing and manipulation of a url string\r\n * @param\t{string} urlString\ta url string (relative or absolute)\r\n * @param\t{string} [baseString] optional base for the url,\r\n * default to window.location.href\r\n */\r\nclass Url {\r\n\tconstructor(urlString, baseString) {\r\n\t\tvar absolute = (urlString.indexOf(\"://\") > -1);\r\n\t\tvar pathname = urlString;\r\n\t\tvar basePath;\r\n\r\n\t\tthis.Url = undefined;\r\n\t\tthis.href = urlString;\r\n\t\tthis.protocol = \"\";\r\n\t\tthis.origin = \"\";\r\n\t\tthis.hash = \"\";\r\n\t\tthis.hash = \"\";\r\n\t\tthis.search = \"\";\r\n\t\tthis.base = baseString;\r\n\r\n\t\tif (!absolute &&\r\n\t\t\t\tbaseString !== false &&\r\n\t\t\t\ttypeof(baseString) !== \"string\" &&\r\n\t\t\t\twindow && window.location) {\r\n\t\t\tthis.base = window.location.href;\r\n\t\t}\r\n\r\n\t\t// URL Polyfill doesn't throw an error if base is empty\r\n\t\tif (absolute || this.base) {\r\n\t\t\ttry {\r\n\t\t\t\tif (this.base) { // Safari doesn't like an undefined base\r\n\t\t\t\t\tthis.Url = new URL(urlString, this.base);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.Url = new URL(urlString);\r\n\t\t\t\t}\r\n\t\t\t\tthis.href = this.Url.href;\r\n\r\n\t\t\t\tthis.protocol = this.Url.protocol;\r\n\t\t\t\tthis.origin = this.Url.origin;\r\n\t\t\t\tthis.hash = this.Url.hash;\r\n\t\t\t\tthis.search = this.Url.search;\r\n\r\n\t\t\t\tpathname = this.Url.pathname + (this.Url.search ? this.Url.search : '');\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Skip URL parsing\r\n\t\t\t\tthis.Url = undefined;\r\n\t\t\t\t// resolve the pathname from the base\r\n\t\t\t\tif (this.base) {\r\n\t\t\t\t\tbasePath = new Path(this.base);\r\n\t\t\t\t\tpathname = basePath.resolve(pathname);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.Path = new Path(pathname);\r\n\r\n\t\tthis.directory = this.Path.directory;\r\n\t\tthis.filename = this.Path.filename;\r\n\t\tthis.extension = this.Path.extension;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {Path}\r\n\t */\r\n\tpath () {\r\n\t\treturn this.Path;\r\n\t}\r\n\r\n\t/**\r\n\t * Resolves a relative path to a absolute url\r\n\t * @param {string} what\r\n\t * @returns {string} url\r\n\t */\r\n\tresolve (what) {\r\n\t\tvar isAbsolute = (what.indexOf(\"://\") > -1);\r\n\t\tvar fullpath;\r\n\r\n\t\tif (isAbsolute) {\r\n\t\t\treturn what;\r\n\t\t}\r\n\r\n\t\tfullpath = path.resolve(this.directory, what);\r\n\t\treturn this.origin + fullpath;\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a path relative to the url\r\n\t * @param {string} what\r\n\t * @returns {string} path\r\n\t */\r\n\trelative (what) {\r\n\t\treturn path.relative(what, this.directory);\r\n\t}\r\n\r\n\t/**\r\n\t * @returns {string}\r\n\t */\r\n\ttoString () {\r\n\t\treturn this.href;\r\n\t}\r\n}\r\n\r\nexport default Url;\r\n","/**\r\n * Hooks allow for injecting functions that must all complete in order before finishing\r\n * They will execute in parallel but all must finish before continuing\r\n * Functions may return a promise if they are asycn.\r\n * @param {any} context scope of this\r\n * @example this.content = new EPUBJS.Hook(this);\r\n */\r\nclass Hook {\r\n\tconstructor(context){\r\n\t\tthis.context = context || this;\r\n\t\tthis.hooks = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a function to be run before a hook completes\r\n\t * @example this.content.register(function(){...});\r\n\t */\r\n\tregister(){\r\n\t\tfor(var i = 0; i < arguments.length; ++i) {\r\n\t\t\tif (typeof arguments[i]  === \"function\") {\r\n\t\t\t\tthis.hooks.push(arguments[i]);\r\n\t\t\t} else {\r\n\t\t\t\t// unpack array\r\n\t\t\t\tfor(var j = 0; j < arguments[i].length; ++j) {\r\n\t\t\t\t\tthis.hooks.push(arguments[i][j]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Removes a function\r\n\t * @example this.content.deregister(function(){...});\r\n\t */\r\n\tderegister(func){\r\n\t\tlet hook;\r\n\t\tfor (let i = 0; i < this.hooks.length; i++) {\r\n\t\t\thook = this.hooks[i];\r\n\t\t\tif (hook === func) {\r\n\t\t\t\tthis.hooks.splice(i, 1);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggers a hook to run all functions\r\n\t * @example this.content.trigger(args).then(function(){...});\r\n\t */\r\n\ttrigger(){\r\n\t\t\r\n\t\tvar args = arguments;\r\n\t\t\r\n\t\tvar context = this.context;\r\n\t\tvar promises = [];\r\n\r\n\t\tthis.hooks.forEach(function(task) {\r\n\t\t\ttry {\r\n\t\t\t\tvar executing = task.apply(context, args);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t}\r\n\r\n\t\t\tif(executing && typeof executing[\"then\"] === \"function\") {\r\n\t\t\t\t// Task is a function that returns a promise\r\n\t\t\t\tpromises.push(executing);\r\n\t\t\t}\r\n\t\t\t// Otherwise Task resolves immediately, continue\r\n\t\t});\r\n\r\n\r\n\t\treturn Promise.all(promises);\r\n\t}\r\n\r\n\r\n\t// Adds a function to be run before a hook completes\r\n\tlist(){\r\n\t\treturn this.hooks;\r\n\t}\r\n\r\n\tclear(){\r\n\t\treturn this.hooks = [];\r\n\t}\r\n}\r\nexport default Hook;\r\n","'use strict';\n\nif (!process) {\n  var process = {\n    \"cwd\" : function () { return '/' }\n  };\n}\n\nfunction assertPath(path) {\n  if (typeof path !== 'string') {\n    throw new TypeError('Path must be a string. Received ' + path);\n  }\n}\n\n// Resolves . and .. elements in a path with directory names\nfunction normalizeStringPosix(path, allowAboveRoot) {\n  var res = '';\n  var lastSlash = -1;\n  var dots = 0;\n  var code;\n  for (var i = 0; i <= path.length; ++i) {\n    if (i < path.length)\n      code = path.charCodeAt(i);\n    else if (code === 47/*/*/)\n      break;\n    else\n      code = 47/*/*/;\n    if (code === 47/*/*/) {\n      if (lastSlash === i - 1 || dots === 1) {\n        // NOOP\n      } else if (lastSlash !== i - 1 && dots === 2) {\n        if (res.length < 2 ||\n            res.charCodeAt(res.length - 1) !== 46/*.*/ ||\n            res.charCodeAt(res.length - 2) !== 46/*.*/) {\n          if (res.length > 2) {\n            var start = res.length - 1;\n            var j = start;\n            for (; j >= 0; --j) {\n              if (res.charCodeAt(j) === 47/*/*/)\n                break;\n            }\n            if (j !== start) {\n              if (j === -1)\n                res = '';\n              else\n                res = res.slice(0, j);\n              lastSlash = i;\n              dots = 0;\n              continue;\n            }\n          } else if (res.length === 2 || res.length === 1) {\n            res = '';\n            lastSlash = i;\n            dots = 0;\n            continue;\n          }\n        }\n        if (allowAboveRoot) {\n          if (res.length > 0)\n            res += '/..';\n          else\n            res = '..';\n        }\n      } else {\n        if (res.length > 0)\n          res += '/' + path.slice(lastSlash + 1, i);\n        else\n          res = path.slice(lastSlash + 1, i);\n      }\n      lastSlash = i;\n      dots = 0;\n    } else if (code === 46/*.*/ && dots !== -1) {\n      ++dots;\n    } else {\n      dots = -1;\n    }\n  }\n  return res;\n}\n\nfunction _format(sep, pathObject) {\n  var dir = pathObject.dir || pathObject.root;\n  var base = pathObject.base ||\n    ((pathObject.name || '') + (pathObject.ext || ''));\n  if (!dir) {\n    return base;\n  }\n  if (dir === pathObject.root) {\n    return dir + base;\n  }\n  return dir + sep + base;\n}\n\nvar posix = {\n  // path.resolve([from ...], to)\n  resolve: function resolve() {\n    var resolvedPath = '';\n    var resolvedAbsolute = false;\n    var cwd;\n\n    for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n      var path;\n      if (i >= 0)\n        path = arguments[i];\n      else {\n        if (cwd === undefined)\n          cwd = process.cwd();\n        path = cwd;\n      }\n\n      assertPath(path);\n\n      // Skip empty entries\n      if (path.length === 0) {\n        continue;\n      }\n\n      resolvedPath = path + '/' + resolvedPath;\n      resolvedAbsolute = path.charCodeAt(0) === 47/*/*/;\n    }\n\n    // At this point the path should be resolved to a full absolute path, but\n    // handle relative paths to be safe (might happen when process.cwd() fails)\n\n    // Normalize the path\n    resolvedPath = normalizeStringPosix(resolvedPath, !resolvedAbsolute);\n\n    if (resolvedAbsolute) {\n      if (resolvedPath.length > 0)\n        return '/' + resolvedPath;\n      else\n        return '/';\n    } else if (resolvedPath.length > 0) {\n      return resolvedPath;\n    } else {\n      return '.';\n    }\n  },\n\n\n  normalize: function normalize(path) {\n    assertPath(path);\n\n    if (path.length === 0)\n      return '.';\n\n    var isAbsolute = path.charCodeAt(0) === 47/*/*/;\n    var trailingSeparator = path.charCodeAt(path.length - 1) === 47/*/*/;\n\n    // Normalize the path\n    path = normalizeStringPosix(path, !isAbsolute);\n\n    if (path.length === 0 && !isAbsolute)\n      path = '.';\n    if (path.length > 0 && trailingSeparator)\n      path += '/';\n\n    if (isAbsolute)\n      return '/' + path;\n    return path;\n  },\n\n\n  isAbsolute: function isAbsolute(path) {\n    assertPath(path);\n    return path.length > 0 && path.charCodeAt(0) === 47/*/*/;\n  },\n\n\n  join: function join() {\n    if (arguments.length === 0)\n      return '.';\n    var joined;\n    for (var i = 0; i < arguments.length; ++i) {\n      var arg = arguments[i];\n      assertPath(arg);\n      if (arg.length > 0) {\n        if (joined === undefined)\n          joined = arg;\n        else\n          joined += '/' + arg;\n      }\n    }\n    if (joined === undefined)\n      return '.';\n    return posix.normalize(joined);\n  },\n\n\n  relative: function relative(from, to) {\n    assertPath(from);\n    assertPath(to);\n\n    if (from === to)\n      return '';\n\n    from = posix.resolve(from);\n    to = posix.resolve(to);\n\n    if (from === to)\n      return '';\n\n    // Trim any leading backslashes\n    var fromStart = 1;\n    for (; fromStart < from.length; ++fromStart) {\n      if (from.charCodeAt(fromStart) !== 47/*/*/)\n        break;\n    }\n    var fromEnd = from.length;\n    var fromLen = (fromEnd - fromStart);\n\n    // Trim any leading backslashes\n    var toStart = 1;\n    for (; toStart < to.length; ++toStart) {\n      if (to.charCodeAt(toStart) !== 47/*/*/)\n        break;\n    }\n    var toEnd = to.length;\n    var toLen = (toEnd - toStart);\n\n    // Compare paths to find the longest common path from root\n    var length = (fromLen < toLen ? fromLen : toLen);\n    var lastCommonSep = -1;\n    var i = 0;\n    for (; i <= length; ++i) {\n      if (i === length) {\n        if (toLen > length) {\n          if (to.charCodeAt(toStart + i) === 47/*/*/) {\n            // We get here if `from` is the exact base path for `to`.\n            // For example: from='/foo/bar'; to='/foo/bar/baz'\n            return to.slice(toStart + i + 1);\n          } else if (i === 0) {\n            // We get here if `from` is the root\n            // For example: from='/'; to='/foo'\n            return to.slice(toStart + i);\n          }\n        } else if (fromLen > length) {\n          if (from.charCodeAt(fromStart + i) === 47/*/*/) {\n            // We get here if `to` is the exact base path for `from`.\n            // For example: from='/foo/bar/baz'; to='/foo/bar'\n            lastCommonSep = i;\n          } else if (i === 0) {\n            // We get here if `to` is the root.\n            // For example: from='/foo'; to='/'\n            lastCommonSep = 0;\n          }\n        }\n        break;\n      }\n      var fromCode = from.charCodeAt(fromStart + i);\n      var toCode = to.charCodeAt(toStart + i);\n      if (fromCode !== toCode)\n        break;\n      else if (fromCode === 47/*/*/)\n        lastCommonSep = i;\n    }\n\n    var out = '';\n    // Generate the relative path based on the path difference between `to`\n    // and `from`\n    for (i = fromStart + lastCommonSep + 1; i <= fromEnd; ++i) {\n      if (i === fromEnd || from.charCodeAt(i) === 47/*/*/) {\n        if (out.length === 0)\n          out += '..';\n        else\n          out += '/..';\n      }\n    }\n\n    // Lastly, append the rest of the destination (`to`) path that comes after\n    // the common path parts\n    if (out.length > 0)\n      return out + to.slice(toStart + lastCommonSep);\n    else {\n      toStart += lastCommonSep;\n      if (to.charCodeAt(toStart) === 47/*/*/)\n        ++toStart;\n      return to.slice(toStart);\n    }\n  },\n\n\n  _makeLong: function _makeLong(path) {\n    return path;\n  },\n\n\n  dirname: function dirname(path) {\n    assertPath(path);\n    if (path.length === 0)\n      return '.';\n    var code = path.charCodeAt(0);\n    var hasRoot = (code === 47/*/*/);\n    var end = -1;\n    var matchedSlash = true;\n    for (var i = path.length - 1; i >= 1; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n        // We saw the first non-path separator\n        matchedSlash = false;\n      }\n    }\n\n    if (end === -1)\n      return hasRoot ? '/' : '.';\n    if (hasRoot && end === 1)\n      return '//';\n    return path.slice(0, end);\n  },\n\n\n  basename: function basename(path, ext) {\n    if (ext !== undefined && typeof ext !== 'string')\n      throw new TypeError('\"ext\" argument must be a string');\n    assertPath(path);\n\n    var start = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i;\n\n    if (ext !== undefined && ext.length > 0 && ext.length <= path.length) {\n      if (ext.length === path.length && ext === path)\n        return '';\n      var extIdx = ext.length - 1;\n      var firstNonSlashEnd = -1;\n      for (i = path.length - 1; i >= 0; --i) {\n        var code = path.charCodeAt(i);\n        if (code === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else {\n          if (firstNonSlashEnd === -1) {\n            // We saw the first non-path separator, remember this index in case\n            // we need it if the extension ends up not matching\n            matchedSlash = false;\n            firstNonSlashEnd = i + 1;\n          }\n          if (extIdx >= 0) {\n            // Try to match the explicit extension\n            if (code === ext.charCodeAt(extIdx)) {\n              if (--extIdx === -1) {\n                // We matched the extension, so mark this as the end of our path\n                // component\n                end = i;\n              }\n            } else {\n              // Extension does not match, so our result is the entire path\n              // component\n              extIdx = -1;\n              end = firstNonSlashEnd;\n            }\n          }\n        }\n      }\n\n      if (start === end)\n        end = firstNonSlashEnd;\n      else if (end === -1)\n        end = path.length;\n      return path.slice(start, end);\n    } else {\n      for (i = path.length - 1; i >= 0; --i) {\n        if (path.charCodeAt(i) === 47/*/*/) {\n          // If we reached a path separator that was not part of a set of path\n          // separators at the end of the string, stop now\n          if (!matchedSlash) {\n            start = i + 1;\n            break;\n          }\n        } else if (end === -1) {\n          // We saw the first non-path separator, mark this as the end of our\n          // path component\n          matchedSlash = false;\n          end = i + 1;\n        }\n      }\n\n      if (end === -1)\n        return '';\n      return path.slice(start, end);\n    }\n  },\n\n\n  extname: function extname(path) {\n    assertPath(path);\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n    for (var i = path.length - 1; i >= 0; --i) {\n      var code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      return '';\n    }\n    return path.slice(startDot, end);\n  },\n\n\n  format: function format(pathObject) {\n    if (pathObject === null || typeof pathObject !== 'object') {\n      throw new TypeError(\n        'Parameter \"pathObject\" must be an object, not ' + typeof(pathObject)\n      );\n    }\n    return _format('/', pathObject);\n  },\n\n\n  parse: function parse(path) {\n    assertPath(path);\n\n    var ret = { root: '', dir: '', base: '', ext: '', name: '' };\n    if (path.length === 0)\n      return ret;\n    var code = path.charCodeAt(0);\n    var isAbsolute = (code === 47/*/*/);\n    var start;\n    if (isAbsolute) {\n      ret.root = '/';\n      start = 1;\n    } else {\n      start = 0;\n    }\n    var startDot = -1;\n    var startPart = 0;\n    var end = -1;\n    var matchedSlash = true;\n    var i = path.length - 1;\n\n    // Track the state of characters (if any) we see before our first dot and\n    // after any path separator we find\n    var preDotState = 0;\n\n    // Get non-dir info\n    for (; i >= start; --i) {\n      code = path.charCodeAt(i);\n      if (code === 47/*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n      if (end === -1) {\n        // We saw the first non-path separator, mark this as the end of our\n        // extension\n        matchedSlash = false;\n        end = i + 1;\n      }\n      if (code === 46/*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n      } else if (startDot !== -1) {\n        // We saw a non-dot and non-path separator before our dot, so we should\n        // have a good chance at having a non-empty extension\n        preDotState = -1;\n      }\n    }\n\n    if (startDot === -1 ||\n        end === -1 ||\n        // We saw a non-dot character immediately before the dot\n        preDotState === 0 ||\n        // The (right-most) trimmed path component is exactly '..'\n        (preDotState === 1 &&\n         startDot === end - 1 &&\n         startDot === startPart + 1)) {\n      if (end !== -1) {\n        if (startPart === 0 && isAbsolute)\n          ret.base = ret.name = path.slice(1, end);\n        else\n          ret.base = ret.name = path.slice(startPart, end);\n      }\n    } else {\n      if (startPart === 0 && isAbsolute) {\n        ret.name = path.slice(1, startDot);\n        ret.base = path.slice(1, end);\n      } else {\n        ret.name = path.slice(startPart, startDot);\n        ret.base = path.slice(startPart, end);\n      }\n      ret.ext = path.slice(startDot, end);\n    }\n\n    if (startPart > 0)\n      ret.dir = path.slice(0, startPart - 1);\n    else if (isAbsolute)\n      ret.dir = '/';\n\n    return ret;\n  },\n\n\n  sep: '/',\n  delimiter: ':',\n  posix: null\n};\n\n\nmodule.exports = posix;\n","import { qs, qsa } from \"./core\";\r\nimport Url from \"./url\";\r\nimport Path from \"./path\";\r\n\r\nexport function replaceBase(doc, section){\r\n\tvar base;\r\n\tvar head;\r\n\tvar url = section.url;\r\n\tvar absolute = (url.indexOf(\"://\") > -1);\r\n\r\n\tif(!doc){\r\n\t\treturn;\r\n\t}\r\n\r\n\thead = qs(doc, \"head\");\r\n\tbase = qs(head, \"base\");\r\n\r\n\tif(!base) {\r\n\t\tbase = doc.createElement(\"base\");\r\n\t\thead.insertBefore(base, head.firstChild);\r\n\t}\r\n\r\n\t// Fix for Safari crashing if the url doesn't have an origin\r\n\tif (!absolute && window && window.location) {\r\n\t\turl = window.location.origin + url;\r\n\t}\r\n\r\n\tbase.setAttribute(\"href\", url);\r\n}\r\n\r\nexport function replaceCanonical(doc, section){\r\n\tvar head;\r\n\tvar link;\r\n\tvar url = section.canonical;\r\n\r\n\tif(!doc){\r\n\t\treturn;\r\n\t}\r\n\r\n\thead = qs(doc, \"head\");\r\n\tlink = qs(head, \"link[rel='canonical']\");\r\n\r\n\tif (link) {\r\n\t\tlink.setAttribute(\"href\", url);\r\n\t} else {\r\n\t\tlink = doc.createElement(\"link\");\r\n\t\tlink.setAttribute(\"rel\", \"canonical\");\r\n\t\tlink.setAttribute(\"href\", url);\r\n\t\thead.appendChild(link);\r\n\t}\r\n}\r\n\r\nexport function replaceMeta(doc, section){\r\n\tvar head;\r\n\tvar meta;\r\n\tvar id = section.idref;\r\n\tif(!doc){\r\n\t\treturn;\r\n\t}\r\n\r\n\thead = qs(doc, \"head\");\r\n\tmeta = qs(head, \"link[property='dc.identifier']\");\r\n\r\n\tif (meta) {\r\n\t\tmeta.setAttribute(\"content\", id);\r\n\t} else {\r\n\t\tmeta = doc.createElement(\"meta\");\r\n\t\tmeta.setAttribute(\"name\", \"dc.identifier\");\r\n\t\tmeta.setAttribute(\"content\", id);\r\n\t\thead.appendChild(meta);\r\n\t}\r\n}\r\n\r\n// TODO: move me to Contents\r\nexport function replaceLinks(contents, fn) {\r\n\r\n\tvar links = contents.querySelectorAll(\"a[href]\");\r\n\r\n\tif (!links.length) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar base = qs(contents.ownerDocument, \"base\");\r\n\tvar location = base ? base.getAttribute(\"href\") : undefined;\r\n\tvar replaceLink = function(link){\r\n\t\tvar href = link.getAttribute(\"href\");\r\n\r\n\t\tif(href.indexOf(\"mailto:\") === 0){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar absolute = (href.indexOf(\"://\") > -1);\r\n\r\n\t\tif(absolute){\r\n\r\n\t\t\tlink.setAttribute(\"target\", \"_blank\");\r\n\r\n\t\t}else{\r\n\t\t\tvar linkUrl;\r\n\t\t\ttry {\r\n\t\t\t\tlinkUrl = new Url(href, location);\t\r\n\t\t\t} catch(error) {\r\n\t\t\t\t// NOOP\r\n\t\t\t}\r\n\r\n\t\t\tlink.onclick = function(){\r\n\r\n\t\t\t\tif(linkUrl && linkUrl.hash) {\r\n\t\t\t\t\tfn(linkUrl.Path.path + linkUrl.hash);\r\n\t\t\t\t} else if(linkUrl){\r\n\t\t\t\t\tfn(linkUrl.Path.path);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfn(href);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t}\r\n\t}.bind(this);\r\n\r\n\tfor (var i = 0; i < links.length; i++) {\r\n\t\treplaceLink(links[i]);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport function substitute(content, urls, replacements) {\r\n\turls.forEach(function(url, i){\r\n\t\tif (url && replacements[i]) {\r\n\t\t\t// Account for special characters in the file name.\r\n\t\t\t// See https://stackoverflow.com/a/6318729.\r\n\t\t\turl = url.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\r\n\t\t\tcontent = content.replace(new RegExp(url, \"g\"), replacements[i]);\r\n\t\t}\r\n\t});\r\n\treturn content;\r\n}\r\n","import {defer, requestAnimationFrame} from \"./core\";\r\n\r\n/**\r\n * Queue for handling tasks one at a time\r\n * @class\r\n * @param {scope} context what this will resolve to in the tasks\r\n */\r\nclass Queue {\r\n\tconstructor(context){\r\n\t\tthis._q = [];\r\n\t\tthis.context = context;\r\n\t\tthis.tick = requestAnimationFrame;\r\n\t\tthis.running = false;\r\n\t\tthis.paused = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Add an item to the queue\r\n\t * @return {Promise}\r\n\t */\r\n\tenqueue() {\r\n\t\tvar deferred, promise;\r\n\t\tvar queued;\r\n\t\tvar task = [].shift.call(arguments);\r\n\t\tvar args = arguments;\r\n\r\n\t\t// Handle single args without context\r\n\t\t// if(args && !Array.isArray(args)) {\r\n\t\t//   args = [args];\r\n\t\t// }\r\n\t\tif(!task) {\r\n\t\t\tthrow new Error(\"No Task Provided\");\r\n\t\t}\r\n\r\n\t\tif(typeof task === \"function\"){\r\n\r\n\t\t\tdeferred = new defer();\r\n\t\t\tpromise = deferred.promise;\r\n\r\n\t\t\tqueued = {\r\n\t\t\t\t\"task\" : task,\r\n\t\t\t\t\"args\"     : args,\r\n\t\t\t\t//\"context\"  : context,\r\n\t\t\t\t\"deferred\" : deferred,\r\n\t\t\t\t\"promise\" : promise\r\n\t\t\t};\r\n\r\n\t\t} else {\r\n\t\t\t// Task is a promise\r\n\t\t\tqueued = {\r\n\t\t\t\t\"promise\" : task\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tthis._q.push(queued);\r\n\r\n\t\t// Wait to start queue flush\r\n\t\tif (this.paused == false && !this.running) {\r\n\t\t\t// setTimeout(this.flush.bind(this), 0);\r\n\t\t\t// this.tick.call(window, this.run.bind(this));\r\n\t\t\tthis.run();\r\n\t\t}\r\n\r\n\t\treturn queued.promise;\r\n\t}\r\n\r\n\t/**\r\n\t * Run one item\r\n\t * @return {Promise}\r\n\t */\r\n\tdequeue(){\r\n\t\tvar inwait, task, result;\r\n\r\n\t\tif(this._q.length && !this.paused) {\r\n\t\t\tinwait = this._q.shift();\r\n\t\t\ttask = inwait.task;\r\n\t\t\tif(task){\r\n\t\t\t\t// console.log(task)\r\n\r\n\t\t\t\tresult = task.apply(this.context, inwait.args);\r\n\r\n\t\t\t\tif(result && typeof result[\"then\"] === \"function\") {\r\n\t\t\t\t\t// Task is a function that returns a promise\r\n\t\t\t\t\treturn result.then(function(){\r\n\t\t\t\t\t\tinwait.deferred.resolve.apply(this.context, arguments);\r\n\t\t\t\t\t}.bind(this), function() {\r\n\t\t\t\t\t\tinwait.deferred.reject.apply(this.context, arguments);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Task resolves immediately\r\n\t\t\t\t\tinwait.deferred.resolve.apply(this.context, result);\r\n\t\t\t\t\treturn inwait.promise;\r\n\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t} else if(inwait.promise) {\r\n\t\t\t\t// Task is a promise\r\n\t\t\t\treturn inwait.promise;\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tinwait = new defer();\r\n\t\t\tinwait.deferred.resolve();\r\n\t\t\treturn inwait.promise;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Run All Immediately\r\n\tdump(){\r\n\t\twhile(this._q.length) {\r\n\t\t\tthis.dequeue();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Run all tasks sequentially, at convince\r\n\t * @return {Promise}\r\n\t */\r\n\trun(){\r\n\r\n\t\tif(!this.running){\r\n\t\t\tthis.running = true;\r\n\t\t\tthis.defered = new defer();\r\n\t\t}\r\n\r\n\t\tthis.tick.call(window, () => {\r\n\r\n\t\t\tif(this._q.length) {\r\n\r\n\t\t\t\tthis.dequeue()\r\n\t\t\t\t\t.then(function(){\r\n\t\t\t\t\t\tthis.run();\r\n\t\t\t\t\t}.bind(this));\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis.defered.resolve();\r\n\t\t\t\tthis.running = undefined;\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// Unpause\r\n\t\tif(this.paused == true) {\r\n\t\t\tthis.paused = false;\r\n\t\t}\r\n\r\n\t\treturn this.defered.promise;\r\n\t}\r\n\r\n\t/**\r\n\t * Flush all, as quickly as possible\r\n\t * @return {Promise}\r\n\t */\r\n\tflush(){\r\n\r\n\t\tif(this.running){\r\n\t\t\treturn this.running;\r\n\t\t}\r\n\r\n\t\tif(this._q.length) {\r\n\t\t\tthis.running = this.dequeue()\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tthis.running = undefined;\r\n\t\t\t\t\treturn this.flush();\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\treturn this.running;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Clear all items in wait\r\n\t */\r\n\tclear(){\r\n\t\tthis._q = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Get the number of tasks in the queue\r\n\t * @return {number} tasks\r\n\t */\r\n\tlength(){\r\n\t\treturn this._q.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Pause a running queue\r\n\t */\r\n\tpause(){\r\n\t\tthis.paused = true;\r\n\t}\r\n\r\n\t/**\r\n\t * End the queue\r\n\t */\r\n\tstop(){\r\n\t\tthis._q = [];\r\n\t\tthis.running = false;\r\n\t\tthis.paused = true;\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * Create a new task from a callback\r\n * @class\r\n * @private\r\n * @param {function} task\r\n * @param {array} args\r\n * @param {scope} context\r\n * @return {function} task\r\n */\r\nclass Task {\r\n\tconstructor(task, args, context){\r\n\r\n\t\treturn function(){\r\n\t\t\tvar toApply = arguments || [];\r\n\r\n\t\t\treturn new Promise( (resolve, reject) => {\r\n\t\t\t\tvar callback = function(value, err){\r\n\t\t\t\t\tif (!value && err) {\r\n\t\t\t\t\t\treject(err);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(value);\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t\t// Add the callback to the arguments list\r\n\t\t\t\ttoApply.push(callback);\r\n\r\n\t\t\t\t// Apply all arguments to the functions\r\n\t\t\t\ttask.apply(context || this, toApply);\r\n\r\n\t\t\t});\r\n\r\n\t\t};\r\n\r\n\t}\r\n}\r\n\r\n\r\nexport default Queue;\r\nexport { Task };\r\n","// Detect RTL scroll type\r\n// Based on https://github.com/othree/jquery.rtl-scroll-type/blob/master/src/jquery.rtl-scroll.js\r\nexport default function scrollType() {\r\n\tvar type = \"reverse\";\r\n\tvar definer = createDefiner();\r\n\tdocument.body.appendChild(definer);\r\n\r\n\tif (definer.scrollLeft > 0) {\r\n\t\ttype = \"default\";\r\n\t} else {\r\n\t\tif (typeof Element !== 'undefined' && Element.prototype.scrollIntoView) {\r\n\t\t\tdefiner.children[0].children[1].scrollIntoView();\r\n\t\t\tif (definer.scrollLeft < 0) {\r\n\t\t\t\ttype = \"negative\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tdefiner.scrollLeft = 1;\r\n\t\t\tif (definer.scrollLeft === 0) {\r\n\t\t\t\ttype = \"negative\";\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdocument.body.removeChild(definer);\r\n\treturn type;\r\n}\r\n\r\nexport function createDefiner() {\r\n\tvar definer = document.createElement('div');\r\n\tdefiner.dir=\"rtl\";\r\n\r\n\tdefiner.style.position = \"fixed\";\r\n\tdefiner.style.width = \"1px\";\r\n\tdefiner.style.height = \"1px\";\r\n\tdefiner.style.top = \"0px\";\r\n\tdefiner.style.left = \"0px\";\r\n\tdefiner.style.overflow = \"hidden\";\r\n\r\n\tvar innerDiv = document.createElement('div');\r\n\tinnerDiv.style.width = \"2px\";\r\n\r\n\tvar spanA = document.createElement('span');\r\n\tspanA.style.width = \"1px\";\r\n\tspanA.style.display = \"inline-block\";\r\n\r\n\tvar spanB = document.createElement('span');\r\n\tspanB.style.width = \"1px\";\r\n\tspanB.style.display = \"inline-block\";\r\n\r\n\tinnerDiv.appendChild(spanA);\r\n\tinnerDiv.appendChild(spanB);\r\n\tdefiner.appendChild(innerDiv);\r\n\r\n\treturn definer;\r\n}\r\n","import {uuid, isNumber, isElement, windowBounds, extend} from \"../../utils/core\";\r\nimport throttle from 'lodash/throttle'\r\n\r\nclass Stage {\r\n\tconstructor(_options) {\r\n\t\tthis.settings = _options || {};\r\n\t\tthis.id = \"epubjs-container-\" + uuid();\r\n\r\n\t\tthis.container = this.create(this.settings);\r\n\r\n\t\tif(this.settings.hidden) {\r\n\t\t\tthis.wrapper = this.wrap(this.container);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/*\r\n\t* Creates an element to render to.\r\n\t* Resizes to passed width and height or to the elements size\r\n\t*/\r\n\tcreate(options){\r\n\t\tlet height  = options.height;// !== false ? options.height : \"100%\";\r\n\t\tlet width   = options.width;// !== false ? options.width : \"100%\";\r\n\t\tlet overflow  = options.overflow || false;\r\n\t\tlet axis = options.axis || \"vertical\";\r\n\t\tlet direction = options.direction;\r\n\r\n\t\textend(this.settings, options);\r\n\r\n\t\tif(options.height && isNumber(options.height)) {\r\n\t\t\theight = options.height + \"px\";\r\n\t\t}\r\n\r\n\t\tif(options.width && isNumber(options.width)) {\r\n\t\t\twidth = options.width + \"px\";\r\n\t\t}\r\n\r\n\t\t// Create new container element\r\n\t\tlet container = document.createElement(\"div\");\r\n\r\n\t\tcontainer.style.marginLeft = \"auto\";\r\n\t\tcontainer.style.marginRight=\"auto\";\r\n\t\t\r\n\t\tcontainer.id = this.id;\r\n\t\tcontainer.classList.add(\"epub-container\");\r\n\r\n\t\t// Style Element\r\n\t\t// container.style.fontSize = \"0\";\r\n\t\tcontainer.style.wordSpacing = \"0\";\r\n\t\tcontainer.style.lineHeight = \"0\";\r\n\t\tcontainer.style.verticalAlign = \"top\";\r\n\t\tcontainer.style.position = \"relative\";\r\n\r\n\t\tif(axis === \"horizontal\") {\r\n\t\t\t// container.style.whiteSpace = \"nowrap\";\r\n\t\t\tcontainer.style.display = \"flex\";\r\n\t\t\tcontainer.style.flexDirection = \"row\";\r\n\t\t\tcontainer.style.flexWrap = \"nowrap\";\r\n\t\t}\r\n\r\n\t\tif(width){\r\n\t\t\tcontainer.style.width = width;\r\n\t\t}\r\n\r\n\t\tif(height){\r\n\t\t\tcontainer.style.height = height;\r\n\t\t}\r\n\r\n\t\tif (overflow) {\r\n\t\t\tif (overflow === \"scroll\" && axis === \"vertical\") {\r\n\t\t\t\tcontainer.style[\"overflow-y\"] = overflow;\r\n\t\t\t\tcontainer.style[\"overflow-x\"] = \"hidden\";\r\n\t\t\t} else if (overflow === \"scroll\" && axis === \"horizontal\") {\r\n\t\t\t\tcontainer.style[\"overflow-y\"] = \"hidden\";\r\n\t\t\t\tcontainer.style[\"overflow-x\"] = overflow;\r\n\t\t\t} else {\r\n\t\t\t\tcontainer.style[\"overflow\"] = overflow;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (direction) {\r\n\t\t\t// container.dir = direction;\r\n\t\t\t// container.style[\"direction\"] = direction;\r\n\t\t}\r\n\r\n\t\tif (direction && this.settings.fullsize) {\r\n\t\t\tdocument.body.style[\"direction\"] = direction;\r\n\t\t}\r\n\t\treturn container;\r\n\t}\r\n\r\n\twrap(container) {\r\n\t\tvar wrapper = document.createElement(\"div\");\r\n\r\n\t\twrapper.style.visibility = \"hidden\";\r\n\t\twrapper.style.overflow = \"hidden\";\r\n\t\twrapper.style.width = \"0\";\r\n\t\twrapper.style.height = \"0\";\r\n\r\n\t\twrapper.appendChild(container);\r\n\t\treturn wrapper;\r\n\t}\r\n\r\n\r\n\tgetElement(_element){\r\n\t\tvar element;\r\n\r\n\t\tif(isElement(_element)) {\r\n\t\t\telement = _element;\r\n\t\t} else if (typeof _element === \"string\") {\r\n\t\t\telement = document.getElementById(_element);\r\n\t\t}\r\n\r\n\t\tif(!element){\r\n\t\t\tthrow new Error(\"Not an Element\");\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tattachTo(what){\r\n\r\n\t\tvar element = this.getElement(what);\r\n\t\tvar base;\r\n\r\n\t\tif(!element){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this.settings.hidden) {\r\n\t\t\tbase = this.wrapper;\r\n\t\t} else {\r\n\t\t\tbase = this.container;\r\n\t\t}\r\n\r\n\t\telement.appendChild(base);\r\n\r\n\t\tthis.element = element;\r\n\r\n\t\treturn element;\r\n\r\n\t}\r\n\r\n\tgetContainer() {\r\n\t\treturn this.container;\r\n\t}\r\n\r\n\tonResize(func){\r\n\t\t\r\n\t\t// Only listen to window for resize event if width and height are not fixed.\r\n\t\t// This applies if it is set to a percent or auto.\r\n\t\tif(!isNumber(this.settings.width) ||\r\n\t\t\t !isNumber(this.settings.height) ) {\r\n\t\t\t\t //김병현 수정 스로틀 값 50 -> 0\r\n\t\t\tthis.resizeFunc = throttle(func, 50);\r\n\t\t\twindow.addEventListener(\"resize\", this.resizeFunc, false);\r\n\t\t\t\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonOrientationChange(func){\r\n\t\tthis.orientationChangeFunc = func;\r\n\t\twindow.addEventListener(\"orientationchange\", this.orientationChangeFunc, false);\r\n\t}\r\n\r\n\tsize(width, height){\r\n\t\tvar bounds;\r\n\t\tlet _width = width || this.settings.width;\r\n\t\tlet _height = height || this.settings.height;\r\n\r\n\t\t// If width or height are set to false, inherit them from containing element\r\n\t\tif(width === null) {\r\n\t\t\tbounds = this.element.getBoundingClientRect();\r\n\r\n\t\t\tif(bounds.width) {\r\n\t\t\t\twidth = Math.floor(bounds.width);\r\n\t\t\t\tthis.container.style.width = width + \"px\";\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (isNumber(width)) {\r\n\t\t\t\tthis.container.style.width = width + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.style.width = width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(height === null) {\r\n\t\t\tbounds = bounds || this.element.getBoundingClientRect();\r\n\r\n\t\t\tif(bounds.height) {\r\n\t\t\t\theight = bounds.height;\r\n\t\t\t\tthis.container.style.height = height + \"px\";\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tif (isNumber(height)) {\r\n\t\t\t\tthis.container.style.height = height + \"px\";\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.style.height = height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(!isNumber(width)) {\r\n\t\t\twidth = this.container.clientWidth;\r\n\t\t}\r\n\r\n\t\tif(!isNumber(height)) {\r\n\t\t\theight = this.container.clientHeight;\r\n\t\t}\r\n\r\n\t\tthis.containerStyles = window.getComputedStyle(this.container);\r\n\r\n\t\tthis.containerPadding = {\r\n\t\t\tleft: parseFloat(this.containerStyles[\"padding-left\"]) || 0,\r\n\t\t\tright: parseFloat(this.containerStyles[\"padding-right\"]) || 0,\r\n\t\t\ttop: parseFloat(this.containerStyles[\"padding-top\"]) || 0,\r\n\t\t\tbottom: parseFloat(this.containerStyles[\"padding-bottom\"]) || 0\r\n\t\t};\r\n\r\n\t\t// Bounds not set, get them from window\r\n\t\tlet _windowBounds = windowBounds();\r\n\t\tlet bodyStyles = window.getComputedStyle(document.body);\r\n\t\tlet bodyPadding = {\r\n\t\t\tleft: parseFloat(bodyStyles[\"padding-left\"]) || 0,\r\n\t\t\tright: parseFloat(bodyStyles[\"padding-right\"]) || 0,\r\n\t\t\ttop: parseFloat(bodyStyles[\"padding-top\"]) || 0,\r\n\t\t\tbottom: parseFloat(bodyStyles[\"padding-bottom\"]) || 0\r\n\t\t};\r\n\r\n\t\tif (!_width) {\r\n\t\t\twidth = _windowBounds.width -\r\n\t\t\t\t\t\t\t\tbodyPadding.left -\r\n\t\t\t\t\t\t\t\tbodyPadding.right;\r\n\t\t}\r\n\r\n\t\tif ((this.settings.fullsize && !_height) || !_height) {\r\n\t\t\theight = _windowBounds.height -\r\n\t\t\t\t\t\t\t\tbodyPadding.top -\r\n\t\t\t\t\t\t\t\tbodyPadding.bottom;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\twidth: width -\r\n\t\t\t\t\t\t\tthis.containerPadding.left -\r\n\t\t\t\t\t\t\tthis.containerPadding.right,\r\n\t\t\theight: height -\r\n\t\t\t\t\t\t\tthis.containerPadding.top -\r\n\t\t\t\t\t\t\tthis.containerPadding.bottom\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tbounds(){\r\n\t\tlet box;\r\n\t\tif (this.container.style.overflow !== \"visible\") {\r\n\t\t\tbox = this.container && this.container.getBoundingClientRect();\r\n\t\t}\r\n\r\n\t\tif(!box || !box.width || !box.height) {\r\n\t\t\treturn windowBounds();\r\n\t\t} else {\r\n\t\t\treturn box;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tgetSheet(){\r\n\t\tvar style = document.createElement(\"style\");\r\n\r\n\t\t// WebKit hack --> https://davidwalsh.name/add-rules-stylesheets\r\n\t\tstyle.appendChild(document.createTextNode(\"\"));\r\n\r\n\t\tdocument.head.appendChild(style);\r\n\r\n\t\treturn style.sheet;\r\n\t}\r\n\r\n\taddStyleRules(selector, rulesArray){\r\n\t\tvar scope = \"#\" + this.id + \" \";\r\n\t\tvar rules = \"\";\r\n\r\n\t\tif(!this.sheet){\r\n\t\t\tthis.sheet = this.getSheet();\r\n\t\t}\r\n\r\n\t\trulesArray.forEach(function(set) {\r\n\t\t\tfor (var prop in set) {\r\n\t\t\t\tif(set.hasOwnProperty(prop)) {\r\n\t\t\t\t\trules += prop + \":\" + set[prop] + \";\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.sheet.insertRule(scope + selector + \" {\" + rules + \"}\", 0);\r\n\t}\r\n\r\n\taxis(axis) {\r\n\t\tif(axis === \"horizontal\") {\r\n\t\t\tthis.container.style.display = \"flex\";\r\n\t\t\tthis.container.style.flexDirection = \"row\";\r\n\t\t\tthis.container.style.flexWrap = \"nowrap\";\r\n\t\t} else {\r\n\t\t\tthis.container.style.display = \"block\";\r\n\t\t}\r\n\t\tthis.settings.axis = axis;\r\n\t}\r\n\r\n\t// orientation(orientation) {\r\n\t// \tif (orientation === \"landscape\") {\r\n\t//\r\n\t// \t} else {\r\n\t//\r\n\t// \t}\r\n\t//\r\n\t// \tthis.orientation = orientation;\r\n\t// }\r\n\r\n\tdirection(dir) {\r\n\t\tif (this.container) {\r\n\t\t\tthis.container.dir = dir;\r\n\t\t\tthis.container.style[\"direction\"] = dir;\r\n\t\t}\r\n\r\n\t\tif (this.settings.fullsize) {\r\n\t\t\tdocument.body.style[\"direction\"] = dir;\r\n\t\t}\r\n\t\tthis.settings.dir = dir;\r\n\t}\r\n\r\n\toverflow(overflow) {\r\n\t\tif (this.container) {\r\n\t\t\tif (overflow === \"scroll\" && this.settings.axis === \"vertical\") {\r\n\t\t\t\tthis.container.style[\"overflow-y\"] = overflow;\r\n\t\t\t\tthis.container.style[\"overflow-x\"] = \"hidden\";\r\n\t\t\t} else if (overflow === \"scroll\" && this.settings.axis === \"horizontal\") {\r\n\t\t\t\tthis.container.style[\"overflow-y\"] = \"hidden\";\r\n\t\t\t\tthis.container.style[\"overflow-x\"] = overflow;\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.style[\"overflow\"] = overflow;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.settings.overflow = overflow;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tvar base;\r\n\r\n\t\tif (this.element) {\r\n\r\n\t\t\tif(this.settings.hidden) {\r\n\t\t\t\tbase = this.wrapper;\r\n\t\t\t} else {\r\n\t\t\t\tbase = this.container;\r\n\t\t\t}\r\n\r\n\t\t\tif(this.element.contains(this.container)) {\r\n\t\t\t\tthis.element.removeChild(this.container);\r\n\t\t\t}\r\n\r\n\t\t\twindow.removeEventListener(\"resize\", this.resizeFunc);\r\n\t\t\twindow.removeEventListener(\"orientationChange\", this.orientationChangeFunc);\r\n\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default Stage;\r\n","class Views {\r\n\tconstructor(container) {\r\n\t\tthis.container = container;\r\n\t\tthis._views = [];\r\n\t\tthis.length = 0;\r\n\t\tthis.hidden = false;\r\n\t}\r\n\r\n\tall() {\r\n\t\treturn this._views;\r\n\t}\r\n\r\n\tfirst() {\r\n\t\treturn this._views[0];\r\n\t}\r\n\r\n\tlast() {\r\n\t\treturn this._views[this._views.length-1];\r\n\t}\r\n\r\n\tindexOf(view) {\r\n\t\treturn this._views.indexOf(view);\r\n\t}\r\n\r\n\tslice() {\r\n\t\treturn this._views.slice.apply(this._views, arguments);\r\n\t}\r\n\r\n\tget(i) {\r\n\t\treturn this._views[i];\r\n\t}\r\n\r\n\tappend(view){\r\n\t\tthis._views.push(view);\r\n\t\tif(this.container){\r\n\t\t\t\r\n\t\t\tthis.container.appendChild(view.element);\r\n\t\t}\r\n\t\tthis.length++;\r\n\t\treturn view;\r\n\t}\r\n\r\n\tprepend(view){\r\n\t\tthis._views.unshift(view);\r\n\t\tif(this.container){\r\n\t\t\tthis.container.insertBefore(view.element, this.container.firstChild);\r\n\t\t}\r\n\t\tthis.length++;\r\n\t\treturn view;\r\n\t}\r\n\r\n\tinsert(view, index) {\r\n\t\tthis._views.splice(index, 0, view);\r\n\r\n\t\tif(this.container){\r\n\t\t\tif(index < this.container.children.length){\r\n\t\t\t\tthis.container.insertBefore(view.element, this.container.children[index]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.appendChild(view.element);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.length++;\r\n\t\treturn view;\r\n\t}\r\n\r\n\tremove(view) {\r\n\t\tvar index = this._views.indexOf(view);\r\n\r\n\t\tif(index > -1) {\r\n\t\t\tthis._views.splice(index, 1);\r\n\t\t}\r\n\r\n\r\n\t\tthis.destroy(view);\r\n\r\n\t\tthis.length--;\r\n\t}\r\n\r\n\tdestroy(view) {\r\n\t\tif(view.displayed){\r\n\t\t\tview.destroy();\r\n\t\t}\r\n\t\t\r\n\t\tif(this.container){\r\n\t\t\t this.container.removeChild(view.element);\r\n\t\t}\r\n\t\tview = null;\r\n\t}\r\n\r\n\t// Iterators\r\n\r\n\tforEach() {\r\n\t\treturn this._views.forEach.apply(this._views, arguments);\r\n\t}\r\n\r\n\tclear(){\r\n\t\t// Remove all views\r\n\t\tvar view;\r\n\t\tvar len = this.length;\r\n\r\n\t\tif(!this.length) return;\r\n\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tview = this._views[i];\r\n\t\t\tthis.destroy(view);\r\n\t\t}\r\n\r\n\t\tthis._views = [];\r\n\t\tthis.length = 0;\r\n\t}\r\n\r\n\tfind(section){\r\n\r\n\t\tvar view;\r\n\t\tvar len = this.length;\r\n\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tview = this._views[i];\r\n\t\t\tif(view.displayed && view.section.index == section.index) {\r\n\t\t\t\treturn view;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tdisplayed(){\r\n\t\tvar displayed = [];\r\n\t\tvar view;\r\n\t\tvar len = this.length;\r\n\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tview = this._views[i];\r\n\t\t\tif(view.displayed){\r\n\t\t\t\tdisplayed.push(view);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn displayed;\r\n\t}\r\n\r\n\tshow(){\r\n\t\tvar view;\r\n\t\tvar len = this.length;\r\n\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tview = this._views[i];\r\n\t\t\tif(view.displayed){\r\n\t\t\t\tview.show();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.hidden = false;\r\n\t}\r\n\r\n\thide(){\r\n\t\tvar view;\r\n\t\tvar len = this.length;\r\n\r\n\t\tfor (var i = 0; i < len; i++) {\r\n\t\t\tview = this._views[i];\r\n\t\t\tif(view.displayed){\r\n\t\t\t\tview.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.hidden = true;\r\n\t}\r\n}\r\n\r\nexport default Views;\r\n","import EventEmitter from \"event-emitter\";\r\nimport { extend, defer, windowBounds, isNumber } from \"../../utils/core\";\r\nimport scrollType from \"../../utils/scrolltype\";\r\nimport Mapping from \"../../mapping\";\r\nimport Queue from \"../../utils/queue\";\r\nimport Stage from \"../helpers/stage\";\r\nimport Views from \"../helpers/views\";\r\nimport { EVENTS } from \"../../utils/constants\";\r\nimport Rendition from \"../../rendition\";\r\n\r\nclass DefaultViewManager {\r\n\tconstructor(options) {\r\n\r\n\t\tthis.name = \"default\";\r\n\t\tthis.optsSettings = options.settings;\r\n\t\tthis.View = options.view;\r\n\t\tthis.request = options.request;\r\n\t\tthis.renditionQueue = options.queue;\r\n\t\tthis.q = new Queue(this);\r\n\r\n\t\tthis.settings = extend(this.settings || {}, {\r\n\t\t\tinfinite: true,\r\n\t\t\thidden: false,\r\n\t\t\twidth: undefined,\r\n\t\t\theight: undefined,\r\n\t\t\taxis: undefined,\r\n\t\t\twritingMode: undefined,\r\n\t\t\tflow: \"scrolled\",\r\n\t\t\tignoreClass: \"\",\r\n\t\t\tfullsize: undefined\r\n\t\t});\r\n\r\n\t\textend(this.settings, options.settings || {});\r\n\r\n\t\tthis.viewSettings = {\r\n\t\t\tignoreClass: this.settings.ignoreClass,\r\n\t\t\taxis: this.settings.axis,\r\n\t\t\tflow: this.settings.flow,\r\n\t\t\tlayout: this.layout,\r\n\t\t\tmethod: this.settings.method, // srcdoc, blobUrl, write\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\tforceEvenPages: true\r\n\t\t};\r\n\r\n\t\tthis.rendered = false;\r\n\r\n\t}\r\n\r\n\trender(element, size) {\r\n\t\tlet tag = element.tagName;\r\n\r\n\t\tif (typeof this.settings.fullsize === \"undefined\" &&\r\n\t\t\ttag && (tag.toLowerCase() == \"body\" ||\r\n\t\t\t\ttag.toLowerCase() == \"html\")) {\r\n\t\t\tthis.settings.fullsize = true;\r\n\t\t}\r\n\r\n\t\tif (this.settings.fullsize) {\r\n\t\t\tthis.settings.overflow = \"visible\";\r\n\t\t\tthis.overflow = this.settings.overflow;\r\n\t\t}\r\n\r\n\t\tthis.settings.size = size;\r\n\r\n\t\tthis.settings.rtlScrollType = scrollType();\r\n\r\n\t\t// Save the stage\r\n\t\tthis.stage = new Stage({\r\n\t\t\twidth: size.width,\r\n\t\t\theight: size.height,\r\n\t\t\toverflow: this.overflow,\r\n\t\t\thidden: this.settings.hidden,\r\n\t\t\taxis: this.settings.axis,\r\n\t\t\tfullsize: this.settings.fullsize,\r\n\t\t\tdirection: this.settings.direction\r\n\t\t});\r\n\r\n\t\tthis.stage.attachTo(element);\r\n\r\n\t\t// Get this stage container div\r\n\t\tthis.container = this.stage.getContainer();\r\n\r\n\t\t// Views array methods\r\n\t\tthis.views = new Views(this.container);\r\n\r\n\t\t// Calculate Stage Size\r\n\t\tthis._bounds = this.bounds();\r\n\t\tthis._stageSize = this.stage.size();\r\n\r\n\t\t// Set the dimensions for views\r\n\t\tthis.viewSettings.width = this._stageSize.width;\r\n\t\tthis.viewSettings.height = this._stageSize.height;\r\n\r\n\t\t// Function to handle a resize event.\r\n\t\t// Will only attach if width and height are both fixed.\r\n\t\tthis.stage.onResize(this.onResized.bind(this));\r\n\r\n\t\tthis.stage.onOrientationChange(this.onOrientationChange.bind(this));\r\n\r\n\t\t// Add Event Listeners\r\n\t\tthis.addEventListeners();\r\n\r\n\t\t// Add Layout method\r\n\t\t// this.applyLayoutMethod();\r\n\t\tif (this.layout) {\r\n\t\t\tthis.updateLayout();\r\n\t\t}\r\n\r\n\t\tthis.rendered = true;\r\n\r\n\t}\r\n\r\n\taddEventListeners() {\r\n\t\tvar scroller;\r\n\r\n\t\twindow.addEventListener(\"unload\", function (e) {\r\n\t\t\tthis.destroy();\r\n\t\t}.bind(this));\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscroller = this.container;\r\n\t\t} else {\r\n\t\t\tscroller = window;\r\n\t\t}\r\n\r\n\t\tthis._onScroll = this.onScroll.bind(this);\r\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\r\n\t}\r\n\r\n\tremoveEventListeners() {\r\n\t\tvar scroller;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscroller = this.container;\r\n\t\t} else {\r\n\t\t\tscroller = window;\r\n\t\t}\r\n\r\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\r\n\t\tthis._onScroll = undefined;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tclearTimeout(this.orientationTimeout);\r\n\t\tclearTimeout(this.resizeTimeout);\r\n\t\tclearTimeout(this.afterScrolled);\r\n\r\n\t\tthis.clear();\r\n\r\n\t\tthis.removeEventListeners();\r\n\r\n\t\tthis.stage.destroy();\r\n\r\n\t\tthis.rendered = false;\r\n\r\n\t\t/*\r\n\r\n\t\t\tclearTimeout(this.trimTimeout);\r\n\t\t\tif(this.settings.hidden) {\r\n\t\t\t\tthis.element.removeChild(this.wrapper);\r\n\t\t\t} else {\r\n\t\t\t\tthis.element.removeChild(this.container);\r\n\t\t\t}\r\n\t\t*/\r\n\t}\r\n\r\n\tonOrientationChange(e) {\r\n\t\tlet { orientation } = window;\r\n\r\n\t\tif (this.optsSettings.resizeOnOrientationChange) {\r\n\t\t\tthis.resize();\r\n\t\t}\r\n\r\n\t\t// Per ampproject:\r\n\t\t// In IOS 10.3, the measured size of an element is incorrect if the\r\n\t\t// element size depends on window size directly and the measurement\r\n\t\t// happens in window.resize event. Adding a timeout for correct\r\n\t\t// measurement. See https://github.com/ampproject/amphtml/issues/8479\r\n\t\tclearTimeout(this.orientationTimeout);\r\n\t\tthis.orientationTimeout = setTimeout(function () {\r\n\t\t\tthis.orientationTimeout = undefined;\r\n\r\n\t\t\tif (this.optsSettings.resizeOnOrientationChange) {\r\n\t\t\t\tthis.resize();\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(EVENTS.MANAGERS.ORIENTATION_CHANGE, orientation);\r\n\t\t}.bind(this), 500);\r\n\r\n\t}\r\n\r\n\tonResized(e) {\r\n\r\n\t\tthis.resize();\r\n\t}\r\n\r\n\tresize(width, height, epubcfi) {\r\n\t\tlet stageSize = this.stage.size(width, height);\r\n\r\n\t\t// For Safari, wait for orientation to catch up\r\n\t\t// if the window is a square\r\n\t\tthis.winBounds = windowBounds();\r\n\t\tif (this.orientationTimeout &&\r\n\t\t\tthis.winBounds.width === this.winBounds.height) {\r\n\t\t\t// reset the stage size for next resize\r\n\t\t\tthis._stageSize = undefined;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this._stageSize &&\r\n\t\t\tthis._stageSize.width === stageSize.width &&\r\n\t\t\tthis._stageSize.height === stageSize.height) {\r\n\t\t\t// Size is the same, no need to resize\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._stageSize = stageSize;\r\n\r\n\t\tthis._bounds = this.bounds();\r\n\r\n\t\t// Clear current views\r\n\t\tthis.clear();\r\n\r\n\t\t// Update for new views\r\n\t\tthis.viewSettings.width = this._stageSize.width;\r\n\t\tthis.viewSettings.height = this._stageSize.height;\r\n\r\n\t\tthis.updateLayout();\r\n\r\n\t\tthis.emit(EVENTS.MANAGERS.RESIZED, {\r\n\t\t\twidth: this._stageSize.width,\r\n\t\t\theight: this._stageSize.height\r\n\t\t}, epubcfi);\r\n\t}\r\n\r\n\tcreateView(section, forceRight) {\r\n\t\treturn new this.View(section, extend(this.viewSettings, { forceRight }));\r\n\t}\r\n\r\n\thandleNextPrePaginated(forceRight, section, action) {\r\n\t\tlet next;\r\n\r\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\r\n\t\t\tif (forceRight || section.index === 0) {\r\n\t\t\t\t// First page (cover) should stand alone for pre-paginated books\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tnext = section.next();\r\n\t\t\tif (next && !next.properties.includes(\"page-spread-left\")) {\r\n\t\t\t\treturn action.call(this, next);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tdisplay(section, target) {\r\n\r\n\t\t//김병현 주석 moveto \r\n\t\tvar displaying = new defer();\r\n\t\tvar displayed = displaying.promise;\r\n\r\n\t\t// Check if moving to target is needed\r\n\t\tif (target === section.href || isNumber(target)) {\r\n\t\t\ttarget = undefined;\r\n\t\t}\r\n\r\n\t\t// Check to make sure the section we want isn't already shown\r\n\t\tvar visible = this.views.find(section);\r\n\r\n\t\t// View is already shown, just move to correct location in view\r\n\t\tif (visible && section && this.layout.name !== \"pre-paginated\") {\r\n\t\t\tlet offset = visible.offset();\r\n\r\n\t\t\tif (this.settings.direction === \"ltr\") {\r\n\t\t\t\tthis.scrollTo(offset.left, offset.top, true);\r\n\t\t\t} else {\r\n\t\t\t\tlet width = visible.width();\r\n\t\t\t\tthis.scrollTo(offset.left + width, offset.top, true);\r\n\t\t\t}\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tif (target) {\r\n\t\t\t\t\tlet offset = visible.locationOf(target);\r\n\t\t\t\t\tlet width = visible.width();\r\n\t\t\t\t\tthis.moveTo(offset, width);\r\n\t\t\t\t\tlet reportEvent = new CustomEvent(\"reportEvent\");\r\n\t\t\t\t\tdocument.dispatchEvent(reportEvent);\r\n\t\t\t\t}\r\n\t\t\t}, 100)\r\n\t\t\tdisplaying.resolve();\r\n\t\t\treturn displayed;\r\n\t\t}\r\n\r\n\t\t// Hide all current views\r\n\t\tthis.clear();\r\n\r\n\t\tlet forceRight = false;\r\n\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && section.properties.includes(\"page-spread-right\")) {\r\n\t\t\tforceRight = true;\r\n\t\t}\r\n\r\n\t\tthis.add(section, forceRight)\r\n\t\t\t.then(function (view) {\r\n\t\t\t\t// Move to correct place within the section, if needed\r\n\t\t\t\t\r\n\t\t\t\t//김병현 추가 window settimeout \r\n\t\t\t\t\r\n\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\tif (target) {\r\n\t\t\t\t\t\tlet offset = view.locationOf(target);\r\n\t\t\t\t\t\tlet width = view.width();\r\n\t\t\t\t\t\tthis.moveTo(offset, width);\r\n\r\n\t\t\t\t\t\tlet reportEvent = new CustomEvent(\"reportEvent\");\r\n\t\t\t\t\t\tdocument.dispatchEvent(reportEvent);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 500)\r\n\t\t\t}.bind(this), (err) => {\r\n\t\t\t\tdisplaying.reject(err);\r\n\t\t\t})\r\n\t\t\t.then(function () {\r\n\t\t\t\treturn this.handleNextPrePaginated(forceRight, section, this.add);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function () {\r\n\r\n\t\t\t\tthis.views.show();\r\n\r\n\t\t\t\tdisplaying.resolve();\r\n\r\n\t\t\t}.bind(this));\r\n\t\t// .then(function(){\r\n\t\t// \treturn this.hooks.display.trigger(view);\r\n\t\t// }.bind(this))\r\n\t\t// .then(function(){\r\n\t\t// \tthis.views.show();\r\n\t\t// }.bind(this));\r\n\t\treturn displayed;\r\n\t}\r\n\r\n\tafterDisplayed(view) {\r\n\t\tthis.emit(EVENTS.MANAGERS.ADDED, view);\r\n\t}\r\n\r\n\tafterResized(view) {\r\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\r\n\t}\r\n\r\n\tmoveTo(offset, width) {\r\n\t\tvar distX = 0,\r\n\t\t\tdistY = 0;\r\n\r\n\t\tif (!this.isPaginated) {\r\n\t\t\tdistY = offset.top;\r\n\t\t} else {\r\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\r\n\r\n\t\t\tif (distX + this.layout.delta > this.container.scrollWidth) {\r\n\t\t\t\tdistX = this.container.scrollWidth - this.layout.delta;\r\n\t\t\t}\r\n\r\n\t\t\tdistY = Math.floor(offset.top / this.layout.delta) * this.layout.delta;\r\n\r\n\t\t\tif (distY + this.layout.delta > this.container.scrollHeight) {\r\n\t\t\t\tdistY = this.container.scrollHeight - this.layout.delta;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (this.settings.direction === 'rtl') {\r\n\t\t\t/***\r\n\t\t\t\tthe `floor` function above (L343) is on positive values, so we should add one `layout.delta` \r\n\t\t\t\tto distX or use `Math.ceil` function, or multiply offset.left by -1\r\n\t\t\t\tbefore `Math.floor`\r\n\t\t\t*/\r\n\t\t\tdistX = distX + this.layout.delta\r\n\t\t\tdistX = distX - width\r\n\t\t}\r\n\t\tthis.scrollTo(distX, distY, true);\r\n\t}\r\n\r\n\tadd(section, forceRight) {\r\n\t\tvar view = this.createView(section, forceRight);\r\n\r\n\t\tthis.views.prepend(view);\r\n\r\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\t\tview.onResize = this.afterResized.bind(this);\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\treturn view.display(this.request);\r\n\t}\r\n\r\n\tappend(section, forceRight) {\r\n\t\tvar view = this.createView(section, forceRight);\r\n\t\tthis.views.prepend(view);\r\n\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\t\tview.onResize = this.afterResized.bind(this);\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\treturn view.display(this.request);\r\n\t}\r\n\r\n\tprepend(section, forceRight) {\r\n\r\n\t\tvar view = this.createView(section, forceRight);\r\n\r\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\r\n\t\t\t//김병현 추가\t\t\r\n\t\t\tif (document.getElementsByClassName(\"epub-container\")[0].classList.contains(\"ios-container\")) return;\r\n\t\t\tthis.counter(bounds);\r\n\t\t});\r\n\r\n\t\tthis.views.prepend(view);\r\n\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\t\tview.onResize = this.afterResized.bind(this);\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\treturn view.display(this.request);\r\n\t}\r\n\r\n\tcounter(bounds) {\r\n\t\tif (this.settings.axis === \"vertical\") {\r\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\r\n\t\t} else {\r\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// resizeView(view) {\r\n\t//\r\n\t// \tif(this.settings.globalLayoutProperties.layout === \"pre-paginated\") {\r\n\t// \t\tview.lock(\"both\", this.bounds.width, this.bounds.height);\r\n\t// \t} else {\r\n\t// \t\tview.lock(\"width\", this.bounds.width, this.bounds.height);\r\n\t// \t}\r\n\t//\r\n\t// };\r\n\r\n\tnext() {\r\n\t\tvar next;\r\n\t\tvar left;\r\n\r\n\t\tlet dir = this.settings.direction;\r\n\r\n\t\tif (!this.views.length) return;\r\n\r\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\r\n\r\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth + this.layout.delta;\r\n\r\n\t\t\tif (left <= this.container.scrollWidth) {\r\n\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\r\n\t\t\t} else {\r\n\t\t\t\tnext = this.views.last().section.next();\r\n\t\t\t}\r\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\r\n\r\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\t\tif (this.settings.rtlScrollType === \"default\") {\r\n\t\t\t\tleft = this.container.scrollLeft;\r\n\r\n\t\t\t\tif (left > 0) {\r\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext = this.views.last().section.next();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tleft = this.container.scrollLeft + (this.layout.delta * -1);\r\n\r\n\t\t\t\tif (left > this.container.scrollWidth * -1) {\r\n\t\t\t\t\tthis.scrollBy(this.layout.delta, 0, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnext = this.views.last().section.next();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\r\n\r\n\t\t\tthis.scrollTop = this.container.scrollTop;\r\n\r\n\t\t\tlet top = this.container.scrollTop + this.container.offsetHeight;\r\n\r\n\t\t\tif (top < this.container.scrollHeight) {\r\n\t\t\t\tthis.scrollBy(0, this.layout.height, true);\r\n\t\t\t} else {\r\n\t\t\t\tnext = this.views.last().section.next();\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tnext = this.views.last().section.next();\r\n\t\t}\r\n\r\n\t\tif (next) {\r\n\t\t\tthis.clear();\r\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\r\n\t\t\tthis.updateLayout();\r\n\r\n\t\t\tlet forceRight = false;\r\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && next.properties.includes(\"page-spread-right\")) {\r\n\t\t\t\tforceRight = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.append(next, forceRight)\r\n\t\t\t\t.then(function () {\r\n\t\t\t\t\treturn this.handleNextPrePaginated(forceRight, next, this.append);\r\n\t\t\t\t}.bind(this), (err) => {\r\n\t\t\t\t\treturn err;\r\n\t\t\t\t})\r\n\t\t\t\t.then(function () {\r\n\t\t\t\t\t// Reset position to start for scrolled-doc vertical-rl in default mode\r\n\t\t\t\t\tif (!this.isPaginated &&\r\n\t\t\t\t\t\tthis.settings.axis === \"horizontal\" &&\r\n\t\t\t\t\t\tthis.settings.direction === \"rtl\" &&\r\n\t\t\t\t\t\tthis.settings.rtlScrollType === \"default\") {\r\n\r\n\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth, 0, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//김병현 주석\r\n\t\t\t\t\t// this.views.show();\r\n\t\t\t\t}.bind(this));\r\n\t\t}\r\n\t\telse {\r\n\t\t}\r\n\t}\r\n\r\n\tprev() {\r\n\t\tvar prev;\r\n\t\tvar left;\r\n\t\tlet dir = this.settings.direction;\r\n\r\n\t\tif (!this.views.length) return;\r\n\r\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\" && (!dir || dir === \"ltr\")) {\r\n\r\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\t\tleft = this.container.scrollLeft;\r\n\r\n\t\t\tif (left > 0) {\r\n\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\r\n\t\t\t} else {\r\n\t\t\t\tprev = this.views.first().section.prev();\r\n\t\t\t}\r\n\r\n\t\t} else if (this.isPaginated && this.settings.axis === \"horizontal\" && dir === \"rtl\") {\r\n\r\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\r\n\t\t\tif (this.settings.rtlScrollType === \"default\") {\r\n\t\t\t\tleft = this.container.scrollLeft + this.container.offsetWidth;\r\n\r\n\t\t\t\tif (left < this.container.scrollWidth) {\r\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprev = this.views.first().section.prev();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tleft = this.container.scrollLeft;\r\n\r\n\t\t\t\tif (left < 0) {\r\n\t\t\t\t\tthis.scrollBy(-this.layout.delta, 0, true);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tprev = this.views.first().section.prev();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else if (this.isPaginated && this.settings.axis === \"vertical\") {\r\n\r\n\t\t\tthis.scrollTop = this.container.scrollTop;\r\n\r\n\t\t\tlet top = this.container.scrollTop;\r\n\r\n\t\t\tif (top > 0) {\r\n\t\t\t\tthis.scrollBy(0, -(this.layout.height), true);\r\n\t\t\t} else {\r\n\t\t\t\tprev = this.views.first().section.prev();\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tprev = this.views.first().section.prev();\r\n\r\n\t\t}\r\n\r\n\t\tif (prev) {\r\n\t\t\tthis.clear();\r\n\t\t\t// The new section may have a different writing-mode from the old section. Thus, we need to update layout.\r\n\t\t\tthis.updateLayout();\r\n\r\n\t\t\tlet forceRight = false;\r\n\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor === 2 && typeof prev.prev() !== \"object\") {\r\n\t\t\t\tforceRight = true;\r\n\t\t\t}\r\n\r\n\t\t\treturn this.prepend(prev, forceRight)\r\n\t\t\t\t.then(function () {\r\n\t\t\t\t\tvar left;\r\n\t\t\t\t\tif (this.layout.name === \"pre-paginated\" && this.layout.divisor > 1) {\r\n\t\t\t\t\t\tleft = prev.prev();\r\n\t\t\t\t\t\tif (left) {\r\n\t\t\t\t\t\t\treturn this.prepend(left);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}.bind(this), (err) => {\r\n\t\t\t\t\treturn err;\r\n\t\t\t\t})\r\n\t\t\t\t.then(function () {\r\n\t\t\t\t\t// window.requestAnimationFrame(()=>{\r\n\r\n\t\t\t\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\r\n\t\t\t\t\t\tif (this.settings.direction === \"rtl\") {\r\n\t\t\t\t\t\t\tif (this.settings.rtlScrollType === \"default\") {\r\n\t\t\t\t\t\t\t\tthis.scrollTo(0, 0, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.scrollTo((this.container.scrollWidth * -1) + this.layout.delta, 0, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.scrollTo(this.container.scrollWidth, 0, true);\r\n\t\t\t\t\t\t\t// this.scrollTo(this.container.scrollWidth, 0, true);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// this.views.show();\r\n\r\n\t\t\t\t\tthis.container.prev = true;\r\n\t\t\t\t\t// });\r\n\r\n\t\t\t\t}.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\tcurrent() {\r\n\t\tvar visible = this.visible();\r\n\t\tif (visible.length) {\r\n\t\t\t// Current is the last visible view\r\n\t\t\treturn visible[visible.length - 1];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tclear() {\r\n\r\n\t\t// this.q.clear();\r\n\r\n\t\tif (this.views) {\r\n\t\t\tthis.views.hide();\r\n\t\t\t//김병현 주석\r\n\t\t\t// this.scrollTo(0,0, true);\r\n\t\t\tthis.views.clear();\r\n\t\t}\r\n\t}\r\n\r\n\tcurrentLocation() {\r\n\r\n\t\tthis.updateLayout();\r\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\r\n\t\t\tthis.location = this.paginatedLocation();\r\n\t\t} else {\r\n\t\t\tthis.location = this.scrolledLocation();\r\n\t\t}\r\n\t\treturn this.location;\r\n\t}\r\n\r\n\tscrolledLocation() {\r\n\t\tlet visible = this.visible();\r\n\t\tlet container = this.container.getBoundingClientRect();\r\n\t\tlet pageHeight = (container.height < document.documentElement.clientHeight) ? container.height : document.documentElement.clientHeight;\r\n\t\tlet pageWidth = (container.width < document.documentElement.clientWidth) ? container.width : document.documentElement.clientWidth;\r\n\t\tlet vertical = (this.settings.axis === \"vertical\");\r\n\t\tlet rtl = (this.settings.direction === \"rtl\");\r\n\r\n\t\tlet offset = 0;\r\n\t\tlet used = 0;\r\n\r\n\t\tif (this.settings.fullsize) {\r\n\t\t\toffset = vertical ? window.scrollY : window.scrollX;\r\n\t\t}\r\n\r\n\t\tlet sections = visible.map((view) => {\r\n\t\t\tlet { index, href } = view.section;\r\n\t\t\tlet position = view.position();\r\n\t\t\tlet width = view.width();\r\n\t\t\tlet height = view.height();\r\n\r\n\t\t\tlet startPos;\r\n\t\t\tlet endPos;\r\n\t\t\tlet stopPos;\r\n\t\t\tlet totalPages;\r\n\r\n\t\t\tif (vertical) {\r\n\t\t\t\tstartPos = offset + container.top - position.top + used;\r\n\t\t\t\tendPos = startPos + pageHeight - used;\r\n\t\t\t\ttotalPages = this.layout.count(height, pageHeight).pages;\r\n\t\t\t\tstopPos = pageHeight;\r\n\t\t\t} else {\r\n\t\t\t\tstartPos = offset + container.left - position.left + used;\r\n\t\t\t\tendPos = startPos + pageWidth - used;\r\n\t\t\t\ttotalPages = this.layout.count(width, pageWidth).pages;\r\n\t\t\t\tstopPos = pageWidth;\r\n\t\t\t}\r\n\r\n\t\t\tlet currPage = Math.ceil(startPos / stopPos);\r\n\t\t\tlet pages = [];\r\n\t\t\tlet endPage = Math.ceil(endPos / stopPos);\r\n\r\n\t\t\t// Reverse page counts for horizontal rtl\r\n\t\t\tif (this.settings.direction === \"rtl\" && !vertical) {\r\n\t\t\t\tlet tempStartPage = currPage;\r\n\t\t\t\tcurrPage = totalPages - endPage;\r\n\t\t\t\tendPage = totalPages - tempStartPage;\r\n\t\t\t}\r\n\r\n\t\t\tpages = [];\r\n\t\t\tfor (var i = currPage; i <= endPage; i++) {\r\n\t\t\t\tlet pg = i + 1;\r\n\t\t\t\tpages.push(pg);\r\n\t\t\t}\r\n\r\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, startPos, endPos);\r\n\r\n\t\t\treturn {\r\n\t\t\t\tindex,\r\n\t\t\t\thref,\r\n\t\t\t\tpages,\r\n\t\t\t\ttotalPages,\r\n\t\t\t\tmapping\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn sections;\r\n\t}\r\n\r\n\tpaginatedLocation() {\r\n\t\tlet visible = this.visible();\r\n\t\tlet container = this.container.getBoundingClientRect();\r\n\r\n\t\tlet left = 0;\r\n\t\tlet used = 0;\r\n\r\n\t\tif (this.settings.fullsize) {\r\n\t\t\tleft = window.scrollX;\r\n\t\t}\r\n\r\n\t\tlet sections = visible.map((view) => {\r\n\t\t\tlet { index, href } = view.section;\r\n\t\t\tlet offset;\r\n\t\t\tlet position = view.position();\r\n\t\t\tlet width = view.width();\r\n\r\n\t\t\t// Find mapping\r\n\t\t\tlet start;\r\n\t\t\tlet end;\r\n\t\t\tlet pageWidth;\r\n\r\n\t\t\tif (this.settings.direction === \"rtl\") {\r\n\t\t\t\toffset = container.right - left;\r\n\t\t\t\tpageWidth = Math.min(Math.abs(offset - position.left), this.layout.width) - used;\r\n\t\t\t\tend = position.width - (position.right - offset) - used;\r\n\t\t\t\tstart = end - pageWidth;\r\n\t\t\t} else {\r\n\t\t\t\toffset = container.left + left;\r\n\t\t\t\tpageWidth = Math.min(position.right - offset, this.layout.width) - used;\r\n\t\t\t\tstart = offset - position.left + used;\r\n\t\t\t\tend = start + pageWidth;\r\n\t\t\t}\r\n\r\n\t\t\tused += pageWidth;\r\n\r\n\t\t\tlet mapping = this.mapping.page(view.contents, view.section.cfiBase, start, end);\r\n\r\n\t\t\tlet totalPages = this.layout.count(width).pages;\r\n\t\t\tlet startPage = Math.floor(start / this.layout.pageWidth);\r\n\t\t\tlet pages = [];\r\n\t\t\tlet endPage = Math.floor(end / this.layout.pageWidth);\r\n\r\n\t\t\t// start page should not be negative\r\n\t\t\tif (startPage < 0) {\r\n\t\t\t\tstartPage = 0;\r\n\t\t\t\tendPage = endPage + 1;\r\n\t\t\t}\r\n\r\n\t\t\t// Reverse page counts for rtl\r\n\t\t\tif (this.settings.direction === \"rtl\") {\r\n\t\t\t\tlet tempStartPage = startPage;\r\n\t\t\t\tstartPage = totalPages - endPage;\r\n\t\t\t\tendPage = totalPages - tempStartPage;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tfor (var i = startPage + 1; i <= endPage; i++) {\r\n\t\t\t\tlet pg = i;\r\n\t\t\t\tpages.push(pg);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tindex,\r\n\t\t\t\thref,\r\n\t\t\t\tpages,\r\n\t\t\t\ttotalPages,\r\n\t\t\t\tmapping\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn sections;\r\n\t}\r\n\r\n\tisVisible(view, offsetPrev, offsetNext, _container) {\r\n\t\tvar position = view.position();\r\n\t\tvar container = _container || this.bounds();\r\n\r\n\t\tif (this.settings.axis === \"horizontal\" &&\r\n\t\t\tposition.right > container.left - offsetPrev &&\r\n\t\t\tposition.left < container.right + offsetNext) {\r\n\r\n\t\t\treturn true;\r\n\r\n\t\t} else if (this.settings.axis === \"vertical\" &&\r\n\t\t\tposition.bottom > container.top - offsetPrev &&\r\n\t\t\tposition.top < container.bottom + offsetNext) {\r\n\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\tvisible() {\r\n\t\tvar container = this.bounds();\r\n\t\tvar views = this.views.displayed();\r\n\t\tvar viewsLength = views.length;\r\n\t\tvar visible = [];\r\n\t\tvar isVisible;\r\n\t\tvar view;\r\n\r\n\t\tfor (var i = 0; i < viewsLength; i++) {\r\n\t\t\tview = views[i];\r\n\t\t\tisVisible = this.isVisible(view, 0, 0, container);\r\n\r\n\t\t\tif (isVisible === true) {\r\n\t\t\t\tvisible.push(view);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn visible;\r\n\t}\r\n\r\n\tscrollBy(x, y, silent) {\r\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\r\n\r\n\t\tif (silent) {\r\n\t\t\tthis.ignore = true;\r\n\t\t}\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tif (x) this.container.scrollLeft += x * dir;\r\n\t\t\tif (y) {\r\n\t\t\t\tif (this.container.scrollTop <= this.settings.offset) {\r\n\t\t\t\t\tthis.container.scrollTop += y;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twindow.scrollBy(x * dir, y * dir);\r\n\t\t}\r\n\t\tthis.scrolled = true;\r\n\t}\r\n\r\n\tscrollBy2(x, y, silent) {\r\n\t\tlet dir = this.settings.direction === \"rtl\" ? -1 : 1;\r\n\r\n\t\tif (silent) {\r\n\t\t\tthis.ignore = true;\r\n\t\t}\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tif (x) this.container.scrollLeft += x * dir;\r\n\t\t\tif (y) {\r\n\r\n\t\t\t\tthis.container.scrollTop += y;\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\twindow.scrollBy(x * dir, y * dir);\r\n\t\t}\r\n\t\tthis.scrolled = true;\r\n\t}\r\n\r\n\tscrollTo(x, y, silent) {\r\n\r\n\t\tif (silent) {\r\n\t\t\tthis.ignore = true;\r\n\t\t}\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tthis.container.scrollLeft = x;\r\n\t\t\tthis.container.scrollTop = y;\r\n\t\t}\r\n\t\telse {\r\n\t\t\twindow.scrollTo(x, y);\r\n\t\t}\r\n\t\tthis.scrolled = true;\r\n\t}\r\n\r\n\tonScroll() {\r\n\t\tlet scrollTop;\r\n\t\tlet scrollLeft;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscrollTop = this.container.scrollTop;\r\n\t\t\tscrollLeft = this.container.scrollLeft;\r\n\t\t} else {\r\n\t\t\tscrollTop = window.scrollY;\r\n\t\t\tscrollLeft = window.scrollX;\r\n\t\t}\r\n\r\n\t\tthis.scrollTop = scrollTop;\r\n\t\tthis.scrollLeft = scrollLeft;\r\n\r\n\t\tif (!this.ignore) {\r\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\r\n\t\t\t\ttop: scrollTop,\r\n\t\t\t\tleft: scrollLeft\r\n\t\t\t});\r\n\r\n\t\t\tclearTimeout(this.afterScrolled);\r\n\t\t\tthis.afterScrolled = setTimeout(function () {\r\n\t\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\r\n\t\t\t\t\ttop: this.scrollTop,\r\n\t\t\t\t\tleft: this.scrollLeft\r\n\t\t\t\t});\r\n\t\t\t}.bind(this), 20);\r\n\r\n\r\n\r\n\t\t} else {\r\n\t\t\tthis.ignore = false;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tbounds() {\r\n\t\tvar bounds;\r\n\r\n\t\tbounds = this.stage.bounds();\r\n\r\n\t\treturn bounds;\r\n\t}\r\n\r\n\tapplyLayout(layout) {\r\n\r\n\t\tthis.layout = layout;\r\n\t\tthis.updateLayout();\r\n\t\tif (this.views && this.views.length > 0 && this.layout.name === \"pre-paginated\") {\r\n\t\t\tthis.display(this.views.first().section);\r\n\t\t}\r\n\t\t// this.manager.layout(this.layout.format);\r\n\t}\r\n\r\n\tupdateLayout() {\r\n\r\n\t\tif (!this.stage) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._stageSize = this.stage.size();\r\n\r\n\t\tif (!this.isPaginated) {\r\n\t\t\tthis.layout.calculate(this._stageSize.width, this._stageSize.height);\r\n\t\t} else {\r\n\t\t\tthis.layout.calculate(\r\n\t\t\t\tthis._stageSize.width,\r\n\t\t\t\tthis._stageSize.height,\r\n\t\t\t\tthis.settings.gap\r\n\t\t\t);\r\n\r\n\t\t\t// Set the look ahead offset for what is visible\r\n\t\t\tthis.settings.offset = this.layout.delta / this.layout.divisor;\r\n\r\n\t\t\t// this.stage.addStyleRules(\"iframe\", [{\"margin-right\" : this.layout.gap + \"px\"}]);\r\n\r\n\t\t}\r\n\r\n\t\t// Set the dimensions for views\r\n\t\tthis.viewSettings.width = this.layout.width;\r\n\t\tthis.viewSettings.height = this.layout.height;\r\n\r\n\t\tthis.setLayout(this.layout);\r\n\r\n\t}\r\n\r\n\tsetLayout(layout) {\r\n\r\n\t\tthis.viewSettings.layout = layout;\r\n\r\n\t\tthis.mapping = new Mapping(layout.props, this.settings.direction, this.settings.axis);\r\n\r\n\t\tif (this.views) {\r\n\r\n\t\t\tthis.views.forEach(function (view) {\r\n\t\t\t\tif (view) {\r\n\t\t\t\t\tview.setLayout(layout);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdateWritingMode(mode) {\r\n\t\tthis.writingMode = mode;\r\n\t}\r\n\r\n\tupdateAxis(axis, forceUpdate) {\r\n\r\n\t\tif (!forceUpdate && axis === this.settings.axis) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.settings.axis = axis;\r\n\r\n\t\tthis.stage && this.stage.axis(axis);\r\n\r\n\t\tthis.viewSettings.axis = axis;\r\n\r\n\t\tif (this.mapping) {\r\n\t\t\tthis.mapping = new Mapping(this.layout.props, this.settings.direction, this.settings.axis);\r\n\t\t}\r\n\r\n\t\tif (this.layout) {\r\n\t\t\tif (axis === \"vertical\") {\r\n\t\t\t\tthis.layout.spread(\"none\");\r\n\t\t\t} else {\r\n\t\t\t\tthis.layout.spread(this.layout.settings.spread);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tupdateFlow(flow, defaultScrolledOverflow = \"auto\") {\r\n\t\tlet isPaginated = (flow === \"paginated\" || flow === \"auto\");\r\n\r\n\t\tthis.isPaginated = isPaginated;\r\n\r\n\t\tif (flow === \"scrolled-doc\" ||\r\n\t\t\tflow === \"scrolled-continuous\" ||\r\n\t\t\tflow === \"scrolled\") {\r\n\t\t\tthis.updateAxis(\"vertical\");\r\n\t\t} else {\r\n\t\t\tthis.updateAxis(\"horizontal\");\r\n\t\t}\r\n\r\n\t\tthis.viewSettings.flow = flow;\r\n\r\n\t\tif (!this.settings.overflow) {\r\n\t\t\tthis.overflow = isPaginated ? \"hidden\" : defaultScrolledOverflow;\r\n\t\t} else {\r\n\t\t\tthis.overflow = this.settings.overflow;\r\n\t\t}\r\n\r\n\t\tthis.stage && this.stage.overflow(this.overflow);\r\n\r\n\t\tthis.updateLayout();\r\n\r\n\t}\r\n\r\n\tgetContents() {\r\n\r\n\t\tvar contents = [];\r\n\t\tif (!this.views) {\r\n\t\t\treturn contents;\r\n\t\t}\r\n\t\tthis.views.forEach(function (view) {\r\n\t\t\tconst viewContents = view && view.contents;\r\n\t\t\tif (viewContents) {\r\n\t\t\t\tcontents.push(viewContents);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn contents;\r\n\t}\r\n\r\n\tgetAllContents() {\r\n\r\n\t\tvar contents = [];\r\n\r\n\t\tthis.views.forEach(function (view) {\r\n\r\n\r\n\t\t\tcontents.push(view);\r\n\r\n\t\t});\r\n\t\treturn contents;\r\n\t}\r\n\r\n\tdirection(dir = \"ltr\") {\r\n\t\tthis.settings.direction = dir;\r\n\r\n\t\tthis.stage && this.stage.direction(dir);\r\n\r\n\t\tthis.viewSettings.direction = dir;\r\n\r\n\t\tthis.updateLayout();\r\n\t}\r\n\r\n\tisRendered() {\r\n\t\treturn this.rendered;\r\n\t}\r\n}\r\n\r\n//-- Enable binding events to Manager\r\nEventEmitter(DefaultViewManager.prototype);\r\n\r\nexport default DefaultViewManager;\r\n","import EpubCFI from \"./epubcfi\";\r\nimport { nodeBounds } from \"./utils/core\";\r\n\r\n/**\r\n * Map text locations to CFI ranges\r\n * @class\r\n * @param {Layout} layout Layout to apply\r\n * @param {string} [direction=\"ltr\"] Text direction\r\n * @param {string} [axis=\"horizontal\"] vertical or horizontal axis\r\n * @param {boolean} [dev] toggle developer highlighting\r\n */\r\nclass Mapping {\r\n\tconstructor(layout, direction, axis, dev=false) {\r\n\t\tthis.layout = layout;\r\n\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\r\n\t\tthis.direction = direction || \"ltr\";\r\n\t\tthis._dev = dev;\r\n\t}\r\n\r\n\t/**\r\n\t * Find CFI pairs for entire section at once\r\n\t */\r\n\tsection(view) {\r\n\t\tvar ranges = this.findRanges(view);\r\n\t\tvar map = this.rangeListToCfiList(view.section.cfiBase, ranges);\r\n\r\n\t\treturn map;\r\n\t}\r\n\r\n\t/**\r\n\t * Find CFI pairs for a page\r\n\t * @param {Contents} contents Contents from view\r\n\t * @param {string} cfiBase string of the base for a cfi\r\n\t * @param {number} start position to start at\r\n\t * @param {number} end position to end at\r\n\t */\r\n\tpage(contents, cfiBase, start, end) {\r\n\t\tvar root = contents && contents.document ? contents.document.body : false;\r\n\t\tvar result;\r\n\r\n\t\tif (!root) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tresult = this.rangePairToCfiPair(cfiBase, {\r\n\t\t\tstart: this.findStart(root, start, end),\r\n\t\t\tend: this.findEnd(root, start, end)\r\n\t\t});\r\n\r\n\t\tif (this._dev === true) {\r\n\t\t\tlet doc = contents.document;\r\n\t\t\tlet startRange = new EpubCFI(result.start).toRange(doc);\r\n\t\t\tlet endRange = new EpubCFI(result.end).toRange(doc);\r\n\r\n\t\t\tlet selection = doc.defaultView.getSelection();\r\n\t\t\tlet r = doc.createRange();\r\n\t\t\tselection.removeAllRanges();\r\n\t\t\tr.setStart(startRange.startContainer, startRange.startOffset);\r\n\t\t\tr.setEnd(endRange.endContainer, endRange.endOffset);\r\n\t\t\tselection.addRange(r);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Walk a node, preforming a function on each node it finds\r\n\t * @private\r\n\t * @param {Node} root Node to walkToNode\r\n\t * @param {function} func walk function\r\n\t * @return {*} returns the result of the walk function\r\n\t */\r\n\twalk(root, func) {\r\n\t\t// IE11 has strange issue, if root is text node IE throws exception on\r\n\t\t// calling treeWalker.nextNode(), saying\r\n\t\t// Unexpected call to method or property access instead of returing null value\r\n\t\tif(root && root.nodeType === Node.TEXT_NODE) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// safeFilter is required so that it can work in IE as filter is a function for IE\r\n\t\t// and for other browser filter is an object.\r\n\t\tvar filter = {\r\n\t\t\tacceptNode: function(node) {\r\n\t\t\t\tif (node.data.trim().length > 0) {\r\n\t\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn NodeFilter.FILTER_REJECT;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tvar safeFilter = filter.acceptNode;\r\n\t\tsafeFilter.acceptNode = filter.acceptNode;\r\n\r\n\t\tvar treeWalker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, safeFilter, false);\r\n\t\tvar node;\r\n\t\tvar result;\r\n\t\twhile ((node = treeWalker.nextNode())) {\r\n\t\t\tresult = func(node);\r\n\t\t\tif(result) break;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfindRanges(view){\r\n\t\tvar columns = [];\r\n\t\tvar scrollWidth = view.contents.scrollWidth();\r\n\t\tvar spreads = Math.ceil( scrollWidth / this.layout.spreadWidth);\r\n\t\tvar count = spreads * this.layout.divisor;\r\n\t\tvar columnWidth = this.layout.columnWidth;\r\n\t\tvar gap = this.layout.gap;\r\n\t\tvar start, end;\r\n\r\n\t\tfor (var i = 0; i < count.pages; i++) {\r\n\t\t\tstart = (columnWidth + gap) * i;\r\n\t\t\tend = (columnWidth * (i+1)) + (gap * i);\r\n\t\t\tcolumns.push({\r\n\t\t\t\tstart: this.findStart(view.document.body, start, end),\r\n\t\t\t\tend: this.findEnd(view.document.body, start, end)\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn columns;\r\n\t}\r\n\r\n\t/**\r\n\t * Find Start Range\r\n\t * @private\r\n\t * @param {Node} root root node\r\n\t * @param {number} start position to start at\r\n\t * @param {number} end position to end at\r\n\t * @return {Range}\r\n\t */\r\n\tfindStart(root, start, end){\r\n\t\tvar stack = [root];\r\n\t\tvar $el;\r\n\t\tvar found;\r\n\t\tvar $prev = root;\r\n\r\n\t\twhile (stack.length) {\r\n\r\n\t\t\t$el = stack.shift();\r\n\r\n\t\t\tfound = this.walk($el, (node) => {\r\n\t\t\t\tvar left, right, top, bottom;\r\n\t\t\t\tvar elPos;\r\n\t\t\t\tvar elRange;\r\n\r\n\r\n\t\t\t\telPos = nodeBounds(node);\r\n\r\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\r\n\r\n\t\t\t\t\tleft = this.horizontal ? elPos.left : elPos.top;\r\n\t\t\t\t\tright = this.horizontal ? elPos.right : elPos.bottom;\r\n\r\n\t\t\t\t\tif( left >= start && left <= end ) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else if (right > start) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\r\n\r\n\t\t\t\t\tleft = elPos.left;\r\n\t\t\t\t\tright = elPos.right;\r\n\r\n\t\t\t\t\tif( right <= end && right >= start ) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else if (left < end) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttop = elPos.top;\r\n\t\t\t\t\tbottom = elPos.bottom;\r\n\r\n\t\t\t\t\tif( top >= start && top <= end ) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else if (bottom > start) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t});\r\n\r\n\t\t\tif(found) {\r\n\t\t\t\t\r\n\t\t\t\treturn this.findTextStartRange(found, start, end);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t\r\n\t\t// Return last element\r\n\t\treturn this.findTextStartRange($prev, start, end);\r\n\t}\r\n\r\n\t/**\r\n\t * Find End Range\r\n\t * @private\r\n\t * @param {Node} root root node\r\n\t * @param {number} start position to start at\r\n\t * @param {number} end position to end at\r\n\t * @return {Range}\r\n\t */\r\n\tfindEnd(root, start, end){\r\n\t\tvar stack = [root];\r\n\t\tvar $el;\r\n\t\tvar $prev = root;\r\n\t\tvar found;\r\n\r\n\t\twhile (stack.length) {\r\n\r\n\t\t\t$el = stack.shift();\r\n\r\n\t\t\tfound = this.walk($el, (node) => {\r\n\r\n\t\t\t\tvar left, right, top, bottom;\r\n\t\t\t\tvar elPos;\r\n\t\t\t\tvar elRange;\r\n\r\n\t\t\t\telPos = nodeBounds(node);\r\n\r\n\t\t\t\tif (this.horizontal && this.direction === \"ltr\") {\r\n\r\n\t\t\t\t\tleft = Math.round(elPos.left);\r\n\t\t\t\t\tright = Math.round(elPos.right);\r\n\r\n\t\t\t\t\tif(left > end && $prev) {\r\n\t\t\t\t\t\treturn $prev;\r\n\t\t\t\t\t} else if(right > end) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\r\n\r\n\t\t\t\t\tleft = Math.round(this.horizontal ? elPos.left : elPos.top);\r\n\t\t\t\t\tright = Math.round(this.horizontal ? elPos.right : elPos.bottom);\r\n\r\n\t\t\t\t\tif(right < start && $prev) {\r\n\t\t\t\t\t\treturn $prev;\r\n\t\t\t\t\t} else if(left < start) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttop = Math.round(elPos.top);\r\n\t\t\t\t\tbottom = Math.round(elPos.bottom);\r\n\r\n\t\t\t\t\tif(top > end && $prev) {\r\n\t\t\t\t\t\treturn $prev;\r\n\t\t\t\t\t} else if(bottom > end) {\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t$prev = node;\r\n\t\t\t\t\t\tstack.push(node);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\r\n\t\t\tif(found){\r\n\t\t\t\treturn this.findTextEndRange(found, start, end);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// end of chapter\r\n\t\treturn this.findTextEndRange($prev, start, end);\r\n\t}\r\n\r\n\t/**\r\n\t * Find Text Start Range\r\n\t * @private\r\n\t * @param {Node} root root node\r\n\t * @param {number} start position to start at\r\n\t * @param {number} end position to end at\r\n\t * @return {Range}\r\n\t */\r\n\tfindTextStartRange(node, start, end){\r\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\r\n\t\tvar range;\r\n\t\tvar pos;\r\n\t\tvar left, top, right;\r\n\r\n\t\tfor (var i = 0; i < ranges.length; i++) {\r\n\t\t\trange = ranges[i];\r\n\r\n\t\t\tpos = range.getBoundingClientRect();\r\n\r\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\r\n\r\n\t\t\t\tleft = pos.left;\r\n\t\t\t\tif( left >= start ) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\r\n\r\n\t\t\t\tright = pos.right;\r\n\t\t\t\tif( right <= end ) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttop = pos.top;\r\n\t\t\t\tif( top >= start ) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// prev = range;\r\n\r\n\t\t}\r\n\r\n\t\treturn ranges[0];\r\n\t}\r\n\r\n\t/**\r\n\t * Find Text End Range\r\n\t * @private\r\n\t * @param {Node} root root node\r\n\t * @param {number} start position to start at\r\n\t * @param {number} end position to end at\r\n\t * @return {Range}\r\n\t */\r\n\tfindTextEndRange(node, start, end){\r\n\t\tvar ranges = this.splitTextNodeIntoRanges(node);\r\n\t\tvar prev;\r\n\t\tvar range;\r\n\t\tvar pos;\r\n\t\tvar left, right, top, bottom;\r\n\r\n\t\tfor (var i = 0; i < ranges.length; i++) {\r\n\t\t\trange = ranges[i];\r\n\r\n\t\t\tpos = range.getBoundingClientRect();\r\n\r\n\t\t\tif (this.horizontal && this.direction === \"ltr\") {\r\n\r\n\t\t\t\tleft = pos.left;\r\n\t\t\t\tright = pos.right;\r\n\r\n\t\t\t\tif(left > end && prev) {\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t} else if(right > end) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if (this.horizontal && this.direction === \"rtl\") {\r\n\r\n\t\t\t\tleft = pos.left\r\n\t\t\t\tright = pos.right;\r\n\r\n\t\t\t\tif(right < start && prev) {\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t} else if(left < start) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\ttop = pos.top;\r\n\t\t\t\tbottom = pos.bottom;\r\n\r\n\t\t\t\tif(top > end && prev) {\r\n\t\t\t\t\treturn prev;\r\n\t\t\t\t} else if(bottom > end) {\r\n\t\t\t\t\treturn range;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t\tprev = range;\r\n\r\n\t\t}\r\n\r\n\t\t// Ends before limit\r\n\t\treturn ranges[ranges.length-1];\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Split up a text node into ranges for each word\r\n\t * @private\r\n\t * @param {Node} root root node\r\n\t * @param {string} [_splitter] what to split on\r\n\t * @return {Range[]}\r\n\t */\r\n\tsplitTextNodeIntoRanges(node, _splitter){\r\n\t\tvar ranges = [];\r\n\t\tvar textContent = node.textContent || \"\";\r\n\t\tvar text = textContent.trim();\r\n\t\tvar range;\r\n\t\tvar doc = node.ownerDocument;\r\n\t\tvar splitter = _splitter || \" \";\r\n\r\n\t\tvar pos = text.indexOf(splitter);\r\n\r\n\t\tif(pos === -1 || node.nodeType != Node.TEXT_NODE) {\r\n\t\t\trange = doc.createRange();\r\n\t\t\trange.selectNodeContents(node);\r\n\t\t\treturn [range];\r\n\t\t}\r\n\r\n\t\trange = doc.createRange();\r\n\t\trange.setStart(node, 0);\r\n\t\trange.setEnd(node, pos);\r\n\t\tranges.push(range);\r\n\t\trange = false;\r\n\r\n\t\twhile ( pos != -1 ) {\r\n\r\n\t\t\tpos = text.indexOf(splitter, pos + 1);\r\n\t\t\tif(pos > 0) {\r\n\r\n\t\t\t\tif(range) {\r\n\t\t\t\t\trange.setEnd(node, pos);\r\n\t\t\t\t\tranges.push(range);\r\n\t\t\t\t}\r\n\r\n\t\t\t\trange = doc.createRange();\r\n\t\t\t\trange.setStart(node, pos+1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif(range) {\r\n\t\t\trange.setEnd(node, text.length);\r\n\t\t\tranges.push(range);\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Turn a pair of ranges into a pair of CFIs\r\n\t * @private\r\n\t * @param {string} cfiBase base string for an EpubCFI\r\n\t * @param {object} rangePair { start: Range, end: Range }\r\n\t * @return {object} { start: \"epubcfi(...)\", end: \"epubcfi(...)\" }\r\n\t */\r\n\trangePairToCfiPair(cfiBase, rangePair){\r\n\r\n\t\tvar startRange = rangePair.start;\r\n\t\tvar endRange = rangePair.end;\r\n\r\n\t\tstartRange.collapse(true);\r\n\t\tendRange.collapse(false);\r\n\r\n\t\tlet startCfi = new EpubCFI(startRange, cfiBase).toString();\r\n\t\tlet endCfi = new EpubCFI(endRange, cfiBase).toString();\r\n\r\n\t\treturn {\r\n\t\t\tstart: startCfi,\r\n\t\t\tend: endCfi\r\n\t\t};\r\n\r\n\t}\r\n\r\n\trangeListToCfiList(cfiBase, columns){\r\n\t\tvar map = [];\r\n\t\tvar cifPair;\r\n\r\n\t\tfor (var i = 0; i < columns.length; i++) {\r\n\t\t\tcifPair = this.rangePairToCfiPair(cfiBase, columns[i]);\r\n\r\n\t\t\tmap.push(cifPair);\r\n\r\n\t\t}\r\n\r\n\t\treturn map;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the axis for mapping\r\n\t * @param {string} axis horizontal | vertical\r\n\t * @return {boolean} is it horizontal?\r\n\t */\r\n\taxis(axis) {\r\n\t\tif (axis) {\r\n\t\t\tthis.horizontal = (axis === \"horizontal\") ? true : false;\r\n\t\t}\r\n\t\treturn this.horizontal;\r\n\t}\r\n}\r\n\r\nexport default Mapping;\r\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","import { extend } from \"./utils/core\";\r\nimport { EVENTS } from \"./utils/constants\";\r\nimport EventEmitter from \"event-emitter\";\r\n\r\n/**\r\n * Figures out the CSS values to apply for a layout\r\n * @class\r\n * @param {object} settings\r\n * @param {string} [settings.layout='reflowable']\r\n * @param {string} [settings.spread]\r\n * @param {number} [settings.minSpreadWidth=800]\r\n * @param {boolean} [settings.evenSpreads=false]\r\n */\r\nclass Layout {\r\n\tconstructor(settings) {\r\n\t\tthis.settings = settings;\r\n\t\tthis.name = settings.layout || \"reflowable\";\r\n\t\tthis._spread = (settings.spread === \"none\") ? false : true;\r\n\t\t//김병현 수정\r\n\t\tthis._minSpreadWidth = settings.minSpreadWidth || 0;\r\n\t\tthis._evenSpreads = settings.evenSpreads || false;\r\n\r\n\t\tif (settings.flow === \"scrolled\" ||\r\n\t\t\tsettings.flow === \"scrolled-continuous\" ||\r\n\t\t\tsettings.flow === \"scrolled-doc\") {\r\n\t\t\tthis._flow = \"scrolled\";\r\n\t\t} else {\r\n\t\t\tthis._flow = \"paginated\";\r\n\t\t}\r\n\r\n\r\n\t\tthis.width = 0;\r\n\t\tthis.height = 0;\r\n\t\tthis.spreadWidth = 0;\r\n\t\tthis.delta = 0;\r\n\r\n\t\tthis.columnWidth = 0;\r\n\t\tthis.gap = 0;\r\n\t\tthis.divisor = 1;\r\n\r\n\t\tthis.props = {\r\n\t\t\tname: this.name,\r\n\t\t\tspread: this._spread,\r\n\t\t\tflow: this._flow,\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\tspreadWidth: 0,\r\n\t\t\tdelta: 0,\r\n\t\t\tcolumnWidth: 0,\r\n\t\t\tgap: 0,\r\n\t\t\tdivisor: 1\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Switch the flow between paginated and scrolled\r\n\t * @param  {string} flow paginated | scrolled\r\n\t * @return {string} simplified flow\r\n\t */\r\n\tflow(flow) {\r\n\t\tif (typeof (flow) != \"undefined\") {\r\n\t\t\tif (flow === \"scrolled\" ||\r\n\t\t\t\tflow === \"scrolled-continuous\" ||\r\n\t\t\t\tflow === \"scrolled-doc\") {\r\n\t\t\t\tthis._flow = \"scrolled\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._flow = \"paginated\";\r\n\t\t\t}\r\n\t\t\t// this.props.flow = this._flow;\r\n\t\t\tthis.update({ flow: this._flow });\r\n\t\t}\r\n\t\treturn this._flow;\r\n\t}\r\n\r\n\t/**\r\n\t * Switch between using spreads or not, and set the\r\n\t * width at which they switch to single.\r\n\t * @param  {string} spread \"none\" | \"always\" | \"auto\"\r\n\t * @param  {number} min integer in pixels\r\n\t * @return {boolean} spread true | false\r\n\t */\r\n\tspread(spread, min) {\r\n\r\n\t\tif (spread) {\r\n\t\t\tthis._spread = (spread === \"none\") ? false : true;\r\n\t\t\tthis.props.spread = this._spread;\r\n\r\n\t\t\twindow.setTimeout(() => {\r\n\t\t\t\tthis.update({ spread: this._spread });\r\n\t\t\t}, 500)\r\n\r\n\t\t}\r\n\r\n\t\tif (min >= 0) {\r\n\t\t\tthis._minSpreadWidth = min;\r\n\t\t}\r\n\r\n\t\treturn this._spread;\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the dimensions of the pagination\r\n\t * @param  {number} _width  width of the rendering\r\n\t * @param  {number} _height height of the rendering\r\n\t * @param  {number} _gap    width of the gap between columns\r\n\t */\r\n\tcalculate(_width, _height, _gap) {\r\n\r\n\t\tvar divisor = 1;\r\n\t\tvar gap = _gap || 0;\r\n\r\n\t\t//-- Check the width and create even width columns\r\n\t\t// var fullWidth = Math.floor(_width);\r\n\t\tvar width = _width;\r\n\t\tvar height = _height;\r\n\r\n\t\tvar section = Math.floor(width / 12);\r\n\r\n\t\tvar columnWidth;\r\n\t\tvar spreadWidth;\r\n\t\tvar pageWidth;\r\n\t\tvar delta;\r\n\r\n\t\tif (this._spread && width >= this._minSpreadWidth) {\r\n\t\t\tdivisor = 2;\r\n\t\t} else {\r\n\t\t\tdivisor = 1;\r\n\t\t}\r\n\r\n\t\tif (this.name === \"reflowable\" && this._flow === \"paginated\" && !(_gap >= 0)) {\r\n\t\t\tgap = ((section % 2 === 0) ? section : section - 1);\r\n\t\t}\r\n\r\n\t\tif (this.name === \"pre-paginated\") {\r\n\t\t\tgap = 0;\r\n\t\t}\r\n\r\n\t\t//-- Double Page\r\n\t\tif (divisor > 1) {\r\n\t\t\t// width = width - gap;\r\n\t\t\t// columnWidth = (width - gap) / divisor;\r\n\t\t\t// gap = gap / divisor;\r\n\t\t\tcolumnWidth = (width / divisor) - gap;\r\n\t\t\tpageWidth = columnWidth + gap;\r\n\t\t} else {\r\n\t\t\tcolumnWidth = width;\r\n\t\t\tpageWidth = width;\r\n\t\t}\r\n\r\n\t\tif (this.name === \"pre-paginated\" && divisor > 1) {\r\n\t\t\twidth = columnWidth;\r\n\t\t}\r\n\r\n\t\tspreadWidth = (columnWidth * divisor) + gap;\r\n\r\n\t\tdelta = width;\r\n\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tthis.spreadWidth = spreadWidth;\r\n\t\tthis.pageWidth = pageWidth;\r\n\t\tthis.delta = delta;\r\n\r\n\t\tthis.columnWidth = columnWidth;\r\n\t\tthis.gap = gap;\r\n\t\tthis.divisor = divisor;\r\n\r\n\t\t// this.props.width = width;\r\n\t\t// this.props.height = _height;\r\n\t\t// this.props.spreadWidth = spreadWidth;\r\n\t\t// this.props.pageWidth = pageWidth;\r\n\t\t// this.props.delta = delta;\r\n\t\t//\r\n\t\t// this.props.columnWidth = colWidth;\r\n\t\t// this.props.gap = gap;\r\n\t\t// this.props.divisor = divisor;\r\n\r\n\t\tthis.update({\r\n\t\t\twidth,\r\n\t\t\theight,\r\n\t\t\tspreadWidth,\r\n\t\t\tpageWidth,\r\n\t\t\tdelta,\r\n\t\t\tcolumnWidth,\r\n\t\t\tgap,\r\n\t\t\tdivisor\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Apply Css to a Document\r\n\t * @param  {Contents} contents\r\n\t * @return {Promise}\r\n\t */\r\n\tformat(contents, section, axis) {\r\n\t\tvar formating;\r\n\r\n\t\tif (this.name === \"pre-paginated\") {\r\n\t\t\tformating = contents.fit(this.columnWidth, this.height, section);\r\n\t\t} else if (this._flow === \"paginated\") {\r\n\t\t\tformating = contents.columns(this.width, this.height, this.columnWidth, this.gap, this.settings.direction);\r\n\t\t} else if (axis && axis === \"horizontal\") {\r\n\t\t\tformating = contents.size(null, this.height);\r\n\t\t} else {\r\n\t\t\tformating = contents.size(this.width, null);\r\n\t\t}\r\n\r\n\t\treturn formating; // might be a promise in some View Managers\r\n\t}\r\n\r\n\t/**\r\n\t * Count number of pages\r\n\t * @param  {number} totalLength\r\n\t * @param  {number} pageLength\r\n\t * @return {{spreads: Number, pages: Number}}\r\n\t */\r\n\tcount(totalLength, pageLength) {\r\n\r\n\t\tlet spreads, pages;\r\n\r\n\t\tif (this.name === \"pre-paginated\") {\r\n\t\t\tspreads = 1;\r\n\t\t\tpages = 1;\r\n\t\t} else if (this._flow === \"paginated\") {\r\n\t\t\tpageLength = pageLength || this.delta;\r\n\t\t\tspreads = Math.ceil(totalLength / pageLength);\r\n\t\t\tpages = spreads * this.divisor;\r\n\t\t} else { // scrolled\r\n\t\t\tpageLength = pageLength || this.height;\r\n\t\t\tspreads = Math.ceil(totalLength / pageLength);\r\n\t\t\tpages = spreads;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tspreads,\r\n\t\t\tpages\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Update props that have changed\r\n\t * @private\r\n\t * @param  {object} props\r\n\t */\r\n\tupdate(props) {\r\n\t\t// Remove props that haven't changed\r\n\t\tObject.keys(props).forEach((propName) => {\r\n\t\t\tif (this.props[propName] === props[propName]) {\r\n\t\t\t\t// delete props[propName];\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (Object.keys(props).length > 0) {\r\n\t\t\tlet newProps = extend(this.props, props);\r\n\t\t\tthis.emit(EVENTS.LAYOUT.UPDATED, newProps, props);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nEventEmitter(Layout.prototype);\r\n\r\nexport default Layout;\r\n","import Url from \"./utils/url\";\r\n\r\n/**\r\n * Themes to apply to displayed content\r\n * @class\r\n * @param {Rendition} rendition\r\n */\r\nclass Themes {\r\n\tconstructor(rendition) {\r\n\t\tthis.rendition = rendition;\r\n\t\tthis._themes = {\r\n\t\t\t\"default\": {\r\n\t\t\t\t\"rules\": {},\r\n\t\t\t\t\"url\": \"\",\r\n\t\t\t\t\"serialized\": \"\"\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis._overrides = {};\r\n\t\tthis._current = \"default\";\r\n\t\tthis._injected = [];\r\n\t\tthis.rendition.hooks.content.register(this.inject.bind(this));\r\n\t\tthis.rendition.hooks.content.register(this.overrides.bind(this));\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Add themes to be used by a rendition\r\n\t * @param {object | Array<object> | string}\r\n\t * @example themes.register(\"light\", \"http://example.com/light.css\")\r\n\t * @example themes.register(\"light\", { \"body\": { \"color\": \"purple\"}})\r\n\t * @example themes.register({ \"light\" : {...}, \"dark\" : {...}})\r\n\t */\r\n\tregister() {\r\n\t\tif (arguments.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (arguments.length === 1 && typeof (arguments[0]) === \"object\") {\r\n\t\t\treturn this.registerThemes(arguments[0]);\r\n\t\t}\r\n\t\tif (arguments.length === 1 && typeof (arguments[0]) === \"string\") {\r\n\t\t\treturn this.default(arguments[0]);\r\n\t\t}\r\n\t\tif (arguments.length === 2 && typeof (arguments[1]) === \"string\") {\r\n\t\t\treturn this.registerUrl(arguments[0], arguments[1]);\r\n\t\t}\r\n\t\tif (arguments.length === 2 && typeof (arguments[1]) === \"object\") {\r\n\t\t\treturn this.registerRules(arguments[0], arguments[1]);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add a default theme to be used by a rendition\r\n\t * @param {object | string} theme\r\n\t * @example themes.register(\"http://example.com/default.css\")\r\n\t * @example themes.register({ \"body\": { \"color\": \"purple\"}})\r\n\t */\r\n\tdefault(theme) {\r\n\t\tif (!theme) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof (theme) === \"string\") {\r\n\t\t\treturn this.registerUrl(\"default\", theme);\r\n\t\t}\r\n\t\tif (typeof (theme) === \"object\") {\r\n\t\t\treturn this.registerRules(\"default\", theme);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Register themes object\r\n\t * @param {object} themes\r\n\t */\r\n\tregisterThemes(themes) {\r\n\t\tfor (var theme in themes) {\r\n\t\t\tif (themes.hasOwnProperty(theme)) {\r\n\t\t\t\tif (typeof (themes[theme]) === \"string\") {\r\n\t\t\t\t\tthis.registerUrl(theme, themes[theme]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.registerRules(theme, themes[theme]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Register a theme by passing its css as string\r\n\t * @param {string} name \r\n\t * @param {string} css \r\n\t */\r\n\tregisterCss(name, css) {\r\n\t\tthis._themes[name] = { \"serialized\": css };\r\n\t\tif (this._injected[name] || name == 'default') {\r\n\t\t\tthis.update(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Register a url\r\n\t * @param {string} name\r\n\t * @param {string} input\r\n\t */\r\n\tregisterUrl(name, input) {\r\n\t\tvar url = new Url(input);\r\n\t\tthis._themes[name] = { \"url\": url.toString() };\r\n\t\tif (this._injected[name] || name == 'default') {\r\n\t\t\tthis.update(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Register rule\r\n\t * @param {string} name\r\n\t * @param {object} rules\r\n\t */\r\n\tregisterRules(name, rules) {\r\n\t\tthis._themes[name] = { \"rules\": rules };\r\n\t\t// TODO: serialize css rules\r\n\t\tif (this._injected[name] || name == 'default') {\r\n\t\t\tthis.update(name);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Select a theme\r\n\t * @param {string} name\r\n\t */\r\n\tselect(name) {\r\n\t\tvar prev = this._current;\r\n\t\tvar contents;\r\n\r\n\t\tthis._current = name;\r\n\t\tthis.update(name);\r\n\r\n\t\tcontents = this.rendition.getContents();\r\n\t\tcontents.forEach((content) => {\r\n\t\t\tcontent.removeClass(prev);\r\n\t\t\tcontent.addClass(name);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Update a theme\r\n\t * @param {string} name\r\n\t */\r\n\tupdate(name) {\r\n\t\tvar contents = this.rendition.getContents();\r\n\t\tcontents.forEach((content) => {\r\n\t\t\tthis.add(name, content);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Inject all themes into contents\r\n\t * @param {Contents} contents\r\n\t */\r\n\tinject(contents) {\r\n\r\n\t\tvar links = [];\r\n\t\tvar themes = this._themes;\r\n\t\tvar theme;\r\n\r\n\t\tfor (var name in themes) {\r\n\t\t\tif (themes.hasOwnProperty(name) && (name === this._current || name === \"default\")) {\r\n\t\t\t\ttheme = themes[name];\r\n\t\t\t\tif ((theme.rules && Object.keys(theme.rules).length > 0) || (theme.url && links.indexOf(theme.url) === -1)) {\r\n\t\t\t\t\tthis.add(name, contents);\r\n\t\t\t\t}\r\n\t\t\t\tthis._injected.push(name);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._current != \"default\") {\r\n\t\t\tcontents.addClass(this._current);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add Theme to contents\r\n\t * @param {string} name\r\n\t * @param {Contents} contents\r\n\t */\r\n\tadd(name, contents) {\r\n\r\n\t\tvar theme = this._themes[name];\r\n\r\n\t\tif (!theme || !contents) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (theme.url) {\r\n\t\t\tcontents.addStylesheet(theme.url);\r\n\t\t} else if (theme.serialized) {\r\n\t\t\tcontents.addStylesheetCss(theme.serialized, name);\r\n\t\t\ttheme.injected = true;\r\n\t\t} else if (theme.rules) {\r\n\t\t\tcontents.addStylesheetRules(theme.rules, name);\r\n\t\t\ttheme.injected = true;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add override\r\n\t * @param {string} name\r\n\t * @param {string} value\r\n\t * @param {boolean} priority\r\n\t */\r\n\toverride(name, value, priority) {\r\n\r\n\t\tvar contents = this.rendition.getContents();\r\n\r\n\t\tthis._overrides[name] = {\r\n\t\t\tvalue: value,\r\n\t\t\tpriority: priority === true\r\n\t\t};\r\n\r\n\t\tcontents.forEach((content) => {\r\n\t\t\tif (name == \"font-family\") {\r\n\t\t\t\tcontent.changeChildCss(name, this._overrides[name].value);\r\n\t\t\t}\r\n\t\t\tcontent.css(name, this._overrides[name].value, this._overrides[name].priority);\r\n\t\t});\r\n\t}\r\n\r\n\tremoveOverride(name) {\r\n\t\tvar contents = this.rendition.getContents();\r\n\r\n\t\tdelete this._overrides[name];\r\n\r\n\t\tcontents.forEach((content) => {\r\n\t\t\tcontent.css(name);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Add all overrides\r\n\t * @param {Content} content\r\n\t */\r\n\toverrides(contents) {\r\n\r\n\t\tvar overrides = this._overrides;\r\n\r\n\t\tfor (var rule in overrides) {\r\n\r\n\t\t\tif (overrides.hasOwnProperty(rule)) {\r\n\t\t\t\t//김병현 추가\t\r\n\t\t\t\tif (rule == \"font-family\") {\r\n\t\t\t\t\tcontents.changeChildCss(rule, overrides[rule].value);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontents.css(rule, overrides[rule].value, overrides[rule].priority);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust the font size of a rendition\r\n\t * @param {number} size\r\n\t */\r\n\tfontSize(size) {\r\n\t\tthis.override(\"font-size\", size);\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust the font-family of a rendition\r\n\t * @param {string} f\r\n\t */\r\n\tfont(f) {\r\n\r\n\t\tthis.override(\"font-family\", f, true);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.rendition = undefined;\r\n\t\tthis._themes = undefined;\r\n\t\tthis._overrides = undefined;\r\n\t\tthis._current = undefined;\r\n\t\tthis._injected = undefined;\r\n\t}\r\n\r\n}\r\n\r\nexport default Themes;\r\n","import EventEmitter from \"event-emitter\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport { EVENTS } from \"./utils/constants\";\r\n\r\n/**\r\n\t* Handles managing adding & removing Annotations\r\n\t* @param {Rendition} rendition\r\n\t* @class\r\n\t*/\r\nclass Annotations {\r\n\r\n\tconstructor(rendition) {\r\n\t\tthis.rendition = rendition;\r\n\t\tthis.highlights = [];\r\n\t\tthis.memos = [];\r\n\t\tthis.underlines = [];\r\n\t\tthis.marks = [];\r\n\t\tthis._annotations = {};\r\n\t\tthis._annotationsBySectionIndex = {};\r\n\r\n\t\tthis.rendition.hooks.show.register(this.remove.bind(this));\r\n\t\tthis.rendition.hooks.show.register(this.inject.bind(this));\r\n\t\tthis.rendition.hooks.unloaded.register(this.clear.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Add an annotation to store\r\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\r\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\r\n\t * @param {object} data Data to assign to annotation\r\n\t * @param {function} [cb] Callback after annotation is added\r\n\t * @param {string} className CSS class to assign to annotation\r\n\t * @param {object} styles CSS styles to assign to annotation\r\n\t * @returns {Annotation} annotation\r\n\t */\r\n\tadd(type, cfiRange, data, cb, className, styles, color) {\r\n\r\n\t\t//김병현 추가\r\n\t\tthis.highlights.push(cfiRange);\r\n\t\tif (data && data.memo) {\r\n\t\t\tthis.memos.push(cfiRange);\r\n\t\t}\r\n\t\t//\r\n\t\tlet hash = encodeURI(cfiRange + type);\r\n\t\tlet cfi = new EpubCFI(cfiRange);\r\n\t\tlet sectionIndex = cfi.spinePos;\r\n\t\tlet annotation = new Annotation({\r\n\t\t\ttype,\r\n\t\t\tcfiRange,\r\n\t\t\tdata,\r\n\t\t\tsectionIndex,\r\n\t\t\tcb,\r\n\t\t\tclassName,\r\n\t\t\tstyles,\r\n\t\t\tcolor\r\n\t\t});\r\n\r\n\t\tthis._annotations[hash] = annotation;\r\n\r\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\r\n\t\t\tthis._annotationsBySectionIndex[sectionIndex].push(hash);\r\n\t\t} else {\r\n\t\t\tthis._annotationsBySectionIndex[sectionIndex] = [hash];\r\n\t\t}\r\n\r\n\t\tlet views = this.rendition.views();\r\n\r\n\t\tviews.forEach((view) => {\r\n\t\t\tif (annotation.sectionIndex === view.index) {\r\n\t\t\t\tannotation.attach(view);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\t\treturn annotation;\r\n\t}\r\n\r\n\t/**\r\n\t * Remove an annotation from store\r\n\t * @param {EpubCFI} cfiRange EpubCFI range the annotation is attached to\r\n\t * @param {string} type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\r\n\t */\r\n\tremove(cfiRange, type) {\r\n\t\tlet hash = encodeURI(cfiRange + type);\r\n\r\n\t\tif (hash in this._annotations) {\r\n\t\t\tlet annotation = this._annotations[hash];\r\n\r\n\t\t\tif (type && annotation.type !== type) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tlet views = this.rendition.views();\r\n\t\t\tviews.forEach((view) => {\r\n\t\t\t\tthis._removeFromAnnotationBySectionIndex(annotation.sectionIndex, hash);\r\n\t\t\t\tif (annotation.sectionIndex === view.index) {\r\n\t\t\t\t\tannotation.detach(view);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tdelete this._annotations[hash];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Remove an annotations by Section Index\r\n\t * @private\r\n\t */\r\n\t_removeFromAnnotationBySectionIndex(sectionIndex, hash) {\r\n\t\tthis._annotationsBySectionIndex[sectionIndex] = this._annotationsAt(sectionIndex).filter(h => h !== hash);\r\n\t}\r\n\r\n\t/**\r\n\t * Get annotations by Section Index\r\n\t * @private\r\n\t */\r\n\t_annotationsAt(index) {\r\n\t\treturn this._annotationsBySectionIndex[index];\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Add a highlight to the store\r\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\r\n\t * @param {object} data Data to assign to annotation\r\n\t * @param {function} cb Callback after annotation is clicked\r\n\t * @param {string} className CSS class to assign to annotation\r\n\t * @param {object} styles CSS styles to assign to annotation\r\n\t */\r\n\thighlight(cfiRange, data, cb, className, styles, color) {\r\n\t\treturn this.add(\"highlight\", cfiRange, data, cb, className, styles, color);\r\n\t}\r\n\r\n\tremoveAllHighlight() {\r\n\t\tfor (let i = 0; i < this.highlights.length; i++) {\r\n\t\t\tthis.remove(this.highlights[i], \"highlight\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add a underline to the store\r\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\r\n\t * @param {object} data Data to assign to annotation\r\n\t * @param {function} cb Callback after annotation is clicked\r\n\t * @param {string} className CSS class to assign to annotation\r\n\t * @param {object} styles CSS styles to assign to annotation\r\n\t */\r\n\tunderline(cfiRange, data, cb, className, styles) {\r\n\t\treturn this.add(\"underline\", cfiRange, data, cb, className, styles);\r\n\t}\r\n\r\n\t/**\r\n\t * Add a mark to the store\r\n\t * @param {EpubCFI} cfiRange EpubCFI range to attach annotation to\r\n\t * @param {object} data Data to assign to annotation\r\n\t * @param {function} cb Callback after annotation is clicked\r\n\t */\r\n\tmark(cfiRange, data, cb) {\r\n\t\treturn this.add(\"mark\", cfiRange, data, cb);\r\n\t}\r\n\r\n\t/**\r\n\t * iterate over annotations in the store\r\n\t */\r\n\teach() {\r\n\t\treturn this._annotations.forEach.apply(this._annotations, arguments);\r\n\t}\r\n\r\n\t/**\r\n\t * Hook for injecting annotation into a view\r\n\t * @param {View} view\r\n\t * @private\r\n\t */\r\n\tinject(view) {\r\n\t\tlet sectionIndex = view.index;\r\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\r\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\r\n\t\t\tannotations.forEach((hash) => {\r\n\t\t\t\tlet annotation = this._annotations[hash];\r\n\t\t\t\tannotation.attach(view);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hook for removing annotation from a view\r\n\t * @param {View} view\r\n\t * @private\r\n\t */\r\n\tclear(view) {\r\n\t\tlet sectionIndex = view.index;\r\n\t\tif (sectionIndex in this._annotationsBySectionIndex) {\r\n\t\t\tlet annotations = this._annotationsBySectionIndex[sectionIndex];\r\n\t\t\tannotations.forEach((hash) => {\r\n\t\t\t\tlet annotation = this._annotations[hash];\r\n\t\t\t\tannotation.detach(view);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * [Not Implemented] Show annotations\r\n\t * @TODO: needs implementation in View\r\n\t */\r\n\tshow() {\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * [Not Implemented] Hide annotations\r\n\t * @TODO: needs implementation in View\r\n\t */\r\n\thide() {\r\n\r\n\t}\r\n\r\n}\r\n\r\n/**\r\n * Annotation object\r\n * @class\r\n * @param {object} options\r\n * @param {string} options.type Type of annotation to add: \"highlight\", \"underline\", \"mark\"\r\n * @param {EpubCFI} options.cfiRange EpubCFI range to attach annotation to\r\n * @param {object} options.data Data to assign to annotation\r\n * @param {int} options.sectionIndex Index in the Spine of the Section annotation belongs to\r\n * @param {function} [options.cb] Callback after annotation is clicked\r\n * @param {string} className CSS class to assign to annotation\r\n * @param {object} styles CSS styles to assign to annotation\r\n * @returns {Annotation} annotation\r\n */\r\nclass Annotation {\r\n\r\n\tconstructor({\r\n\t\ttype,\r\n\t\tcfiRange,\r\n\t\tdata,\r\n\t\tsectionIndex,\r\n\t\tcb,\r\n\t\tclassName,\r\n\t\tstyles,\r\n\t\tcolor\r\n\t}) {\r\n\t\tthis.type = type;\r\n\t\tthis.cfiRange = cfiRange;\r\n\t\tthis.data = data;\r\n\t\tthis.sectionIndex = sectionIndex;\r\n\t\tthis.mark = undefined;\r\n\t\tthis.cb = cb;\r\n\t\tthis.className = className;\r\n\t\tthis.styles = styles;\r\n\t\tthis.color = color;\r\n\t}\r\n\r\n\t/**\r\n\t * Update stored data\r\n\t * @param {object} data\r\n\t */\r\n\tupdate(data) {\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\t/**\r\n\t * Add to a view\r\n\t * @param {View} view\r\n\t */\r\n\tattach(view) {\r\n\r\n\t\tlet { cfiRange, data, type, mark, cb, className, styles, color } = this;\r\n\t\tlet result;\r\n\r\n\t\tif (type === \"highlight\") {\r\n\t\t\tresult = view.highlight(cfiRange, data, cb, className, styles, color);\r\n\t\t} else if (type === \"underline\") {\r\n\t\t\tresult = view.underline(cfiRange, data, cb, className, styles);\r\n\t\t} else if (type === \"mark\") {\r\n\t\t\tresult = view.mark(cfiRange, data, cb);\r\n\t\t}\r\n\r\n\t\tthis.mark = result;\r\n\t\tthis.emit(EVENTS.ANNOTATION.ATTACH, result);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Remove from a view\r\n\t * @param {View} view\r\n\t */\r\n\tdetach(view) {\r\n\t\tlet { cfiRange, type } = this;\r\n\t\tlet result;\r\n\r\n\t\tif (view) {\r\n\t\t\tif (type === \"highlight\") {\r\n\t\t\t\tresult = view.unhighlight(cfiRange);\r\n\t\t\t} else if (type === \"underline\") {\r\n\t\t\t\tresult = view.ununderline(cfiRange);\r\n\t\t\t} else if (type === \"mark\") {\r\n\t\t\t\tresult = view.unmark(cfiRange);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.mark = undefined;\r\n\t\tthis.emit(EVENTS.ANNOTATION.DETACH, result);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * [Not Implemented] Get text of an annotation\r\n\t * @TODO: needs implementation in contents\r\n\t */\r\n\ttext() {\r\n\r\n\t}\r\n\r\n}\r\n\r\nEventEmitter(Annotation.prototype);\r\n\r\n\r\nexport default Annotations\r\n","import EventEmitter from \"event-emitter\";\r\nimport { extend, defer, isFloat } from \"./utils/core\";\r\nimport Hook from \"./utils/hook\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport Queue from \"./utils/queue\";\r\nimport Layout from \"./layout\";\r\n// import Mapping from \"./mapping\";\r\nimport Themes from \"./themes\";\r\nimport Contents from \"./contents\";\r\nimport Annotations from \"./annotations\";\r\nimport { EVENTS, DOM_EVENTS } from \"./utils/constants\";\r\n\r\n// Default Views\r\nimport IframeView from \"./managers/views/iframe\";\r\n\r\n// Default View Managers\r\nimport DefaultViewManager from \"./managers/default/index\";\r\nimport ContinuousViewManager from \"./managers/continuous/index\";\r\n\r\nimport debounce from \"lodash/debounce\";\r\n\r\n/**\r\n * Displays an Epub as a series of Views for each Section.\r\n * Requires Manager and View class to handle specifics of rendering\r\n * the section content.\r\n * @class\r\n * @param {Book} book\r\n * @param {object} [options]\r\n * @param {number} [options.width]\r\n * @param {number} [options.height]\r\n * @param {string} [options.ignoreClass] class for the cfi parser to ignore\r\n * @param {string | function | object} [options.manager='default']\r\n * @param {string | function} [options.view='iframe']\r\n * @param {string} [options.layout] layout to force\r\n * @param {string} [options.spread] force spread value\r\n * @param {number} [options.minSpreadWidth] overridden by spread: none (never) / both (always)\r\n * @param {string} [options.stylesheet] url of stylesheet to be injected\r\n * @param {boolean} [options.resizeOnOrientationChange] false to disable orientation events\r\n * @param {string} [options.script] url of script to be injected\r\n * @param {boolean | object} [options.snap=false] use snap scrolling\r\n */\r\nclass Rendition {\r\n\tconstructor(book, options) {\r\n\r\n\t\tthis.settings = extend(this.settings || {}, {\r\n\t\t\twidth: null,\r\n\t\t\theight: null,\r\n\t\t\tignoreClass: \"\",\r\n\t\t\tmanager: \"default\",\r\n\t\t\tview: \"iframe\",\r\n\t\t\tflow: null,\r\n\t\t\tlayout: null,\r\n\t\t\tspread: null,\r\n\t\t\tminSpreadWidth: 0,\r\n\t\t\tstylesheet: null,\r\n\t\t\tresizeOnOrientationChange: true,\r\n\t\t\tscript: null,\r\n\t\t\tsnap: false,\r\n\t\t\tdefaultDirection: \"ltr\"\r\n\t\t});\r\n\r\n\t\textend(this.settings, options);\r\n\r\n\t\tif (typeof (this.settings.manager) === \"object\") {\r\n\t\t\tthis.manager = this.settings.manager;\r\n\t\t}\r\n\r\n\t\tthis.book = book;\r\n\r\n\t\t/**\r\n\t\t * Adds Hook methods to the Rendition prototype\r\n\t\t * @member {object} hooks\r\n\t\t * @property {Hook} hooks.content\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.hooks = {};\r\n\t\tthis.hooks.display = new Hook(this);\r\n\t\tthis.hooks.serialize = new Hook(this);\r\n\t\tthis.hooks.content = new Hook(this);\r\n\t\tthis.hooks.unloaded = new Hook(this);\r\n\t\tthis.hooks.layout = new Hook(this);\r\n\t\tthis.hooks.render = new Hook(this);\r\n\t\tthis.hooks.show = new Hook(this);\r\n\r\n\t\tthis.hooks.content.register(this.handleLinks.bind(this));\r\n\t\tthis.hooks.content.register(this.passEvents.bind(this));\r\n\t\tthis.hooks.content.register(this.adjustImages.bind(this));\r\n\r\n\t\tthis.book.spine.hooks.content.register(this.injectIdentifier.bind(this));\r\n\r\n\t\tif (this.settings.stylesheet) {\r\n\t\t\tthis.book.spine.hooks.content.register(this.injectStylesheet.bind(this));\r\n\t\t}\r\n\r\n\t\tif (this.settings.script) {\r\n\t\t\tthis.book.spine.hooks.content.register(this.injectScript.bind(this));\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * @member {Themes} themes\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.themes = new Themes(this);\r\n\r\n\t\t/**\r\n\t\t * @member {Annotations} annotations\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.annotations = new Annotations(this);\r\n\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis.q = new Queue(this);\r\n\r\n\t\t/**\r\n\t\t * A Rendered Location Range\r\n\t\t * @typedef location\r\n\t\t * @type {Object}\r\n\t\t * @property {object} start\r\n\t\t * @property {string} start.index\r\n\t\t * @property {string} start.href\r\n\t\t * @property {object} start.displayed\r\n\t\t * @property {EpubCFI} start.cfi\r\n\t\t * @property {number} start.location\r\n\t\t * @property {number} start.percentage\r\n\t\t * @property {number} start.displayed.page\r\n\t\t * @property {number} start.displayed.total\r\n\t\t * @property {object} end\r\n\t\t * @property {string} end.index\r\n\t\t * @property {string} end.href\r\n\t\t * @property {object} end.displayed\r\n\t\t * @property {EpubCFI} end.cfi\r\n\t\t * @property {number} end.location\r\n\t\t * @property {number} end.percentage\r\n\t\t * @property {number} end.displayed.page\r\n\t\t * @property {number} end.displayed.total\r\n\t\t * @property {boolean} atStart\r\n\t\t * @property {boolean} atEnd\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.location = undefined;\r\n\r\n\t\t// Hold queue until book is opened\r\n\t\tthis.q.enqueue(this.book.opened);\r\n\r\n\t\tthis.starting = new defer();\r\n\t\t/**\r\n\t\t * @member {promise} started returns after the rendition has started\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.started = this.starting.promise;\r\n\r\n\t\t// Block the queue until rendering is started\r\n\t\tthis.q.enqueue(this.start);\r\n\t}\r\n\r\n\t/**\r\n\t * Set the manager function\r\n\t * @param {function} manager\r\n\t */\r\n\tsetManager(manager) {\r\n\t\tthis.manager = manager;\r\n\t}\r\n\r\n\t/**\r\n\t * Require the manager from passed string, or as a class function\r\n\t * @param  {string|object} manager [description]\r\n\t * @return {method}\r\n\t */\r\n\trequireManager(manager) {\r\n\t\tvar viewManager;\r\n\r\n\t\t// If manager is a string, try to load from imported managers\r\n\t\tif (typeof manager === \"string\" && manager === \"default\") {\r\n\t\t\tviewManager = DefaultViewManager;\r\n\t\t} else if (typeof manager === \"string\" && manager === \"continuous\") {\r\n\t\t\tviewManager = ContinuousViewManager;\r\n\t\t} else {\r\n\t\t\t// otherwise, assume we were passed a class function\r\n\t\t\tviewManager = manager;\r\n\t\t}\r\n\r\n\t\treturn viewManager;\r\n\t}\r\n\r\n\t/**\r\n\t * Require the view from passed string, or as a class function\r\n\t * @param  {string|object} view\r\n\t * @return {view}\r\n\t */\r\n\trequireView(view) {\r\n\t\tvar View;\r\n\r\n\t\t// If view is a string, try to load from imported views,\r\n\t\tif (typeof view == \"string\" && view === \"iframe\") {\r\n\t\t\tView = IframeView;\r\n\t\t} else {\r\n\t\t\t// otherwise, assume we were passed a class function\r\n\t\t\tView = view;\r\n\t\t}\r\n\r\n\t\treturn View;\r\n\t}\r\n\r\n\t/**\r\n\t * Start the rendering\r\n\t * @return {Promise} rendering has started\r\n\t */\r\n\tstart() {\r\n\t\tif (!this.settings.layout && (this.book.package.metadata.layout === \"pre-paginated\" || this.book.displayOptions.fixedLayout === \"true\")) {\r\n\t\t\tthis.settings.layout = \"pre-paginated\";\r\n\t\t}\r\n\t\tswitch (this.book.package.metadata.spread) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tthis.settings.spread = 'none';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'both':\r\n\t\t\t\tthis.settings.spread = true;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (!this.manager) {\r\n\t\t\tthis.ViewManager = this.requireManager(this.settings.manager);\r\n\t\t\tthis.View = this.requireView(this.settings.view);\r\n\r\n\t\t\tthis.manager = new this.ViewManager({\r\n\t\t\t\tview: this.View,\r\n\t\t\t\tqueue: this.q,\r\n\t\t\t\trequest: this.book.load.bind(this.book),\r\n\t\t\t\tsettings: this.settings\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.direction(this.book.package.metadata.direction || this.settings.defaultDirection);\r\n\r\n\t\t// Parse metadata to get layout props\r\n\t\tthis.settings.globalLayoutProperties = this.determineLayoutProperties(this.book.package.metadata);\r\n\r\n\t\tthis.flow(this.settings.globalLayoutProperties.flow);\r\n\r\n\t\tthis.layout(this.settings.globalLayoutProperties);\r\n\r\n\t\t// Listen for displayed views\r\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this.afterDisplayed.bind(this));\r\n\t\tthis.manager.on(EVENTS.MANAGERS.REMOVED, this.afterRemoved.bind(this));\r\n\r\n\t\t// Listen for resizing\r\n\t\tthis.manager.on(EVENTS.MANAGERS.RESIZED, debounce(this.onResized.bind(this), 300));\r\n\r\n\t\t// Listen for rotation\r\n\t\tthis.manager.on(EVENTS.MANAGERS.ORIENTATION_CHANGE, this.onOrientationChange.bind(this));\r\n\r\n\t\t// Listen for scroll changes\r\n\t\tthis.manager.on(EVENTS.MANAGERS.SCROLLED, this.reportLocation.bind(this));\r\n\r\n\t\t/**\r\n\t\t * Emit that rendering has started\r\n\t\t * @event started\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.STARTED);\r\n\r\n\t\t// Start processing queue\r\n\t\tthis.starting.resolve();\r\n\t}\r\n\r\n\t/**\r\n\t * Call to attach the container to an element in the dom\r\n\t * Container must be attached before rendering can begin\r\n\t * @param  {element} element to attach to\r\n\t * @return {Promise}\r\n\t */\r\n\tattachTo(element) {\r\n\r\n\t\treturn this.q.enqueue(function () {\r\n\r\n\t\t\t// Start rendering\r\n\t\t\tthis.manager.render(element, {\r\n\t\t\t\t\"width\": this.settings.width,\r\n\t\t\t\t\"height\": this.settings.height\r\n\t\t\t});\r\n\r\n\t\t\t/**\r\n\t\t\t * Emit that rendering has attached to an element\r\n\t\t\t * @event attached\r\n\t\t\t * @memberof Rendition\r\n\t\t\t */\r\n\t\t\tthis.emit(EVENTS.RENDITION.ATTACHED);\r\n\r\n\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Display a point in the book\r\n\t * The request will be added to the rendering Queue,\r\n\t * so it will wait until book is opened, rendering started\r\n\t * and all other rendering tasks have finished to be called.\r\n\t * @param  {string} target Url or EpubCFI\r\n\t * @return {Promise}\r\n\t */\r\n\tdisplay(target) {\r\n\t\tif (this.displaying) {\r\n\t\t\tthis.displaying.resolve();\r\n\t\t}\r\n\t\treturn this.q.enqueue(this._display, target);\r\n\t}\r\n\r\n\t/**\r\n\t * Tells the manager what to display immediately\r\n\t * @private\r\n\t * @param  {string} target Url or EpubCFI\r\n\t * @return {Promise}\r\n\t */\r\n\t_display(target) {\r\n\t\tif (!this.book) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar isCfiString = this.epubcfi.isCfiString(target);\r\n\t\tvar displaying = new defer();\r\n\t\tvar displayed = displaying.promise;\r\n\t\tvar section;\r\n\t\tvar moveTo;\r\n\r\n\t\tthis.displaying = displaying;\r\n\r\n\r\n\t\t// Check if this is a book percentage\r\n\t\tif (this.book.locations.length() && isFloat(target)) {\r\n\t\t\ttarget = this.book.locations.cfiFromPercentage(parseFloat(target));\r\n\t\t}\r\n\r\n\t\tsection = this.book.spine.get(target);\r\n\r\n\t\tif (!section) {\r\n\t\t\tdisplaying.reject(new Error(\"No Section Found\"));\r\n\t\t\treturn displayed;\r\n\t\t}\r\n\t\tthis.manager.display(section, target)\r\n\t\t\t.then(() => {\r\n\t\t\t\tdisplaying.resolve(section);\r\n\t\t\t\tthis.displaying = undefined;\r\n\t\t\t\t/**\r\n\t\t\t\t * Emit that a section has been displayed\r\n\t\t\t\t * @event displayed\r\n\t\t\t\t * @param {Section} section\r\n\t\t\t\t * @memberof Rendition\r\n\t\t\t\t */\r\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAYED, section);\r\n\t\t\t\tthis.reportLocation();\r\n\r\n\r\n\t\t\t}, (err) => {\r\n\t\t\t\t/**\r\n\t\t\t\t * Emit that has been an error displaying\r\n\t\t\t\t * @event displayError\r\n\t\t\t\t * @param {Section} section\r\n\t\t\t\t * @memberof Rendition\r\n\t\t\t\t */\r\n\t\t\t\tthis.emit(EVENTS.RENDITION.DISPLAY_ERROR, err);\r\n\t\t\t});\r\n\r\n\r\n\t\treturn displayed;\r\n\t}\r\n\r\n\t/*\r\n\trender(view, show) {\r\n\r\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\r\n\t\tview.create();\r\n\r\n\t\t// Fit to size of the container, apply padding\r\n\t\tthis.manager.resizeView(view);\r\n\r\n\t\t// Render Chain\r\n\t\treturn view.section.render(this.book.request)\r\n\t\t\t.then(function(contents){\r\n\t\t\t\treturn view.load(contents);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(doc){\r\n\t\t\t\treturn this.hooks.content.trigger(view, this);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\tthis.layout.format(view.contents);\r\n\t\t\t\treturn this.hooks.layout.trigger(view, this);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\treturn view.display();\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\treturn this.hooks.render.trigger(view, this);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function(){\r\n\t\t\t\tif(show !== false) {\r\n\t\t\t\t\tthis.q.enqueue(function(view){\r\n\t\t\t\t\t\tview.show();\r\n\t\t\t\t\t}, view);\r\n\t\t\t\t}\r\n\t\t\t\t// this.map = new Map(view, this.layout);\r\n\t\t\t\tthis.hooks.show.trigger(view, this);\r\n\t\t\t\tthis.trigger(\"rendered\", view.section);\r\n\r\n\t\t\t}.bind(this))\r\n\t\t\t.catch(function(e){\r\n\t\t\t\tthis.trigger(\"loaderror\", e);\r\n\t\t\t}.bind(this));\r\n\r\n\t}\r\n\t*/\r\n\r\n\t/**\r\n\t * Report what section has been displayed\r\n\t * @private\r\n\t * @param  {*} view\r\n\t */\r\n\tafterDisplayed(view) {\r\n\r\n\t\tview.on(EVENTS.VIEWS.MARK_CLICKED, (cfiRange, data, content, color) => this.triggerMarkEvent(cfiRange, data, view.contents, color));\r\n\t\tview.on(EVENTS.VIEWS.MARK_IMAGE_CLICKED, (data) => this.triggerMarkImageEvent(data));\r\n\t\tthis.hooks.render.trigger(view, this)\r\n\t\t\t.then(() => {\r\n\t\t\t\tif (view.contents) {\r\n\t\t\t\t\t//김병현 추가 로딩 \r\n\t\t\t\t\tlet loadingDiv = document.getElementById(\"div-loading\");\r\n\t\t\t\t\t// if (loadingDiv) loadingDiv.classList.add(\"show\");\r\n\r\n\t\t\t\t\tthis.hooks.content.trigger(view.contents, this).then(() => {\r\n\t\t\t\t\t\t//김병현 추가 셋타임s\t\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t//김병현추가 업데이트 레이아웃 \r\n\t\t\t\t\t\t\tthis.manager.updateLayout();\r\n\t\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t\t * Emit that a section has been rendered\r\n\t\t\t\t\t\t\t * @event rendered\r\n\t\t\t\t\t\t\t * @param {Section} section\r\n\t\t\t\t\t\t\t * @param {View} view\r\n\t\t\t\t\t\t\t * @memberof Rendition\r\n\t\t\t\t\t\t\t */\r\n\t\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\r\n\r\n\t\t\t\t\t\t\tthis.manager.views.show(view, this);\r\n\r\n\t\t\t\t\t\t\t//김병현 추가 처음 스크롤 바뀌는거\r\n\t\t\t\t\t\t\tif (document.getElementById(\"viewer\").classList.contains(\"scroll\")) {\r\n\t\t\t\t\t\t\t\tvar container = document.getElementsByClassName(\"epub-container\")[0];\r\n\t\t\t\t\t\t\t\tif (container.classList.contains(\"ios-container\")) {\r\n\t\t\t\t\t\t\t\t\tif (container.start) {\r\n\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\t\tcontainer.scrollTo(0, (document.documentElement.clientHeight * 4 / 10));\r\n\t\t\t\t\t\t\t\t\t\tcontainer.start = true;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\twindow.setTimeout(() => {\r\n\t\t\t\t\t\t\t\tif (loadingDiv) {\r\n\t\t\t\t\t\t\t\t\tthis.hooks.show.trigger(view, this).then(() => {\r\n\t\t\t\t\t\t\t\t\t\tfixSize();\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}, 100);\r\n\r\n\t\t\t\t\t\t}, 0)\r\n\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RENDERED, view.section, view);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Report what has been removed\r\n\t * @private\r\n\t * @param  {*} view\r\n\t */\r\n\tafterRemoved(view) {\r\n\t\tthis.hooks.unloaded.trigger(view, this).then(() => {\r\n\t\t\t/**\r\n\t\t\t * Emit that a section has been removed\r\n\t\t\t * @event removed\r\n\t\t\t * @param {Section} section\r\n\t\t\t * @param {View} view\r\n\t\t\t * @memberof Rendition\r\n\t\t\t */\r\n\t\t\tthis.emit(EVENTS.RENDITION.REMOVED, view.section, view);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Report resize events and display the last seen location\r\n\t * @private\r\n\t */\r\n\tonResized(size, epubcfi) {\r\n\t\t/**\r\n\t\t * Emit that the rendition has been resized\r\n\t\t * @event resized\r\n\t\t * @param {number} width\r\n\t\t * @param {height} height\r\n\t\t * @param {string} epubcfi (optional)\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.RESIZED, {\r\n\t\t\twidth: size.width,\r\n\t\t\theight: size.height\r\n\t\t}, epubcfi);\r\n\t\tif (this.location && this.location.start) {\r\n\r\n\t\t\tthis.display(epubcfi || this.location.start.cfi);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Report orientation events and display the last seen location\r\n\t * @private\r\n\t */\r\n\tonOrientationChange(orientation) {\r\n\t\t/**\r\n\t\t * Emit that the rendition has been rotated\r\n\t\t * @event orientationchange\r\n\t\t * @param {string} orientation\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.ORIENTATION_CHANGE, orientation);\r\n\t}\r\n\r\n\t/**\r\n\t * Move the Rendition to a specific offset\r\n\t * Usually you would be better off calling display()\r\n\t * @param {object} offset\r\n\t */\r\n\tmoveTo(offset) {\r\n\t\tthis.manager.moveTo(offset);\r\n\t}\r\n\r\n\t/**\r\n\t * Trigger a resize of the views\r\n\t * @param {number} [width]\r\n\t * @param {number} [height]\r\n\t * @param {string} [epubcfi] (optional)\r\n\t */\r\n\tresize(width, height, epubcfi) {\r\n\r\n\t\tif (width) {\r\n\t\t\tthis.settings.width = width;\r\n\t\t}\r\n\t\tif (height) {\r\n\t\t\tthis.settings.height = height;\r\n\t\t}\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.resize(width, height, epubcfi);\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Clear all rendered views\r\n\t */\r\n\tclear() {\r\n\t\tthis.manager.clear();\r\n\t}\r\n\r\n\t/**\r\n\t * Go to the next \"page\" in the rendition\r\n\t * @return {Promise}\r\n\t */\r\n\tnext() {\r\n\t\treturn this.q.enqueue(this.manager.next.bind(this.manager))\r\n\t\t\t.then(this.reportLocation.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Go to the previous \"page\" in the rendition\r\n\t * @return {Promise}\r\n\t */\r\n\tprev() {\r\n\t\treturn this.q.enqueue(this.manager.prev.bind(this.manager))\r\n\t\t\t.then(this.reportLocation.bind(this));\r\n\t}\r\n\r\n\t//-- http://www.idpf.org/epub/301/spec/epub-publications.html#meta-properties-rendering\r\n\t/**\r\n\t * Determine the Layout properties from metadata and settings\r\n\t * @private\r\n\t * @param  {object} metadata\r\n\t * @return {object} properties\r\n\t */\r\n\tdetermineLayoutProperties(metadata) {\r\n\t\tvar properties;\r\n\t\tvar layout = this.settings.layout || metadata.layout || \"reflowable\";\r\n\t\tvar spread = this.settings.spread || metadata.spread || \"auto\";\r\n\t\tvar orientation = this.settings.orientation || metadata.orientation || \"auto\";\r\n\t\tvar flow = this.settings.flow || metadata.flow || \"auto\";\r\n\t\tvar viewport = metadata.viewport || \"\";\r\n\t\t//김병현 수정\r\n\t\tvar minSpreadWidth = this.settings.minSpreadWidth || metadata.minSpreadWidth || 0;\r\n\t\tvar direction = this.settings.direction || metadata.direction || \"ltr\";\r\n\r\n\t\tif ((this.settings.width === 0 || this.settings.width > 0) &&\r\n\t\t\t(this.settings.height === 0 || this.settings.height > 0)) {\r\n\t\t\t// viewport = \"width=\"+this.settings.width+\", height=\"+this.settings.height+\"\";\r\n\t\t}\r\n\r\n\t\tproperties = {\r\n\t\t\tlayout: layout,\r\n\t\t\tspread: spread,\r\n\t\t\torientation: orientation,\r\n\t\t\tflow: flow,\r\n\t\t\tviewport: viewport,\r\n\t\t\tminSpreadWidth: minSpreadWidth,\r\n\t\t\tdirection: direction\r\n\t\t};\r\n\r\n\t\treturn properties;\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust the flow of the rendition to paginated or scrolled\r\n\t * (scrolled-continuous vs scrolled-doc are handled by different view managers)\r\n\t * @param  {string} flow\r\n\t */\r\n\tflow(flow) {\r\n\r\n\t\tvar _flow = flow;\r\n\t\tif (flow === \"scrolled\" ||\r\n\t\t\tflow === \"scrolled-doc\" ||\r\n\t\t\tflow === \"scrolled-continuous\") {\r\n\t\t\t_flow = \"scrolled\";\r\n\t\t}\r\n\r\n\t\tif (flow === \"auto\" || flow === \"paginated\") {\r\n\t\t\t_flow = \"paginated\";\r\n\t\t}\r\n\r\n\t\tthis.settings.flow = flow;\r\n\r\n\t\tif (this._layout) {\r\n\t\t\tthis._layout.flow(_flow);\r\n\t\t}\r\n\r\n\t\tif (this.manager && this._layout) {\r\n\t\t\tthis.manager.applyLayout(this._layout);\r\n\t\t}\r\n\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.updateFlow(_flow);\r\n\t\t}\r\n\r\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\r\n\t\t\tthis.manager.clear();\r\n\t\t\tthis.display(this.location.start.cfi);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust the layout of the rendition to reflowable or pre-paginated\r\n\t * @param  {object} settings\r\n\t */\r\n\tlayout(settings) {\r\n\t\tif (settings) {\r\n\t\t\tthis._layout = new Layout(settings);\r\n\t\t\tthis._layout.spread(settings.spread, this.settings.minSpreadWidth);\r\n\r\n\t\t\t//  this.mapping = new Mapping(this._layout.props);\r\n\r\n\t\t\tthis._layout.on(EVENTS.LAYOUT.UPDATED, (props, changed) => {\r\n\t\t\t\tthis.emit(EVENTS.RENDITION.LAYOUT, props, changed);\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tif (this.manager && this._layout) {\r\n\t\t\tthis.manager.applyLayout(this._layout);\r\n\t\t}\r\n\r\n\t\treturn this._layout;\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust if the rendition uses spreads\r\n\t * @param  {string} spread none | auto (TODO: implement landscape, portrait, both)\r\n\t * @param  {int} [min] min width to use spreads at\r\n\t */\r\n\tspread(spread, min) {\r\n\r\n\t\tthis.settings.spread = spread;\r\n\r\n\t\tif (min) {\r\n\t\t\tthis.settings.minSpreadWidth = min;\r\n\t\t}\r\n\r\n\t\tif (this._layout) {\r\n\t\t\tthis._layout.spread(spread, min);\r\n\t\t}\r\n\r\n\t\tif (this.manager && this.manager.isRendered()) {\r\n\t\t\tthis.manager.updateLayout();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Adjust the direction of the rendition\r\n\t * @param  {string} dir\r\n\t */\r\n\tdirection(dir) {\r\n\r\n\t\tthis.settings.direction = dir || \"ltr\";\r\n\r\n\t\tif (this.manager) {\r\n\t\t\tthis.manager.direction(this.settings.direction);\r\n\t\t}\r\n\r\n\t\tif (this.manager && this.manager.isRendered() && this.location) {\r\n\t\t\tthis.manager.clear();\r\n\t\t\tthis.display(this.location.start.cfi);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Report the current location\r\n\t * @fires relocated\r\n\t * @fires locationChanged\r\n\t */\r\n\treportLocation() {\r\n\t\t//김병현 추가 \r\n\t\tif (this.location) {\r\n\t\t\tlet evt = new CustomEvent(\"pageMoveBefore\", {\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tcfi: this.location.start.cfi\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tdocument.dispatchEvent(evt);\r\n\t\t}\r\n\t\treturn this.q.enqueue(function reportedLocation() {\r\n\t\t\trequestAnimationFrame(function reportedLocationAfterRAF() {\r\n\t\t\t\tvar location = this.manager.currentLocation();\r\n\t\t\t\tif (location && location.then && typeof location.then === \"function\") {\r\n\t\t\t\t\tlocation.then(function (result) {\r\n\r\n\t\t\t\t\t\tlet located = this.located(result);\r\n\r\n\t\t\t\t\t\tif (!located || !located.start || !located.end) {\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\tthis.location = located;\r\n\r\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\r\n\t\t\t\t\t\t\tindex: this.location.start.index,\r\n\t\t\t\t\t\t\thref: this.location.start.href,\r\n\t\t\t\t\t\t\tstart: this.location.start.cfi,\r\n\t\t\t\t\t\t\tend: this.location.end.cfi,\r\n\t\t\t\t\t\t\tpercentage: this.location.start.percentage\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\r\n\t\t\t\t\t}.bind(this));\r\n\t\t\t\t}\r\n\t\t\t\telse if (location) {\r\n\t\t\t\t\tlet located = this.located(location);\r\n\r\n\t\t\t\t\tif (!located || !located.start || !located.end) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.location = located;\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * @event locationChanged\r\n\t\t\t\t\t * @deprecated\r\n\t\t\t\t\t * @type {object}\r\n\t\t\t\t\t * @property {number} index\r\n\t\t\t\t\t * @property {string} href\r\n\t\t\t\t\t * @property {EpubCFI} start\r\n\t\t\t\t\t * @property {EpubCFI} end\r\n\t\t\t\t\t * @property {number} percentage\r\n\t\t\t\t\t * @memberof Rendition\r\n\t\t\t\t\t */\r\n\r\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.LOCATION_CHANGED, {\r\n\t\t\t\t\t\tindex: this.location.start.index,\r\n\t\t\t\t\t\thref: this.location.start.href,\r\n\t\t\t\t\t\tstart: this.location.start.cfi,\r\n\t\t\t\t\t\tend: this.location.end.cfi,\r\n\t\t\t\t\t\tpercentage: this.location.start.percentage\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t/**\r\n\t\t\t\t\t * @event relocated\r\n\t\t\t\t\t * @type {displayedLocation}\r\n\t\t\t\t\t * @memberof Rendition\r\n\t\t\t\t\t */\r\n\t\t\t\t\tthis.emit(EVENTS.RENDITION.RELOCATED, this.location);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Get the Current Location object\r\n\t * @return {displayedLocation | promise} location (may be a promise)\r\n\t */\r\n\tcurrentLocation() {\r\n\t\tvar location = this.manager.currentLocation();\r\n\t\tif (location && location.then && typeof location.then === \"function\") {\r\n\t\t\tlocation.then(function (result) {\r\n\t\t\t\tlet located = this.located(result);\r\n\t\t\t\treturn located;\r\n\t\t\t}.bind(this));\r\n\t\t} else if (location) {\r\n\t\t\tlet located = this.located(location);\r\n\t\t\treturn located;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a Rendition#locationRange from location\r\n\t * passed by the Manager\r\n\t * @returns {displayedLocation}\r\n\t * @private\r\n\t */\r\n\tlocated(location) {\r\n\r\n\t\tif (!location.length) {\r\n\t\t\treturn {};\r\n\t\t}\r\n\t\tlet start = location[0];\r\n\t\tlet end = location[location.length - 1];\r\n\r\n\t\tlet located = {\r\n\t\t\tstart: {\r\n\t\t\t\tindex: start.index,\r\n\t\t\t\thref: start.href,\r\n\t\t\t\tcfi: start.mapping.start,\r\n\t\t\t\tdisplayed: {\r\n\t\t\t\t\tpage: start.pages[0] || 1,\r\n\t\t\t\t\ttotal: start.totalPages\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tend: {\r\n\t\t\t\tindex: end.index,\r\n\t\t\t\thref: end.href,\r\n\t\t\t\tcfi: end.mapping.end,\r\n\t\t\t\tdisplayed: {\r\n\t\t\t\t\tpage: end.pages[end.pages.length - 1] || 1,\r\n\t\t\t\t\ttotal: end.totalPages\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tlet locationStart = this.book.locations.locationFromCfi(start.mapping.start);\r\n\t\tlet locationEnd = this.book.locations.locationFromCfi(end.mapping.end);\r\n\r\n\t\tif (locationStart != null) {\r\n\t\t\tlocated.start.location = locationStart;\r\n\t\t\tlocated.start.percentage = this.book.locations.percentageFromLocation(locationStart);\r\n\t\t}\r\n\t\tif (locationEnd != null) {\r\n\t\t\tlocated.end.location = locationEnd;\r\n\t\t\tlocated.end.percentage = this.book.locations.percentageFromLocation(locationEnd);\r\n\t\t}\r\n\r\n\t\tlet pageStart = this.book.pageList.pageFromCfi(start.mapping.start);\r\n\t\tlet pageEnd = this.book.pageList.pageFromCfi(end.mapping.end);\r\n\r\n\t\tif (pageStart != -1) {\r\n\t\t\tlocated.start.page = pageStart;\r\n\t\t}\r\n\t\tif (pageEnd != -1) {\r\n\t\t\tlocated.end.page = pageEnd;\r\n\t\t}\r\n\r\n\t\tif (end.index === this.book.spine.last().index &&\r\n\t\t\tlocated.end.displayed.page >= located.end.displayed.total) {\r\n\t\t\tlocated.atEnd = true;\r\n\t\t}\r\n\r\n\t\tif (start.index === this.book.spine.first().index &&\r\n\t\t\tlocated.start.displayed.page === 1) {\r\n\t\t\tlocated.atStart = true;\r\n\t\t}\r\n\r\n\t\treturn located;\r\n\t}\r\n\r\n\t/**\r\n\t * Remove and Clean Up the Rendition\r\n\t */\r\n\tdestroy() {\r\n\t\t// Clear the queue\r\n\t\t// this.q.clear();\r\n\t\t// this.q = undefined;\r\n\r\n\t\tthis.manager && this.manager.destroy();\r\n\r\n\t\tthis.book = undefined;\r\n\r\n\t\t// this.views = null;\r\n\r\n\t\t// this.hooks.display.clear();\r\n\t\t// this.hooks.serialize.clear();\r\n\t\t// this.hooks.content.clear();\r\n\t\t// this.hooks.layout.clear();\r\n\t\t// this.hooks.render.clear();\r\n\t\t// this.hooks.show.clear();\r\n\t\t// this.hooks = {};\r\n\r\n\t\t// this.themes.destroy();\r\n\t\t// this.themes = undefined;\r\n\r\n\t\t// this.epubcfi = undefined;\r\n\r\n\t\t// this.starting = undefined;\r\n\t\t// this.started = undefined;\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Pass the events from a view's Contents\r\n\t * @private\r\n\t * @param  {Contents} view contents\r\n\t */\r\n\tpassEvents(contents) {\r\n\t\tDOM_EVENTS.forEach((e) => {\r\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\r\n\t\t});\r\n\r\n\t\tcontents.on(EVENTS.CONTENTS.SELECTED, (e) => this.triggerSelectedEvent(e, contents));\r\n\r\n\t\tcontents.on(\"customSelect\", (range, contents, startTop, startLeft, endTop, endLeft, text, doc) => this.triggerCustomSelectedEvent(range, contents, startTop, startLeft, endTop, endLeft, text, doc));\r\n\t\tcontents.on(\"customSelectCancel\", () => this.triggerCustomSelectedCancelEvent());\r\n\r\n\r\n\t\tcontents.on(\"click\", () => { this.emit(\"click\") });\r\n\t}\r\n\r\n\t/**\r\n\t * Emit events passed by a view\r\n\t * @private\r\n\t * @param  {event} e\r\n\t */\r\n\ttriggerViewEvent(e, contents) {\r\n\t\tthis.emit(e.type, e, contents);\r\n\t}\r\n\r\n\t/**\r\n\t * Emit a selection event's CFI Range passed from a a view\r\n\t * @private\r\n\t * @param  {string} cfirange\r\n\t */\r\n\ttriggerSelectedEvent(cfirange, contents) {\r\n\t\t/**\r\n\t\t * Emit that a text selection has occured\r\n\t\t * @event selected\r\n\t\t * @param {string} cfirange\r\n\t\t * @param {Contents} contents\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.SELECTED, cfirange, contents);\r\n\t}\r\n\t//김병현추가\r\n\ttriggerCustomSelectedEvent(cfirange, contents, startTop, startLeft, endTop, endLeft, text, doc) {\r\n\t\t/**\r\n\t\t * Emit that a text selection has occured\r\n\t\t * @event selected\r\n\t\t * @param {string} cfirange\r\n\t\t * @param {Contents} contents\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(\"customSelect\", cfirange, contents, startTop, startLeft, endTop, endLeft, text, doc);\r\n\t}\r\n\t//김병현추가\r\n\ttriggerCustomSelectedCancelEvent(cfirange, contents, x, y) {\r\n\t\t/**\r\n\t\t * Emit that a text selection has occured\r\n\t\t * @event selected\r\n\t\t * @param {string} cfirange\r\n\t\t * @param {Contents} contents\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(\"customSelectCancel\", cfirange, contents, x, y);\r\n\t}\r\n\r\n\t/**\r\n\t * Emit a markClicked event with the cfiRange and data from a mark\r\n\t * @private\r\n\t * @param  {EpubCFI} cfirange\r\n\t */\r\n\ttriggerMarkEvent(cfiRange, data, contents, color) {\r\n\t\t/**\r\n\t\t * Emit that a mark was clicked\r\n\t\t * @event markClicked\r\n\t\t * @param {EpubCFI} cfirange\r\n\t\t * @param {object} data\r\n\t\t * @param {Contents} contents\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.MARK_CLICKED, cfiRange, data, contents, color);\r\n\t}\r\n\r\n\t//김병현 추가\r\n\ttriggerMarkImageEvent(data) {\r\n\t\t/**\r\n\t\t * Emit that a mark was clicked\r\n\t\t * @event markClicked\r\n\t\t * @param {EpubCFI} cfirange\r\n\t\t * @param {object} data\r\n\t\t * @param {Contents} contents\r\n\t\t * @memberof Rendition\r\n\t\t */\r\n\t\tthis.emit(EVENTS.RENDITION.MARK_IMAGE_CLICKED, data);\r\n\t}\r\n\r\n\r\n\r\n\t/**\r\n\t * Get a Range from a Visible CFI\r\n\t * @param  {string} cfi EpubCfi String\r\n\t * @param  {string} ignoreClass\r\n\t * @return {range}\r\n\t */\r\n\tgetRange(cfi, ignoreClass) {\r\n\t\tvar _cfi = new EpubCFI(cfi);\r\n\t\tvar found = this.manager.visible().filter(function (view) {\r\n\t\t\tif (_cfi.spinePos === view.index) return true;\r\n\t\t});\r\n\r\n\t\t// Should only every return 1 item\r\n\t\tif (found.length) {\r\n\t\t\treturn found[0].contents.range(_cfi, ignoreClass);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hook to adjust images to fit in columns\r\n\t * @param  {Contents} contents\r\n\t * @private\r\n\t */\r\n\tadjustImages(contents) {\r\n\r\n\t\tif (this._layout.name === \"pre-paginated\") {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tlet computed = contents.window.getComputedStyle(contents.content, null);\r\n\t\tlet height = (contents.content.offsetHeight - (parseFloat(computed.paddingTop) + parseFloat(computed.paddingBottom)));\r\n\t\tlet horizontalPadding = parseFloat(computed.paddingLeft) + parseFloat(computed.paddingRight);\r\n\t\tcontents.addStylesheetRules({\r\n\t\t\t\"img\": {\r\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\r\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\r\n\t\t\t\t\"object-fit\": \"contain\",\r\n\t\t\t\t\"page-break-inside\": \"avoid\",\r\n\t\t\t\t\"break-inside\": \"avoid\",\r\n\t\t\t\t\"box-sizing\": \"border-box\"\r\n\t\t\t},\r\n\t\t\t\"svg\": {\r\n\t\t\t\t\"max-width\": (this._layout.columnWidth ? (this._layout.columnWidth - horizontalPadding) + \"px\" : \"100%\") + \"!important\",\r\n\t\t\t\t\"max-height\": height + \"px\" + \"!important\",\r\n\t\t\t\t\"page-break-inside\": \"avoid\",\r\n\t\t\t\t\"break-inside\": \"avoid\"\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\t// Wait to apply\r\n\t\t\tsetTimeout(function () {\r\n\t\t\t\tresolve();\r\n\t\t\t}, 1);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get the Contents object of each rendered view\r\n\t * @returns {Contents[]}\r\n\t */\r\n\tgetContents() {\r\n\t\treturn this.manager ? this.manager.getContents() : [];\r\n\t}\r\n\r\n\tgetAllContents() {\r\n\t\treturn this.manager ? this.manager.getAllContents() : [];\r\n\t}\r\n\r\n\t/**\r\n\t * Get the views member from the manager\r\n\t * @returns {Views}\r\n\t */\r\n\tviews() {\r\n\t\tlet views = this.manager ? this.manager.views : undefined;\r\n\t\treturn views || [];\r\n\t}\r\n\r\n\t/**\r\n\t * Hook to handle link clicks in rendered content\r\n\t * @param  {Contents} contents\r\n\t * @private\r\n\t */\r\n\thandleLinks(contents) {\r\n\t\tif (contents) {\r\n\t\t\tcontents.on(EVENTS.CONTENTS.LINK_CLICKED, (href) => {\r\n\t\t\t\tlet relative = this.book.path.relative(href);\r\n\t\t\t\tthis.display(relative);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Hook to handle injecting stylesheet before\r\n\t * a Section is serialized\r\n\t * @param  {document} doc\r\n\t * @param  {Section} section\r\n\t * @private\r\n\t */\r\n\tinjectStylesheet(doc, section) {\r\n\t\tlet style = doc.createElement(\"link\");\r\n\t\tstyle.setAttribute(\"type\", \"text/css\");\r\n\t\tstyle.setAttribute(\"rel\", \"stylesheet\");\r\n\t\tstyle.setAttribute(\"href\", this.settings.stylesheet);\r\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(style);\r\n\t}\r\n\r\n\t/**\r\n\t * Hook to handle injecting scripts before\r\n\t * a Section is serialized\r\n\t * @param  {document} doc\r\n\t * @param  {Section} section\r\n\t * @private\r\n\t */\r\n\tinjectScript(doc, section) {\r\n\t\tlet script = doc.createElement(\"script\");\r\n\t\tscript.setAttribute(\"type\", \"text/javascript\");\r\n\t\tscript.setAttribute(\"src\", this.settings.script);\r\n\t\tscript.textContent = \" \"; // Needed to prevent self closing tag\r\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(script);\r\n\t}\r\n\r\n\t/**\r\n\t * Hook to handle the document identifier before\r\n\t * a Section is serialized\r\n\t * @param  {document} doc\r\n\t * @param  {Section} section\r\n\t * @private\r\n\t */\r\n\tinjectIdentifier(doc, section) {\r\n\t\tlet ident = this.book.packaging.metadata.identifier;\r\n\t\tlet meta = doc.createElement(\"meta\");\r\n\t\tmeta.setAttribute(\"name\", \"dc.relation.ispartof\");\r\n\t\tif (ident) {\r\n\t\t\tmeta.setAttribute(\"content\", ident);\r\n\t\t}\r\n\t\tdoc.getElementsByTagName(\"head\")[0].appendChild(meta);\r\n\t}\r\n\r\n}\r\n\r\n//-- Enable binding events to Renderer\r\nEventEmitter(Rendition.prototype);\r\n\r\nexport default Rendition;\r\n","/**\r\n * Returns true if the start point of a selection occurs after the end point,\r\n * in document order.\r\n *\r\n * @param {Selection} selection\r\n */\r\nexport function isSelectionBackwards(selection) {\r\n  if (selection.focusNode === selection.anchorNode) {\r\n    return selection.focusOffset < selection.anchorOffset;\r\n  }\r\n\r\n  const range = selection.getRangeAt(0);\r\n  // Does not work correctly on iOS when selecting nodes backwards.\r\n  // https://bugs.webkit.org/show_bug.cgi?id=220523\r\n  return range.startContainer === selection.focusNode;\r\n}\r\n\r\n/**\r\n * Returns true if any part of `node` lies within `range`.\r\n *\r\n * @param {Range} range\r\n * @param {Node} node\r\n */\r\nexport function isNodeInRange(range, node) {\r\n  try {\r\n    // if (node.NodeValue.length)\r\n    // const length = node.nodeValue?.length ?? node.childNodes.length;\r\n    let length;\r\n\r\n    if (node && node.nodeValue && node.nodeValue.length) {\r\n      length = node.nodeValue.length;\r\n    }\r\n    else {\r\n      length = node.childNodes.length;\r\n    }\r\n    return (\r\n      // Check start of node is before end of range.\r\n      range.comparePoint(node, 0) <= 0 &&\r\n      // Check end of node is after start of range.\r\n      range.comparePoint(node, length) >= 0\r\n    );\r\n  } catch (e) {\r\n    // `comparePoint` may fail if the `range` and `node` do not share a common\r\n    // ancestor or `node` is a doctype.\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Iterate over all Node(s) which overlap `range` in document order and invoke\r\n * `callback` for each of them.\r\n *\r\n * @param {Range} range\r\n * @param {(n: Node) => any} callback\r\n */\r\nexport function forEachNodeInRange(range, callback) {\r\n  const root = range.commonAncestorContainer;\r\n  const nodeIter = /** @type {Document} */ (root.ownerDocument).createNodeIterator(\r\n    root,\r\n    NodeFilter.SHOW_ALL\r\n  );\r\n\r\n  let currentNode;\r\n  while ((currentNode = nodeIter.nextNode())) {\r\n    if (isNodeInRange(range, currentNode)) {\r\n      callback(currentNode);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Returns the bounding rectangles of non-whitespace text nodes in `range`.\r\n *\r\n * @param {Range} range\r\n * @return {Array<DOMRect>} Array of bounding rects in viewport coordinates.\r\n */\r\nexport function getTextBoundingBoxes(range) {\r\n  const whitespaceOnly = /^\\s*$/;\r\n  const textNodes = [];\r\n  forEachNodeInRange(range, function (node) {\r\n    if (\r\n      node.nodeType === Node.TEXT_NODE &&\r\n      !(/** @type {string} */ (node.textContent).match(whitespaceOnly))\r\n    ) {\r\n      textNodes.push(node);\r\n    }\r\n  });\r\n\r\n  let rects = [];\r\n  textNodes.forEach(function (node) {\r\n    const nodeRange = node.ownerDocument.createRange();\r\n    nodeRange.selectNodeContents(node);\r\n    if (node === range.startContainer) {\r\n      nodeRange.setStart(node, range.startOffset);\r\n    }\r\n    if (node === range.endContainer) {\r\n      nodeRange.setEnd(node, range.endOffset);\r\n    }\r\n    if (nodeRange.collapsed) {\r\n      // If the range ends at the start of this text node or starts at the end\r\n      // of this node then do not include it.\r\n      return;\r\n    }\r\n\r\n    // Measure the range and translate from viewport to document coordinates\r\n    const viewportRects = Array.from(nodeRange.getClientRects());\r\n    nodeRange.detach();\r\n    rects = rects.concat(viewportRects);\r\n  });\r\n  return rects;\r\n}\r\n\r\n/**\r\n * Returns the rectangle, in viewport coordinates, for the line of text\r\n * containing the focus point of a Selection.\r\n *\r\n * Returns null if the selection is empty.\r\n *\r\n * @param {Selection} selection\r\n * @return {DOMRect|null}\r\n */\r\nexport function selectionFocusRect(selection) {\r\n  if (selection.isCollapsed) {\r\n    return null;\r\n  }\r\n  const textBoxes = getTextBoundingBoxes(selection.getRangeAt(0));\r\n  if (textBoxes.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  let loc = {};\r\n  loc.start = textBoxes[0];\r\n  loc.end = textBoxes[textBoxes.length - 1];\r\n  return loc;\r\n  if (isSelectionBackwards(selection)) {\r\n    return textBoxes[0];\r\n  } else {\r\n    return textBoxes[textBoxes.length - 1];\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieve a set of items associated with nodes in a given range.\r\n *\r\n * An `item` can be any data that the caller wishes to compute from or associate\r\n * with a node. Only unique items, as determined by `Object.is`, are returned.\r\n *\r\n * @template T\r\n * @param {Range} range\r\n * @param {(n: Node) => T} itemForNode - Callback returning the item for a given node\r\n * @return {T[]} items\r\n */\r\nexport function itemsForRange(range, itemForNode) {\r\n  const checkedNodes = new Set();\r\n  const items = new Set();\r\n\r\n  forEachNodeInRange(range, node => {\r\n    /** @type {Node|null} */\r\n    let current = node;\r\n    while (current) {\r\n      if (checkedNodes.has(current)) {\r\n        break;\r\n      }\r\n      checkedNodes.add(current);\r\n\r\n      const item = itemForNode(current);\r\n      if (item) {\r\n        items.add(item);\r\n      }\r\n\r\n      current = current.parentNode;\r\n    }\r\n  });\r\n\r\n  return [...items];\r\n}\r\n","\r\nimport EpubCFI from \"./epubcfi\";\r\nimport * as rangeUtil from \"./utils/range-util\";\r\n\r\nclass SelectionObserver {\r\n    constructor(contents) {\r\n        this.contents = contents;\r\n        this.document = contents.document;\r\n        let eventHandler = (e) => {\r\n            //안드로이드의 경우 touchend, mouseup 이벤트가 화면터치로 발생되지 않아 나눴습니다.\r\n            if (typeof (iosChecker) == \"undefined\" || iosChecker == true) { //ios의 경우 또는 PC VIEWER\r\n                if (e.type == \"selectionchange\") {\r\n                    let selection = this.document.getSelection();\r\n\r\n                    if (selection) {\r\n                        if (!(selection.type == \"Range\")) {\r\n                            // this.contents.emit(\"customSelectCancel\");\r\n                            return;\r\n                        }\r\n                        let cfirange = new EpubCFI(selection.getRangeAt(0), this.contents.cfiBase).toString();\r\n                        this.range = cfirange;\r\n                        this.selection = selection;\r\n\r\n                        // const selectionRange = selection.getRangeAt(0);\r\n                        // selection.removeAllRanges();\r\n                        // selection.addRange(selectionRange);\r\n                    }\r\n                    else {\r\n                        // this.contents.emit(\"customSelectCancel\");\r\n                    }\r\n\r\n                }\r\n                else if (e.type == \"mouseup\" || e.type == \"touchend\" || e.type == \"touchcancel\") {\r\n                    if (typeof (iosChecker) == \"undefined\" || iosChecker == true || iosChecker == false) {\r\n                        setTimeout(() => {\r\n                            if (!this.selection) return;\r\n                            let { startTop, startLeft, endTop, endLeft } = this.calculateTarget(rangeUtil.selectionFocusRect(this.selection));\r\n                            if (this.range) {\r\n                                this.contents.emit(\"customSelect\", this.range, this.contents, startTop, startLeft, endTop, endLeft, this.selection.toString(), this.contents);\r\n                            }\r\n                        }, 10)\r\n                    }\r\n\r\n                }\r\n                else if (e.type == \"mousedown\" || e.type == \"touchstart\") {\r\n                    // if (this.selection) {\r\n                    //     this.selection.removeAllRanges();\r\n                    // }\r\n                    this.selection = null;\r\n                    this.contents.emit(\"customSelectCancel\");\r\n                }\r\n                else if (e.type == \"touchmove\") {\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n            else { //안드로이드 \r\n                if (e.type == \"selectionchange\") {\r\n                    let selection = this.document.getSelection();\r\n                    this.selection = selection;\r\n                    if (selection) {\r\n                        if (!(selection.type == \"Range\")) {\r\n                            return;\r\n                        }\r\n                        setTimeout(() => {\r\n                            if (!this.selection) return;\r\n                            let { startTop, startLeft, endTop, endLeft } = this.calculateTarget(rangeUtil.selectionFocusRect(this.selection));\r\n                            let cfirange = new EpubCFI(selection.getRangeAt(0), this.contents.cfiBase).toString();\r\n                            this.range = cfirange;\r\n                            if (this.range) {\r\n                                this.contents.emit(\"customSelect\", this.range, this.contents, startTop, startLeft, endTop, endLeft, this.selection.toString(), this.contents);\r\n                            }\r\n                        }, 10)\r\n                    }\r\n                }\r\n\r\n                else if (e.type == \"touchstart\" || e.type == \"mousedown\") {\r\n                    this.selection = null;\r\n                    this.contents.emit(\"customSelectCancel\");\r\n                }\r\n                else if (e.type == \"touchend\" || e.type == \"mouseup\") {\r\n\r\n                }\r\n            }\r\n        }\r\n        this.eventHandler = eventHandler;\r\n    }\r\n\r\n    addListener() {\r\n        this.document.addEventListener(\"mouseup\", this.eventHandler, true);\r\n        this.document.addEventListener(\"mousedown\", this.eventHandler);\r\n        this.document.addEventListener(\"touchstart\", this.eventHandler);\r\n        this.document.addEventListener(\"touchend\", this.eventHandler, true);\r\n        this.document.addEventListener(\"touchcancel\", this.eventHandler);\r\n        this.document.addEventListener(\"touchmove\", this.eventHandler);\r\n        this.document.addEventListener(\"selectionchange\", this.eventHandler);\r\n    }\r\n    removeListener() {\r\n        this.document.removeEventListener(\"mouseup\", this.eventHandler);\r\n        this.document.removeEventListener(\"mousedown\", this.eventHandler);\r\n        this.document.removeEventListener(\"touchstart\", this.eventHandler);\r\n        this.document.removeEventListener(\"touchend\", this.eventHandler);\r\n        this.document.removeEventListener(\"touchcancel\", this.eventHandler);\r\n        this.document.removeEventListener(\"touchmove\", this.eventHandler);\r\n        this.document.removeEventListener(\"selectionchange\", this.eventHandler);\r\n    }\r\n\r\n    getLoc(range) {\r\n        let textBoxes = rangeUtil.getTextBoundingBoxes(range);\r\n        let loc = {};\r\n        loc.start = textBoxes[0];\r\n        loc.end = textBoxes[textBoxes.length - 1];\r\n        return this.calculateTarget(loc);\r\n    }\r\n\r\n    calculateTarget(selectionRect) {\r\n        if (selectionRect) {\r\n            let startTop;\r\n            let startLeft;\r\n            let endTop;\r\n            let endLeft;\r\n            startLeft = selectionRect.start.left;\r\n            endLeft = selectionRect.end.left + selectionRect.end.width;\r\n            startTop = selectionRect.start.top;\r\n            endTop = selectionRect.end.top + selectionRect.end.height;\r\n\r\n\r\n            // Constrain the adder to the viewport.\r\n            // startLeft = Math.max(startLeft, 0);\r\n            // endLeft = Math.min(endLeft, this.document.innerWidth);\r\n            // startTop = Math.max(startTop, 0);\r\n            // endTop = Math.min(endTop, this.document.innerHeight);\r\n            // let views = rendition.views()._views;\r\n            // for(let i=0;i<views.length;i++){\r\n            //     if(!(views[i].contents == this.contents)){\r\n            //         top += views[i].contents.clientHeight;\r\n            //     }\r\n            // }\r\n\r\n\r\n            return { startTop, startLeft, endTop, endLeft };\r\n        }\r\n        else {\r\n            return { top: -9999, left: -9999 };\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\r\nexport default SelectionObserver;","import EventEmitter from \"event-emitter\";\r\nimport {isNumber, prefixed, borders, defaults} from \"./utils/core\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport Mapping from \"./mapping\";\r\nimport {replaceLinks} from \"./utils/replacements\";\r\nimport { EPUBJS_VERSION, EVENTS, DOM_EVENTS } from \"./utils/constants\";\r\n\r\n//김병현추가\r\nimport SelectionObserver from \"./selectionObserver\";\r\n\r\nconst hasNavigator = typeof (navigator) !== \"undefined\";\r\n\r\nconst isChrome = hasNavigator && /Chrome/.test(navigator.userAgent);\r\nconst isWebkit = hasNavigator && !isChrome && /AppleWebKit/.test(navigator.userAgent);\r\n\r\nconst ELEMENT_NODE = 1;\r\nconst TEXT_NODE = 3;\r\n\r\n/**\r\n\t* Handles DOM manipulation, queries and events for View contents\r\n\t* @class\r\n\t* @param {document} doc Document\r\n\t* @param {element} content Parent Element (typically Body)\r\n\t* @param {string} cfiBase Section component of CFIs\r\n\t* @param {number} sectionIndex Index in Spine of Conntent's Section\r\n\t*/\r\nclass Contents {\r\n\tconstructor(doc, content, cfiBase, sectionIndex) {\r\n\t\t// Blank Cfi for Parsing\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis.document = doc;\r\n\t\tthis.documentElement =  this.document.documentElement;\r\n\t\tthis.content = content || this.document.body;\r\n\t\tthis.window = this.document.defaultView;\r\n\r\n\t\tthis._size = {\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0\r\n\t\t};\r\n\r\n\t\tthis.sectionIndex = sectionIndex || 0;\r\n\t\tthis.cfiBase = cfiBase || \"\";\r\n\r\n\t\tthis.epubReadingSystem(\"epub.js\", EPUBJS_VERSION);\r\n\t\tthis.called = 0;\r\n\t\tthis.active = true;\r\n\r\n//김병현 추가\r\n\t\tthis.selectionObserver  = new SelectionObserver(this);\r\n\r\n\t\tthis.listeners();\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get DOM events that are listened for and passed along\r\n\t\t*/\r\n\tstatic get listenedEvents() {\r\n\t\treturn DOM_EVENTS;\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get or Set width\r\n\t\t* @param {number} [w]\r\n\t\t* @returns {number} width\r\n\t\t*/\r\n\twidth(w) {\r\n\t\t// var frame = this.documentElement;\r\n\t\tvar frame = this.content;\r\n\r\n\t\tif (w && isNumber(w)) {\r\n\t\t\tw = w + \"px\";\r\n\t\t}\r\n\r\n\t\tif (w) {\r\n\t\t\tframe.style.width = w;\r\n\t\t\t// this.content.style.width = w;\r\n\t\t}\r\n\r\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"width\"]);\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get or Set height\r\n\t\t* @param {number} [h]\r\n\t\t* @returns {number} height\r\n\t\t*/\r\n\theight(h) {\r\n\t\t// var frame = this.documentElement;\r\n\t\tvar frame = this.content;\r\n\r\n\t\tif (h && isNumber(h)) {\r\n\t\t\th = h + \"px\";\r\n\t\t}\r\n\r\n\t\tif (h) {\r\n\t\t\tframe.style.height = h;\r\n\t\t\t// this.content.style.height = h;\r\n\t\t}\r\n\r\n\t\treturn parseInt(this.window.getComputedStyle(frame)[\"height\"]);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get or Set width of the contents\r\n\t\t* @param {number} [w]\r\n\t\t* @returns {number} width\r\n\t\t*/\r\n\tcontentWidth(w) {\r\n\r\n\t\tvar content = this.content || this.document.body;\r\n\r\n\t\tif (w && isNumber(w)) {\r\n\t\t\tw = w + \"px\";\r\n\t\t}\r\n\r\n\t\tif (w) {\r\n\t\t\tcontent.style.width = w;\r\n\t\t}\r\n\r\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"width\"]);\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get or Set height of the contents\r\n\t\t* @param {number} [h]\r\n\t\t* @returns {number} height\r\n\t\t*/\r\n\tcontentHeight(h) {\r\n\r\n\t\tvar content = this.content || this.document.body;\r\n\r\n\t\tif (h && isNumber(h)) {\r\n\t\t\th = h + \"px\";\r\n\t\t}\r\n\r\n\t\tif (h) {\r\n\t\t\tcontent.style.height = h;\r\n\t\t}\r\n\r\n\t\treturn parseInt(this.window.getComputedStyle(content)[\"height\"]);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get the width of the text using Range\r\n\t\t* @returns {number} width\r\n\t\t*/\r\n\ttextWidth() {\r\n\t\tlet rect;\r\n\t\tlet width;\r\n\t\tlet range = this.document.createRange();\r\n\t\tlet content = this.content || this.document.body;\r\n\t\tlet border = borders(content);\r\n\r\n\t\t// Select the contents of frame\r\n\t\trange.selectNodeContents(content);\r\n\r\n\t\t// get the width of the text content\r\n\t\trect = range.getBoundingClientRect();\r\n\t\twidth = rect.width;\r\n\r\n\t\tif (border && border.width) {\r\n\t\t\twidth += border.width;\r\n\t\t}\r\n\r\n\t\treturn Math.round(width);\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get the height of the text using Range\r\n\t\t* @returns {number} height\r\n\t\t*/\r\n\ttextHeight() {\r\n\t\tlet rect;\r\n\t\tlet height;\r\n\t\tlet range = this.document.createRange();\r\n\t\tlet content = this.content || this.document.body;\r\n\r\n\t\trange.selectNodeContents(content);\r\n\r\n\t\trect = range.getBoundingClientRect();\r\n\t\theight = rect.bottom;\r\n\r\n\t\treturn Math.round(height);\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get documentElement scrollWidth\r\n\t\t* @returns {number} width\r\n\t\t*/\r\n\tscrollWidth() {\r\n\t\tvar width = this.documentElement.scrollWidth;\r\n\r\n\t\treturn width;\r\n\t}\r\n\r\n\t/**\r\n\t\t* Get documentElement scrollHeight\r\n\t\t* @returns {number} height\r\n\t\t*/\r\n\tscrollHeight() {\r\n\t\tvar height = this.documentElement.scrollHeight;\r\n\r\n\t\treturn height;\r\n\t}\r\n\r\n\t/**\r\n\t\t* Set overflow css style of the contents\r\n\t\t* @param {string} [overflow]\r\n\t\t*/\r\n\toverflow(overflow) {\r\n\r\n\t\tif (overflow) {\r\n\t\t\tthis.documentElement.style.overflow = overflow;\r\n\t\t}\r\n\r\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflow\"];\r\n\t}\r\n\r\n\t/**\r\n\t\t* Set overflowX css style of the documentElement\r\n\t\t* @param {string} [overflow]\r\n\t\t*/\r\n\toverflowX(overflow) {\r\n\r\n\t\tif (overflow) {\r\n\t\t\tthis.documentElement.style.overflowX = overflow;\r\n\t\t}\r\n\r\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowX\"];\r\n\t}\r\n\r\n\t/**\r\n\t\t* Set overflowY css style of the documentElement\r\n\t\t* @param {string} [overflow]\r\n\t\t*/\r\n\toverflowY(overflow) {\r\n\r\n\t\tif (overflow) {\r\n\t\t\tthis.documentElement.style.overflowY = overflow;\r\n\t\t}\r\n\r\n\t\treturn this.window.getComputedStyle(this.documentElement)[\"overflowY\"];\r\n\t}\r\n\r\n\t/**\r\n\t\t* Set Css styles on the contents element (typically Body)\r\n\t\t* @param {string} property\r\n\t\t* @param {string} value\r\n\t\t* @param {boolean} [priority] set as \"important\"\r\n\t\t*/\r\n\tcss(property, value, priority) {\r\n\t\tvar content = this.content || this.document.body;\r\n\t\tif (value) {\r\n\t\t\tcontent.style.setProperty(property, value, priority ? \"important\" : \"\");\r\n\t\t} else {\r\n\t\t\tcontent.style.removeProperty(property);\r\n\t\t}\r\n\r\n\t\treturn this.window.getComputedStyle(content)[property];\r\n\t}\r\n\r\n\t//김병현 추가\r\n\tchangeChildCss(property, value){\r\n\t\tvar allElement = this.document.body.getElementsByTagName(\"p\");\r\n\t\tfor(var i =0;i<allElement.length;i++){\r\n\t\t\tif(value){\r\n\t\t\t\tallElement[i].style.setProperty(property, value, \"important\");\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tallElement[i].style.removeProperty(property);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\t/**\r\n\t\t* Get or Set the viewport element\r\n\t\t* @param {object} [options]\r\n\t\t* @param {string} [options.width]\r\n\t\t* @param {string} [options.height]\r\n\t\t* @param {string} [options.scale]\r\n\t\t* @param {string} [options.minimum]\r\n\t\t* @param {string} [options.maximum]\r\n\t\t* @param {string} [options.scalable]\r\n\t\t*/\r\n\tviewport(options) {\r\n\t\tvar _width, _height, _scale, _minimum, _maximum, _scalable;\r\n\t\t// var width, height, scale, minimum, maximum, scalable;\r\n\t\tvar $viewport = this.document.querySelector(\"meta[name='viewport']\");\r\n\t\tvar parsed = {\r\n\t\t\t\"width\": undefined,\r\n\t\t\t\"height\": undefined,\r\n\t\t\t\"scale\": undefined,\r\n\t\t\t\"minimum\": undefined,\r\n\t\t\t\"maximum\": undefined,\r\n\t\t\t\"scalable\": undefined\r\n\t\t};\r\n\t\tvar newContent = [];\r\n\t\tvar settings = {};\r\n\r\n\t\t/*\r\n\t\t* check for the viewport size\r\n\t\t* <meta name=\"viewport\" content=\"width=1024,height=697\" />\r\n\t\t*/\r\n\t\tif($viewport && $viewport.hasAttribute(\"content\")) {\r\n\t\t\tlet content = $viewport.getAttribute(\"content\");\r\n\t\t\tlet _width = content.match(/width\\s*=\\s*([^,]*)/);\r\n\t\t\tlet _height = content.match(/height\\s*=\\s*([^,]*)/);\r\n\t\t\tlet _scale = content.match(/initial-scale\\s*=\\s*([^,]*)/);\r\n\t\t\tlet _minimum = content.match(/minimum-scale\\s*=\\s*([^,]*)/);\r\n\t\t\tlet _maximum = content.match(/maximum-scale\\s*=\\s*([^,]*)/);\r\n\t\t\tlet _scalable = content.match(/user-scalable\\s*=\\s*([^,]*)/);\r\n\r\n\t\t\tif(_width && _width.length && typeof _width[1] !== \"undefined\"){\r\n\t\t\t\tparsed.width = _width[1];\r\n\t\t\t}\r\n\t\t\tif(_height && _height.length && typeof _height[1] !== \"undefined\"){\r\n\t\t\t\tparsed.height = _height[1];\r\n\t\t\t}\r\n\t\t\tif(_scale && _scale.length && typeof _scale[1] !== \"undefined\"){\r\n\t\t\t\tparsed.scale = _scale[1];\r\n\t\t\t}\r\n\t\t\tif(_minimum && _minimum.length && typeof _minimum[1] !== \"undefined\"){\r\n\t\t\t\tparsed.minimum = _minimum[1];\r\n\t\t\t}\r\n\t\t\tif(_maximum && _maximum.length && typeof _maximum[1] !== \"undefined\"){\r\n\t\t\t\tparsed.maximum = _maximum[1];\r\n\t\t\t}\r\n\t\t\tif(_scalable && _scalable.length && typeof _scalable[1] !== \"undefined\"){\r\n\t\t\t\tparsed.scalable = _scalable[1];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsettings = defaults(options || {}, parsed);\r\n\r\n\t\tif (options) {\r\n\t\t\tif (settings.width) {\r\n\t\t\t\tnewContent.push(\"width=\" + settings.width);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.height) {\r\n\t\t\t\tnewContent.push(\"height=\" + settings.height);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.scale) {\r\n\t\t\t\tnewContent.push(\"initial-scale=\" + settings.scale);\r\n\t\t\t}\r\n\r\n\t\t\tif (settings.scalable === \"no\") {\r\n\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.scale);\r\n\t\t\t\tnewContent.push(\"maximum-scale=\" + settings.scale);\r\n\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif (settings.scalable) {\r\n\t\t\t\t\tnewContent.push(\"user-scalable=\" + settings.scalable);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.minimum) {\r\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.minimum);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settings.maximum) {\r\n\t\t\t\t\tnewContent.push(\"minimum-scale=\" + settings.maximum);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!$viewport) {\r\n\t\t\t\t$viewport = this.document.createElement(\"meta\");\r\n\t\t\t\t$viewport.setAttribute(\"name\", \"viewport\");\r\n\t\t\t\tthis.document.querySelector(\"head\").appendChild($viewport);\r\n\t\t\t}\r\n\r\n\t\t\t$viewport.setAttribute(\"content\", newContent.join(\", \"));\r\n\r\n\t\t\tthis.window.scrollTo(0, 0);\r\n\t\t}\r\n\r\n\r\n\t\treturn settings;\r\n\t}\r\n\r\n\t/**\r\n\t * Event emitter for when the contents has expanded\r\n\t * @private\r\n\t */\r\n\texpand() {\r\n\t\tthis.emit(EVENTS.CONTENTS.EXPAND);\r\n\t}\r\n\r\n\t/**\r\n\t * Add DOM listeners\r\n\t * @private\r\n\t */\r\n\tlisteners() {\r\n\t\tthis.imageLoadListeners();\r\n\r\n\t\tthis.mediaQueryListeners();\r\n\r\n\t\t// this.fontLoadListeners();\r\n\r\n\t\tthis.addEventListeners();\r\n\r\n\t\tthis.addSelectionListeners();\r\n\r\n\t\t// this.transitionListeners();\r\n\r\n\t\tif (typeof ResizeObserver === \"undefined\") {\r\n\t\t\tthis.resizeListeners();\r\n\t\t\tthis.visibilityListeners();\r\n\t\t} else {\r\n\t\t\tthis.resizeObservers();\r\n\t\t}\r\n\r\n\t\t// this.mutationObservers();\r\n\r\n\t\tthis.linksHandler();\r\n\t\t//김병현 추가\r\n\t\tthis.selectionObserver.addListener();\r\n\t\t//\r\n\t}\r\n\r\n\t/**\r\n\t * Remove DOM listeners\r\n\t * @private\r\n\t */\r\n\tremoveListeners() {\r\n\r\n\t\tthis.removeEventListeners();\r\n\r\n\t\tthis.removeSelectionListeners();\r\n\r\n\t\tif (this.observer) {\r\n\t\t\tthis.observer.disconnect();\r\n\t\t}\r\n\r\n\t\tclearTimeout(this.expanding);\r\n\t\t//김병현 추가\r\n\t\tthis.selectionObserver.removeListener();\r\n\t}\r\n\r\n\t/**\r\n\t * Check if size of contents has changed and\r\n\t * emit 'resize' event if it has.\r\n\t * @private\r\n\t */\r\n\tresizeCheck() {\r\n\t\tlet width = this.textWidth();\r\n\t\tlet height = this.textHeight();\r\n\r\n\t\tif (width != this._size.width || height != this._size.height) {\r\n\r\n\t\t\tthis._size = {\r\n\t\t\t\twidth: width,\r\n\t\t\t\theight: height\r\n\t\t\t};\r\n\r\n\t\t\tthis.onResize && this.onResize(this._size);\r\n\t\t\tthis.emit(EVENTS.CONTENTS.RESIZE, this._size);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Poll for resize detection\r\n\t * @private\r\n\t */\r\n\tresizeListeners() {\r\n\t\tvar width, height;\r\n\t\t// Test size again\r\n\t\tclearTimeout(this.expanding);\r\n\t\trequestAnimationFrame(this.resizeCheck.bind(this));\r\n\t\tthis.expanding = setTimeout(this.resizeListeners.bind(this), 350);\r\n\t}\r\n\r\n\t/**\r\n\t * Listen for visibility of tab to change\r\n\t * @private\r\n\t */\r\n\tvisibilityListeners() {\r\n\t\tdocument.addEventListener(\"visibilitychange\", () => {\r\n\t\t\tif (document.visibilityState === \"visible\" && this.active === false) {\r\n\t\t\t\tthis.active = true;\r\n\t\t\t\tthis.resizeListeners();\r\n\t\t\t} else {\r\n\t\t\t\tthis.active = false;\r\n\t\t\t\tclearTimeout(this.expanding);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Use css transitions to detect resize\r\n\t * @private\r\n\t */\r\n\ttransitionListeners() {\r\n\t\tlet body = this.content;\r\n\r\n\t\tbody.style['transitionProperty'] = \"font, font-size, font-size-adjust, font-stretch, font-variation-settings, font-weight, width, height\";\r\n\t\tbody.style['transitionDuration'] = \"0.001ms\";\r\n\t\tbody.style['transitionTimingFunction'] = \"linear\";\r\n\t\tbody.style['transitionDelay'] = \"0\";\r\n\r\n\t\tthis._resizeCheck = this.resizeCheck.bind(this);\r\n\t\tthis.document.addEventListener('transitionend', this._resizeCheck);\r\n\t}\r\n\r\n\t/**\r\n\t * Listen for media query changes and emit 'expand' event\r\n\t * Adapted from: https://github.com/tylergaw/media-query-events/blob/master/js/mq-events.js\r\n\t * @private\r\n\t */\r\n\tmediaQueryListeners() {\r\n\t\tvar sheets = this.document.styleSheets;\r\n\t\tvar mediaChangeHandler = function(m){\r\n\t\t\tif(m.matches && !this._expanding) {\r\n\t\t\t\tsetTimeout(this.expand.bind(this), 1);\r\n\t\t\t}\r\n\t\t}.bind(this);\r\n\r\n\t\tfor (var i = 0; i < sheets.length; i += 1) {\r\n\t\t\tvar rules;\r\n\t\t\t// Firefox errors if we access cssRules cross-domain\r\n\t\t\ttry {\r\n\t\t\t\trules = sheets[i].cssRules;\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif(!rules) return; // Stylesheets changed\r\n\t\t\tfor (var j = 0; j < rules.length; j += 1) {\r\n\t\t\t\t//if (rules[j].constructor === CSSMediaRule) {\r\n\t\t\t\tif(rules[j].media){\r\n\t\t\t\t\tvar mql = this.window.matchMedia(rules[j].media.mediaText);\r\n\t\t\t\t\tmql.addListener(mediaChangeHandler);\r\n\t\t\t\t\t//mql.onchange = mediaChangeHandler;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Use ResizeObserver to listen for changes in the DOM and check for resize\r\n\t * @private\r\n\t */\r\n\tresizeObservers() {\r\n\t\t// create an observer instance\r\n\t\t\r\n\t\tthis.observer = new ResizeObserver((e) => {\r\n\t\t\trequestAnimationFrame(this.resizeCheck.bind(this));\r\n\t\t\t\r\n\t\t});\r\n\t\t// pass in the target node\r\n\t\tthis.observer.observe(this.document.documentElement);\r\n\t}\r\n\r\n\t/**\r\n\t * Use MutationObserver to listen for changes in the DOM and check for resize\r\n\t * @private\r\n\t */\r\n\tmutationObservers() {\r\n\t\t// create an observer instance\r\n\t\tthis.observer = new MutationObserver((mutations) => {\r\n\t\t\tthis.resizeCheck();\r\n\t\t});\r\n\r\n\t\t// configuration of the observer:\r\n\t\tlet config = { attributes: true, childList: true, characterData: true, subtree: true };\r\n\r\n\t\t// pass in the target node, as well as the observer options\r\n\t\tthis.observer.observe(this.document, config);\r\n\t}\r\n\r\n\t/**\r\n\t * Test if images are loaded or add listener for when they load\r\n\t * @private\r\n\t */\r\n\timageLoadListeners() {\r\n\t\tvar images = this.document.querySelectorAll(\"img\");\r\n\t\tvar img;\r\n\t\tfor (var i = 0; i < images.length; i++) {\r\n\t\t\timg = images[i];\r\n\r\n\t\t\tif (typeof img.naturalWidth !== \"undefined\" &&\r\n\t\t\t\t\timg.naturalWidth === 0) {\r\n\t\t\t\timg.onload = this.expand.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Listen for font load and check for resize when loaded\r\n\t * @private\r\n\t */\r\n\tfontLoadListeners() {\r\n\t\tif (!this.document || !this.document.fonts) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.document.fonts.ready.then(function () {\r\n\t\t\tthis.resizeCheck();\r\n\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get the documentElement\r\n\t * @returns {element} documentElement\r\n\t */\r\n\troot() {\r\n\t\tif(!this.document) return null;\r\n\t\treturn this.document.documentElement;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the location offset of a EpubCFI or an #id\r\n\t * @param {string | EpubCFI} target\r\n\t * @param {string} [ignoreClass] for the cfi\r\n\t * @returns { {left: Number, top: Number }\r\n\t */\r\n\tlocationOf(target, ignoreClass) {\r\n\t\tvar position;\r\n\t\tvar targetPos = {\"left\": 0, \"top\": 0};\r\n\r\n\t\tif(!this.document) return targetPos;\r\n\r\n\t\tif(this.epubcfi.isCfiString(target)) {\r\n\t\t\tlet range = new EpubCFI(target).toRange(this.document, ignoreClass);\r\n\r\n\t\t\tif(range) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (!range.endContainer ||\r\n\t\t\t\t\t\t(range.startContainer == range.endContainer\r\n\t\t\t\t\t\t&& range.startOffset == range.endOffset)) {\r\n\t\t\t\t\t\t// If the end for the range is not set, it results in collapsed becoming\r\n\t\t\t\t\t\t// true. This in turn leads to inconsistent behaviour when calling\r\n\t\t\t\t\t\t// getBoundingRect. Wrong bounds lead to the wrong page being displayed.\r\n\t\t\t\t\t\t// https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/15684911/\r\n\t\t\t\t\t\tlet pos = range.startContainer.textContent.indexOf(\" \", range.startOffset);\r\n\t\t\t\t\t\tif (pos == -1) {\r\n\t\t\t\t\t\t\tpos = range.startContainer.textContent.length;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trange.setEnd(range.startContainer, pos);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\tconsole.error(\"setting end offset to start container length failed\", e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (range.startContainer.nodeType === Node.ELEMENT_NODE) {\r\n\t\t\t\t\tposition = range.startContainer.getBoundingClientRect();\r\n\t\t\t\t\ttargetPos.left = position.left;\r\n\t\t\t\t\ttargetPos.top = position.top;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Webkit does not handle collapsed range bounds correctly\r\n\t\t\t\t\t// https://bugs.webkit.org/show_bug.cgi?id=138949\r\n\r\n\t\t\t\t\t// Construct a new non-collapsed range\r\n\t\t\t\t\tif (isWebkit) {\r\n\t\t\t\t\t\tlet container = range.startContainer;\r\n\t\t\t\t\t\tlet newRange = new Range();\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tif (container.nodeType === ELEMENT_NODE) {\r\n\t\t\t\t\t\t\t\tposition = container.getBoundingClientRect();\r\n\t\t\t\t\t\t\t} else if (range.startOffset + 2 < container.length) {\r\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset);\r\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset + 2);\r\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\r\n\t\t\t\t\t\t\t} else if (range.startOffset - 2 > 0) {\r\n\t\t\t\t\t\t\t\tnewRange.setStart(container, range.startOffset - 2);\r\n\t\t\t\t\t\t\t\tnewRange.setEnd(container, range.startOffset);\r\n\t\t\t\t\t\t\t\tposition = newRange.getBoundingClientRect();\r\n\t\t\t\t\t\t\t} else { // empty, return the parent element\r\n\t\t\t\t\t\t\t\tposition = container.parentNode.getBoundingClientRect();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\tconsole.error(e, e.stack);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tposition = range.getBoundingClientRect();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} else if(typeof target === \"string\" &&\r\n\t\t\ttarget.indexOf(\"#\") > -1) {\r\n\r\n\t\t\tlet id = target.substring(target.indexOf(\"#\")+1);\r\n\t\t\tlet el = this.document.getElementById(id);\r\n\t\t\tif(el) {\r\n\t\t\t\tif (isWebkit) {\r\n\t\t\t\t\t// Webkit reports incorrect bounding rects in Columns\r\n\t\t\t\t\tlet newRange = new Range();\r\n\t\t\t\t\tnewRange.selectNode(el);\r\n\t\t\t\t\tposition = newRange.getBoundingClientRect();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tposition = el.getBoundingClientRect();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (position) {\r\n\t\t\ttargetPos.left = position.left;\r\n\t\t\ttargetPos.top = position.top;\r\n\t\t}\r\n\r\n\t\treturn targetPos;\r\n\t}\r\n\r\n\t/**\r\n\t * Append a stylesheet link to the document head\r\n\t * @param {string} src url\r\n\t */\r\n\taddStylesheet(src) {\r\n\t\treturn new Promise(function(resolve, reject){\r\n\t\t\tvar $stylesheet;\r\n\t\t\tvar ready = false;\r\n\r\n\t\t\tif(!this.document) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Check if link already exists\r\n\t\t\t$stylesheet = this.document.querySelector(\"link[href='\"+src+\"']\");\r\n\t\t\tif ($stylesheet) {\r\n\t\t\t\tresolve(true);\r\n\t\t\t\treturn; // already present\r\n\t\t\t}\r\n\r\n\t\t\t$stylesheet = this.document.createElement(\"link\");\r\n\t\t\t$stylesheet.type = \"text/css\";\r\n\t\t\t$stylesheet.rel = \"stylesheet\";\r\n\t\t\t$stylesheet.href = src;\r\n\t\t\t$stylesheet.onload = $stylesheet.onreadystatechange = function() {\r\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\r\n\t\t\t\t\tready = true;\r\n\t\t\t\t\t// Let apply\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t}, 1);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.document.head.appendChild($stylesheet);\r\n\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\t_getStylesheetNode(key) {\r\n\t\tvar styleEl;\r\n\t\tkey = \"epubjs-inserted-css-\" + (key || '');\r\n\r\n\t\tif(!this.document) return false;\r\n\r\n\t\t// Check if link already exists\r\n\t\tstyleEl = this.document.getElementById(key);\r\n\t\tif (!styleEl) {\r\n\t\t\tstyleEl = this.document.createElement(\"style\");\r\n\t\t\tstyleEl.id = key;\r\n\t\t\t// Append style element to head\r\n\t\t\tthis.document.head.appendChild(styleEl);\r\n\t\t}\r\n\t\treturn styleEl;\r\n\t}\r\n\r\n\t/**\r\n\t * Append stylesheet css\r\n\t * @param {string} serializedCss\r\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\r\n\t */\r\n\taddStylesheetCss(serializedCss, key) {\r\n\t\tif(!this.document || !serializedCss) return false;\r\n\r\n\t\tvar styleEl;\r\n\t\tstyleEl = this._getStylesheetNode(key);\r\n\t\tstyleEl.innerHTML = serializedCss;\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Append stylesheet rules to a generate stylesheet\r\n\t * Array: https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule\r\n\t * Object: https://github.com/desirable-objects/json-to-css\r\n\t * @param {array | object} rules\r\n\t * @param {string} key If the key is the same, the CSS will be replaced instead of inserted\r\n\t */\r\n\taddStylesheetRules(rules, key) {\r\n\t\tvar styleSheet;\r\n\r\n\t\tif(!this.document || !rules || rules.length === 0) return;\r\n\r\n\t\t// Grab style sheet\r\n\t\tstyleSheet = this._getStylesheetNode(key).sheet;\r\n\r\n\t\tif (Object.prototype.toString.call(rules) === \"[object Array]\") {\r\n\t\t\tfor (var i = 0, rl = rules.length; i < rl; i++) {\r\n\t\t\t\tvar j = 1, rule = rules[i], selector = rules[i][0], propStr = \"\";\r\n\t\t\t\t// If the second argument of a rule is an array of arrays, correct our variables.\r\n\t\t\t\tif (Object.prototype.toString.call(rule[1][0]) === \"[object Array]\") {\r\n\t\t\t\t\trule = rule[1];\r\n\t\t\t\t\tj = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var pl = rule.length; j < pl; j++) {\r\n\t\t\t\t\tvar prop = rule[j];\r\n\t\t\t\t\tpropStr += prop[0] + \":\" + prop[1] + (prop[2] ? \" !important\" : \"\") + \";\\n\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Insert CSS Rule\r\n\t\t\t\tstyleSheet.insertRule(selector + \"{\" + propStr + \"}\", styleSheet.cssRules.length);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconst selectors = Object.keys(rules);\r\n\t\t\tselectors.forEach((selector) => {\r\n\t\t\t\tconst definition = rules[selector];\r\n\t\t\t\tif (Array.isArray(definition)) {\r\n\t\t\t\t\tdefinition.forEach((item) => {\r\n\t\t\t\t\t\tconst _rules = Object.keys(item);\r\n\t\t\t\t\t\tconst result = _rules.map((rule) => {\r\n\t\t\t\t\t\t\treturn `${rule}:${item[rule]}`;\r\n\t\t\t\t\t\t}).join(';');\r\n\t\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst _rules = Object.keys(definition);\r\n\t\t\t\t\tconst result = _rules.map((rule) => {\r\n\t\t\t\t\t\treturn `${rule}:${definition[rule]}`;\r\n\t\t\t\t\t}).join(';');\r\n\t\t\t\t\tstyleSheet.insertRule(`${selector}{${result}}`, styleSheet.cssRules.length);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Append a script tag to the document head\r\n\t * @param {string} src url\r\n\t * @returns {Promise} loaded\r\n\t */\r\n\taddScript(src) {\r\n\r\n\t\treturn new Promise(function(resolve, reject){\r\n\t\t\tvar $script;\r\n\t\t\tvar ready = false;\r\n\r\n\t\t\tif(!this.document) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$script = this.document.createElement(\"script\");\r\n\t\t\t$script.type = \"text/javascript\";\r\n\t\t\t$script.async = true;\r\n\t\t\t$script.src = src;\r\n\t\t\t$script.onload = $script.onreadystatechange = function() {\r\n\t\t\t\tif ( !ready && (!this.readyState || this.readyState == \"complete\") ) {\r\n\t\t\t\t\tready = true;\r\n\t\t\t\t\tsetTimeout(function(){\r\n\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t}, 1);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.document.head.appendChild($script);\r\n\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Add a class to the contents container\r\n\t * @param {string} className\r\n\t */\r\n\taddClass(className) {\r\n\t\tvar content;\r\n\r\n\t\tif(!this.document) return;\r\n\r\n\t\tcontent = this.content || this.document.body;\r\n\r\n\t\tvar classes = className.split(\" \");\r\n\r\n\t\tif (content) {\r\n\r\n\t\t\t// content.classList.add(className);\r\n\t\t\tclasses.forEach((t)=>{\t\r\n\t\t\t\tif(t.length>0)\t\t\t\r\n\t\t\t\tcontent.classList.add(t);\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Remove a class from the contents container\r\n\t * @param {string} removeClass\r\n\t */\r\n\tremoveClass(className) {\r\n\t\tvar content;\r\n\r\n\t\tif(!this.document) return;\r\n\r\n\t\tcontent = this.content || this.document.body;\r\n\t\tvar classes = className.split(\" \");\r\n\t\tif (content) {\r\n\t\t\tclasses.forEach((t)=>{\r\n\t\t\t\tif(t.length>0)\r\n\t\t\t\tcontent.classList.remove(t);\r\n\t\t\t})\r\n\t\t\t//content.classList.remove(className);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add DOM event listeners\r\n\t * @private\r\n\t */\r\n\taddEventListeners(){\r\n\t\tif(!this.document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._triggerEvent = this.triggerEvent.bind(this);\r\n\r\n\t\tDOM_EVENTS.forEach(function(eventName){\r\n\t\t\tthis.document.addEventListener(eventName, this._triggerEvent, { passive: true });\r\n\t\t}, this);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Remove DOM event listeners\r\n\t * @private\r\n\t */\r\n\tremoveEventListeners(){\r\n\t\tif(!this.document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tDOM_EVENTS.forEach(function(eventName){\r\n\t\t\tthis.document.removeEventListener(eventName, this._triggerEvent, { passive: true });\r\n\t\t}, this);\r\n\t\tthis._triggerEvent = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Emit passed browser events\r\n\t * @private\r\n\t */\r\n\ttriggerEvent(e){\r\n\t\tthis.emit(e.type, e);\r\n\t}\r\n\r\n\t/**\r\n\t * Add listener for text selection\r\n\t * @private\r\n\t */\r\n\taddSelectionListeners(){\r\n\t\tif(!this.document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._onSelectionChange = this.onSelectionChange.bind(this);\r\n\t\tthis.document.addEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\r\n\t}\r\n\r\n\t/**\r\n\t * Remove listener for text selection\r\n\t * @private\r\n\t */\r\n\tremoveSelectionListeners(){\r\n\t\tif(!this.document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.document.removeEventListener(\"selectionchange\", this._onSelectionChange, { passive: true });\r\n\t\tthis._onSelectionChange = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Handle getting text on selection\r\n\t * @private\r\n\t */\r\n\tonSelectionChange(e){\r\n\t\t\r\n\t\tif (this.selectionEndTimeout) {\r\n\t\t\tclearTimeout(this.selectionEndTimeout);\r\n\t\t}\r\n\t\tthis.selectionEndTimeout = setTimeout(function() {\r\n\t\t\tvar selection = this.window.getSelection();\r\n\t\t\tthis.triggerSelectedEvent(selection);\r\n\t\t}.bind(this), 250);\r\n\t}\r\n\r\n\t/**\r\n\t * Emit event on text selection\r\n\t * @private\r\n\t */\r\n\ttriggerSelectedEvent(selection){\r\n\t\tvar range, cfirange;\r\n\r\n\t\tif (selection && selection.rangeCount > 0) {\r\n\t\t\trange = selection.getRangeAt(0);\r\n\t\t\tif(!range.collapsed) {\r\n\t\t\t\t// cfirange = this.section.cfiFromRange(range);\r\n\t\t\t\tcfirange = new EpubCFI(range, this.cfiBase).toString();\r\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED, cfirange);\r\n\t\t\t\tthis.emit(EVENTS.CONTENTS.SELECTED_RANGE, range);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get a Dom Range from EpubCFI\r\n\t * @param {EpubCFI} _cfi\r\n\t * @param {string} [ignoreClass]\r\n\t * @returns {Range} range\r\n\t */\r\n\trange(_cfi, ignoreClass){\r\n\t\tvar cfi = new EpubCFI(_cfi);\r\n\t\treturn cfi.toRange(this.document, ignoreClass);\r\n\t}\r\n\r\n\t/**\r\n\t * Get an EpubCFI from a Dom Range\r\n\t * @param {Range} range\r\n\t * @param {string} [ignoreClass]\r\n\t * @returns {EpubCFI} cfi\r\n\t */\r\n\tcfiFromRange(range, ignoreClass){\r\n\t\treturn new EpubCFI(range, this.cfiBase, ignoreClass).toString();\r\n\t}\r\n\r\n\t/**\r\n\t * Get an EpubCFI from a Dom node\r\n\t * @param {node} node\r\n\t * @param {string} [ignoreClass]\r\n\t * @returns {EpubCFI} cfi\r\n\t */\r\n\tcfiFromNode(node, ignoreClass){\r\n\t\treturn new EpubCFI(node, this.cfiBase, ignoreClass).toString();\r\n\t}\r\n\r\n\t// TODO: find where this is used - remove?\r\n\tmap(layout){\r\n\t\tvar map = new Mapping(layout);\r\n\t\treturn map.section();\r\n\t}\r\n\r\n\t/**\r\n\t * Size the contents to a given width and height\r\n\t * @param {number} [width]\r\n\t * @param {number} [height]\r\n\t */\r\n\tsize(width, height){\r\n\t\tvar viewport = { scale: 1.0, scalable: \"no\" };\r\n\r\n\t\tthis.layoutStyle(\"scrolling\");\r\n\r\n\t\tif (width >= 0) {\r\n\t\t\tthis.width(width);\r\n\t\t\tviewport.width = width;\r\n\t\t\t// this.css(\"padding\", \"0 \"+(width/12)+\"px\");\r\n\t\t\tthis.css(\"padding\", \"0 \"+(width/20)+\"px\");\r\n\t\t}\r\n\r\n\t\tif (height >= 0) {\r\n\t\t\tthis.height(height);\r\n\t\t\tviewport.height = height;\r\n\t\t}\r\n\r\n\t\tthis.css(\"margin\", \"0\");\r\n\t\tthis.css(\"box-sizing\", \"border-box\");\r\n\r\n\r\n\t\tthis.viewport(viewport);\r\n\t}\r\n\r\n\t/**\r\n\t * Apply columns to the contents for pagination\r\n\t * @param {number} width\r\n\t * @param {number} height\r\n\t * @param {number} columnWidth\r\n\t * @param {number} gap\r\n\t */\r\n\tcolumns(width, height, columnWidth, gap, dir){\r\n\t\tlet COLUMN_AXIS = prefixed(\"column-axis\");\r\n\t\tlet COLUMN_GAP = prefixed(\"column-gap\");\r\n\t\tlet COLUMN_WIDTH = prefixed(\"column-width\");\r\n\t\tlet COLUMN_FILL = prefixed(\"column-fill\");\r\n\r\n\t\tlet writingMode = this.writingMode();\r\n\t\tlet axis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\r\n\r\n\t\tthis.layoutStyle(\"paginated\");\r\n\r\n\t\tif (dir === \"rtl\" && axis === \"horizontal\") {\r\n\t\t\tthis.direction(dir);\r\n\t\t}\r\n\r\n\t\tthis.width(width);\r\n\t\tthis.height(height);\r\n\r\n\t\t// Deal with Mobile trying to scale to viewport\r\n\t\tthis.viewport({ width: width, height: height, scale: 1.0, scalable: \"no\" });\r\n\r\n\t\t// TODO: inline-block needs more testing\r\n\t\t// Fixes Safari column cut offs, but causes RTL issues\r\n\t\t// this.css(\"display\", \"inline-block\");\r\n\r\n\t\tthis.css(\"overflow-y\", \"hidden\");\r\n\t\tthis.css(\"margin\", \"0\", true);\r\n\r\n\t\tif (axis === \"vertical\") {\r\n\t\t\tthis.css(\"padding-top\", (gap / 2) + \"px\", true);\r\n\t\t\tthis.css(\"padding-bottom\", (gap / 2) + \"px\", true);\r\n\t\t\tthis.css(\"padding-left\", \"20px\");\r\n\t\t\tthis.css(\"padding-right\", \"20px\");\r\n\t\t\tthis.css(COLUMN_AXIS, \"vertical\");\r\n\t\t} else {\r\n\t\t\tthis.css(\"padding-top\", \"20px\");\r\n\t\t\tthis.css(\"padding-bottom\", \"20px\");\r\n\t\t\tthis.css(\"padding-left\", (gap / 2) + \"px\", true);\r\n\t\t\tthis.css(\"padding-right\", (gap / 2) + \"px\", true);\r\n\t\t\tthis.css(COLUMN_AXIS, \"horizontal\");\r\n\t\t}\r\n\r\n\t\tthis.css(\"box-sizing\", \"border-box\");\r\n\t\tthis.css(\"max-width\", \"inherit\");\r\n\r\n\t\tthis.css(COLUMN_FILL, \"auto\");\r\n\r\n\t\tthis.css(COLUMN_GAP, gap+\"px\");\r\n\t\tthis.css(COLUMN_WIDTH, columnWidth+\"px\");\r\n\r\n\t\t// Fix glyph clipping in WebKit\r\n\t\t// https://github.com/futurepress/epub.js/issues/983\r\n\t\tthis.css(\"-webkit-line-box-contain\", \"block glyphs replaced\");\r\n\t}\r\n\r\n\t/**\r\n\t * Scale contents from center\r\n\t * @param {number} scale\r\n\t * @param {number} offsetX\r\n\t * @param {number} offsetY\r\n\t */\r\n\tscaler(scale, offsetX, offsetY){\r\n\t\tvar scaleStr = \"scale(\" + scale + \")\";\r\n\t\tvar translateStr = \"\";\r\n\t\t// this.css(\"position\", \"absolute\"));\r\n\t\tthis.css(\"transform-origin\", \"top left\");\r\n\r\n\t\tif (offsetX >= 0 || offsetY >= 0) {\r\n\t\t\ttranslateStr = \" translate(\" + (offsetX || 0 )+ \"px, \" + (offsetY || 0 )+ \"px )\";\r\n\t\t}\r\n\r\n\t\tthis.css(\"transform\", scaleStr + translateStr);\r\n\t}\r\n\r\n\t/**\r\n\t * Fit contents into a fixed width and height\r\n\t * @param {number} width\r\n\t * @param {number} height\r\n\t */\r\n\tfit(width, height, section){\r\n\t\tvar viewport = this.viewport();\r\n\t\tvar viewportWidth = parseInt(viewport.width);\r\n\t\tvar viewportHeight = parseInt(viewport.height);\r\n\t\tvar widthScale = width / viewportWidth;\r\n\t\tvar heightScale = height / viewportHeight;\r\n\t\tvar scale = widthScale < heightScale ? widthScale : heightScale;\r\n\r\n\t\t// the translate does not work as intended, elements can end up unaligned\r\n\t\t// var offsetY = (height - (viewportHeight * scale)) / 2;\r\n\t\t// var offsetX = 0;\r\n\t\t// if (this.sectionIndex % 2 === 1) {\r\n\t\t// \toffsetX = width - (viewportWidth * scale);\r\n\t\t// }\r\n\r\n\t\tthis.layoutStyle(\"paginated\");\r\n\r\n\t\t// scale needs width and height to be set\r\n\t\tthis.width(viewportWidth);\r\n\t\tthis.height(viewportHeight);\r\n\t\tthis.overflow(\"hidden\");\r\n\r\n\t\t// Scale to the correct size\r\n\t\tthis.scaler(scale, 0, 0);\r\n\t\t// this.scaler(scale, offsetX > 0 ? offsetX : 0, offsetY);\r\n\r\n\t\t// background images are not scaled by transform\r\n\t\tthis.css(\"background-size\", viewportWidth * scale + \"px \" + viewportHeight * scale + \"px\");\r\n\r\n\t\tthis.css(\"background-color\", \"transparent\");\r\n\t\tif (section && section.properties.includes(\"page-spread-left\")) {\r\n\t\t\t// set margin since scale is weird\r\n\t\t\tvar marginLeft = width - (viewportWidth * scale);\r\n\t\t\tthis.css(\"margin-left\", marginLeft + \"px\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Set the direction of the text\r\n\t * @param {string} [dir=\"ltr\"] \"rtl\" | \"ltr\"\r\n\t */\r\n\tdirection(dir) {\r\n\t\tif (this.documentElement) {\r\n\t\t\tthis.documentElement.style[\"direction\"] = dir;\r\n\t\t}\r\n\t}\r\n\r\n\tmapPage(cfiBase, layout, start, end, dev) {\r\n\t\tvar mapping = new Mapping(layout, dev);\r\n\r\n\t\treturn mapping.page(this, cfiBase, start, end);\r\n\t}\r\n\r\n\t/**\r\n\t * Emit event when link in content is clicked\r\n\t * @private\r\n\t */\r\n\tlinksHandler() {\r\n\t\treplaceLinks(this.content, (href) => {\r\n\t\t\tthis.emit(EVENTS.CONTENTS.LINK_CLICKED, href);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Set the writingMode of the text\r\n\t * @param {string} [mode=\"horizontal-tb\"] \"horizontal-tb\" | \"vertical-rl\" | \"vertical-lr\"\r\n\t */\r\n\twritingMode(mode) {\r\n\t\tlet WRITING_MODE = prefixed(\"writing-mode\");\r\n\r\n\t\tif (mode && this.documentElement) {\r\n\t\t\tthis.documentElement.style[WRITING_MODE] = mode;\r\n\t\t}\r\n\r\n\t\treturn this.window.getComputedStyle(this.documentElement)[WRITING_MODE] || '';\r\n\t}\r\n\r\n\t/**\r\n\t * Set the layoutStyle of the content\r\n\t * @param {string} [style=\"paginated\"] \"scrolling\" | \"paginated\"\r\n\t * @private\r\n\t */\r\n\tlayoutStyle(style) {\r\n\r\n\t\tif (style) {\r\n\t\t\tthis._layoutStyle = style;\r\n\t\t\tnavigator.epubReadingSystem.layoutStyle = this._layoutStyle;\r\n\t\t}\r\n\r\n\t\treturn this._layoutStyle || \"paginated\";\r\n\t}\r\n\r\n\t/**\r\n\t * Add the epubReadingSystem object to the navigator\r\n\t * @param {string} name\r\n\t * @param {string} version\r\n\t * @private\r\n\t */\r\n\tepubReadingSystem(name, version) {\r\n\t\tnavigator.epubReadingSystem = {\r\n\t\t\tname: name,\r\n\t\t\tversion: version,\r\n\t\t\tlayoutStyle: this.layoutStyle(),\r\n\t\t\thasFeature: function (feature) {\r\n\t\t\t\tswitch (feature) {\r\n\t\t\t\t\tcase \"dom-manipulation\":\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tcase \"layout-changes\":\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tcase \"touch-events\":\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tcase \"mouse-events\":\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tcase \"keyboard-events\":\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tcase \"spine-scripting\":\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\treturn navigator.epubReadingSystem;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\t// this.document.removeEventListener('transitionend', this._resizeCheck);\r\n\r\n\t\tthis.removeListeners();\r\n\r\n\t}\r\n}\r\n\r\nEventEmitter(Contents.prototype);\r\n\r\nexport default Contents;\r\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Underline = exports.Highlight = exports.Mark = exports.Pane = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _svg = require('./svg');\n\nvar _svg2 = _interopRequireDefault(_svg);\n\nvar _events = require('./events');\n\nvar _events2 = _interopRequireDefault(_events);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Pane = exports.Pane = function () {\n    function Pane(target) {\n        var container = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : document.body;\n\n        _classCallCheck(this, Pane);\n\n        this.target = target;\n        this.element = _svg2.default.createElement('svg');\n        this.marks = [];\n\n        // Match the coordinates of the target element\n        this.element.style.position = 'absolute';\n        // Disable pointer events\n        this.element.setAttribute('pointer-events', 'none');\n\n        // Set up mouse event proxying between the target element and the marks\n        _events2.default.proxyMouse(this.target, this.marks);\n\n        this.container = container;\n        this.container.appendChild(this.element);\n\n        this.render();\n    }\n\n    _createClass(Pane, [{\n        key: 'addMark',\n        value: function addMark(mark) {\n            var g = _svg2.default.createElement('g');\n            this.element.appendChild(g);\n            mark.bind(g, this.container);\n\n            this.marks.push(mark);\n\n            mark.render();\n            return mark;\n        }\n    }, {\n        key: 'removeMark',\n        value: function removeMark(mark) {\n            var idx = this.marks.indexOf(mark);\n            if (idx === -1) {\n                return;\n            }\n            var el = mark.unbind();\n            this.element.removeChild(el);\n            this.marks.splice(idx, 1);\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            setCoords(this.element, coords(this.target, this.container));\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this.marks[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var m = _step.value;\n\n                    m.render();\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        }\n    }]);\n\n    return Pane;\n}();\n\nvar Mark = exports.Mark = function () {\n    function Mark() {\n        _classCallCheck(this, Mark);\n\n        this.element = null;\n    }\n\n    _createClass(Mark, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            this.element = element;\n            this.container = container;\n        }\n    }, {\n        key: 'unbind',\n        value: function unbind() {\n            var el = this.element;\n            this.element = null;\n            return el;\n        }\n    }, {\n        key: 'render',\n        value: function render() {}\n    }, {\n        key: 'dispatchEvent',\n        value: function dispatchEvent(e) {\n            if (!this.element) return;\n            this.element.dispatchEvent(e);\n        }\n    }, {\n        key: 'getBoundingClientRect',\n        value: function getBoundingClientRect() {\n            return this.element.getBoundingClientRect();\n        }\n    }, {\n        key: 'getClientRects',\n        value: function getClientRects() {\n            var rects = [];\n            var el = this.element.firstChild;\n            while (el) {\n                rects.push(el.getBoundingClientRect());\n                el = el.nextSibling;\n            }\n            return rects;\n        }\n    }, {\n        key: 'filteredRanges',\n        value: function filteredRanges() {\n            var rects = Array.from(this.range.getClientRects());\n\n            // De-duplicate the boxes\n            return rects.filter(function (box) {\n                for (var i = 0; i < rects.length; i++) {\n                    if (rects[i] === box) {\n                        return true;\n                    }\n                    var contained = contains(rects[i], box);\n                    if (contained) {\n                        return false;\n                    }\n                }\n                return true;\n            });\n        }\n    }]);\n\n    return Mark;\n}();\n\nvar Highlight = exports.Highlight = function (_Mark) {\n    _inherits(Highlight, _Mark);\n\n    function Highlight(range, className, data, attributes) {\n        _classCallCheck(this, Highlight);\n\n        var _this = _possibleConstructorReturn(this, (Highlight.__proto__ || Object.getPrototypeOf(Highlight)).call(this));\n\n        _this.range = range;\n        _this.className = className;\n        _this.data = data || {};\n        _this.attributes = attributes || {};\n        return _this;\n    }\n\n    _createClass(Highlight, [{\n        key: 'bind',\n        value: function bind(element, container) {\n            _get(Highlight.prototype.__proto__ || Object.getPrototypeOf(Highlight.prototype), 'bind', this).call(this, element, container);\n\n            for (var attr in this.data) {\n                if (this.data.hasOwnProperty(attr)) {\n                    this.element.dataset[attr] = this.data[attr];\n                }\n            }\n\n            for (var attr in this.attributes) {\n                if (this.attributes.hasOwnProperty(attr)) {\n                    this.element.setAttribute(attr, this.attributes[attr]);\n                }\n            }\n\n            if (this.className) {\n                this.element.classList.add(this.className);\n            }\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n                var el = _svg2.default.createElement('rect');\n                el.setAttribute('x', r.left - offset.left + container.left);\n                el.setAttribute('y', r.top - offset.top + container.top);\n                el.setAttribute('height', r.height);\n                el.setAttribute('width', r.width);\n                docFrag.appendChild(el);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Highlight;\n}(Mark);\n\nvar Underline = exports.Underline = function (_Highlight) {\n    _inherits(Underline, _Highlight);\n\n    function Underline(range, className, data, attributes) {\n        _classCallCheck(this, Underline);\n\n        return _possibleConstructorReturn(this, (Underline.__proto__ || Object.getPrototypeOf(Underline)).call(this, range, className, data, attributes));\n    }\n\n    _createClass(Underline, [{\n        key: 'render',\n        value: function render() {\n            // Empty element\n            while (this.element.firstChild) {\n                this.element.removeChild(this.element.firstChild);\n            }\n\n            var docFrag = this.element.ownerDocument.createDocumentFragment();\n            var filtered = this.filteredRanges();\n            var offset = this.element.getBoundingClientRect();\n            var container = this.container.getBoundingClientRect();\n\n            for (var i = 0, len = filtered.length; i < len; i++) {\n                var r = filtered[i];\n\n                var rect = _svg2.default.createElement('rect');\n                rect.setAttribute('x', r.left - offset.left + container.left);\n                rect.setAttribute('y', r.top - offset.top + container.top);\n                rect.setAttribute('height', r.height);\n                rect.setAttribute('width', r.width);\n                rect.setAttribute('fill', 'none');\n\n                var line = _svg2.default.createElement('line');\n                line.setAttribute('x1', r.left - offset.left + container.left);\n                line.setAttribute('x2', r.left - offset.left + container.left + r.width);\n                line.setAttribute('y1', r.top - offset.top + container.top + r.height - 1);\n                line.setAttribute('y2', r.top - offset.top + container.top + r.height - 1);\n\n                line.setAttribute('stroke-width', 1);\n                line.setAttribute('stroke', 'black'); //TODO: match text color?\n                line.setAttribute('stroke-linecap', 'square');\n\n                docFrag.appendChild(rect);\n\n                docFrag.appendChild(line);\n            }\n\n            this.element.appendChild(docFrag);\n        }\n    }]);\n\n    return Underline;\n}(Highlight);\n\nfunction coords(el, container) {\n    var offset = container.getBoundingClientRect();\n    var rect = el.getBoundingClientRect();\n\n    return {\n        top: rect.top - offset.top,\n        left: rect.left - offset.left,\n        height: el.scrollHeight,\n        width: el.scrollWidth\n    };\n}\n\nfunction setCoords(el, coords) {\n    el.style.setProperty('top', coords.top + 'px', 'important');\n    el.style.setProperty('left', coords.left + 'px', 'important');\n    el.style.setProperty('height', coords.height + 'px', 'important');\n    el.style.setProperty('width', coords.width + 'px', 'important');\n}\n\nfunction contains(rect1, rect2) {\n    return rect2.right <= rect1.right && rect2.left >= rect1.left && rect2.top >= rect1.top && rect2.bottom <= rect1.bottom;\n}\n","module.exports = __WEBPACK_EXTERNAL_MODULE__16__;","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\"use strict\";\n\nvar _undefined = require(\"../function/noop\")(); // Support ES3 engines\n\nmodule.exports = function (val) { return val !== _undefined && val !== null; };\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","import EventEmitter from \"event-emitter\";\r\nimport { extend, borders, uuid, isNumber, bounds, defer, createBlobUrl, revokeBlobUrl } from \"../../utils/core\";\r\nimport EpubCFI from \"../../epubcfi\";\r\nimport Contents from \"../../contents\";\r\nimport { EVENTS } from \"../../utils/constants\";\r\nimport { Pane, Highlight, Underline } from \"marks-pane\";\r\n\r\nclass IframeView {\r\n\tconstructor(section, options) {\r\n\t\tthis.settings = extend({\r\n\t\t\tignoreClass: \"\",\r\n\t\t\taxis: undefined, //options.layout && options.layout.props.flow === \"scrolled\" ? \"vertical\" : \"horizontal\",\r\n\t\t\tdirection: undefined,\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\tlayout: undefined,\r\n\t\t\tglobalLayoutProperties: {},\r\n\t\t\tmethod: undefined,\r\n\t\t\tforceRight: false\r\n\t\t}, options || {});\r\n\r\n\t\tthis.id = \"epubjs-view-\" + uuid();\r\n\t\tthis.section = section;\r\n\t\tthis.index = section.index;\r\n\r\n\t\tthis.element = this.container(this.settings.axis);\r\n\r\n\t\tthis.added = false;\r\n\t\tthis.displayed = false;\r\n\t\tthis.rendered = false;\r\n\r\n\t\t// this.width  = this.settings.width;\r\n\t\t// this.height = this.settings.height;\r\n\r\n\t\tthis.fixedWidth = 0;\r\n\t\tthis.fixedHeight = 0;\r\n\r\n\t\t// Blank Cfi for Parsing\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis.layout = this.settings.layout;\r\n\t\t// Dom events to listen for\r\n\t\t// this.listenedEvents = [\"keydown\", \"keyup\", \"keypressed\", \"mouseup\", \"mousedown\", \"click\", \"touchend\", \"touchstart\"];\r\n\r\n\t\tthis.pane = undefined;\r\n\t\tthis.highlights = {};\r\n\t\t//김병현추가\r\n\t\tthis.icons = {};\r\n\t\tthis.underlines = {};\r\n\t\tthis.marks = {};\r\n\t\tthis.panes = [];\r\n\r\n\t}\r\n\r\n\tcontainer(axis) {\r\n\t\tvar element = document.createElement(\"div\");\r\n\r\n\t\telement.classList.add(\"epub-view\");\r\n\r\n\t\t// this.element.style.minHeight = \"100px\";\r\n\t\telement.style.height = \"0px\";\r\n\t\telement.style.width = \"0px\";\r\n\t\telement.style.overflow = \"hidden\";\r\n\t\telement.style.position = \"relative\";\r\n\t\telement.style.display = \"block\";\r\n\r\n\t\tif (axis && axis == \"horizontal\") {\r\n\t\t\telement.style.flex = \"none\";\r\n\t\t} else {\r\n\t\t\telement.style.flex = \"initial\";\r\n\t\t}\r\n\r\n\t\treturn element;\r\n\t}\r\n\r\n\tcreate() {\r\n\r\n\t\tif (this.iframe) {\r\n\t\t\treturn this.iframe;\r\n\t\t}\r\n\r\n\t\tif (!this.element) {\r\n\t\t\tthis.element = this.createContainer();\r\n\t\t}\r\n\r\n\t\tthis.iframe = document.createElement(\"iframe\");\r\n\t\tthis.iframe.id = this.id;\r\n\t\tthis.iframe.scrolling = \"no\"; // Might need to be removed: breaks ios width calculations\r\n\t\tthis.iframe.style.overflow = \"hidden\";\r\n\t\tthis.iframe.seamless = \"seamless\";\r\n\t\t// Back up if seamless isn't supported\r\n\t\tthis.iframe.style.border = \"none\";\r\n\r\n\t\tthis.iframe.setAttribute(\"enable-annotation\", \"true\");\r\n\r\n\t\tthis.resizing = true;\r\n\r\n\t\t// this.iframe.style.display = \"none\";\r\n\t\tthis.element.style.visibility = \"hidden\";\r\n\t\tthis.iframe.style.visibility = \"hidden\";\r\n\r\n\t\tthis.iframe.style.width = \"0\";\r\n\t\tthis.iframe.style.height = \"0\";\r\n\t\tthis._width = 0;\r\n\t\tthis._height = 0;\r\n\r\n\t\tthis.element.setAttribute(\"ref\", this.index);\r\n\r\n\t\tthis.added = true;\r\n\r\n\t\tthis.elementBounds = bounds(this.element);\r\n\r\n\t\t// if(width || height){\r\n\t\t//   this.resize(width, height);\r\n\t\t// } else if(this.width && this.height){\r\n\t\t//   this.resize(this.width, this.height);\r\n\t\t// } else {\r\n\t\t//   this.iframeBounds = bounds(this.iframe);\r\n\t\t// }\r\n\r\n\r\n\t\tif ((\"srcdoc\" in this.iframe)) {\r\n\t\t\tthis.supportsSrcdoc = true;\r\n\t\t} else {\r\n\t\t\tthis.supportsSrcdoc = false;\r\n\t\t}\r\n\r\n\t\tif (!this.settings.method) {\r\n\t\t\tthis.settings.method = this.supportsSrcdoc ? \"srcdoc\" : \"write\";\r\n\t\t}\r\n\r\n\t\treturn this.iframe;\r\n\t}\r\n\r\n\trender(request, show) {\r\n\r\n\t\t// view.onLayout = this.layout.format.bind(this.layout);\r\n\t\tthis.create();\r\n\r\n\t\t// Fit to size of the container, apply padding\r\n\t\tthis.size();\r\n\r\n\t\tif (!this.sectionRender) {\r\n\t\t\tthis.sectionRender = this.section.render(request);\r\n\t\t}\r\n\r\n\t\t// Render Chain\r\n\t\treturn this.sectionRender\r\n\t\t\t.then(function (contents) {\r\n\t\t\t\treturn this.load(contents);\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function () {\r\n\r\n\t\t\t\t// find and report the writingMode axis\r\n\t\t\t\tlet writingMode = this.contents.writingMode();\r\n\r\n\t\t\t\t// Set the axis based on the flow and writing mode\r\n\t\t\t\tlet axis;\r\n\t\t\t\tif (this.settings.flow === \"scrolled\") {\r\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"horizontal\" : \"vertical\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\taxis = (writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (writingMode.indexOf(\"vertical\") === 0 && this.settings.flow === \"paginated\") {\r\n\t\t\t\t\tthis.layout.delta = this.layout.height;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.setAxis(axis);\r\n\t\t\t\tthis.emit(EVENTS.VIEWS.AXIS, axis);\r\n\r\n\t\t\t\tthis.setWritingMode(writingMode);\r\n\t\t\t\tthis.emit(EVENTS.VIEWS.WRITING_MODE, writingMode);\r\n\r\n\r\n\t\t\t\t// apply the layout function to the contents\r\n\t\t\t\tthis.layout.format(this.contents, this.section, this.axis);\r\n\r\n\t\t\t\t// Listen for events that require an expansion of the iframe\r\n\t\t\t\tthis.addListeners();\r\n\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\t// Expand the iframe to the full size of the content\r\n\t\t\t\t\tthis.expand();\r\n\r\n\t\t\t\t\tif (this.settings.forceRight) {\r\n\t\t\t\t\t\tthis.element.style.marginLeft = this.width() + \"px\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\r\n\t\t\t}.bind(this), function (e) {\r\n\t\t\t\tthis.emit(EVENTS.VIEWS.LOAD_ERROR, e);\r\n\t\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\treject(e);\r\n\t\t\t\t});\r\n\t\t\t}.bind(this))\r\n\t\t\t.then(function () {\r\n\t\t\t\tthis.emit(EVENTS.VIEWS.RENDERED, this.section);\r\n\t\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\treset() {\r\n\t\tif (this.iframe) {\r\n\t\t\tthis.iframe.style.width = \"0\";\r\n\t\t\tthis.iframe.style.height = \"0\";\r\n\t\t\tthis._width = 0;\r\n\t\t\tthis._height = 0;\r\n\t\t\tthis._textWidth = undefined;\r\n\t\t\tthis._contentWidth = undefined;\r\n\t\t\tthis._textHeight = undefined;\r\n\t\t\tthis._contentHeight = undefined;\r\n\t\t}\r\n\t\tthis._needsReframe = true;\r\n\t}\r\n\r\n\t// Determine locks base on settings\r\n\tsize(_width, _height) {\r\n\t\tvar width = _width || this.settings.width;\r\n\t\tvar height = _height || this.settings.height;\r\n\r\n\t\tif (this.layout.name === \"pre-paginated\") {\r\n\t\t\tthis.lock(\"both\", width, height);\r\n\t\t} else if (this.settings.axis === \"horizontal\") {\r\n\t\t\tthis.lock(\"height\", width, height);\r\n\t\t} else {\r\n\t\t\tthis.lock(\"width\", width, height);\r\n\t\t}\r\n\r\n\t\tthis.settings.width = width;\r\n\t\tthis.settings.height = height;\r\n\t}\r\n\r\n\t// Lock an axis to element dimensions, taking borders into account\r\n\tlock(what, width, height) {\r\n\t\tvar elBorders = borders(this.element);\r\n\t\tvar iframeBorders;\r\n\r\n\t\tif (this.iframe) {\r\n\t\t\tiframeBorders = borders(this.iframe);\r\n\t\t} else {\r\n\t\t\tiframeBorders = { width: 0, height: 0 };\r\n\t\t}\r\n\r\n\t\tif (what == \"width\" && isNumber(width)) {\r\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\r\n\t\t\t// this.resize(this.lockedWidth, width); //  width keeps ratio correct\r\n\t\t}\r\n\r\n\t\tif (what == \"height\" && isNumber(height)) {\r\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\r\n\t\t\t// this.resize(width, this.lockedHeight);\r\n\t\t}\r\n\r\n\t\tif (what === \"both\" &&\r\n\t\t\tisNumber(width) &&\r\n\t\t\tisNumber(height)) {\r\n\r\n\t\t\tthis.lockedWidth = width - elBorders.width - iframeBorders.width;\r\n\t\t\tthis.lockedHeight = height - elBorders.height - iframeBorders.height;\r\n\t\t\t// this.resize(this.lockedWidth, this.lockedHeight);\r\n\t\t}\r\n\r\n\t\tif (this.displayed && this.iframe) {\r\n\r\n\t\t\t// this.contents.layout();\r\n\t\t\tthis.expand();\r\n\t\t}\r\n\r\n\r\n\r\n\t}\r\n\r\n\t// Resize a single axis based on content dimensions\r\n\texpand(force) {\r\n\r\n\t\tvar width = this.lockedWidth;\r\n\t\tvar height = this.lockedHeight;\r\n\t\tvar columns;\r\n\r\n\t\tvar textWidth, textHeight;\r\n\r\n\t\tif (!this.iframe || this._expanding) return;\r\n\r\n\t\tthis._expanding = true;\r\n\r\n\t\tif (this.layout.name === \"pre-paginated\") {\r\n\t\t\twidth = this.layout.columnWidth;\r\n\t\t\theight = this.layout.height;\r\n\t\t}\r\n\t\t// Expand Horizontally\r\n\t\telse if (this.settings.axis === \"horizontal\") {\r\n\t\t\t// Get the width of the text\r\n\t\t\twidth = this.contents.textWidth();\r\n\r\n\t\t\tif (width % this.layout.pageWidth > 0) {\r\n\t\t\t\twidth = Math.ceil(width / this.layout.pageWidth) * this.layout.pageWidth;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.settings.forceEvenPages) {\r\n\t\t\t\tcolumns = (width / this.layout.pageWidth);\r\n\t\t\t\tif (this.layout.divisor > 1 &&\r\n\t\t\t\t\tthis.layout.name === \"reflowable\" &&\r\n\t\t\t\t\t(columns % 2 > 0)) {\r\n\t\t\t\t\t// add a blank page\r\n\t\t\t\t\twidth += this.layout.pageWidth;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t} // Expand Vertically\r\n\t\telse if (this.settings.axis === \"vertical\") {\r\n\t\t\theight = this.contents.textHeight();\r\n\t\t\tif (this.settings.flow === \"paginated\" &&\r\n\t\t\t\theight % this.layout.height > 0) {\r\n\t\t\t\theight = Math.ceil(height / this.layout.height) * this.layout.height;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Only Resize if dimensions have changed or\r\n\t\t// if Frame is still hidden, so needs reframing\r\n\t\tif (this._needsReframe || width != this._width || height != this._height) {\r\n\t\t\tthis.reframe(width, height);\r\n\t\t}\r\n\r\n\t\tthis._expanding = false;\r\n\t}\r\n\r\n\treframe(width, height) {\r\n\r\n\t\tvar size;\r\n\r\n\t\tif (isNumber(width)) {\r\n\t\t\tthis.element.style.width = width + \"px\";\r\n\t\t\tthis.iframe.style.width = width + \"px\";\r\n\t\t\tthis._width = width;\r\n\t\t}\r\n\r\n\t\tif (isNumber(height)) {\r\n\t\t\tthis.element.style.height = height + \"px\";\r\n\t\t\tthis.iframe.style.height = height + \"px\";\r\n\t\t\tthis._height = height;\r\n\t\t}\r\n\r\n\t\tlet widthDelta = this.prevBounds ? width - this.prevBounds.width : width;\r\n\t\tlet heightDelta = this.prevBounds ? height - this.prevBounds.height : height;\r\n\t\t//김병현 추가\r\n\t\tif (widthDelta < 0) widthDelta = 0;\r\n\t\tif (heightDelta < 0) heightDelta = 0;\r\n\t\tsize = {\r\n\t\t\twidth: width,\r\n\t\t\theight: height,\r\n\t\t\twidthDelta: widthDelta,\r\n\t\t\theightDelta: heightDelta,\r\n\t\t};\r\n\r\n\t\tthis.pane && this.pane.render();\r\n\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tlet mark;\r\n\t\t\tfor (let m in this.marks) {\r\n\t\t\t\tif (this.marks.hasOwnProperty(m)) {\r\n\t\t\t\t\tmark = this.marks[m];\r\n\t\t\t\t\tthis.placeMark(mark.element, mark.range);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.onResize(this, size);\r\n\r\n\t\tthis.emit(EVENTS.VIEWS.RESIZED, size);\r\n\r\n\t\tthis.prevBounds = size;\r\n\r\n\t\tthis.elementBounds = bounds(this.element);\r\n\r\n\t}\r\n\r\n\r\n\tload(contents) {\r\n\t\tvar loading = new defer();\r\n\t\tvar loaded = loading.promise;\r\n\r\n\t\tif (!this.iframe) {\r\n\t\t\tloading.reject(new Error(\"No Iframe Available\"));\r\n\t\t\treturn loaded;\r\n\t\t}\r\n\r\n\t\tthis.iframe.onload = function (event) {\r\n\r\n\t\t\tthis.onLoad(event, loading);\r\n\r\n\t\t}.bind(this);\r\n\r\n\t\tif (this.settings.method === \"blobUrl\") {\r\n\t\t\tthis.blobUrl = createBlobUrl(contents, \"application/xhtml+xml\");\r\n\t\t\tthis.iframe.src = this.blobUrl;\r\n\t\t\tthis.element.appendChild(this.iframe);\r\n\t\t} else if (this.settings.method === \"srcdoc\") {\r\n\t\t\tthis.iframe.srcdoc = contents;\r\n\t\t\tthis.element.appendChild(this.iframe);\r\n\t\t} else {\r\n\r\n\t\t\tthis.element.appendChild(this.iframe);\r\n\r\n\t\t\tthis.document = this.iframe.contentDocument;\r\n\r\n\t\t\tif (!this.document) {\r\n\t\t\t\tloading.reject(new Error(\"No Document Available\"));\r\n\t\t\t\treturn loaded;\r\n\t\t\t}\r\n\r\n\t\t\tthis.iframe.contentDocument.open();\r\n\t\t\t// For Cordova windows platform\r\n\t\t\tif (window.MSApp && MSApp.execUnsafeLocalFunction) {\r\n\t\t\t\tvar outerThis = this;\r\n\t\t\t\tMSApp.execUnsafeLocalFunction(function () {\r\n\t\t\t\t\touterThis.iframe.contentDocument.write(contents);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tthis.iframe.contentDocument.write(contents);\r\n\t\t\t}\r\n\t\t\tthis.iframe.contentDocument.close();\r\n\r\n\t\t}\r\n\r\n\t\treturn loaded;\r\n\t}\r\n\r\n\tonLoad(event, promise) {\r\n\r\n\t\tthis.window = this.iframe.contentWindow;\r\n\t\tthis.document = this.iframe.contentDocument;\r\n\r\n\t\tthis.contents = new Contents(this.document, this.document.body, this.section.cfiBase, this.section.index);\r\n\r\n\t\tthis.rendering = false;\r\n\r\n\t\tvar link = this.document.querySelector(\"link[rel='canonical']\");\r\n\t\tif (link) {\r\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\r\n\t\t} else {\r\n\t\t\tlink = this.document.createElement(\"link\");\r\n\t\t\tlink.setAttribute(\"rel\", \"canonical\");\r\n\t\t\tlink.setAttribute(\"href\", this.section.canonical);\r\n\t\t\tthis.document.querySelector(\"head\").appendChild(link);\r\n\t\t}\r\n\r\n\t\tthis.contents.on(EVENTS.CONTENTS.EXPAND, () => {\r\n\t\t\tif (this.displayed && this.iframe) {\r\n\t\t\t\tthis.expand();\r\n\t\t\t\tif (this.contents) {\r\n\t\t\t\t\tthis.layout.format(this.contents);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.contents.on(EVENTS.CONTENTS.RESIZE, (e) => {\r\n\t\t\tif (this.displayed && this.iframe) {\r\n\t\t\t\tthis.expand();\r\n\t\t\t\tif (this.contents) {\r\n\t\t\t\t\tthis.layout.format(this.contents);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tpromise.resolve(this.contents);\r\n\t}\r\n\r\n\tsetLayout(layout) {\r\n\t\tthis.layout = layout;\r\n\r\n\t\tif (this.contents) {\r\n\t\t\tthis.layout.format(this.contents);\r\n\t\t\tthis.expand();\r\n\t\t}\r\n\t}\r\n\r\n\tsetAxis(axis) {\r\n\r\n\t\tthis.settings.axis = axis;\r\n\r\n\t\tif (axis == \"horizontal\") {\r\n\t\t\tthis.element.style.flex = \"none\";\r\n\t\t} else {\r\n\t\t\tthis.element.style.flex = \"initial\";\r\n\t\t}\r\n\r\n\t\tthis.size();\r\n\r\n\t}\r\n\r\n\tsetWritingMode(mode) {\r\n\t\t// this.element.style.writingMode = writingMode;\r\n\t\tthis.writingMode = mode;\r\n\t}\r\n\r\n\taddListeners() {\r\n\t\t//TODO: Add content listeners for expanding\r\n\t}\r\n\r\n\tremoveListeners(layoutFunc) {\r\n\t\t//TODO: remove content listeners for expanding\r\n\t}\r\n\r\n\tdisplay(request) {\r\n\t\tvar displayed = new defer();\r\n\r\n\t\tif (!this.displayed) {\r\n\r\n\t\t\tthis.render(request)\r\n\t\t\t\t.then(function () {\r\n\r\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.DISPLAYED, this);\r\n\t\t\t\t\tthis.onDisplayed(this);\r\n\r\n\t\t\t\t\tthis.displayed = true;\r\n\t\t\t\t\tdisplayed.resolve(this);\r\n\r\n\t\t\t\t}.bind(this), function (err) {\r\n\t\t\t\t\tdisplayed.reject(err, this);\r\n\t\t\t\t});\r\n\r\n\t\t} else {\r\n\t\t\tdisplayed.resolve(this);\r\n\t\t}\r\n\r\n\r\n\t\treturn displayed.promise;\r\n\t}\r\n\r\n\tshow() {\r\n\t\tthis.element.style.visibility = \"visible\";\r\n\r\n\t\tif (this.iframe) {\r\n\t\t\tthis.iframe.style.visibility = \"visible\";\r\n\r\n\t\t\t// Remind Safari to redraw the iframe\r\n\t\t\tthis.iframe.style.transform = \"translateZ(0)\";\r\n\t\t\tthis.iframe.offsetWidth;\r\n\t\t\tthis.iframe.style.transform = null;\r\n\t\t}\r\n\r\n\t\tthis.emit(EVENTS.VIEWS.SHOWN, this);\r\n\t}\r\n\r\n\thide() {\r\n\t\t// this.iframe.style.display = \"none\";\r\n\t\tthis.element.style.visibility = \"hidden\";\r\n\t\tthis.iframe.style.visibility = \"hidden\";\r\n\r\n\t\tthis.stopExpanding = true;\r\n\t\tthis.emit(EVENTS.VIEWS.HIDDEN, this);\r\n\t}\r\n\r\n\toffset() {\r\n\t\treturn {\r\n\t\t\ttop: this.element.offsetTop,\r\n\t\t\tleft: this.element.offsetLeft\r\n\t\t}\r\n\t}\r\n\r\n\twidth() {\r\n\t\treturn this._width;\r\n\t}\r\n\r\n\theight() {\r\n\t\treturn this._height;\r\n\t}\r\n\r\n\tposition() {\r\n\t\treturn this.element.getBoundingClientRect();\r\n\t}\r\n\r\n\tlocationOf(target) {\r\n\t\tvar parentPos = this.iframe.getBoundingClientRect();\r\n\t\tvar targetPos = this.contents.locationOf(target, this.settings.ignoreClass);\r\n\r\n\t\treturn {\r\n\t\t\t\"left\": targetPos.left,\r\n\t\t\t\"top\": targetPos.top\r\n\t\t};\r\n\t}\r\n\r\n\tonDisplayed(view) {\r\n\t\t// Stub, override with a custom functions\r\n\t}\r\n\r\n\tonResize(view, e) {\r\n\t\t// Stub, override with a custom functions\r\n\t}\r\n\r\n\tbounds(force) {\r\n\t\tif (force || !this.elementBounds) {\r\n\t\t\tthis.elementBounds = bounds(this.element);\r\n\t\t}\r\n\r\n\t\treturn this.elementBounds;\r\n\t}\r\n\r\n\thighlight(cfiRange, data = {}, cb, className = \"epubjs-hl\", styles = {}, color = \"yellow\") {\r\n\t\tif (this.highlights[cfiRange]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this.contents) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst attributes = Object.assign({ \"fill\": color, \"opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\" }, styles);\r\n\t\t// const attributes = Object.assign({ \"fill\": color, \"fill-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\" }, styles);\r\n\t\tlet range = this.contents.range(cfiRange);\r\n\r\n\r\n\t\tlet emitter = (e) => {\r\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data, this.contents, color);\r\n\t\t};\r\n\r\n\t\tdata[\"epubcfi\"] = cfiRange;\r\n\t\t//김병현 주석\r\n\t\t// if (!this.pane) {\r\n\t\tlet marks;\r\n\t\tif (this.pane) {\r\n\t\t\tmarks = this.pane.marks;\r\n\t\t}\r\n\r\n\t\tthis.pane = new Pane(this.iframe, this.element);\r\n\t\tif (marks) {\r\n\t\t\tfor (let i = 0; i < marks.length; i++) {\r\n\t\t\t\tthis.pane.marks.push(marks[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// }\r\n\r\n\t\tlet m = new Highlight(range, className, data, attributes);\r\n\t\tlet h = this.pane.addMark(m);\r\n\t\t//김병현 추가\r\n\t\tif (data.memo) {\r\n\t\t\tlet firstRect = h.element.children[0];\r\n\t\t\tlet imageLeft = firstRect.getAttribute(\"x\");\r\n\t\t\tlet imageTop = firstRect.getAttribute(\"y\");\r\n\t\t\tlet imageTag = this.document.createElement(\"img\");\r\n\t\t\t// imageTag.src = \"../../web/images/bookmark.png\";\r\n\t\t\timageTag.src = window.location.origin + window.location.pathname.replace(window.location.pathname.split(\"/\").pop(), \"\") + \"./images/note_memo.svg\";\r\n\t\t\timageTag.style.left = imageLeft - 10 + \"px\";\r\n\t\t\timageTag.style.top = imageTop - 10 + \"px\";\r\n\t\t\timageTag.style.width = \"14px\";\r\n\t\t\timageTag.style.height = \"14px\";\r\n\t\t\timageTag.style.position = \"absolute\";\r\n\t\t\timageTag.style.userSelect = \"none\";\r\n\t\t\timageTag.epubcfi = cfiRange;\r\n\t\t\timageTag.style.userSelect = \"none\";\r\n\t\t\timageTag.style.webkitUserSelect = \"none\";\r\n\t\t\t// imageTag.style.opacity = \"0.2\";\t\t\r\n\t\t\tthis.contents.document.body.appendChild(imageTag);\r\n\t\t\tthis.icons[cfiRange] = imageTag;\r\n\t\t\timageTag.addEventListener(\"click\", (e) => {\r\n\t\t\t\tthis.window.setTimeout(() => {\r\n\t\t\t\t\tthis.emit(EVENTS.VIEWS.MARK_IMAGE_CLICKED, data);\r\n\t\t\t\t}, 1);\r\n\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\treturn false;\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t//셀렉션 지우기\r\n\t\tif (this.contents.window.getSelection) {\r\n\t\t\tif (this.contents.window.getSelection().empty) {  // Chrome\r\n\t\t\t\tthis.contents.window.getSelection().empty();\r\n\t\t\t}\r\n\t\t\telse if (this.contents.window.getSelection().removeAllRanges) {  // Firefox\r\n\t\t\t\tthis.contents.window.getSelection().removeAllRanges();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.contents.document.selection) {  // IE?\r\n\t\t\tthis.contents.document.selection.empty();\r\n\t\t}\r\n\t\t//=========\r\n\t\tthis.highlights[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\r\n\t\t//김병현추가\r\n\t\th.element.style.pointerEvents = \"auto\";\r\n\t\th.element.style.userSelect = \"none\";\r\n\r\n\t\th.element.setAttribute(\"ref\", className);\r\n\t\th.element.addEventListener(\"click\", emitter, true);\r\n\t\th.element.addEventListener(\"touchstart\", emitter, true);\r\n\r\n\r\n\r\n\t\tif (cb) {\r\n\t\t\th.element.addEventListener(\"click\", cb, true);\r\n\t\t\th.element.addEventListener(\"touchstart\", cb, true);\r\n\t\t}\r\n\r\n\t\treturn h;\r\n\t}\r\n\r\n\tunderline(cfiRange, data = {}, cb, className = \"epubjs-ul\", styles = {}) {\r\n\t\tif (!this.contents) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst attributes = Object.assign({ \"stroke\": \"black\", \"stroke-opacity\": \"0.3\", \"mix-blend-mode\": \"multiply\" }, styles);\r\n\t\tlet range = this.contents.range(cfiRange);\r\n\t\tlet emitter = () => {\r\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\r\n\t\t};\r\n\r\n\t\tdata[\"epubcfi\"] = cfiRange;\r\n\r\n\t\tif (!this.pane) {\r\n\t\t\tthis.pane = new Pane(this.iframe, this.element);\r\n\t\t}\r\n\r\n\t\tlet m = new Underline(range, className, data, attributes);\r\n\t\tlet h = this.pane.addMark(m);\r\n\r\n\t\tthis.underlines[cfiRange] = { \"mark\": h, \"element\": h.element, \"listeners\": [emitter, cb] };\r\n\r\n\t\th.element.setAttribute(\"ref\", className);\r\n\t\th.element.addEventListener(\"click\", emitter);\r\n\t\th.element.addEventListener(\"touchstart\", emitter);\r\n\r\n\t\tif (cb) {\r\n\t\t\th.element.addEventListener(\"click\", cb);\r\n\t\t\th.element.addEventListener(\"touchstart\", cb);\r\n\t\t}\r\n\t\treturn h;\r\n\t}\r\n\r\n\tmark(cfiRange, data = {}, cb) {\r\n\r\n\t\tif (!this.contents) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (cfiRange in this.marks) {\r\n\t\t\tlet item = this.marks[cfiRange];\r\n\t\t\treturn item;\r\n\t\t}\r\n\r\n\t\tlet range = this.contents.range(cfiRange);\r\n\t\tif (!range) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet container = range.commonAncestorContainer;\r\n\t\tlet parent = (container.nodeType === 1) ? container : container.parentNode;\r\n\r\n\t\tlet emitter = (e) => {\r\n\t\t\tthis.emit(EVENTS.VIEWS.MARK_CLICKED, cfiRange, data);\r\n\t\t};\r\n\r\n\t\tif (range.collapsed && container.nodeType === 1) {\r\n\t\t\trange = new Range();\r\n\t\t\trange.selectNodeContents(container);\r\n\t\t} else if (range.collapsed) { // Webkit doesn't like collapsed ranges\r\n\t\t\trange = new Range();\r\n\t\t\trange.selectNodeContents(parent);\r\n\t\t}\r\n\r\n\t\tlet mark = this.document.createElement(\"a\");\r\n\t\tmark.setAttribute(\"ref\", \"epubjs-mk\");\r\n\t\tmark.style.position = \"absolute\";\r\n\t\tmark.dataset[\"epubcfi\"] = cfiRange;\r\n\r\n\t\tif (data) {\r\n\t\t\tObject.keys(data).forEach((key) => {\r\n\t\t\t\tmark.dataset[key] = data[key];\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (cb) {\r\n\t\t\tmark.addEventListener(\"click\", cb);\r\n\t\t\tmark.addEventListener(\"touchstart\", cb);\r\n\t\t}\r\n\r\n\t\tmark.addEventListener(\"click\", emitter);\r\n\t\tmark.addEventListener(\"touchstart\", emitter);\r\n\r\n\t\tthis.placeMark(mark, range);\r\n\r\n\t\tthis.element.appendChild(mark);\r\n\r\n\t\tthis.marks[cfiRange] = { \"element\": mark, \"range\": range, \"listeners\": [emitter, cb] };\r\n\r\n\t\treturn parent;\r\n\t}\r\n\r\n\tplaceMark(element, range) {\r\n\t\tlet top, right, left;\r\n\r\n\t\tif (this.layout.name === \"pre-paginated\" ||\r\n\t\t\tthis.settings.axis !== \"horizontal\") {\r\n\t\t\tlet pos = range.getBoundingClientRect();\r\n\t\t\ttop = pos.top;\r\n\t\t\tright = pos.right;\r\n\t\t} else {\r\n\t\t\t// Element might break columns, so find the left most element\r\n\t\t\tlet rects = range.getClientRects();\r\n\r\n\t\t\tlet rect;\r\n\t\t\tfor (var i = 0; i != rects.length; i++) {\r\n\t\t\t\trect = rects[i];\r\n\t\t\t\tif (!left || rect.left < left) {\r\n\t\t\t\t\tleft = rect.left;\r\n\t\t\t\t\t// right = rect.right;\r\n\t\t\t\t\tright = Math.ceil(left / this.layout.props.pageWidth) * this.layout.props.pageWidth - (this.layout.gap / 2);\r\n\t\t\t\t\ttop = rect.top;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\telement.style.top = `${top}px`;\r\n\t\telement.style.left = `${right}px`;\r\n\t}\r\n\r\n\tunhighlight(cfiRange) {\r\n\t\tlet item;\r\n\t\tif (cfiRange in this.highlights) {\r\n\t\t\titem = this.highlights[cfiRange];\r\n\r\n\t\t\t//김병현 주석\r\n\t\t\t// this.pane.removeMark(item.mark);\r\n\t\t\t//김병현 추가 \r\n\t\t\titem.mark.element.remove();\r\n\t\t\titem.listeners.forEach((l) => {\r\n\t\t\t\tif (l) {\r\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\r\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tdelete this.highlights[cfiRange];\r\n\t\t}\r\n\r\n\t\t//김병현 추가\r\n\t\tlet item2;\r\n\t\tif (cfiRange in this.icons) {\r\n\t\t\titem2 = this.icons[cfiRange];\r\n\r\n\t\t\tthis.document.body.removeChild(item2);\r\n\t\t}\r\n\t\tdelete this.icons[cfiRange];\r\n\t}\r\n\r\n\tununderline(cfiRange) {\r\n\t\tlet item;\r\n\t\tif (cfiRange in this.underlines) {\r\n\t\t\titem = this.underlines[cfiRange];\r\n\t\t\tthis.pane.removeMark(item.mark);\r\n\t\t\titem.listeners.forEach((l) => {\r\n\t\t\t\tif (l) {\r\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\r\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tdelete this.underlines[cfiRange];\r\n\t\t}\r\n\t}\r\n\r\n\tremoveHighlight() {\r\n\t\tfor (let cfiRange in this.highlights) {\r\n\r\n\t\t\tthis.unhighlight(cfiRange);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tunmark(cfiRange) {\r\n\t\tlet item;\r\n\t\tif (cfiRange in this.marks) {\r\n\t\t\titem = this.marks[cfiRange];\r\n\t\t\tthis.element.removeChild(item.element);\r\n\t\t\titem.listeners.forEach((l) => {\r\n\t\t\t\tif (l) {\r\n\t\t\t\t\titem.element.removeEventListener(\"click\", l);\r\n\t\t\t\t\titem.element.removeEventListener(\"touchstart\", l);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tdelete this.marks[cfiRange];\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t\tfor (let cfiRange in this.highlights) {\r\n\t\t\tthis.unhighlight(cfiRange);\r\n\t\t}\r\n\r\n\t\tfor (let cfiRange in this.underlines) {\r\n\t\t\tthis.ununderline(cfiRange);\r\n\t\t}\r\n\r\n\t\tfor (let cfiRange in this.marks) {\r\n\t\t\tthis.unmark(cfiRange);\r\n\t\t}\r\n\r\n\t\tif (this.blobUrl) {\r\n\t\t\trevokeBlobUrl(this.blobUrl);\r\n\t\t}\r\n\r\n\t\tif (this.displayed) {\r\n\t\t\tthis.displayed = false;\r\n\r\n\t\t\tthis.removeListeners();\r\n\t\t\tthis.contents.destroy();\r\n\r\n\t\t\tthis.stopExpanding = true;\r\n\t\t\tthis.element.removeChild(this.iframe);\r\n\r\n\t\t\tthis.iframe = undefined;\r\n\t\t\tthis.contents = undefined;\r\n\r\n\t\t\tthis._textWidth = null;\r\n\t\t\tthis._textHeight = null;\r\n\t\t\tthis._width = null;\r\n\t\t\tthis._height = null;\r\n\t\t}\r\n\r\n\t\t// this.element.style.height = \"0px\";\r\n\t\t// this.element.style.width = \"0px\";\r\n\t}\r\n}\r\n\r\nEventEmitter(IframeView.prototype);\r\n\r\nexport default IframeView;\r\n","import {extend, defer, requestAnimationFrame, prefixed} from \"../../utils/core\";\r\nimport { EVENTS, DOM_EVENTS } from \"../../utils/constants\";\r\nimport EventEmitter from \"event-emitter\";\r\n\r\n// easing equations from https://github.com/danro/easing-js/blob/master/easing.js\r\nconst PI_D2 = (Math.PI / 2);\r\nconst EASING_EQUATIONS = {\r\n\t\teaseOutSine: function (pos) {\r\n\t\t\t\treturn Math.sin(pos * PI_D2);\r\n\t\t},\r\n\t\teaseInOutSine: function (pos) {\r\n\t\t\t\treturn (-0.5 * (Math.cos(Math.PI * pos) - 1));\r\n\t\t},\r\n\t\teaseInOutQuint: function (pos) {\r\n\t\t\t\tif ((pos /= 0.5) < 1) {\r\n\t\t\t\t\t\treturn 0.5 * Math.pow(pos, 5);\r\n\t\t\t\t}\r\n\t\t\t\treturn 0.5 * (Math.pow((pos - 2), 5) + 2);\r\n\t\t},\r\n\t\teaseInCubic: function(pos) {\r\n\t\t\treturn Math.pow(pos, 3);\r\n  \t}\r\n};\r\n\r\nclass Snap {\r\n\tconstructor(manager, options) {\r\n\r\n\t\tthis.settings = extend({\r\n\t\t\tduration: 80,\r\n\t\t\tminVelocity: 0.2,\r\n\t\t\tminDistance: 10,\r\n\t\t\teasing: EASING_EQUATIONS['easeInCubic']\r\n\t\t}, options || {});\r\n\r\n\t\tthis.supportsTouch = this.supportsTouch();\r\n\r\n\t\tif (this.supportsTouch) {\r\n\t\t\tthis.setup(manager);\r\n\t\t}\r\n\t}\r\n\r\n\tsetup(manager) {\r\n\t\tthis.manager = manager;\r\n\r\n\t\tthis.layout = this.manager.layout;\r\n\r\n\t\tthis.fullsize = this.manager.settings.fullsize;\r\n\t\tif (this.fullsize) {\r\n\t\t\tthis.element = this.manager.stage.element;\r\n\t\t\tthis.scroller = window;\r\n\t\t\tthis.disableScroll();\r\n\t\t} else {\r\n\t\t\tthis.element = this.manager.stage.container;\r\n\t\t\tthis.scroller = this.element;\r\n\t\t\tthis.element.style[\"WebkitOverflowScrolling\"] = \"touch\";\r\n\t\t}\r\n\r\n\t\t// this.overflow = this.manager.overflow;\r\n\r\n\t\t// set lookahead offset to page width\r\n\t\tthis.manager.settings.offset = this.layout.width;\r\n\t\tthis.manager.settings.afterScrolledTimeout = this.settings.duration * 2;\r\n\r\n\t\tthis.isVertical = this.manager.settings.axis === \"vertical\";\r\n\r\n\t\t// disable snapping if not paginated or axis in not horizontal\r\n\t\tif (!this.manager.isPaginated || this.isVertical) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.touchCanceler = false;\r\n\t\tthis.resizeCanceler = false;\r\n\t\tthis.snapping = false;\r\n\r\n\r\n\t\tthis.scrollLeft;\r\n\t\tthis.scrollTop;\r\n\r\n\t\tthis.startTouchX = undefined;\r\n\t\tthis.startTouchY = undefined;\r\n\t\tthis.startTime = undefined;\r\n\t\tthis.endTouchX = undefined;\r\n\t\tthis.endTouchY = undefined;\r\n\t\tthis.endTime = undefined;\r\n\r\n\t\tthis.addListeners();\r\n\t}\r\n\r\n\tsupportsTouch() {\r\n\t\tif (('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\tdisableScroll() {\r\n\t\tthis.element.style.overflow = \"hidden\";\r\n\t}\r\n\r\n\tenableScroll() {\r\n\t\tthis.element.style.overflow = \"\";\r\n\t}\r\n\r\n\taddListeners() {\r\n\t\tthis._onResize = this.onResize.bind(this);\r\n\t\twindow.addEventListener('resize', this._onResize);\r\n\r\n\t\tthis._onScroll = this.onScroll.bind(this);\r\n\t\tthis.scroller.addEventListener('scroll', this._onScroll);\r\n\r\n\t\tthis._onTouchStart = this.onTouchStart.bind(this);\r\n\t\tthis.scroller.addEventListener('touchstart', this._onTouchStart, { passive: true });\r\n\t\tthis.on('touchstart', this._onTouchStart);\r\n\r\n\t\tthis._onTouchMove = this.onTouchMove.bind(this);\r\n\t\tthis.scroller.addEventListener('touchmove', this._onTouchMove, { passive: true });\r\n\t\tthis.on('touchmove', this._onTouchMove);\r\n\r\n\t\tthis._onTouchEnd = this.onTouchEnd.bind(this);\r\n\t\tthis.scroller.addEventListener('touchend', this._onTouchEnd, { passive: true });\r\n\t\tthis.on('touchend', this._onTouchEnd);\r\n\r\n\t\tthis._afterDisplayed = this.afterDisplayed.bind(this);\r\n\t\tthis.manager.on(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\r\n\t}\r\n\r\n\tremoveListeners() {\r\n\t\twindow.removeEventListener('resize', this._onResize);\r\n\t\tthis._onResize = undefined;\r\n\r\n\t\tthis.scroller.removeEventListener('scroll', this._onScroll);\r\n\t\tthis._onScroll = undefined;\r\n\r\n\t\tthis.scroller.removeEventListener('touchstart', this._onTouchStart, { passive: true });\r\n\t\tthis.off('touchstart', this._onTouchStart);\r\n\t\tthis._onTouchStart = undefined;\r\n\r\n\t\tthis.scroller.removeEventListener('touchmove', this._onTouchMove, { passive: true });\r\n\t\tthis.off('touchmove', this._onTouchMove);\r\n\t\tthis._onTouchMove = undefined;\r\n\r\n\t\tthis.scroller.removeEventListener('touchend', this._onTouchEnd, { passive: true });\r\n\t\tthis.off('touchend', this._onTouchEnd);\r\n\t\tthis._onTouchEnd = undefined;\r\n\r\n\t\tthis.manager.off(EVENTS.MANAGERS.ADDED, this._afterDisplayed);\r\n\t\tthis._afterDisplayed = undefined;\r\n\t}\r\n\r\n\tafterDisplayed(view) {\r\n\t\tlet contents = view.contents;\r\n\t\t[\"touchstart\", \"touchmove\", \"touchend\"].forEach((e) => {\r\n\t\t\tcontents.on(e, (ev) => this.triggerViewEvent(ev, contents));\r\n\t\t});\r\n\t}\r\n\r\n\ttriggerViewEvent(e, contents){\r\n\t\tthis.emit(e.type, e, contents);\r\n\t}\r\n\r\n\tonScroll(e) {\r\n\t\t\r\n\t\tthis.scrollLeft = this.fullsize ? window.scrollX : this.scroller.scrollLeft;\r\n\t\tthis.scrollTop = this.fullsize ? window.scrollY : this.scroller.scrollTop;\r\n\t}\r\n\r\n\tonResize(e) {\r\n\t\tthis.resizeCanceler = true;\r\n\t}\r\n\r\n\tonTouchStart(e) {\r\n\t\tlet { screenX, screenY } = e.touches[0];\r\n\r\n\t\tif (this.fullsize) {\r\n\t\t\tthis.enableScroll();\r\n\t\t}\r\n\r\n\t\tthis.touchCanceler = true;\r\n\r\n\t\tif (!this.startTouchX) {\r\n\t\t\tthis.startTouchX = screenX;\r\n\t\t\tthis.startTouchY = screenY;\r\n\t\t\tthis.startTime = this.now();\r\n\t\t}\r\n\r\n\t\tthis.endTouchX = screenX;\r\n\t\tthis.endTouchY = screenY;\r\n\t\tthis.endTime = this.now();\r\n\t}\r\n\r\n\tonTouchMove(e) {\r\n\t\tlet { screenX, screenY } = e.touches[0];\r\n\t\tlet deltaY = Math.abs(screenY - this.endTouchY);\r\n\r\n\t\tthis.touchCanceler = true;\r\n\r\n\r\n\t\tif (!this.fullsize && deltaY < 10) {\r\n\t\t\tthis.element.scrollLeft -= screenX - this.endTouchX;\r\n\t\t}\r\n\r\n\t\tthis.endTouchX = screenX;\r\n\t\tthis.endTouchY = screenY;\r\n\t\tthis.endTime = this.now();\r\n\t}\r\n\r\n\tonTouchEnd(e) {\r\n\t\tif (this.fullsize) {\r\n\t\t\tthis.disableScroll();\r\n\t\t}\r\n\r\n\t\tthis.touchCanceler = false;\r\n\r\n\t\tlet swipped = this.wasSwiped();\r\n\r\n\t\tif (swipped !== 0) {\r\n\t\t\tthis.snap(swipped);\r\n\t\t} else {\r\n\t\t\tthis.snap();\r\n\t\t}\r\n\r\n\t\tthis.startTouchX = undefined;\r\n\t\tthis.startTouchY = undefined;\r\n\t\tthis.startTime = undefined;\r\n\t\tthis.endTouchX = undefined;\r\n\t\tthis.endTouchY = undefined;\r\n\t\tthis.endTime = undefined;\r\n\t}\r\n\r\n\twasSwiped() {\r\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\r\n\t\tlet distance = (this.endTouchX - this.startTouchX);\r\n\t\tlet absolute = Math.abs(distance);\r\n\t\tlet time = this.endTime - this.startTime;\r\n\t\tlet velocity = (distance / time);\r\n\t\tlet minVelocity = this.settings.minVelocity;\r\n\r\n\t\tif (absolute <= this.settings.minDistance || absolute >= snapWidth) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tif (velocity > minVelocity) {\r\n\t\t\t// previous\r\n\t\t\treturn -1;\r\n\t\t} else if (velocity < -minVelocity) {\r\n\t\t\t// next\r\n\t\t\treturn 1;\r\n\t\t}\r\n\t}\r\n\r\n\tneedsSnap() {\r\n\t\tlet left = this.scrollLeft;\r\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\r\n\t\treturn (left % snapWidth) !== 0;\r\n\t}\r\n\r\n\tsnap(howMany=0) {\r\n\t\tlet left = this.scrollLeft;\r\n\t\tlet snapWidth = this.layout.pageWidth * this.layout.divisor;\r\n\t\tlet snapTo = Math.round(left / snapWidth) * snapWidth;\r\n\r\n\t\tif (howMany) {\r\n\t\t\tsnapTo += (howMany * snapWidth);\r\n\t\t}\r\n\r\n\t\treturn this.smoothScrollTo(snapTo);\r\n\t}\r\n\r\n\tsmoothScrollTo(destination) {\r\n\t\tconst deferred = new defer();\r\n\t\tconst start = this.scrollLeft;\r\n\t\tconst startTime = this.now();\r\n\r\n\t\tconst duration = this.settings.duration;\r\n\t\tconst easing = this.settings.easing;\r\n\r\n\t\tthis.snapping = true;\r\n\r\n\t\t// add animation loop\r\n\t\tfunction tick() {\r\n\t\t\tconst now = this.now();\r\n\t\t\tconst time = Math.min(1, ((now - startTime) / duration));\r\n\t\t\tconst timeFunction = easing(time);\r\n\r\n\r\n\t\t\tif (this.touchCanceler || this.resizeCanceler) {\r\n\t\t\t\tthis.resizeCanceler = false;\r\n\t\t\t\tthis.snapping = false;\r\n\t\t\t\tdeferred.resolve();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (time < 1) {\r\n\t\t\t\t\twindow.requestAnimationFrame(tick.bind(this));\r\n\t\t\t\t\tthis.scrollTo(start + ((destination - start) * time), 0);\r\n\t\t\t} else {\r\n\t\t\t\t\tthis.scrollTo(destination, 0);\r\n\t\t\t\t\tthis.snapping = false;\r\n\t\t\t\t\tdeferred.resolve();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttick.call(this);\r\n\r\n\t\treturn deferred.promise;\r\n\t}\r\n\r\n\tscrollTo(left=0, top=0) {\r\n\t\tif (this.fullsize) {\r\n\t\t\twindow.scroll(left, top);\r\n\t\t} else {\r\n\t\t\tthis.scroller.scrollLeft = left;\r\n\t\t\tthis.scroller.scrollTop = top;\r\n\t\t}\r\n\t}\r\n\r\n\tnow() {\r\n\t\treturn ('now' in window.performance) ? performance.now() : new Date().getTime();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tif (!this.scroller) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.fullsize) {\r\n\t\t\tthis.enableScroll();\r\n\t\t}\r\n\r\n\t\tthis.removeListeners();\r\n\r\n\t\tthis.scroller = undefined;\r\n\t}\r\n}\r\n\r\nEventEmitter(Snap.prototype);\r\n\r\nexport default Snap;\r\n","import { extend, defer, requestAnimationFrame } from \"../../utils/core\";\r\nimport DefaultViewManager from \"../default\";\r\nimport Snap from \"../helpers/snap\";\r\nimport { EVENTS } from \"../../utils/constants\";\r\nimport debounce from \"lodash/debounce\";\r\n\r\nclass ContinuousViewManager extends DefaultViewManager {\r\n\tconstructor(options) {\r\n\t\tsuper(options);\r\n\r\n\t\tthis.name = \"continuous\";\r\n\r\n\t\tthis.settings = extend(this.settings || {}, {\r\n\t\t\tinfinite: true,\r\n\t\t\toverflow: undefined,\r\n\t\t\taxis: undefined,\r\n\t\t\twritingMode: undefined,\r\n\t\t\tflow: \"scrolled\",\r\n\t\t\toffset: 50,\r\n\t\t\toffsetDelta: 0,\r\n\t\t\twidth: undefined,\r\n\t\t\theight: undefined,\r\n\t\t\tsnap: false,\r\n\t\t\tafterScrolledTimeout: 30\r\n\t\t});\r\n\r\n\t\textend(this.settings, options.settings || {});\r\n\r\n\t\t// Gap can be 0, but defaults doesn't handle that\r\n\t\tif (options.settings.gap != \"undefined\" && options.settings.gap === 0) {\r\n\t\t\tthis.settings.gap = options.settings.gap;\r\n\t\t}\r\n\r\n\t\tthis.viewSettings = {\r\n\t\t\tignoreClass: this.settings.ignoreClass,\r\n\t\t\taxis: this.settings.axis,\r\n\t\t\tflow: this.settings.flow,\r\n\t\t\tlayout: this.layout,\r\n\t\t\twidth: 0,\r\n\t\t\theight: 0,\r\n\t\t\tforceEvenPages: false\r\n\t\t};\r\n\r\n\t\tthis.scrollTop = 0;\r\n\t\tthis.scrollLeft = 0;\r\n\t\tthis.scrollHeight = 0;\r\n\t}\r\n\r\n\tdisplay(section, target) {\r\n\t\treturn DefaultViewManager.prototype.display.call(this, section, target)\r\n\t\t\t.then(function () {\r\n\t\t\t\treturn this.fill();\r\n\t\t\t}.bind(this));\r\n\t}\r\n\r\n\tfill(_full) {\r\n\t\tvar full = _full || new defer();\r\n\r\n\t\tthis.q.enqueue(() => {\r\n\t\t\treturn this.check();\r\n\t\t}).then((result) => {\r\n\t\t\tif (result) {\r\n\t\t\t\tthis.fill(full);\r\n\t\t\t} else {\r\n\t\t\t\tfull.resolve();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn full.promise;\r\n\t}\r\n\r\n\tmoveTo(offset) {\r\n\t\t// var bounds = this.stage.bounds();\r\n\t\t// var dist = Math.floor(offset.top / bounds.height) * bounds.height;\r\n\t\tvar distX = 0,\r\n\t\t\tdistY = 0;\r\n\r\n\t\tvar offsetX = 0,\r\n\t\t\toffsetY = 0;\r\n\r\n\t\tif (!this.isPaginated) {\r\n\t\t\tdistY = offset.top;\r\n\t\t\toffsetY = offset.top + this.settings.offsetDelta;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdistX = Math.floor(offset.left / this.layout.delta) * this.layout.delta;\r\n\t\t\toffsetX = distX + this.settings.offsetDelta;\r\n\t\t}\r\n\r\n\t\tif (distX > 0 || distY > 0) {\r\n\t\t\tthis.scrollBy2(distX, distY, true);\r\n\t\t}\r\n\t}\r\n\r\n\tafterResized(view) {\r\n\t\tthis.emit(EVENTS.MANAGERS.RESIZE, view.section);\r\n\t}\r\n\r\n\t// Remove Previous Listeners if present\r\n\tremoveShownListeners(view) {\r\n\r\n\t\t// view.off(\"shown\", this.afterDisplayed);\r\n\t\t// view.off(\"shown\", this.afterDisplayedAbove);\r\n\t\tview.onDisplayed = function () { };\r\n\r\n\t}\r\n\r\n\tadd(section) {\r\n\t\tvar view = this.createView(section);\r\n\r\n\t\tthis.views.prepend(view);\r\n\r\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\r\n\t\t\tview.expanded = true;\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\t// view.on(EVENTS.VIEWS.SHOWN, this.afterDisplayed.bind(this));\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\t\tview.onResize = this.afterResized.bind(this);\r\n\r\n\t\treturn view.display(this.request);\r\n\t}\r\n\r\n\tappend(section) {\r\n\t\tvar view = this.createView(section);\r\n\r\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\r\n\t\t\tview.expanded = true;\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\tthis.views.append(view);\r\n\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\tprepend(section) {\r\n\t\tvar view = this.createView(section);\r\n\r\n\t\tview.on(EVENTS.VIEWS.RESIZED, (bounds) => {\r\n\t\t\tthis.counter(bounds);\r\n\t\t\tview.expanded = true;\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.AXIS, (axis) => {\r\n\t\t\tthis.updateAxis(axis);\r\n\t\t});\r\n\r\n\t\tview.on(EVENTS.VIEWS.WRITING_MODE, (mode) => {\r\n\t\t\tthis.updateWritingMode(mode);\r\n\t\t});\r\n\r\n\t\tthis.views.prepend(view);\r\n\r\n\t\tview.onDisplayed = this.afterDisplayed.bind(this);\r\n\r\n\t\treturn view;\r\n\t}\r\n\r\n\tcounter(bounds) {\r\n\t\tif (this.settings.axis === \"vertical\") {\r\n\t\t\tthis.scrollBy(0, bounds.heightDelta, true);\r\n\t\t} else {\r\n\t\t\tthis.scrollBy(bounds.widthDelta, 0, true);\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(_offset) {\r\n\t\tvar container = this.bounds();\r\n\t\tvar views = this.views.all();\r\n\t\tvar viewsLength = views.length;\r\n\t\tvar visible = [];\r\n\t\tvar offset = typeof _offset != \"undefined\" ? _offset : (this.settings.offset || 0);\r\n\t\tvar isVisible;\r\n\t\tvar view;\r\n\r\n\t\tvar updating = new defer();\r\n\t\tvar promises = [];\r\n\t\tfor (var i = 0; i < viewsLength; i++) {\r\n\t\t\tview = views[i];\r\n\r\n\t\t\tisVisible = this.isVisible(view, offset, offset, container);\r\n\r\n\t\t\tif (isVisible === true) {\r\n\t\t\t\t// console.log(\"visible \" + view.index, view.displayed);\r\n\r\n\t\t\t\tif (!view.displayed) {\r\n\t\t\t\t\tlet displayed = view.display(this.request)\r\n\t\t\t\t\t\t.then(function (view) {\r\n\t\t\t\t\t\t\tview.show();\r\n\t\t\t\t\t\t}, (err) => {\r\n\t\t\t\t\t\t\tview.hide();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\tpromises.push(displayed);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tview.show();\r\n\t\t\t\t}\r\n\t\t\t\tvisible.push(view);\r\n\t\t\t} else {\r\n\t\t\t\tthis.q.enqueue(view.destroy.bind(view));\r\n\t\t\t\t// console.log(\"hidden \" + view.index, view.displayed);\r\n\r\n\t\t\t\tclearTimeout(this.trimTimeout);\r\n\t\t\t\tthis.trimTimeout = setTimeout(function () {\r\n\t\t\t\t\tthis.q.enqueue(this.trim.bind(this));\r\n\t\t\t\t}.bind(this), 250);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (promises.length) {\r\n\t\t\treturn Promise.all(promises)\r\n\t\t\t\t.catch((err) => {\r\n\t\t\t\t\tupdating.reject(err);\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tupdating.resolve();\r\n\t\t\treturn updating.promise;\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tcheck(_offsetLeft, _offsetTop) {\r\n\r\n\t\tvar checking = new defer();\r\n\t\tvar newViews = [];\r\n\r\n\t\tvar horizontal = (this.settings.axis === \"horizontal\");\r\n\t\tvar delta = this.settings.offset || 0;\r\n\r\n\t\tif (_offsetLeft && horizontal) {\r\n\t\t\tdelta = _offsetLeft;\r\n\t\t}\r\n\r\n\t\tif (_offsetTop && !horizontal) {\r\n\t\t\tdelta = _offsetTop;\r\n\t\t}\r\n\r\n\t\tvar bounds = this._bounds; // bounds saved this until resize\r\n\r\n\t\tlet offset = horizontal ? this.scrollLeft : this.scrollTop;\r\n\t\tlet visibleLength = horizontal ? Math.floor(bounds.width) : bounds.height;\r\n\t\tlet contentLength = horizontal ? this.container.scrollWidth : this.container.scrollHeight;\r\n\t\tlet writingMode = (this.writingMode && this.writingMode.indexOf(\"vertical\") === 0) ? \"vertical\" : \"horizontal\";\r\n\t\tlet rtlScrollType = this.settings.rtlScrollType;\r\n\t\tlet rtl = this.settings.direction === \"rtl\";\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\t// Scroll offset starts at width of element\r\n\t\t\tif (rtl && rtlScrollType === \"default\" && writingMode === \"horizontal\") {\r\n\t\t\t\toffset = contentLength - visibleLength - offset;\r\n\t\t\t}\r\n\t\t\t// Scroll offset starts at 0 and goes negative\r\n\t\t\tif (rtl && rtlScrollType === \"negative\" && writingMode === \"horizontal\") {\r\n\t\t\t\toffset = offset * -1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Scroll offset starts at 0 and goes negative\r\n\t\t\tif ((horizontal && rtl && rtlScrollType === \"negative\") ||\r\n\t\t\t\t(!horizontal && rtl && rtlScrollType === \"default\")) {\r\n\t\t\t\toffset = offset * -1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet prepend = () => {\r\n\t\t\tlet first = this.views.first();\r\n\t\t\tlet prev = first && first.section.prev();\r\n\r\n\t\t\tif (prev) {\r\n\t\t\t\tnewViews.push(this.prepend(prev));\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tlet append = () => {\r\n\t\t\tlet last = this.views.last();\r\n\t\t\tlet next = last && last.section.next();\r\n\r\n\t\t\tif (next) {\r\n\t\t\t\tnewViews.push(this.append(next));\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\r\n\t\tlet end = offset + visibleLength + delta;\r\n\t\tlet start = offset - delta;\r\n\r\n\t\tif (end >= contentLength) {\r\n\r\n\t\t\tappend();\r\n\t\t}\r\n\r\n\t\tif (start <= 0) {\r\n\t\t\tprepend();\r\n\t\t}\r\n\r\n\r\n\t\tlet promises = newViews.map((view) => {\r\n\t\t\treturn view.display(this.request);\r\n\t\t});\r\n\r\n\t\tif (newViews.length) {\r\n\t\t\treturn Promise.all(promises)\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\treturn this.check();\r\n\t\t\t\t})\r\n\t\t\t\t.then(() => {\r\n\t\t\t\t\t// Check to see if anything new is on screen after rendering\r\n\t\t\t\t\treturn this.update(delta);\r\n\t\t\t\t}, (err) => {\r\n\t\t\t\t\treturn err;\r\n\t\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.q.enqueue(function () {\r\n\t\t\t\tthis.update();\r\n\t\t\t}.bind(this));\r\n\t\t\tchecking.resolve(false);\r\n\t\t\treturn checking.promise;\r\n\t\t}\r\n\r\n\r\n\t}\r\n\r\n\ttrim() {\r\n\t\tvar task = new defer();\r\n\t\tvar displayed = this.views.displayed();\r\n\t\tvar first = displayed[0];\r\n\t\tvar last = displayed[displayed.length - 1];\r\n\t\tvar firstIndex = this.views.indexOf(first);\r\n\t\tvar lastIndex = this.views.indexOf(last);\r\n\t\tvar above = this.views.slice(0, firstIndex);\r\n\t\tvar below = this.views.slice(lastIndex + 1);\r\n\r\n\t\t// Erase all but last above\r\n\t\tfor (var i = 0; i < above.length - 1; i++) {\r\n\t\t\tthis.erase(above[i], above);\r\n\t\t}\r\n\r\n\t\t// Erase all except first below\r\n\t\tfor (var j = 1; j < below.length; j++) {\r\n\t\t\tthis.erase(below[j]);\r\n\t\t}\r\n\r\n\t\ttask.resolve();\r\n\t\treturn task.promise;\r\n\t}\r\n\r\n\terase(view, above) { //Trim\r\n\r\n\t\tvar prevTop;\r\n\t\tvar prevLeft;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tprevTop = this.container.scrollTop;\r\n\t\t\tprevLeft = this.container.scrollLeft;\r\n\t\t} else {\r\n\t\t\tprevTop = window.scrollY;\r\n\t\t\tprevLeft = window.scrollX;\r\n\t\t}\r\n\r\n\t\tvar bounds = view.bounds();\r\n\r\n\t\tthis.views.remove(view);\r\n\r\n\t\tif (above) {\r\n\t\t\tif (this.settings.axis === \"vertical\") {\r\n\t\t\t\tthis.scrollTo(0, prevTop - bounds.height, true);\r\n\t\t\t} else {\r\n\t\t\t\tif (this.settings.direction === 'rtl') {\r\n\t\t\t\t\tif (!this.settings.fullsize) {\r\n\t\t\t\t\t\tthis.scrollTo(prevLeft, 0, true);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.scrollTo(prevLeft + Math.floor(bounds.width), 0, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scrollTo(prevLeft - Math.floor(bounds.width), 0, true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\taddEventListeners(stage) {\r\n\r\n\t\twindow.addEventListener(\"unload\", function (e) {\r\n\t\t\tthis.ignore = true;\r\n\t\t\t// this.scrollTo(0,0);\r\n\t\t\tthis.destroy();\r\n\t\t}.bind(this));\r\n\r\n\t\tthis.addScrollListeners();\r\n\r\n\t\tif (this.isPaginated && this.settings.snap) {\r\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\r\n\t\t}\r\n\t}\r\n\r\n\taddScrollListeners() {\r\n\t\tvar scroller;\r\n\r\n\t\tthis.tick = requestAnimationFrame;\r\n\r\n\t\tlet dir = this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\" ? -1 : 1;\r\n\r\n\t\tthis.scrollDeltaVert = 0;\r\n\t\tthis.scrollDeltaHorz = 0;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscroller = this.container;\r\n\t\t\tthis.scrollTop = this.container.scrollTop;\r\n\t\t\tthis.scrollLeft = this.container.scrollLeft;\r\n\t\t\tthis.scrollHeight = this.container.scrollHeight;\r\n\t\t} else {\r\n\t\t\tscroller = window;\r\n\t\t\tthis.scrollTop = window.scrollY * dir;\r\n\t\t\tthis.scrollLeft = window.scrollX * dir;\r\n\t\t}\r\n\r\n\t\tthis._onScroll = this.onScroll.bind(this);\r\n\t\tscroller.addEventListener(\"scroll\", this._onScroll);\r\n\t\tthis._scrolled = debounce(this.scrolled.bind(this), 30);\r\n\t\t// this.tick.call(window, this.onScroll.bind(this));\r\n\r\n\t\tthis.didScroll = false;\r\n\r\n\t}\r\n\r\n\tremoveEventListeners() {\r\n\t\tvar scroller;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscroller = this.container;\r\n\t\t} else {\r\n\t\t\tscroller = window;\r\n\t\t}\r\n\r\n\t\tscroller.removeEventListener(\"scroll\", this._onScroll);\r\n\t\tthis._onScroll = undefined;\r\n\t}\r\n\r\n\tonScroll() {\r\n\t\tlet scrollTop;\r\n\t\tlet scrollLeft;\r\n\t\tlet scrollHeight;\r\n\t\tlet dir = this.settings.direction === \"rtl\" && this.settings.rtlScrollType === \"default\" ? -1 : 1;\r\n\r\n\t\tif (!this.settings.fullsize) {\r\n\t\t\tscrollTop = this.container.scrollTop;\r\n\t\t\tscrollLeft = this.container.scrollLeft;\r\n\t\t\tscrollHeight = this.container.scrollHeight;\r\n\t\t} else {\r\n\t\t\tscrollTop = window.scrollY * dir;\r\n\t\t\tscrollLeft = window.scrollX * dir;\r\n\t\t}\r\n\r\n\t\tthis.scrollTop = scrollTop;\r\n\t\tthis.scrollLeft = scrollLeft;\r\n\t\tthis.scrollHeight = scrollHeight\r\n\t\tif (!this.ignore) {\r\n\r\n\t\t\tthis._scrolled();\r\n\r\n\t\t} else {\r\n\t\t\tthis.ignore = false;\r\n\t\t}\r\n\r\n\t\tthis.scrollDeltaVert += Math.abs(scrollTop - this.prevScrollTop);\r\n\t\tthis.scrollDeltaHorz += Math.abs(scrollLeft - this.prevScrollLeft);\r\n\r\n\t\tthis.prevScrollTop = scrollTop;\r\n\t\tthis.prevScrollLeft = scrollLeft;\r\n\r\n\t\tclearTimeout(this.scrollTimeout);\r\n\t\tthis.scrollTimeout = setTimeout(function () {\r\n\t\t\tthis.scrollDeltaVert = 0;\r\n\t\t\tthis.scrollDeltaHorz = 0;\r\n\t\t}.bind(this), 150);\r\n\r\n\t\tclearTimeout(this.afterScrolled);\r\n\r\n\t\tthis.didScroll = false;\r\n\r\n\t}\r\n\r\n\tscrolled() {\r\n\r\n\t\tthis.q.enqueue(function () {\r\n\t\t\treturn this.check();\r\n\t\t}.bind(this));\r\n\r\n\t\tthis.emit(EVENTS.MANAGERS.SCROLL, {\r\n\t\t\ttop: this.scrollTop,\r\n\t\t\tleft: this.scrollLeft\r\n\t\t});\r\n\r\n\t\tclearTimeout(this.afterScrolled);\r\n\t\tthis.afterScrolled = setTimeout(function () {\r\n\r\n\t\t\t// Don't report scroll if we are about the snap\r\n\t\t\tif (this.snapper && this.snapper.supportsTouch && this.snapper.needsSnap()) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(EVENTS.MANAGERS.SCROLLED, {\r\n\t\t\t\ttop: this.scrollTop,\r\n\t\t\t\tleft: this.scrollLeft\r\n\t\t\t});\r\n\r\n\t\t}.bind(this), this.settings.afterScrolledTimeout);\r\n\t}\r\n\r\n\tnext() {\r\n\r\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\r\n\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\r\n\r\n\t\tif (!this.views.length) return;\r\n\r\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\r\n\r\n\t\t\tthis.scrollBy(delta, 0, true);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.scrollBy(0, this.layout.height, true);\r\n\r\n\t\t}\r\n\r\n\t\tthis.q.enqueue(function () {\r\n\t\t\treturn this.check();\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\tprev() {\r\n\r\n\t\tlet delta = this.layout.props.name === \"pre-paginated\" &&\r\n\t\t\tthis.layout.props.spread ? this.layout.props.delta * 2 : this.layout.props.delta;\r\n\r\n\t\tif (!this.views.length) return;\r\n\r\n\t\tif (this.isPaginated && this.settings.axis === \"horizontal\") {\r\n\r\n\t\t\tthis.scrollBy(-delta, 0, true);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.scrollBy(0, -this.layout.height, true);\r\n\r\n\t\t}\r\n\r\n\t\tthis.q.enqueue(function () {\r\n\t\t\treturn this.check();\r\n\t\t}.bind(this));\r\n\t}\r\n\r\n\tupdateFlow(flow) {\r\n\t\tif (this.rendered && this.snapper) {\r\n\t\t\tthis.snapper.destroy();\r\n\t\t\tthis.snapper = undefined;\r\n\t\t}\r\n\r\n\t\tsuper.updateFlow(flow, \"scroll\");\r\n\r\n\t\tif (this.rendered && this.isPaginated && this.settings.snap) {\r\n\t\t\tthis.snapper = new Snap(this, this.settings.snap && (typeof this.settings.snap === \"object\") && this.settings.snap);\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tsuper.destroy();\r\n\r\n\t\tif (this.snapper) {\r\n\t\t\tthis.snapper.destroy();\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport default ContinuousViewManager;\r\n","/*!\n    localForage -- Offline Storage, Improved\n    Version 1.7.3\n    https://localforage.github.io/localForage\n    (c) 2013-2017 Mozilla, Apache License 2.0\n*/\n(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.localforage = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw (f.code=\"MODULE_NOT_FOUND\", f)}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nvar Mutation = global.MutationObserver || global.WebKitMutationObserver;\n\nvar scheduleDrain;\n\n{\n  if (Mutation) {\n    var called = 0;\n    var observer = new Mutation(nextTick);\n    var element = global.document.createTextNode('');\n    observer.observe(element, {\n      characterData: true\n    });\n    scheduleDrain = function () {\n      element.data = (called = ++called % 2);\n    };\n  } else if (!global.setImmediate && typeof global.MessageChannel !== 'undefined') {\n    var channel = new global.MessageChannel();\n    channel.port1.onmessage = nextTick;\n    scheduleDrain = function () {\n      channel.port2.postMessage(0);\n    };\n  } else if ('document' in global && 'onreadystatechange' in global.document.createElement('script')) {\n    scheduleDrain = function () {\n\n      // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n      // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n      var scriptEl = global.document.createElement('script');\n      scriptEl.onreadystatechange = function () {\n        nextTick();\n\n        scriptEl.onreadystatechange = null;\n        scriptEl.parentNode.removeChild(scriptEl);\n        scriptEl = null;\n      };\n      global.document.documentElement.appendChild(scriptEl);\n    };\n  } else {\n    scheduleDrain = function () {\n      setTimeout(nextTick, 0);\n    };\n  }\n}\n\nvar draining;\nvar queue = [];\n//named nextTick for less confusing stack traces\nfunction nextTick() {\n  draining = true;\n  var i, oldQueue;\n  var len = queue.length;\n  while (len) {\n    oldQueue = queue;\n    queue = [];\n    i = -1;\n    while (++i < len) {\n      oldQueue[i]();\n    }\n    len = queue.length;\n  }\n  draining = false;\n}\n\nmodule.exports = immediate;\nfunction immediate(task) {\n  if (queue.push(task) === 1 && !draining) {\n    scheduleDrain();\n  }\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(_dereq_,module,exports){\n'use strict';\nvar immediate = _dereq_(1);\n\n/* istanbul ignore next */\nfunction INTERNAL() {}\n\nvar handlers = {};\n\nvar REJECTED = ['REJECTED'];\nvar FULFILLED = ['FULFILLED'];\nvar PENDING = ['PENDING'];\n\nmodule.exports = Promise;\n\nfunction Promise(resolver) {\n  if (typeof resolver !== 'function') {\n    throw new TypeError('resolver must be a function');\n  }\n  this.state = PENDING;\n  this.queue = [];\n  this.outcome = void 0;\n  if (resolver !== INTERNAL) {\n    safelyResolveThenable(this, resolver);\n  }\n}\n\nPromise.prototype[\"catch\"] = function (onRejected) {\n  return this.then(null, onRejected);\n};\nPromise.prototype.then = function (onFulfilled, onRejected) {\n  if (typeof onFulfilled !== 'function' && this.state === FULFILLED ||\n    typeof onRejected !== 'function' && this.state === REJECTED) {\n    return this;\n  }\n  var promise = new this.constructor(INTERNAL);\n  if (this.state !== PENDING) {\n    var resolver = this.state === FULFILLED ? onFulfilled : onRejected;\n    unwrap(promise, resolver, this.outcome);\n  } else {\n    this.queue.push(new QueueItem(promise, onFulfilled, onRejected));\n  }\n\n  return promise;\n};\nfunction QueueItem(promise, onFulfilled, onRejected) {\n  this.promise = promise;\n  if (typeof onFulfilled === 'function') {\n    this.onFulfilled = onFulfilled;\n    this.callFulfilled = this.otherCallFulfilled;\n  }\n  if (typeof onRejected === 'function') {\n    this.onRejected = onRejected;\n    this.callRejected = this.otherCallRejected;\n  }\n}\nQueueItem.prototype.callFulfilled = function (value) {\n  handlers.resolve(this.promise, value);\n};\nQueueItem.prototype.otherCallFulfilled = function (value) {\n  unwrap(this.promise, this.onFulfilled, value);\n};\nQueueItem.prototype.callRejected = function (value) {\n  handlers.reject(this.promise, value);\n};\nQueueItem.prototype.otherCallRejected = function (value) {\n  unwrap(this.promise, this.onRejected, value);\n};\n\nfunction unwrap(promise, func, value) {\n  immediate(function () {\n    var returnValue;\n    try {\n      returnValue = func(value);\n    } catch (e) {\n      return handlers.reject(promise, e);\n    }\n    if (returnValue === promise) {\n      handlers.reject(promise, new TypeError('Cannot resolve promise with itself'));\n    } else {\n      handlers.resolve(promise, returnValue);\n    }\n  });\n}\n\nhandlers.resolve = function (self, value) {\n  var result = tryCatch(getThen, value);\n  if (result.status === 'error') {\n    return handlers.reject(self, result.value);\n  }\n  var thenable = result.value;\n\n  if (thenable) {\n    safelyResolveThenable(self, thenable);\n  } else {\n    self.state = FULFILLED;\n    self.outcome = value;\n    var i = -1;\n    var len = self.queue.length;\n    while (++i < len) {\n      self.queue[i].callFulfilled(value);\n    }\n  }\n  return self;\n};\nhandlers.reject = function (self, error) {\n  self.state = REJECTED;\n  self.outcome = error;\n  var i = -1;\n  var len = self.queue.length;\n  while (++i < len) {\n    self.queue[i].callRejected(error);\n  }\n  return self;\n};\n\nfunction getThen(obj) {\n  // Make sure we only access the accessor once as required by the spec\n  var then = obj && obj.then;\n  if (obj && (typeof obj === 'object' || typeof obj === 'function') && typeof then === 'function') {\n    return function appyThen() {\n      then.apply(obj, arguments);\n    };\n  }\n}\n\nfunction safelyResolveThenable(self, thenable) {\n  // Either fulfill, reject or reject with error\n  var called = false;\n  function onError(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.reject(self, value);\n  }\n\n  function onSuccess(value) {\n    if (called) {\n      return;\n    }\n    called = true;\n    handlers.resolve(self, value);\n  }\n\n  function tryToUnwrap() {\n    thenable(onSuccess, onError);\n  }\n\n  var result = tryCatch(tryToUnwrap);\n  if (result.status === 'error') {\n    onError(result.value);\n  }\n}\n\nfunction tryCatch(func, value) {\n  var out = {};\n  try {\n    out.value = func(value);\n    out.status = 'success';\n  } catch (e) {\n    out.status = 'error';\n    out.value = e;\n  }\n  return out;\n}\n\nPromise.resolve = resolve;\nfunction resolve(value) {\n  if (value instanceof this) {\n    return value;\n  }\n  return handlers.resolve(new this(INTERNAL), value);\n}\n\nPromise.reject = reject;\nfunction reject(reason) {\n  var promise = new this(INTERNAL);\n  return handlers.reject(promise, reason);\n}\n\nPromise.all = all;\nfunction all(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var values = new Array(len);\n  var resolved = 0;\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    allResolver(iterable[i], i);\n  }\n  return promise;\n  function allResolver(value, i) {\n    self.resolve(value).then(resolveFromAll, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n    function resolveFromAll(outValue) {\n      values[i] = outValue;\n      if (++resolved === len && !called) {\n        called = true;\n        handlers.resolve(promise, values);\n      }\n    }\n  }\n}\n\nPromise.race = race;\nfunction race(iterable) {\n  var self = this;\n  if (Object.prototype.toString.call(iterable) !== '[object Array]') {\n    return this.reject(new TypeError('must be an array'));\n  }\n\n  var len = iterable.length;\n  var called = false;\n  if (!len) {\n    return this.resolve([]);\n  }\n\n  var i = -1;\n  var promise = new this(INTERNAL);\n\n  while (++i < len) {\n    resolver(iterable[i]);\n  }\n  return promise;\n  function resolver(value) {\n    self.resolve(value).then(function (response) {\n      if (!called) {\n        called = true;\n        handlers.resolve(promise, response);\n      }\n    }, function (error) {\n      if (!called) {\n        called = true;\n        handlers.reject(promise, error);\n      }\n    });\n  }\n}\n\n},{\"1\":1}],3:[function(_dereq_,module,exports){\n(function (global){\n'use strict';\nif (typeof global.Promise !== 'function') {\n  global.Promise = _dereq_(2);\n}\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"2\":2}],4:[function(_dereq_,module,exports){\n'use strict';\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction getIDB() {\n    /* global indexedDB,webkitIndexedDB,mozIndexedDB,OIndexedDB,msIndexedDB */\n    try {\n        if (typeof indexedDB !== 'undefined') {\n            return indexedDB;\n        }\n        if (typeof webkitIndexedDB !== 'undefined') {\n            return webkitIndexedDB;\n        }\n        if (typeof mozIndexedDB !== 'undefined') {\n            return mozIndexedDB;\n        }\n        if (typeof OIndexedDB !== 'undefined') {\n            return OIndexedDB;\n        }\n        if (typeof msIndexedDB !== 'undefined') {\n            return msIndexedDB;\n        }\n    } catch (e) {\n        return;\n    }\n}\n\nvar idb = getIDB();\n\nfunction isIndexedDBValid() {\n    try {\n        // Initialize IndexedDB; fall back to vendor-prefixed versions\n        // if needed.\n        if (!idb) {\n            return false;\n        }\n        // We mimic PouchDB here;\n        //\n        // We test for openDatabase because IE Mobile identifies itself\n        // as Safari. Oh the lulz...\n        var isSafari = typeof openDatabase !== 'undefined' && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform);\n\n        var hasFetch = typeof fetch === 'function' && fetch.toString().indexOf('[native code') !== -1;\n\n        // Safari <10.1 does not meet our requirements for IDB support (#5572)\n        // since Safari 10.1 shipped with fetch, we can use that to detect it\n        return (!isSafari || hasFetch) && typeof indexedDB !== 'undefined' &&\n        // some outdated implementations of IDB that appear on Samsung\n        // and HTC Android devices <4.4 are missing IDBKeyRange\n        // See: https://github.com/mozilla/localForage/issues/128\n        // See: https://github.com/mozilla/localForage/issues/272\n        typeof IDBKeyRange !== 'undefined';\n    } catch (e) {\n        return false;\n    }\n}\n\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\n// Abstracts constructing a Blob object, so it also works in older\n// browsers that don't support the native Blob constructor. (i.e.\n// old QtWebKit versions, at least).\nfunction createBlob(parts, properties) {\n    /* global BlobBuilder,MSBlobBuilder,MozBlobBuilder,WebKitBlobBuilder */\n    parts = parts || [];\n    properties = properties || {};\n    try {\n        return new Blob(parts, properties);\n    } catch (e) {\n        if (e.name !== 'TypeError') {\n            throw e;\n        }\n        var Builder = typeof BlobBuilder !== 'undefined' ? BlobBuilder : typeof MSBlobBuilder !== 'undefined' ? MSBlobBuilder : typeof MozBlobBuilder !== 'undefined' ? MozBlobBuilder : WebKitBlobBuilder;\n        var builder = new Builder();\n        for (var i = 0; i < parts.length; i += 1) {\n            builder.append(parts[i]);\n        }\n        return builder.getBlob(properties.type);\n    }\n}\n\n// This is CommonJS because lie is an external dependency, so Rollup\n// can just ignore it.\nif (typeof Promise === 'undefined') {\n    // In the \"nopromises\" build this will just throw if you don't have\n    // a global promise object, but it would throw anyway later.\n    _dereq_(3);\n}\nvar Promise$1 = Promise;\n\nfunction executeCallback(promise, callback) {\n    if (callback) {\n        promise.then(function (result) {\n            callback(null, result);\n        }, function (error) {\n            callback(error);\n        });\n    }\n}\n\nfunction executeTwoCallbacks(promise, callback, errorCallback) {\n    if (typeof callback === 'function') {\n        promise.then(callback);\n    }\n\n    if (typeof errorCallback === 'function') {\n        promise[\"catch\"](errorCallback);\n    }\n}\n\nfunction normalizeKey(key) {\n    // Cast the key to a string, as that's all we can set as a key.\n    if (typeof key !== 'string') {\n        console.warn(key + ' used as a key, but it is not a string.');\n        key = String(key);\n    }\n\n    return key;\n}\n\nfunction getCallback() {\n    if (arguments.length && typeof arguments[arguments.length - 1] === 'function') {\n        return arguments[arguments.length - 1];\n    }\n}\n\n// Some code originally from async_storage.js in\n// [Gaia](https://github.com/mozilla-b2g/gaia).\n\nvar DETECT_BLOB_SUPPORT_STORE = 'local-forage-detect-blob-support';\nvar supportsBlobs = void 0;\nvar dbContexts = {};\nvar toString = Object.prototype.toString;\n\n// Transaction Modes\nvar READ_ONLY = 'readonly';\nvar READ_WRITE = 'readwrite';\n\n// Transform a binary string to an array buffer, because otherwise\n// weird stuff happens when you try to work with the binary string directly.\n// It is known.\n// From http://stackoverflow.com/questions/14967647/ (continues on next line)\n// encode-decode-image-with-base64-breaks-image (2013-04-21)\nfunction _binStringToArrayBuffer(bin) {\n    var length = bin.length;\n    var buf = new ArrayBuffer(length);\n    var arr = new Uint8Array(buf);\n    for (var i = 0; i < length; i++) {\n        arr[i] = bin.charCodeAt(i);\n    }\n    return buf;\n}\n\n//\n// Blobs are not supported in all versions of IndexedDB, notably\n// Chrome <37 and Android <5. In those versions, storing a blob will throw.\n//\n// Various other blob bugs exist in Chrome v37-42 (inclusive).\n// Detecting them is expensive and confusing to users, and Chrome 37-42\n// is at very low usage worldwide, so we do a hacky userAgent check instead.\n//\n// content-type bug: https://code.google.com/p/chromium/issues/detail?id=408120\n// 404 bug: https://code.google.com/p/chromium/issues/detail?id=447916\n// FileReader bug: https://code.google.com/p/chromium/issues/detail?id=447836\n//\n// Code borrowed from PouchDB. See:\n// https://github.com/pouchdb/pouchdb/blob/master/packages/node_modules/pouchdb-adapter-idb/src/blobSupport.js\n//\nfunction _checkBlobSupportWithoutCaching(idb) {\n    return new Promise$1(function (resolve) {\n        var txn = idb.transaction(DETECT_BLOB_SUPPORT_STORE, READ_WRITE);\n        var blob = createBlob(['']);\n        txn.objectStore(DETECT_BLOB_SUPPORT_STORE).put(blob, 'key');\n\n        txn.onabort = function (e) {\n            // If the transaction aborts now its due to not being able to\n            // write to the database, likely due to the disk being full\n            e.preventDefault();\n            e.stopPropagation();\n            resolve(false);\n        };\n\n        txn.oncomplete = function () {\n            var matchedChrome = navigator.userAgent.match(/Chrome\\/(\\d+)/);\n            var matchedEdge = navigator.userAgent.match(/Edge\\//);\n            // MS Edge pretends to be Chrome 42:\n            // https://msdn.microsoft.com/en-us/library/hh869301%28v=vs.85%29.aspx\n            resolve(matchedEdge || !matchedChrome || parseInt(matchedChrome[1], 10) >= 43);\n        };\n    })[\"catch\"](function () {\n        return false; // error, so assume unsupported\n    });\n}\n\nfunction _checkBlobSupport(idb) {\n    if (typeof supportsBlobs === 'boolean') {\n        return Promise$1.resolve(supportsBlobs);\n    }\n    return _checkBlobSupportWithoutCaching(idb).then(function (value) {\n        supportsBlobs = value;\n        return supportsBlobs;\n    });\n}\n\nfunction _deferReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Create a deferred object representing the current database operation.\n    var deferredOperation = {};\n\n    deferredOperation.promise = new Promise$1(function (resolve, reject) {\n        deferredOperation.resolve = resolve;\n        deferredOperation.reject = reject;\n    });\n\n    // Enqueue the deferred operation.\n    dbContext.deferredOperations.push(deferredOperation);\n\n    // Chain its promise to the database readiness.\n    if (!dbContext.dbReady) {\n        dbContext.dbReady = deferredOperation.promise;\n    } else {\n        dbContext.dbReady = dbContext.dbReady.then(function () {\n            return deferredOperation.promise;\n        });\n    }\n}\n\nfunction _advanceReadiness(dbInfo) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Resolve its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.resolve();\n        return deferredOperation.promise;\n    }\n}\n\nfunction _rejectReadiness(dbInfo, err) {\n    var dbContext = dbContexts[dbInfo.name];\n\n    // Dequeue a deferred operation.\n    var deferredOperation = dbContext.deferredOperations.pop();\n\n    // Reject its promise (which is part of the database readiness\n    // chain of promises).\n    if (deferredOperation) {\n        deferredOperation.reject(err);\n        return deferredOperation.promise;\n    }\n}\n\nfunction _getConnection(dbInfo, upgradeNeeded) {\n    return new Promise$1(function (resolve, reject) {\n        dbContexts[dbInfo.name] = dbContexts[dbInfo.name] || createDbContext();\n\n        if (dbInfo.db) {\n            if (upgradeNeeded) {\n                _deferReadiness(dbInfo);\n                dbInfo.db.close();\n            } else {\n                return resolve(dbInfo.db);\n            }\n        }\n\n        var dbArgs = [dbInfo.name];\n\n        if (upgradeNeeded) {\n            dbArgs.push(dbInfo.version);\n        }\n\n        var openreq = idb.open.apply(idb, dbArgs);\n\n        if (upgradeNeeded) {\n            openreq.onupgradeneeded = function (e) {\n                var db = openreq.result;\n                try {\n                    db.createObjectStore(dbInfo.storeName);\n                    if (e.oldVersion <= 1) {\n                        // Added when support for blob shims was added\n                        db.createObjectStore(DETECT_BLOB_SUPPORT_STORE);\n                    }\n                } catch (ex) {\n                    if (ex.name === 'ConstraintError') {\n                        console.warn('The database \"' + dbInfo.name + '\"' + ' has been upgraded from version ' + e.oldVersion + ' to version ' + e.newVersion + ', but the storage \"' + dbInfo.storeName + '\" already exists.');\n                    } else {\n                        throw ex;\n                    }\n                }\n            };\n        }\n\n        openreq.onerror = function (e) {\n            e.preventDefault();\n            reject(openreq.error);\n        };\n\n        openreq.onsuccess = function () {\n            resolve(openreq.result);\n            _advanceReadiness(dbInfo);\n        };\n    });\n}\n\nfunction _getOriginalConnection(dbInfo) {\n    return _getConnection(dbInfo, false);\n}\n\nfunction _getUpgradedConnection(dbInfo) {\n    return _getConnection(dbInfo, true);\n}\n\nfunction _isUpgradeNeeded(dbInfo, defaultVersion) {\n    if (!dbInfo.db) {\n        return true;\n    }\n\n    var isNewStore = !dbInfo.db.objectStoreNames.contains(dbInfo.storeName);\n    var isDowngrade = dbInfo.version < dbInfo.db.version;\n    var isUpgrade = dbInfo.version > dbInfo.db.version;\n\n    if (isDowngrade) {\n        // If the version is not the default one\n        // then warn for impossible downgrade.\n        if (dbInfo.version !== defaultVersion) {\n            console.warn('The database \"' + dbInfo.name + '\"' + \" can't be downgraded from version \" + dbInfo.db.version + ' to version ' + dbInfo.version + '.');\n        }\n        // Align the versions to prevent errors.\n        dbInfo.version = dbInfo.db.version;\n    }\n\n    if (isUpgrade || isNewStore) {\n        // If the store is new then increment the version (if needed).\n        // This will trigger an \"upgradeneeded\" event which is required\n        // for creating a store.\n        if (isNewStore) {\n            var incVersion = dbInfo.db.version + 1;\n            if (incVersion > dbInfo.version) {\n                dbInfo.version = incVersion;\n            }\n        }\n\n        return true;\n    }\n\n    return false;\n}\n\n// encode a blob for indexeddb engines that don't support blobs\nfunction _encodeBlob(blob) {\n    return new Promise$1(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onerror = reject;\n        reader.onloadend = function (e) {\n            var base64 = btoa(e.target.result || '');\n            resolve({\n                __local_forage_encoded_blob: true,\n                data: base64,\n                type: blob.type\n            });\n        };\n        reader.readAsBinaryString(blob);\n    });\n}\n\n// decode an encoded blob\nfunction _decodeBlob(encodedBlob) {\n    var arrayBuff = _binStringToArrayBuffer(atob(encodedBlob.data));\n    return createBlob([arrayBuff], { type: encodedBlob.type });\n}\n\n// is this one of our fancy encoded blobs?\nfunction _isEncodedBlob(value) {\n    return value && value.__local_forage_encoded_blob;\n}\n\n// Specialize the default `ready()` function by making it dependent\n// on the current database operations. Thus, the driver will be actually\n// ready when it's been initialized (default) *and* there are no pending\n// operations on the database (initiated by some other instances).\nfunction _fullyReady(callback) {\n    var self = this;\n\n    var promise = self._initReady().then(function () {\n        var dbContext = dbContexts[self._dbInfo.name];\n\n        if (dbContext && dbContext.dbReady) {\n            return dbContext.dbReady;\n        }\n    });\n\n    executeTwoCallbacks(promise, callback, callback);\n    return promise;\n}\n\n// Try to establish a new db connection to replace the\n// current one which is broken (i.e. experiencing\n// InvalidStateError while creating a transaction).\nfunction _tryReconnect(dbInfo) {\n    _deferReadiness(dbInfo);\n\n    var dbContext = dbContexts[dbInfo.name];\n    var forages = dbContext.forages;\n\n    for (var i = 0; i < forages.length; i++) {\n        var forage = forages[i];\n        if (forage._dbInfo.db) {\n            forage._dbInfo.db.close();\n            forage._dbInfo.db = null;\n        }\n    }\n    dbInfo.db = null;\n\n    return _getOriginalConnection(dbInfo).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        // store the latest db reference\n        // in case the db was upgraded\n        dbInfo.db = dbContext.db = db;\n        for (var i = 0; i < forages.length; i++) {\n            forages[i]._dbInfo.db = db;\n        }\n    })[\"catch\"](function (err) {\n        _rejectReadiness(dbInfo, err);\n        throw err;\n    });\n}\n\n// FF doesn't like Promises (micro-tasks) and IDDB store operations,\n// so we have to do it with callbacks\nfunction createTransaction(dbInfo, mode, callback, retries) {\n    if (retries === undefined) {\n        retries = 1;\n    }\n\n    try {\n        var tx = dbInfo.db.transaction(dbInfo.storeName, mode);\n        callback(null, tx);\n    } catch (err) {\n        if (retries > 0 && (!dbInfo.db || err.name === 'InvalidStateError' || err.name === 'NotFoundError')) {\n            return Promise$1.resolve().then(function () {\n                if (!dbInfo.db || err.name === 'NotFoundError' && !dbInfo.db.objectStoreNames.contains(dbInfo.storeName) && dbInfo.version <= dbInfo.db.version) {\n                    // increase the db version, to create the new ObjectStore\n                    if (dbInfo.db) {\n                        dbInfo.version = dbInfo.db.version + 1;\n                    }\n                    // Reopen the database for upgrading.\n                    return _getUpgradedConnection(dbInfo);\n                }\n            }).then(function () {\n                return _tryReconnect(dbInfo).then(function () {\n                    createTransaction(dbInfo, mode, callback, retries - 1);\n                });\n            })[\"catch\"](callback);\n        }\n\n        callback(err);\n    }\n}\n\nfunction createDbContext() {\n    return {\n        // Running localForages sharing a database.\n        forages: [],\n        // Shared database.\n        db: null,\n        // Database readiness (promise).\n        dbReady: null,\n        // Deferred operations on the database.\n        deferredOperations: []\n    };\n}\n\n// Open the IndexedDB database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    // Get the current context of the database;\n    var dbContext = dbContexts[dbInfo.name];\n\n    // ...or create a new context.\n    if (!dbContext) {\n        dbContext = createDbContext();\n        // Register the new context in the global container.\n        dbContexts[dbInfo.name] = dbContext;\n    }\n\n    // Register itself as a running localForage in the current context.\n    dbContext.forages.push(self);\n\n    // Replace the default `ready()` function with the specialized one.\n    if (!self._initReady) {\n        self._initReady = self.ready;\n        self.ready = _fullyReady;\n    }\n\n    // Create an array of initialization states of the related localForages.\n    var initPromises = [];\n\n    function ignoreErrors() {\n        // Don't handle errors here,\n        // just makes sure related localForages aren't pending.\n        return Promise$1.resolve();\n    }\n\n    for (var j = 0; j < dbContext.forages.length; j++) {\n        var forage = dbContext.forages[j];\n        if (forage !== self) {\n            // Don't wait for itself...\n            initPromises.push(forage._initReady()[\"catch\"](ignoreErrors));\n        }\n    }\n\n    // Take a snapshot of the related localForages.\n    var forages = dbContext.forages.slice(0);\n\n    // Initialize the connection process only when\n    // all the related localForages aren't pending.\n    return Promise$1.all(initPromises).then(function () {\n        dbInfo.db = dbContext.db;\n        // Get the connection or open a new one without upgrade.\n        return _getOriginalConnection(dbInfo);\n    }).then(function (db) {\n        dbInfo.db = db;\n        if (_isUpgradeNeeded(dbInfo, self._defaultConfig.version)) {\n            // Reopen the database for upgrading.\n            return _getUpgradedConnection(dbInfo);\n        }\n        return db;\n    }).then(function (db) {\n        dbInfo.db = dbContext.db = db;\n        self._dbInfo = dbInfo;\n        // Share the final connection amongst related localForages.\n        for (var k = 0; k < forages.length; k++) {\n            var forage = forages[k];\n            if (forage !== self) {\n                // Self is already up-to-date.\n                forage._dbInfo.db = dbInfo.db;\n                forage._dbInfo.version = dbInfo.version;\n            }\n        }\n    });\n}\n\nfunction getItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.get(key);\n\n                    req.onsuccess = function () {\n                        var value = req.result;\n                        if (value === undefined) {\n                            value = null;\n                        }\n                        if (_isEncodedBlob(value)) {\n                            value = _decodeBlob(value);\n                        }\n                        resolve(value);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items stored in database.\nfunction iterate(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var iterationNumber = 1;\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (cursor) {\n                            var value = cursor.value;\n                            if (_isEncodedBlob(value)) {\n                                value = _decodeBlob(value);\n                            }\n                            var result = iterator(value, cursor.key, iterationNumber++);\n\n                            // when the iterator callback retuns any\n                            // (non-`undefined`) value, then we stop\n                            // the iteration immediately\n                            if (result !== void 0) {\n                                resolve(result);\n                            } else {\n                                cursor[\"continue\"]();\n                            }\n                        } else {\n                            resolve();\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n\n    return promise;\n}\n\nfunction setItem(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        var dbInfo;\n        self.ready().then(function () {\n            dbInfo = self._dbInfo;\n            if (toString.call(value) === '[object Blob]') {\n                return _checkBlobSupport(dbInfo.db).then(function (blobSupport) {\n                    if (blobSupport) {\n                        return value;\n                    }\n                    return _encodeBlob(value);\n                });\n            }\n            return value;\n        }).then(function (value) {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n\n                    // The reason we don't _save_ null is because IE 10 does\n                    // not support saving the `null` type in IndexedDB. How\n                    // ironic, given the bug below!\n                    // See: https://github.com/mozilla/localForage/issues/161\n                    if (value === null) {\n                        value = undefined;\n                    }\n\n                    var req = store.put(value, key);\n\n                    transaction.oncomplete = function () {\n                        // Cast to undefined so the value passed to\n                        // callback/promise is the same as what one would get out\n                        // of `getItem()` later. This leads to some weirdness\n                        // (setItem('foo', undefined) will return `null`), but\n                        // it's not my fault localStorage is our baseline and that\n                        // it's weird.\n                        if (value === undefined) {\n                            value = null;\n                        }\n\n                        resolve(value);\n                    };\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction removeItem(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    // We use a Grunt task to make this safe for IE and some\n                    // versions of Android (including those used by Cordova).\n                    // Normally IE won't like `.delete()` and will insist on\n                    // using `['delete']()`, but we have a build step that\n                    // fixes this for us now.\n                    var req = store[\"delete\"](key);\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onerror = function () {\n                        reject(req.error);\n                    };\n\n                    // The request will be also be aborted if we've exceeded our storage\n                    // space.\n                    transaction.onabort = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction clear(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_WRITE, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.clear();\n\n                    transaction.oncomplete = function () {\n                        resolve();\n                    };\n\n                    transaction.onabort = transaction.onerror = function () {\n                        var err = req.error ? req.error : req.transaction.error;\n                        reject(err);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction length(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.count();\n\n                    req.onsuccess = function () {\n                        resolve(req.result);\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction key(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        if (n < 0) {\n            resolve(null);\n\n            return;\n        }\n\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var advanced = false;\n                    var req = store.openCursor();\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n                        if (!cursor) {\n                            // this means there weren't enough keys\n                            resolve(null);\n\n                            return;\n                        }\n\n                        if (n === 0) {\n                            // We have the first key, return it if that's what they\n                            // wanted.\n                            resolve(cursor.key);\n                        } else {\n                            if (!advanced) {\n                                // Otherwise, ask the cursor to skip ahead n\n                                // records.\n                                advanced = true;\n                                cursor.advance(n);\n                            } else {\n                                // When we get here, we've got the nth key.\n                                resolve(cursor.key);\n                            }\n                        }\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            createTransaction(self._dbInfo, READ_ONLY, function (err, transaction) {\n                if (err) {\n                    return reject(err);\n                }\n\n                try {\n                    var store = transaction.objectStore(self._dbInfo.storeName);\n                    var req = store.openCursor();\n                    var keys = [];\n\n                    req.onsuccess = function () {\n                        var cursor = req.result;\n\n                        if (!cursor) {\n                            resolve(keys);\n                            return;\n                        }\n\n                        keys.push(cursor.key);\n                        cursor[\"continue\"]();\n                    };\n\n                    req.onerror = function () {\n                        reject(req.error);\n                    };\n                } catch (e) {\n                    reject(e);\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        var isCurrentDb = options.name === currentConfig.name && self._dbInfo.db;\n\n        var dbPromise = isCurrentDb ? Promise$1.resolve(self._dbInfo.db) : _getOriginalConnection(options).then(function (db) {\n            var dbContext = dbContexts[options.name];\n            var forages = dbContext.forages;\n            dbContext.db = db;\n            for (var i = 0; i < forages.length; i++) {\n                forages[i]._dbInfo.db = db;\n            }\n            return db;\n        });\n\n        if (!options.storeName) {\n            promise = dbPromise.then(function (db) {\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                }\n\n                var dropDBPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.deleteDatabase(options.name);\n\n                    req.onerror = req.onblocked = function (err) {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        reject(err);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        if (db) {\n                            db.close();\n                        }\n                        resolve(db);\n                    };\n                });\n\n                return dropDBPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var i = 0; i < forages.length; i++) {\n                        var _forage = forages[i];\n                        _advanceReadiness(_forage._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        } else {\n            promise = dbPromise.then(function (db) {\n                if (!db.objectStoreNames.contains(options.storeName)) {\n                    return;\n                }\n\n                var newVersion = db.version + 1;\n\n                _deferReadiness(options);\n\n                var dbContext = dbContexts[options.name];\n                var forages = dbContext.forages;\n\n                db.close();\n                for (var i = 0; i < forages.length; i++) {\n                    var forage = forages[i];\n                    forage._dbInfo.db = null;\n                    forage._dbInfo.version = newVersion;\n                }\n\n                var dropObjectPromise = new Promise$1(function (resolve, reject) {\n                    var req = idb.open(options.name, newVersion);\n\n                    req.onerror = function (err) {\n                        var db = req.result;\n                        db.close();\n                        reject(err);\n                    };\n\n                    req.onupgradeneeded = function () {\n                        var db = req.result;\n                        db.deleteObjectStore(options.storeName);\n                    };\n\n                    req.onsuccess = function () {\n                        var db = req.result;\n                        db.close();\n                        resolve(db);\n                    };\n                });\n\n                return dropObjectPromise.then(function (db) {\n                    dbContext.db = db;\n                    for (var j = 0; j < forages.length; j++) {\n                        var _forage2 = forages[j];\n                        _forage2._dbInfo.db = db;\n                        _advanceReadiness(_forage2._dbInfo);\n                    }\n                })[\"catch\"](function (err) {\n                    (_rejectReadiness(options, err) || Promise$1.resolve())[\"catch\"](function () {});\n                    throw err;\n                });\n            });\n        }\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar asyncStorage = {\n    _driver: 'asyncStorage',\n    _initStorage: _initStorage,\n    _support: isIndexedDBValid(),\n    iterate: iterate,\n    getItem: getItem,\n    setItem: setItem,\n    removeItem: removeItem,\n    clear: clear,\n    length: length,\n    key: key,\n    keys: keys,\n    dropInstance: dropInstance\n};\n\nfunction isWebSQLValid() {\n    return typeof openDatabase === 'function';\n}\n\n// Sadly, the best way to save binary data in WebSQL/localStorage is serializing\n// it to Base64, so this is how we store it to prevent very strange errors with less\n// verbose ways of binary <-> string data storage.\nvar BASE_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\nvar BLOB_TYPE_PREFIX = '~~local_forage_type~';\nvar BLOB_TYPE_PREFIX_REGEX = /^~~local_forage_type~([^~]+)~/;\n\nvar SERIALIZED_MARKER = '__lfsc__:';\nvar SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER.length;\n\n// OMG the serializations!\nvar TYPE_ARRAYBUFFER = 'arbf';\nvar TYPE_BLOB = 'blob';\nvar TYPE_INT8ARRAY = 'si08';\nvar TYPE_UINT8ARRAY = 'ui08';\nvar TYPE_UINT8CLAMPEDARRAY = 'uic8';\nvar TYPE_INT16ARRAY = 'si16';\nvar TYPE_INT32ARRAY = 'si32';\nvar TYPE_UINT16ARRAY = 'ur16';\nvar TYPE_UINT32ARRAY = 'ui32';\nvar TYPE_FLOAT32ARRAY = 'fl32';\nvar TYPE_FLOAT64ARRAY = 'fl64';\nvar TYPE_SERIALIZED_MARKER_LENGTH = SERIALIZED_MARKER_LENGTH + TYPE_ARRAYBUFFER.length;\n\nvar toString$1 = Object.prototype.toString;\n\nfunction stringToBuffer(serializedString) {\n    // Fill the string into a ArrayBuffer.\n    var bufferLength = serializedString.length * 0.75;\n    var len = serializedString.length;\n    var i;\n    var p = 0;\n    var encoded1, encoded2, encoded3, encoded4;\n\n    if (serializedString[serializedString.length - 1] === '=') {\n        bufferLength--;\n        if (serializedString[serializedString.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n\n    var buffer = new ArrayBuffer(bufferLength);\n    var bytes = new Uint8Array(buffer);\n\n    for (i = 0; i < len; i += 4) {\n        encoded1 = BASE_CHARS.indexOf(serializedString[i]);\n        encoded2 = BASE_CHARS.indexOf(serializedString[i + 1]);\n        encoded3 = BASE_CHARS.indexOf(serializedString[i + 2]);\n        encoded4 = BASE_CHARS.indexOf(serializedString[i + 3]);\n\n        /*jslint bitwise: true */\n        bytes[p++] = encoded1 << 2 | encoded2 >> 4;\n        bytes[p++] = (encoded2 & 15) << 4 | encoded3 >> 2;\n        bytes[p++] = (encoded3 & 3) << 6 | encoded4 & 63;\n    }\n    return buffer;\n}\n\n// Converts a buffer to a string to store, serialized, in the backend\n// storage library.\nfunction bufferToString(buffer) {\n    // base64-arraybuffer\n    var bytes = new Uint8Array(buffer);\n    var base64String = '';\n    var i;\n\n    for (i = 0; i < bytes.length; i += 3) {\n        /*jslint bitwise: true */\n        base64String += BASE_CHARS[bytes[i] >> 2];\n        base64String += BASE_CHARS[(bytes[i] & 3) << 4 | bytes[i + 1] >> 4];\n        base64String += BASE_CHARS[(bytes[i + 1] & 15) << 2 | bytes[i + 2] >> 6];\n        base64String += BASE_CHARS[bytes[i + 2] & 63];\n    }\n\n    if (bytes.length % 3 === 2) {\n        base64String = base64String.substring(0, base64String.length - 1) + '=';\n    } else if (bytes.length % 3 === 1) {\n        base64String = base64String.substring(0, base64String.length - 2) + '==';\n    }\n\n    return base64String;\n}\n\n// Serialize a value, afterwards executing a callback (which usually\n// instructs the `setItem()` callback/promise to be executed). This is how\n// we store binary data with localStorage.\nfunction serialize(value, callback) {\n    var valueType = '';\n    if (value) {\n        valueType = toString$1.call(value);\n    }\n\n    // Cannot use `value instanceof ArrayBuffer` or such here, as these\n    // checks fail when running the tests using casper.js...\n    //\n    // TODO: See why those tests fail and use a better solution.\n    if (value && (valueType === '[object ArrayBuffer]' || value.buffer && toString$1.call(value.buffer) === '[object ArrayBuffer]')) {\n        // Convert binary arrays to a string and prefix the string with\n        // a special marker.\n        var buffer;\n        var marker = SERIALIZED_MARKER;\n\n        if (value instanceof ArrayBuffer) {\n            buffer = value;\n            marker += TYPE_ARRAYBUFFER;\n        } else {\n            buffer = value.buffer;\n\n            if (valueType === '[object Int8Array]') {\n                marker += TYPE_INT8ARRAY;\n            } else if (valueType === '[object Uint8Array]') {\n                marker += TYPE_UINT8ARRAY;\n            } else if (valueType === '[object Uint8ClampedArray]') {\n                marker += TYPE_UINT8CLAMPEDARRAY;\n            } else if (valueType === '[object Int16Array]') {\n                marker += TYPE_INT16ARRAY;\n            } else if (valueType === '[object Uint16Array]') {\n                marker += TYPE_UINT16ARRAY;\n            } else if (valueType === '[object Int32Array]') {\n                marker += TYPE_INT32ARRAY;\n            } else if (valueType === '[object Uint32Array]') {\n                marker += TYPE_UINT32ARRAY;\n            } else if (valueType === '[object Float32Array]') {\n                marker += TYPE_FLOAT32ARRAY;\n            } else if (valueType === '[object Float64Array]') {\n                marker += TYPE_FLOAT64ARRAY;\n            } else {\n                callback(new Error('Failed to get type for BinaryArray'));\n            }\n        }\n\n        callback(marker + bufferToString(buffer));\n    } else if (valueType === '[object Blob]') {\n        // Conver the blob to a binaryArray and then to a string.\n        var fileReader = new FileReader();\n\n        fileReader.onload = function () {\n            // Backwards-compatible prefix for the blob type.\n            var str = BLOB_TYPE_PREFIX + value.type + '~' + bufferToString(this.result);\n\n            callback(SERIALIZED_MARKER + TYPE_BLOB + str);\n        };\n\n        fileReader.readAsArrayBuffer(value);\n    } else {\n        try {\n            callback(JSON.stringify(value));\n        } catch (e) {\n            console.error(\"Couldn't convert value into a JSON string: \", value);\n\n            callback(null, e);\n        }\n    }\n}\n\n// Deserialize data we've inserted into a value column/field. We place\n// special markers into our strings to mark them as encoded; this isn't\n// as nice as a meta field, but it's the only sane thing we can do whilst\n// keeping localStorage support intact.\n//\n// Oftentimes this will just deserialize JSON content, but if we have a\n// special marker (SERIALIZED_MARKER, defined above), we will extract\n// some kind of arraybuffer/binary data/typed array out of the string.\nfunction deserialize(value) {\n    // If we haven't marked this string as being specially serialized (i.e.\n    // something other than serialized JSON), we can just return it and be\n    // done with it.\n    if (value.substring(0, SERIALIZED_MARKER_LENGTH) !== SERIALIZED_MARKER) {\n        return JSON.parse(value);\n    }\n\n    // The following code deals with deserializing some kind of Blob or\n    // TypedArray. First we separate out the type of data we're dealing\n    // with from the data itself.\n    var serializedString = value.substring(TYPE_SERIALIZED_MARKER_LENGTH);\n    var type = value.substring(SERIALIZED_MARKER_LENGTH, TYPE_SERIALIZED_MARKER_LENGTH);\n\n    var blobType;\n    // Backwards-compatible blob type serialization strategy.\n    // DBs created with older versions of localForage will simply not have the blob type.\n    if (type === TYPE_BLOB && BLOB_TYPE_PREFIX_REGEX.test(serializedString)) {\n        var matcher = serializedString.match(BLOB_TYPE_PREFIX_REGEX);\n        blobType = matcher[1];\n        serializedString = serializedString.substring(matcher[0].length);\n    }\n    var buffer = stringToBuffer(serializedString);\n\n    // Return the right type based on the code/type set during\n    // serialization.\n    switch (type) {\n        case TYPE_ARRAYBUFFER:\n            return buffer;\n        case TYPE_BLOB:\n            return createBlob([buffer], { type: blobType });\n        case TYPE_INT8ARRAY:\n            return new Int8Array(buffer);\n        case TYPE_UINT8ARRAY:\n            return new Uint8Array(buffer);\n        case TYPE_UINT8CLAMPEDARRAY:\n            return new Uint8ClampedArray(buffer);\n        case TYPE_INT16ARRAY:\n            return new Int16Array(buffer);\n        case TYPE_UINT16ARRAY:\n            return new Uint16Array(buffer);\n        case TYPE_INT32ARRAY:\n            return new Int32Array(buffer);\n        case TYPE_UINT32ARRAY:\n            return new Uint32Array(buffer);\n        case TYPE_FLOAT32ARRAY:\n            return new Float32Array(buffer);\n        case TYPE_FLOAT64ARRAY:\n            return new Float64Array(buffer);\n        default:\n            throw new Error('Unkown type: ' + type);\n    }\n}\n\nvar localforageSerializer = {\n    serialize: serialize,\n    deserialize: deserialize,\n    stringToBuffer: stringToBuffer,\n    bufferToString: bufferToString\n};\n\n/*\n * Includes code from:\n *\n * base64-arraybuffer\n * https://github.com/niklasvh/base64-arraybuffer\n *\n * Copyright (c) 2012 Niklas von Hertzen\n * Licensed under the MIT license.\n */\n\nfunction createDbTable(t, dbInfo, callback, errorCallback) {\n    t.executeSql('CREATE TABLE IF NOT EXISTS ' + dbInfo.storeName + ' ' + '(id INTEGER PRIMARY KEY, key unique, value)', [], callback, errorCallback);\n}\n\n// Open the WebSQL database (automatically creates one if one didn't\n// previously exist), using any options set in the config.\nfunction _initStorage$1(options) {\n    var self = this;\n    var dbInfo = {\n        db: null\n    };\n\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = typeof options[i] !== 'string' ? options[i].toString() : options[i];\n        }\n    }\n\n    var dbInfoPromise = new Promise$1(function (resolve, reject) {\n        // Open the database; the openDatabase API will automatically\n        // create it for us if it doesn't exist.\n        try {\n            dbInfo.db = openDatabase(dbInfo.name, String(dbInfo.version), dbInfo.description, dbInfo.size);\n        } catch (e) {\n            return reject(e);\n        }\n\n        // Create our key/value table if it doesn't exist.\n        dbInfo.db.transaction(function (t) {\n            createDbTable(t, dbInfo, function () {\n                self._dbInfo = dbInfo;\n                resolve();\n            }, function (t, error) {\n                reject(error);\n            });\n        }, reject);\n    });\n\n    dbInfo.serializer = localforageSerializer;\n    return dbInfoPromise;\n}\n\nfunction tryExecuteSql(t, dbInfo, sqlStatement, args, callback, errorCallback) {\n    t.executeSql(sqlStatement, args, callback, function (t, error) {\n        if (error.code === error.SYNTAX_ERR) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name = ?\", [dbInfo.storeName], function (t, results) {\n                if (!results.rows.length) {\n                    // if the table is missing (was deleted)\n                    // re-create it table and retry\n                    createDbTable(t, dbInfo, function () {\n                        t.executeSql(sqlStatement, args, callback, errorCallback);\n                    }, errorCallback);\n                } else {\n                    errorCallback(t, error);\n                }\n            }, errorCallback);\n        } else {\n            errorCallback(t, error);\n        }\n    }, errorCallback);\n}\n\nfunction getItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName + ' WHERE key = ? LIMIT 1', [key], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).value : null;\n\n                    // Check to see if this is serialized content we need to\n                    // unpack.\n                    if (result) {\n                        result = dbInfo.serializer.deserialize(result);\n                    }\n\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction iterate$1(iterator, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT * FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var rows = results.rows;\n                    var length = rows.length;\n\n                    for (var i = 0; i < length; i++) {\n                        var item = rows.item(i);\n                        var result = item.value;\n\n                        // Check to see if this is serialized content\n                        // we need to unpack.\n                        if (result) {\n                            result = dbInfo.serializer.deserialize(result);\n                        }\n\n                        result = iterator(result, item.key, i + 1);\n\n                        // void(0) prevents problems with redefinition\n                        // of `undefined`.\n                        if (result !== void 0) {\n                            resolve(result);\n                            return;\n                        }\n                    }\n\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction _setItem(key, value, callback, retriesLeft) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            // The localStorage API doesn't return undefined values in an\n            // \"expected\" way, so undefined is always cast to null in all\n            // drivers. See: https://github.com/mozilla/localForage/pull/42\n            if (value === undefined) {\n                value = null;\n            }\n\n            // Save the original value to pass to the callback.\n            var originalValue = value;\n\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    dbInfo.db.transaction(function (t) {\n                        tryExecuteSql(t, dbInfo, 'INSERT OR REPLACE INTO ' + dbInfo.storeName + ' ' + '(key, value) VALUES (?, ?)', [key, value], function () {\n                            resolve(originalValue);\n                        }, function (t, error) {\n                            reject(error);\n                        });\n                    }, function (sqlError) {\n                        // The transaction failed; check\n                        // to see if it's a quota error.\n                        if (sqlError.code === sqlError.QUOTA_ERR) {\n                            // We reject the callback outright for now, but\n                            // it's worth trying to re-run the transaction.\n                            // Even if the user accepts the prompt to use\n                            // more storage on Safari, this error will\n                            // be called.\n                            //\n                            // Try to re-run the transaction.\n                            if (retriesLeft > 0) {\n                                resolve(_setItem.apply(self, [key, originalValue, callback, retriesLeft - 1]));\n                                return;\n                            }\n                            reject(sqlError);\n                        }\n                    });\n                }\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction setItem$1(key, value, callback) {\n    return _setItem.apply(this, [key, value, callback, 1]);\n}\n\nfunction removeItem$1(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName + ' WHERE key = ?', [key], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Deletes every item in the table.\n// TODO: Find out if this resets the AUTO_INCREMENT number.\nfunction clear$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'DELETE FROM ' + dbInfo.storeName, [], function () {\n                    resolve();\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Does a simple `COUNT(key)` to get the number of items stored in\n// localForage.\nfunction length$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                // Ahhh, SQL makes this one soooooo easy.\n                tryExecuteSql(t, dbInfo, 'SELECT COUNT(key) as c FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var result = results.rows.item(0).c;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Return the key located at key index X; essentially gets the key from a\n// `WHERE id = ?`. This is the most efficient way I can think to implement\n// this rarely-used (in my experience) part of the API, but it can seem\n// inconsistent, because we do `INSERT OR REPLACE INTO` on `setItem()`, so\n// the ID of each key will change every time it's updated. Perhaps a stored\n// procedure for the `setItem()` SQL would solve this problem?\n// TODO: Don't change ID on `setItem()`.\nfunction key$1(n, callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName + ' WHERE id = ? LIMIT 1', [n + 1], function (t, results) {\n                    var result = results.rows.length ? results.rows.item(0).key : null;\n                    resolve(result);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$1(callback) {\n    var self = this;\n\n    var promise = new Promise$1(function (resolve, reject) {\n        self.ready().then(function () {\n            var dbInfo = self._dbInfo;\n            dbInfo.db.transaction(function (t) {\n                tryExecuteSql(t, dbInfo, 'SELECT key FROM ' + dbInfo.storeName, [], function (t, results) {\n                    var keys = [];\n\n                    for (var i = 0; i < results.rows.length; i++) {\n                        keys.push(results.rows.item(i).key);\n                    }\n\n                    resolve(keys);\n                }, function (t, error) {\n                    reject(error);\n                });\n            });\n        })[\"catch\"](reject);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// https://www.w3.org/TR/webdatabase/#databases\n// > There is no way to enumerate or delete the databases available for an origin from this API.\nfunction getAllStoreNames(db) {\n    return new Promise$1(function (resolve, reject) {\n        db.transaction(function (t) {\n            t.executeSql('SELECT name FROM sqlite_master ' + \"WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'\", [], function (t, results) {\n                var storeNames = [];\n\n                for (var i = 0; i < results.rows.length; i++) {\n                    storeNames.push(results.rows.item(i).name);\n                }\n\n                resolve({\n                    db: db,\n                    storeNames: storeNames\n                });\n            }, function (t, error) {\n                reject(error);\n            });\n        }, function (sqlError) {\n            reject(sqlError);\n        });\n    });\n}\n\nfunction dropInstance$1(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    var currentConfig = this.config();\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            var db;\n            if (options.name === currentConfig.name) {\n                // use the db reference of the current instance\n                db = self._dbInfo.db;\n            } else {\n                db = openDatabase(options.name, '', '', 0);\n            }\n\n            if (!options.storeName) {\n                // drop all database tables\n                resolve(getAllStoreNames(db));\n            } else {\n                resolve({\n                    db: db,\n                    storeNames: [options.storeName]\n                });\n            }\n        }).then(function (operationInfo) {\n            return new Promise$1(function (resolve, reject) {\n                operationInfo.db.transaction(function (t) {\n                    function dropTable(storeName) {\n                        return new Promise$1(function (resolve, reject) {\n                            t.executeSql('DROP TABLE IF EXISTS ' + storeName, [], function () {\n                                resolve();\n                            }, function (t, error) {\n                                reject(error);\n                            });\n                        });\n                    }\n\n                    var operations = [];\n                    for (var i = 0, len = operationInfo.storeNames.length; i < len; i++) {\n                        operations.push(dropTable(operationInfo.storeNames[i]));\n                    }\n\n                    Promise$1.all(operations).then(function () {\n                        resolve();\n                    })[\"catch\"](function (e) {\n                        reject(e);\n                    });\n                }, function (sqlError) {\n                    reject(sqlError);\n                });\n            });\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar webSQLStorage = {\n    _driver: 'webSQLStorage',\n    _initStorage: _initStorage$1,\n    _support: isWebSQLValid(),\n    iterate: iterate$1,\n    getItem: getItem$1,\n    setItem: setItem$1,\n    removeItem: removeItem$1,\n    clear: clear$1,\n    length: length$1,\n    key: key$1,\n    keys: keys$1,\n    dropInstance: dropInstance$1\n};\n\nfunction isLocalStorageValid() {\n    try {\n        return typeof localStorage !== 'undefined' && 'setItem' in localStorage &&\n        // in IE8 typeof localStorage.setItem === 'object'\n        !!localStorage.setItem;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction _getKeyPrefix(options, defaultConfig) {\n    var keyPrefix = options.name + '/';\n\n    if (options.storeName !== defaultConfig.storeName) {\n        keyPrefix += options.storeName + '/';\n    }\n    return keyPrefix;\n}\n\n// Check if localStorage throws when saving an item\nfunction checkIfLocalStorageThrows() {\n    var localStorageTestKey = '_localforage_support_test';\n\n    try {\n        localStorage.setItem(localStorageTestKey, true);\n        localStorage.removeItem(localStorageTestKey);\n\n        return false;\n    } catch (e) {\n        return true;\n    }\n}\n\n// Check if localStorage is usable and allows to save an item\n// This method checks if localStorage is usable in Safari Private Browsing\n// mode, or in any other case where the available quota for localStorage\n// is 0 and there wasn't any saved items yet.\nfunction _isLocalStorageUsable() {\n    return !checkIfLocalStorageThrows() || localStorage.length > 0;\n}\n\n// Config the localStorage backend, using options set in the config.\nfunction _initStorage$2(options) {\n    var self = this;\n    var dbInfo = {};\n    if (options) {\n        for (var i in options) {\n            dbInfo[i] = options[i];\n        }\n    }\n\n    dbInfo.keyPrefix = _getKeyPrefix(options, self._defaultConfig);\n\n    if (!_isLocalStorageUsable()) {\n        return Promise$1.reject();\n    }\n\n    self._dbInfo = dbInfo;\n    dbInfo.serializer = localforageSerializer;\n\n    return Promise$1.resolve();\n}\n\n// Remove all keys from the datastore, effectively destroying all data in\n// the app's key/value store!\nfunction clear$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var keyPrefix = self._dbInfo.keyPrefix;\n\n        for (var i = localStorage.length - 1; i >= 0; i--) {\n            var key = localStorage.key(i);\n\n            if (key.indexOf(keyPrefix) === 0) {\n                localStorage.removeItem(key);\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Retrieve an item from the store. Unlike the original async_storage\n// library in Gaia, we don't modify return values at all. If a key's value\n// is `undefined`, we pass that value to the callback function.\nfunction getItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result = localStorage.getItem(dbInfo.keyPrefix + key);\n\n        // If a result was found, parse it from the serialized\n        // string into a JS object. If result isn't truthy, the key\n        // is likely undefined and we'll pass it straight to the\n        // callback.\n        if (result) {\n            result = dbInfo.serializer.deserialize(result);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Iterate over all items in the store.\nfunction iterate$2(iterator, callback) {\n    var self = this;\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var keyPrefix = dbInfo.keyPrefix;\n        var keyPrefixLength = keyPrefix.length;\n        var length = localStorage.length;\n\n        // We use a dedicated iterator instead of the `i` variable below\n        // so other keys we fetch in localStorage aren't counted in\n        // the `iterationNumber` argument passed to the `iterate()`\n        // callback.\n        //\n        // See: github.com/mozilla/localForage/pull/435#discussion_r38061530\n        var iterationNumber = 1;\n\n        for (var i = 0; i < length; i++) {\n            var key = localStorage.key(i);\n            if (key.indexOf(keyPrefix) !== 0) {\n                continue;\n            }\n            var value = localStorage.getItem(key);\n\n            // If a result was found, parse it from the serialized\n            // string into a JS object. If result isn't truthy, the\n            // key is likely undefined and we'll pass it straight\n            // to the iterator.\n            if (value) {\n                value = dbInfo.serializer.deserialize(value);\n            }\n\n            value = iterator(value, key.substring(keyPrefixLength), iterationNumber++);\n\n            if (value !== void 0) {\n                return value;\n            }\n        }\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Same as localStorage's key() method, except takes a callback.\nfunction key$2(n, callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var result;\n        try {\n            result = localStorage.key(n);\n        } catch (error) {\n            result = null;\n        }\n\n        // Remove the prefix from the key, if a key is found.\n        if (result) {\n            result = result.substring(dbInfo.keyPrefix.length);\n        }\n\n        return result;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction keys$2(callback) {\n    var self = this;\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        var length = localStorage.length;\n        var keys = [];\n\n        for (var i = 0; i < length; i++) {\n            var itemKey = localStorage.key(i);\n            if (itemKey.indexOf(dbInfo.keyPrefix) === 0) {\n                keys.push(itemKey.substring(dbInfo.keyPrefix.length));\n            }\n        }\n\n        return keys;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Supply the number of keys in the datastore to the callback function.\nfunction length$2(callback) {\n    var self = this;\n    var promise = self.keys().then(function (keys) {\n        return keys.length;\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Remove an item from the store, nice and simple.\nfunction removeItem$2(key, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        var dbInfo = self._dbInfo;\n        localStorage.removeItem(dbInfo.keyPrefix + key);\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\n// Set a key's value and run an optional callback once the value is set.\n// Unlike Gaia's implementation, the callback function is passed the value,\n// in case you want to operate on that value only after you're sure it\n// saved, or something like that.\nfunction setItem$2(key, value, callback) {\n    var self = this;\n\n    key = normalizeKey(key);\n\n    var promise = self.ready().then(function () {\n        // Convert undefined values to null.\n        // https://github.com/mozilla/localForage/pull/42\n        if (value === undefined) {\n            value = null;\n        }\n\n        // Save the original value to pass to the callback.\n        var originalValue = value;\n\n        return new Promise$1(function (resolve, reject) {\n            var dbInfo = self._dbInfo;\n            dbInfo.serializer.serialize(value, function (value, error) {\n                if (error) {\n                    reject(error);\n                } else {\n                    try {\n                        localStorage.setItem(dbInfo.keyPrefix + key, value);\n                        resolve(originalValue);\n                    } catch (e) {\n                        // localStorage capacity exceeded.\n                        // TODO: Make this a specific error/event.\n                        if (e.name === 'QuotaExceededError' || e.name === 'NS_ERROR_DOM_QUOTA_REACHED') {\n                            reject(e);\n                        }\n                        reject(e);\n                    }\n                }\n            });\n        });\n    });\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nfunction dropInstance$2(options, callback) {\n    callback = getCallback.apply(this, arguments);\n\n    options = typeof options !== 'function' && options || {};\n    if (!options.name) {\n        var currentConfig = this.config();\n        options.name = options.name || currentConfig.name;\n        options.storeName = options.storeName || currentConfig.storeName;\n    }\n\n    var self = this;\n    var promise;\n    if (!options.name) {\n        promise = Promise$1.reject('Invalid arguments');\n    } else {\n        promise = new Promise$1(function (resolve) {\n            if (!options.storeName) {\n                resolve(options.name + '/');\n            } else {\n                resolve(_getKeyPrefix(options, self._defaultConfig));\n            }\n        }).then(function (keyPrefix) {\n            for (var i = localStorage.length - 1; i >= 0; i--) {\n                var key = localStorage.key(i);\n\n                if (key.indexOf(keyPrefix) === 0) {\n                    localStorage.removeItem(key);\n                }\n            }\n        });\n    }\n\n    executeCallback(promise, callback);\n    return promise;\n}\n\nvar localStorageWrapper = {\n    _driver: 'localStorageWrapper',\n    _initStorage: _initStorage$2,\n    _support: isLocalStorageValid(),\n    iterate: iterate$2,\n    getItem: getItem$2,\n    setItem: setItem$2,\n    removeItem: removeItem$2,\n    clear: clear$2,\n    length: length$2,\n    key: key$2,\n    keys: keys$2,\n    dropInstance: dropInstance$2\n};\n\nvar sameValue = function sameValue(x, y) {\n    return x === y || typeof x === 'number' && typeof y === 'number' && isNaN(x) && isNaN(y);\n};\n\nvar includes = function includes(array, searchElement) {\n    var len = array.length;\n    var i = 0;\n    while (i < len) {\n        if (sameValue(array[i], searchElement)) {\n            return true;\n        }\n        i++;\n    }\n\n    return false;\n};\n\nvar isArray = Array.isArray || function (arg) {\n    return Object.prototype.toString.call(arg) === '[object Array]';\n};\n\n// Drivers are stored here when `defineDriver()` is called.\n// They are shared across all instances of localForage.\nvar DefinedDrivers = {};\n\nvar DriverSupport = {};\n\nvar DefaultDrivers = {\n    INDEXEDDB: asyncStorage,\n    WEBSQL: webSQLStorage,\n    LOCALSTORAGE: localStorageWrapper\n};\n\nvar DefaultDriverOrder = [DefaultDrivers.INDEXEDDB._driver, DefaultDrivers.WEBSQL._driver, DefaultDrivers.LOCALSTORAGE._driver];\n\nvar OptionalDriverMethods = ['dropInstance'];\n\nvar LibraryMethods = ['clear', 'getItem', 'iterate', 'key', 'keys', 'length', 'removeItem', 'setItem'].concat(OptionalDriverMethods);\n\nvar DefaultConfig = {\n    description: '',\n    driver: DefaultDriverOrder.slice(),\n    name: 'localforage',\n    // Default DB size is _JUST UNDER_ 5MB, as it's the highest size\n    // we can use without a prompt.\n    size: 4980736,\n    storeName: 'keyvaluepairs',\n    version: 1.0\n};\n\nfunction callWhenReady(localForageInstance, libraryMethod) {\n    localForageInstance[libraryMethod] = function () {\n        var _args = arguments;\n        return localForageInstance.ready().then(function () {\n            return localForageInstance[libraryMethod].apply(localForageInstance, _args);\n        });\n    };\n}\n\nfunction extend() {\n    for (var i = 1; i < arguments.length; i++) {\n        var arg = arguments[i];\n\n        if (arg) {\n            for (var _key in arg) {\n                if (arg.hasOwnProperty(_key)) {\n                    if (isArray(arg[_key])) {\n                        arguments[0][_key] = arg[_key].slice();\n                    } else {\n                        arguments[0][_key] = arg[_key];\n                    }\n                }\n            }\n        }\n    }\n\n    return arguments[0];\n}\n\nvar LocalForage = function () {\n    function LocalForage(options) {\n        _classCallCheck(this, LocalForage);\n\n        for (var driverTypeKey in DefaultDrivers) {\n            if (DefaultDrivers.hasOwnProperty(driverTypeKey)) {\n                var driver = DefaultDrivers[driverTypeKey];\n                var driverName = driver._driver;\n                this[driverTypeKey] = driverName;\n\n                if (!DefinedDrivers[driverName]) {\n                    // we don't need to wait for the promise,\n                    // since the default drivers can be defined\n                    // in a blocking manner\n                    this.defineDriver(driver);\n                }\n            }\n        }\n\n        this._defaultConfig = extend({}, DefaultConfig);\n        this._config = extend({}, this._defaultConfig, options);\n        this._driverSet = null;\n        this._initDriver = null;\n        this._ready = false;\n        this._dbInfo = null;\n\n        this._wrapLibraryMethodsWithReady();\n        this.setDriver(this._config.driver)[\"catch\"](function () {});\n    }\n\n    // Set any config values for localForage; can be called anytime before\n    // the first API call (e.g. `getItem`, `setItem`).\n    // We loop through options so we don't overwrite existing config\n    // values.\n\n\n    LocalForage.prototype.config = function config(options) {\n        // If the options argument is an object, we use it to set values.\n        // Otherwise, we return either a specified config value or all\n        // config values.\n        if ((typeof options === 'undefined' ? 'undefined' : _typeof(options)) === 'object') {\n            // If localforage is ready and fully initialized, we can't set\n            // any new configuration values. Instead, we return an error.\n            if (this._ready) {\n                return new Error(\"Can't call config() after localforage \" + 'has been used.');\n            }\n\n            for (var i in options) {\n                if (i === 'storeName') {\n                    options[i] = options[i].replace(/\\W/g, '_');\n                }\n\n                if (i === 'version' && typeof options[i] !== 'number') {\n                    return new Error('Database version must be a number.');\n                }\n\n                this._config[i] = options[i];\n            }\n\n            // after all config options are set and\n            // the driver option is used, try setting it\n            if ('driver' in options && options.driver) {\n                return this.setDriver(this._config.driver);\n            }\n\n            return true;\n        } else if (typeof options === 'string') {\n            return this._config[options];\n        } else {\n            return this._config;\n        }\n    };\n\n    // Used to define a custom driver, shared across all instances of\n    // localForage.\n\n\n    LocalForage.prototype.defineDriver = function defineDriver(driverObject, callback, errorCallback) {\n        var promise = new Promise$1(function (resolve, reject) {\n            try {\n                var driverName = driverObject._driver;\n                var complianceError = new Error('Custom driver not compliant; see ' + 'https://mozilla.github.io/localForage/#definedriver');\n\n                // A driver name should be defined and not overlap with the\n                // library-defined, default drivers.\n                if (!driverObject._driver) {\n                    reject(complianceError);\n                    return;\n                }\n\n                var driverMethods = LibraryMethods.concat('_initStorage');\n                for (var i = 0, len = driverMethods.length; i < len; i++) {\n                    var driverMethodName = driverMethods[i];\n\n                    // when the property is there,\n                    // it should be a method even when optional\n                    var isRequired = !includes(OptionalDriverMethods, driverMethodName);\n                    if ((isRequired || driverObject[driverMethodName]) && typeof driverObject[driverMethodName] !== 'function') {\n                        reject(complianceError);\n                        return;\n                    }\n                }\n\n                var configureMissingMethods = function configureMissingMethods() {\n                    var methodNotImplementedFactory = function methodNotImplementedFactory(methodName) {\n                        return function () {\n                            var error = new Error('Method ' + methodName + ' is not implemented by the current driver');\n                            var promise = Promise$1.reject(error);\n                            executeCallback(promise, arguments[arguments.length - 1]);\n                            return promise;\n                        };\n                    };\n\n                    for (var _i = 0, _len = OptionalDriverMethods.length; _i < _len; _i++) {\n                        var optionalDriverMethod = OptionalDriverMethods[_i];\n                        if (!driverObject[optionalDriverMethod]) {\n                            driverObject[optionalDriverMethod] = methodNotImplementedFactory(optionalDriverMethod);\n                        }\n                    }\n                };\n\n                configureMissingMethods();\n\n                var setDriverSupport = function setDriverSupport(support) {\n                    if (DefinedDrivers[driverName]) {\n                        console.info('Redefining LocalForage driver: ' + driverName);\n                    }\n                    DefinedDrivers[driverName] = driverObject;\n                    DriverSupport[driverName] = support;\n                    // don't use a then, so that we can define\n                    // drivers that have simple _support methods\n                    // in a blocking manner\n                    resolve();\n                };\n\n                if ('_support' in driverObject) {\n                    if (driverObject._support && typeof driverObject._support === 'function') {\n                        driverObject._support().then(setDriverSupport, reject);\n                    } else {\n                        setDriverSupport(!!driverObject._support);\n                    }\n                } else {\n                    setDriverSupport(true);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n\n        executeTwoCallbacks(promise, callback, errorCallback);\n        return promise;\n    };\n\n    LocalForage.prototype.driver = function driver() {\n        return this._driver || null;\n    };\n\n    LocalForage.prototype.getDriver = function getDriver(driverName, callback, errorCallback) {\n        var getDriverPromise = DefinedDrivers[driverName] ? Promise$1.resolve(DefinedDrivers[driverName]) : Promise$1.reject(new Error('Driver not found.'));\n\n        executeTwoCallbacks(getDriverPromise, callback, errorCallback);\n        return getDriverPromise;\n    };\n\n    LocalForage.prototype.getSerializer = function getSerializer(callback) {\n        var serializerPromise = Promise$1.resolve(localforageSerializer);\n        executeTwoCallbacks(serializerPromise, callback);\n        return serializerPromise;\n    };\n\n    LocalForage.prototype.ready = function ready(callback) {\n        var self = this;\n\n        var promise = self._driverSet.then(function () {\n            if (self._ready === null) {\n                self._ready = self._initDriver();\n            }\n\n            return self._ready;\n        });\n\n        executeTwoCallbacks(promise, callback, callback);\n        return promise;\n    };\n\n    LocalForage.prototype.setDriver = function setDriver(drivers, callback, errorCallback) {\n        var self = this;\n\n        if (!isArray(drivers)) {\n            drivers = [drivers];\n        }\n\n        var supportedDrivers = this._getSupportedDrivers(drivers);\n\n        function setDriverToConfig() {\n            self._config.driver = self.driver();\n        }\n\n        function extendSelfWithDriver(driver) {\n            self._extend(driver);\n            setDriverToConfig();\n\n            self._ready = self._initStorage(self._config);\n            return self._ready;\n        }\n\n        function initDriver(supportedDrivers) {\n            return function () {\n                var currentDriverIndex = 0;\n\n                function driverPromiseLoop() {\n                    while (currentDriverIndex < supportedDrivers.length) {\n                        var driverName = supportedDrivers[currentDriverIndex];\n                        currentDriverIndex++;\n\n                        self._dbInfo = null;\n                        self._ready = null;\n\n                        return self.getDriver(driverName).then(extendSelfWithDriver)[\"catch\"](driverPromiseLoop);\n                    }\n\n                    setDriverToConfig();\n                    var error = new Error('No available storage method found.');\n                    self._driverSet = Promise$1.reject(error);\n                    return self._driverSet;\n                }\n\n                return driverPromiseLoop();\n            };\n        }\n\n        // There might be a driver initialization in progress\n        // so wait for it to finish in order to avoid a possible\n        // race condition to set _dbInfo\n        var oldDriverSetDone = this._driverSet !== null ? this._driverSet[\"catch\"](function () {\n            return Promise$1.resolve();\n        }) : Promise$1.resolve();\n\n        this._driverSet = oldDriverSetDone.then(function () {\n            var driverName = supportedDrivers[0];\n            self._dbInfo = null;\n            self._ready = null;\n\n            return self.getDriver(driverName).then(function (driver) {\n                self._driver = driver._driver;\n                setDriverToConfig();\n                self._wrapLibraryMethodsWithReady();\n                self._initDriver = initDriver(supportedDrivers);\n            });\n        })[\"catch\"](function () {\n            setDriverToConfig();\n            var error = new Error('No available storage method found.');\n            self._driverSet = Promise$1.reject(error);\n            return self._driverSet;\n        });\n\n        executeTwoCallbacks(this._driverSet, callback, errorCallback);\n        return this._driverSet;\n    };\n\n    LocalForage.prototype.supports = function supports(driverName) {\n        return !!DriverSupport[driverName];\n    };\n\n    LocalForage.prototype._extend = function _extend(libraryMethodsAndProperties) {\n        extend(this, libraryMethodsAndProperties);\n    };\n\n    LocalForage.prototype._getSupportedDrivers = function _getSupportedDrivers(drivers) {\n        var supportedDrivers = [];\n        for (var i = 0, len = drivers.length; i < len; i++) {\n            var driverName = drivers[i];\n            if (this.supports(driverName)) {\n                supportedDrivers.push(driverName);\n            }\n        }\n        return supportedDrivers;\n    };\n\n    LocalForage.prototype._wrapLibraryMethodsWithReady = function _wrapLibraryMethodsWithReady() {\n        // Add a stub for each driver API method that delays the call to the\n        // corresponding driver method until localForage is ready. These stubs\n        // will be replaced by the driver methods as soon as the driver is\n        // loaded, so there is no performance impact.\n        for (var i = 0, len = LibraryMethods.length; i < len; i++) {\n            callWhenReady(this, LibraryMethods[i]);\n        }\n    };\n\n    LocalForage.prototype.createInstance = function createInstance(options) {\n        return new LocalForage(options);\n    };\n\n    return LocalForage;\n}();\n\n// The actual localForage object that we expose as a module or via a\n// global. It's extended by pulling in one of our other libraries.\n\n\nvar localforage_js = new LocalForage();\n\nmodule.exports = localforage_js;\n\n},{\"3\":3}]},{},[4])(4)\n});\n","import { defer, isXml, parse } from \"./core\";\r\nimport Path from \"./path\";\r\n\r\nfunction request(url, type, withCredentials, headers) {\r\n\tvar supportsURL = (typeof window != \"undefined\") ? window.URL : false; // TODO: fallback for url if window isn't defined\r\n\tvar BLOB_RESPONSE = supportsURL ? \"blob\" : \"arraybuffer\";\r\n\r\n\tvar deferred = new defer();\r\n\r\n\tvar xhr = new XMLHttpRequest();\r\n\r\n\t//-- Check from PDF.js:\r\n\t//   https://github.com/mozilla/pdf.js/blob/master/web/compatibility.js\r\n\tvar xhrPrototype = XMLHttpRequest.prototype;\r\n\r\n\tvar header;\r\n\r\n\tif (!(\"overrideMimeType\" in xhrPrototype)) {\r\n\t\t// IE10 might have response, but not overrideMimeType\r\n\t\tObject.defineProperty(xhrPrototype, \"overrideMimeType\", {\r\n\t\t\tvalue: function xmlHttpRequestOverrideMimeType() { }\r\n\t\t});\r\n\t}\r\n\r\n\tif (withCredentials) {\r\n\t\txhr.withCredentials = true;\r\n\t}\r\n\r\n\txhr.onreadystatechange = handler;\r\n\txhr.onerror = err;\r\n\r\n\txhr.open(\"GET\", url, true);\r\n\r\n\tfor (header in headers) {\r\n\t\txhr.setRequestHeader(header, headers[header]);\r\n\t}\r\n\r\n\tif (type == \"json\") {\r\n\t\txhr.setRequestHeader(\"Accept\", \"application/json\");\r\n\t}\r\n\r\n\t// If type isn\"t set, determine it from the file extension\r\n\tif (!type) {\r\n\t\ttype = new Path(url).extension;\r\n\t}\r\n\r\n\tif (type == \"blob\") {\r\n\t\txhr.responseType = BLOB_RESPONSE;\r\n\t}\r\n\r\n\r\n\tif (isXml(type)) {\r\n\t\t// xhr.responseType = \"document\";\r\n\t\txhr.overrideMimeType(\"text/xml\"); // for OPF parsing\r\n\t}\r\n\r\n\tif (type == \"xhtml\") {\r\n\t\t// xhr.responseType = \"document\";\r\n\t}\r\n\r\n\tif (type == \"html\" || type == \"htm\") {\r\n\t\t// xhr.responseType = \"document\";\r\n\t}\r\n\r\n\tif (type == \"binary\") {\r\n\t\txhr.responseType = \"arraybuffer\";\r\n\t}\r\n\r\n\t// xhr.onreadystatechange = function (oEvt) {\r\n\t// \tif (xhr.readyState == 4) {\r\n\t// \t\tif (xhr.status == 200) {\r\n\r\n\t// \t\t}\r\n\t// \t\telse {\r\n\t// \t\t\talert(\"파일이 손상되었습니다. 관리자에게 문의하세요.\");\r\n\t// \t\t\twindow.location.href = document.referrer;\r\n\t// \t\t}\r\n\t// \t}\r\n\t// }\r\n\r\n\txhr.send();\r\n\r\n\r\n\r\n\tfunction err(e) {\r\n\t\tdeferred.reject(e);\r\n\t}\r\n\r\n\tfunction handler() {\r\n\t\tif (this.readyState === XMLHttpRequest.DONE) {\r\n\t\t\tvar responseXML = false;\r\n\r\n\t\t\tif (this.responseType === \"\" || this.responseType === \"document\") {\r\n\t\t\t\tresponseXML = this.responseXML;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.status === 200 || this.status === 0 || responseXML) { //-- Firefox is reporting 0 for blob urls\r\n\t\t\t\tvar r;\r\n\r\n\t\t\t\tif (!this.response && !responseXML) {\r\n\t\t\t\t\tdeferred.reject({\r\n\t\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\t\tmessage: \"Empty Response\",\r\n\t\t\t\t\t\tstack: new Error().stack\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn deferred.promise;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this.status === 403) {\r\n\t\t\t\t\tdeferred.reject({\r\n\t\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\t\tresponse: this.response,\r\n\t\t\t\t\t\tmessage: \"Forbidden\",\r\n\t\t\t\t\t\tstack: new Error().stack\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn deferred.promise;\r\n\t\t\t\t}\r\n\t\t\t\tif (responseXML) {\r\n\t\t\t\t\tr = this.responseXML;\r\n\t\t\t\t} else\r\n\t\t\t\t\tif (isXml(type)) {\r\n\t\t\t\t\t\t// xhr.overrideMimeType(\"text/xml\"); // for OPF parsing\r\n\t\t\t\t\t\t// If this.responseXML wasn't set, try to parse using a DOMParser from text\r\n\t\t\t\t\t\tr = parse(this.response, \"text/xml\");\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tif (type == \"xhtml\") {\r\n\t\t\t\t\t\t\tr = parse(this.response, \"application/xhtml+xml\");\r\n\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\tif (type == \"html\" || type == \"htm\") {\r\n\t\t\t\t\t\t\t\tr = parse(this.response, \"text/html\");\r\n\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\tif (type == \"json\") {\r\n\t\t\t\t\t\t\t\t\tr = JSON.parse(this.response);\r\n\t\t\t\t\t\t\t\t} else\r\n\t\t\t\t\t\t\t\t\tif (type == \"blob\") {\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (supportsURL) {\r\n\t\t\t\t\t\t\t\t\t\t\tr = this.response;\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\t//-- Safari doesn't support responseType blob, so create a blob from arraybuffer\r\n\t\t\t\t\t\t\t\t\t\t\tr = new Blob([this.response]);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tr = this.response;\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\tdeferred.resolve(r);\r\n\t\t\t} else {\r\n\t\t\t\tdeferred.reject({\r\n\t\t\t\t\tstatus: this.status,\r\n\t\t\t\t\tmessage: this.response,\r\n\t\t\t\t\tstack: new Error().stack\r\n\t\t\t\t});\r\n\t\t\t\tconst userAgent =\r\n\t\t\t\t\t(typeof navigator !== \"undefined\" && navigator.userAgent) || \"\";\r\n\t\t\t\tconst platform =\r\n\t\t\t\t\t(typeof navigator !== \"undefined\" && navigator.platform) || \"\";\r\n\t\t\t\tconst maxTouchPoints =\r\n\t\t\t\t\t(typeof navigator !== \"undefined\" && navigator.maxTouchPoints) || 1;\r\n\t\t\t\tconst isAndroid = /Android/.test(userAgent);\r\n\t\t\t\tconst isIOS =\r\n\t\t\t\t\t/\\b(iPad|iPhone|iPod)(?=;)/.test(userAgent) ||\r\n\t\t\t\t\t(platform === \"MacIntel\" && maxTouchPoints > 1);\r\n\t\t\t\tif (isAndroid || isIOS) {\r\n\t\t\t\t\talert(\"파일이 손상되었습니다. 모바일 책장에서 삭제 후 다시 다운로드 하시기 바랍니다.\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\talert(\"파일이 손상되었습니다. 관리자에게 문의하세요.\");\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\twindow.location.href = 'https://dev-dplus-front.azurewebsites.net/';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn deferred.promise;\r\n}\r\n\r\nexport default request;\r\n","import { defer } from \"./utils/core\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport Hook from \"./utils/hook\";\r\nimport { sprint } from \"./utils/core\";\r\nimport { replaceBase } from \"./utils/replacements\";\r\nimport Request from \"./utils/request\";\r\nimport { XMLDOMParser as XMLDOMSerializer } from \"xmldom\";\r\n\r\n/**\r\n * Represents a Section of the Book\r\n *\r\n * In most books this is equivelent to a Chapter\r\n * @param {object} item  The spine item representing the section\r\n * @param {object} hooks hooks for serialize and content\r\n */\r\nclass Section {\r\n\tconstructor(item, hooks){\r\n\t\tthis.idref = item.idref;\r\n\t\tthis.linear = item.linear === \"yes\";\r\n\t\tthis.properties = item.properties;\r\n\t\tthis.index = item.index;\r\n\t\tthis.href = item.href;\r\n\t\tthis.url = item.url;\r\n\t\tthis.canonical = item.canonical;\r\n\t\tthis.next = item.next;\r\n\t\tthis.prev = item.prev;\r\n\r\n\t\tthis.cfiBase = item.cfiBase;\r\n\r\n\t\tif (hooks) {\r\n\t\t\tthis.hooks = hooks;\r\n\t\t} else {\r\n\t\t\tthis.hooks = {};\r\n\t\t\tthis.hooks.serialize = new Hook(this);\r\n\t\t\tthis.hooks.content = new Hook(this);\r\n\t\t}\r\n\r\n\t\tthis.document = undefined;\r\n\t\tthis.contents = undefined;\r\n\t\tthis.output = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Load the section from its url\r\n\t * @param  {method} [_request] a request method to use for loading\r\n\t * @return {document} a promise with the xml document\r\n\t */\r\n\tload(_request){\r\n\t\tvar request = _request || this.request || Request;\r\n\t\tvar loading = new defer();\r\n\t\tvar loaded = loading.promise;\r\n\r\n\t\tif(this.contents) {\r\n\t\t\tloading.resolve(this.contents);\r\n\t\t} else {\r\n\t\t\trequest(this.url)\r\n\t\t\t\t.then(function(xml){\r\n\t\t\t\t\t// var directory = new Url(this.url).directory;\r\n\r\n\t\t\t\t\tthis.document = xml;\r\n\t\t\t\t\tthis.contents = xml.documentElement;\r\n\r\n\t\t\t\t\treturn this.hooks.content.trigger(this.document, this);\r\n\t\t\t\t}.bind(this))\r\n\t\t\t\t.then(function(){\r\n\t\t\t\t\tloading.resolve(this.contents);\r\n\t\t\t\t}.bind(this))\r\n\t\t\t\t.catch(function(error){\r\n\t\t\t\t\tloading.reject(error);\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn loaded;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a base tag for resolving urls in the section\r\n\t * @private\r\n\t */\r\n\tbase(){\r\n\t\treturn replaceBase(this.document, this);\r\n\t}\r\n\r\n\t/**\r\n\t * Render the contents of a section\r\n\t * @param  {method} [_request] a request method to use for loading\r\n\t * @return {string} output a serialized XML Document\r\n\t */\r\n\trender(_request){\r\n\t\tvar rendering = new defer();\r\n\t\tvar rendered = rendering.promise;\r\n\t\tthis.output; // TODO: better way to return this from hooks?\r\n\r\n\t\tthis.load(_request).\r\n\t\t\tthen(function(contents){\r\n\t\t\t\tvar userAgent = (typeof navigator !== 'undefined' && navigator.userAgent) || '';\r\n\t\t\t\tvar isIE = userAgent.indexOf('Trident') >= 0;\r\n\t\t\t\tvar Serializer;\r\n\t\t\t\tif (typeof XMLSerializer === \"undefined\" || isIE) {\r\n\t\t\t\t\tSerializer = XMLDOMSerializer;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tSerializer = XMLSerializer;\r\n\t\t\t\t}\r\n\t\t\t\tvar serializer = new Serializer();\r\n\t\t\t\tthis.output = serializer.serializeToString(contents);\r\n\t\t\t\treturn this.output;\r\n\t\t\t}.bind(this)).\r\n\t\t\tthen(function(){\r\n\t\t\t\treturn this.hooks.serialize.trigger(this.output, this);\r\n\t\t\t}.bind(this)).\r\n\t\t\tthen(function(){\r\n\t\t\t\trendering.resolve(this.output);\r\n\t\t\t}.bind(this))\r\n\t\t\t.catch(function(error){\r\n\t\t\t\trendering.reject(error);\r\n\t\t\t});\r\n\r\n\t\treturn rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * Find a string in a section\r\n\t * @param  {string} _query The query string to find\r\n\t * @return {object[]} A list of matches, with form {cfi, excerpt}\r\n\t */\r\n\tfind(_query){\r\n\t\tvar section = this;\r\n\t\tvar matches = [];\r\n\t\tvar query = _query.toLowerCase();\r\n\t\tvar find = function(node){\r\n\t\t\tvar text = node.textContent.toLowerCase();\r\n\t\t\tvar range = section.document.createRange();\r\n\t\t\tvar cfi;\r\n\t\t\tvar pos;\r\n\t\t\tvar last = -1;\r\n\t\t\tvar excerpt;\r\n\t\t\tvar limit = 80;\r\n\r\n\t\t\twhile (pos != -1) {\r\n\t\t\t\t// Search for the query\r\n\t\t\t\tpos = text.indexOf(query, last + 1);\r\n\r\n\t\t\t\tif (pos != -1) {\r\n\t\t\t\t\t// We found it! Generate a CFI\r\n\t\t\t\t\trange = section.document.createRange();\r\n\t\t\t\t\trange.setStart(node, pos);\r\n\t\t\t\t\trange.setEnd(node, pos + query.length);\r\n\r\n\t\t\t\t\tcfi = section.cfiFromRange(range);\r\n\r\n\t\t\t\t\t// Generate the excerpt\r\n\t\t\t\t\tif (node.textContent.length < limit) {\r\n\t\t\t\t\t\texcerpt = node.textContent;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\texcerpt = node.textContent.substring(pos - limit/2, pos + limit/2);\r\n\t\t\t\t\t\texcerpt = \"...\" + excerpt + \"...\";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add the CFI to the matches list\r\n\t\t\t\t\tmatches.push({\r\n\t\t\t\t\t\tcfi: cfi,\r\n\t\t\t\t\t\texcerpt: excerpt,\r\n\t\t\t\t\t\tchapter : section.index\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlast = pos;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tsprint(section.document, function(node) {\r\n\t\t\tfind(node);\r\n\t\t});\r\n\r\n\t\treturn matches;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Search a string in multiple sequential Element of the section. If the document.createTreeWalker api is missed(eg: IE8), use `find` as a fallback.\r\n\t * @param  {string} _query The query string to search\r\n\t * @param  {int} maxSeqEle The maximum number of Element that are combined for search, defualt value is 5.\r\n\t * @return {object[]} A list of matches, with form {cfi, excerpt}\r\n\t */\r\n\tsearch(_query , maxSeqEle = 5){\r\n\t\tif (typeof(document.createTreeWalker) == \"undefined\") {\r\n\t\t\treturn this.find(_query);\r\n\t\t}\r\n\t\tlet matches = [];\r\n\t\tconst excerptLimit = 150;\r\n\t\tconst section = this;\r\n\t\tconst query = _query.toLowerCase();\r\n\t\tconst search = function(nodeList){\r\n\t\t\tconst textWithCase =  nodeList.reduce((acc ,current)=>{\r\n\t\t\t\treturn acc + current.textContent;\r\n\t\t\t},\"\");\r\n\t\t\tconst text = textWithCase.toLowerCase();\r\n\t\t\tconst pos = text.indexOf(query);\r\n\t\t\tif (pos != -1){\r\n\t\t\t\tconst startNodeIndex = 0 , endPos = pos + query.length;\r\n\t\t\t\tlet endNodeIndex = 0 , l = 0;\r\n\t\t\t\tif (pos < nodeList[startNodeIndex].length){\r\n\t\t\t\t\tlet cfi;\r\n\t\t\t\t\twhile( endNodeIndex < nodeList.length - 1 ){\r\n\t\t\t\t\t\tl += nodeList[endNodeIndex].length;\r\n\t\t\t\t\t\tif ( endPos <= l){\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tendNodeIndex += 1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet startNode = nodeList[startNodeIndex] , endNode = nodeList[endNodeIndex];\r\n\t\t\t\t\tlet range = section.document.createRange();\r\n\t\t\t\t\trange.setStart(startNode,pos);\r\n\t\t\t\t\tlet beforeEndLengthCount =  nodeList.slice(0, endNodeIndex).reduce((acc,current)=>{return acc+current.textContent.length;},0) ;\r\n\t\t\t\t\trange.setEnd(endNode, beforeEndLengthCount > endPos ? endPos : endPos - beforeEndLengthCount );\r\n\t\t\t\t\tcfi = section.cfiFromRange(range);\r\n\r\n\t\t\t\t\tlet excerpt = nodeList.slice(0, endNodeIndex+1).reduce((acc,current)=>{return acc+current.textContent ;},\"\");\r\n\t\t\t\t\tif (excerpt.length > excerptLimit){\r\n\t\t\t\t\t\texcerpt = excerpt.substring(pos - excerptLimit/2, pos + excerptLimit/2);\r\n\t\t\t\t\t\texcerpt = \"...\" + excerpt + \"...\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmatches.push({\r\n\t\t\t\t\t\tcfi: cfi,\r\n\t\t\t\t\t\texcerpt: excerpt\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst treeWalker = document.createTreeWalker(section.document, NodeFilter.SHOW_TEXT, null, false);\r\n\t\tlet node , nodeList = [];\r\n\t\twhile (node = treeWalker.nextNode()) {\r\n\t\t\tnodeList.push(node);\r\n\t\t\tif (nodeList.length == maxSeqEle){\r\n\t\t\t\tsearch(nodeList.slice(0 , maxSeqEle));\r\n\t\t\t\tnodeList = nodeList.slice(1, maxSeqEle);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (nodeList.length > 0){\r\n\t\t\tsearch(nodeList);\r\n\t\t}\r\n\t\treturn matches;\r\n\t}\r\n\r\n\t/**\r\n\t* Reconciles the current chapters layout properies with\r\n\t* the global layout properities.\r\n\t* @param {object} globalLayout  The global layout settings object, chapter properties string\r\n\t* @return {object} layoutProperties Object with layout properties\r\n\t*/\r\n\treconcileLayoutSettings(globalLayout){\r\n\t\t//-- Get the global defaults\r\n\t\tvar settings = {\r\n\t\t\tlayout : globalLayout.layout,\r\n\t\t\tspread : globalLayout.spread,\r\n\t\t\torientation : globalLayout.orientation\r\n\t\t};\r\n\r\n\t\t//-- Get the chapter's display type\r\n\t\tthis.properties.forEach(function(prop){\r\n\t\t\tvar rendition = prop.replace(\"rendition:\", \"\");\r\n\t\t\tvar split = rendition.indexOf(\"-\");\r\n\t\t\tvar property, value;\r\n\r\n\t\t\tif(split != -1){\r\n\t\t\t\tproperty = rendition.slice(0, split);\r\n\t\t\t\tvalue = rendition.slice(split+1);\r\n\r\n\t\t\t\tsettings[property] = value;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn settings;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a CFI from a Range in the Section\r\n\t * @param  {range} _range\r\n\t * @return {string} cfi an EpubCFI string\r\n\t */\r\n\tcfiFromRange(_range) {\r\n\t\treturn new EpubCFI(_range, this.cfiBase).toString();\r\n\t}\r\n\r\n\t/**\r\n\t * Get a CFI from an Element in the Section\r\n\t * @param  {element} el\r\n\t * @return {string} cfi an EpubCFI string\r\n\t */\r\n\tcfiFromElement(el) {\r\n\t\treturn new EpubCFI(el, this.cfiBase).toString();\r\n\t}\r\n\r\n\t/**\r\n\t * Unload the section document\r\n\t */\r\n\tunload() {\r\n\t\tthis.document = undefined;\r\n\t\tthis.contents = undefined;\r\n\t\tthis.output = undefined;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unload();\r\n\t\tthis.hooks.serialize.clear();\r\n\t\tthis.hooks.content.clear();\r\n\r\n\t\tthis.hooks = undefined;\r\n\t\tthis.idref = undefined;\r\n\t\tthis.linear = undefined;\r\n\t\tthis.properties = undefined;\r\n\t\tthis.index = undefined;\r\n\t\tthis.href = undefined;\r\n\t\tthis.url = undefined;\r\n\t\tthis.next = undefined;\r\n\t\tthis.prev = undefined;\r\n\r\n\t\tthis.cfiBase = undefined;\r\n\t}\r\n}\r\n\r\nexport default Section;\r\n","import EpubCFI from \"./epubcfi\";\r\nimport Hook from \"./utils/hook\";\r\nimport Section from \"./section\";\r\nimport { replaceBase, replaceCanonical, replaceMeta } from \"./utils/replacements\";\r\n\r\n/**\r\n * A collection of Spine Items\r\n */\r\nclass Spine {\r\n\tconstructor() {\r\n\t\tthis.spineItems = [];\r\n\t\tthis.spineByHref = {};\r\n\t\tthis.spineById = {};\r\n\r\n\t\tthis.hooks = {};\r\n\t\tthis.hooks.serialize = new Hook();\r\n\t\tthis.hooks.content = new Hook();\r\n\r\n\t\t// Register replacements\r\n\t\tthis.hooks.content.register(replaceBase);\r\n\t\tthis.hooks.content.register(replaceCanonical);\r\n\t\tthis.hooks.content.register(replaceMeta);\r\n\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis.loaded = false;\r\n\r\n\t\tthis.items = undefined;\r\n\t\tthis.manifest = undefined;\r\n\t\tthis.spineNodeIndex = undefined;\r\n\t\tthis.baseUrl = undefined;\r\n\t\tthis.length = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Unpack items from a opf into spine items\r\n\t * @param  {Packaging} _package\r\n\t * @param  {method} resolver URL resolver\r\n\t * @param  {method} canonical Resolve canonical url\r\n\t */\r\n\tunpack(_package, resolver, canonical) {\r\n\r\n\t\tthis.items = _package.spine;\r\n\t\tthis.manifest = _package.manifest;\r\n\t\tthis.spineNodeIndex = _package.spineNodeIndex;\r\n\t\tthis.baseUrl = _package.baseUrl || _package.basePath || \"\";\r\n\t\tthis.length = this.items.length;\r\n\r\n\t\tthis.items.forEach((item, index) => {\r\n\t\t\tvar manifestItem = this.manifest[item.idref];\r\n\t\t\tvar spineItem;\r\n\r\n\t\t\titem.index = index;\r\n\t\t\titem.cfiBase = this.epubcfi.generateChapterComponent(this.spineNodeIndex, item.index, item.idref);\r\n\r\n\t\t\tif (item.href) {\r\n\t\t\t\titem.url = resolver(item.href, true);\r\n\t\t\t\titem.canonical = canonical(item.href);\r\n\t\t\t}\r\n\r\n\t\t\tif (manifestItem) {\r\n\t\t\t\titem.href = manifestItem.href;\r\n\t\t\t\titem.url = resolver(item.href, true);\r\n\t\t\t\titem.canonical = canonical(item.href);\r\n\r\n\t\t\t\tif (manifestItem.properties.length) {\r\n\t\t\t\t\titem.properties.push.apply(item.properties, manifestItem.properties);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t//김병현 주석 linear\r\n\t\t\t// if (item.linear === \"yes\") {\r\n\t\t\titem.prev = function () {\r\n\t\t\t\tlet prevIndex = item.index;\r\n\t\t\t\twhile (prevIndex > 0) {\r\n\t\t\t\t\tlet prev = this.get(prevIndex - 1);\r\n\t\t\t\t\t// if (prev && prev.linear) {\r\n\t\t\t\t\tif (prev) {\r\n\t\t\t\t\t\treturn prev;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tprevIndex -= 1;\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}.bind(this);\r\n\t\t\titem.next = function () {\r\n\t\t\t\tlet nextIndex = item.index;\r\n\t\t\t\twhile (nextIndex < this.spineItems.length - 1) {\r\n\t\t\t\t\tlet next = this.get(nextIndex + 1);\r\n\t\t\t\t\t//김병현 주석 linear 때문에 첫 표지 안뜸??\r\n\t\t\t\t\t// if (next && next.linear) {\r\n\t\t\t\t\tif (next) {\r\n\t\t\t\t\t\treturn next;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnextIndex += 1;\r\n\t\t\t\t}\r\n\t\t\t\t//김병현 추가 마지막 페이지 이벤트=======================\r\n\t\t\t\tlet evt = new CustomEvent(\"lastPage\");\r\n\t\t\t\tdocument.dispatchEvent(evt);\r\n\t\t\t\t//마지막 페이지 이벤트============================\r\n\t\t\t\treturn;\r\n\t\t\t}.bind(this);\r\n\t\t\t// } else {\r\n\t\t\t// \titem.prev = function () {\r\n\t\t\t// \t\treturn;\r\n\t\t\t// \t}\r\n\t\t\t// \titem.next = function () {\r\n\t\t\t// \t\treturn;\r\n\t\t\t// \t}\r\n\t\t\t// }\r\n\r\n\r\n\t\t\tspineItem = new Section(item, this.hooks);\r\n\r\n\t\t\tthis.append(spineItem);\r\n\r\n\r\n\t\t});\r\n\r\n\t\tthis.loaded = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Get an item from the spine\r\n\t * @param  {string|number} [target]\r\n\t * @return {Section} section\r\n\t * @example spine.get();\r\n\t * @example spine.get(1);\r\n\t * @example spine.get(\"chap1.html\");\r\n\t * @example spine.get(\"#id1234\");\r\n\t */\r\n\tget(target) {\r\n\t\tvar index = 0;\r\n\r\n\t\tif (typeof target === \"undefined\") {\r\n\t\t\twhile (index < this.spineItems.length) {\r\n\t\t\t\tlet next = this.spineItems[index];\r\n\t\t\t\t//김병현 주석 linear 때문에 첫 표지 안뜸??\r\n\t\t\t\t// if (next && next.linear) {\r\n\t\t\t\tif (next) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tindex += 1;\r\n\t\t\t}\r\n\t\t} else if (this.epubcfi.isCfiString(target)) {\r\n\t\t\tlet cfi = new EpubCFI(target);\r\n\t\t\tindex = cfi.spinePos;\r\n\t\t} else if (typeof target === \"number\" || isNaN(target) === false) {\r\n\t\t\tindex = target;\r\n\t\t} else if (typeof target === \"string\" && target.indexOf(\"#\") === 0) {\r\n\t\t\tindex = this.spineById[target.substring(1)];\r\n\t\t} else if (typeof target === \"string\") {\r\n\t\t\t// Remove fragments\r\n\t\t\ttarget = target.split(\"#\")[0];\r\n\t\t\tindex = this.spineByHref[target] || this.spineByHref[encodeURI(target)];\r\n\t\t}\r\n\r\n\t\treturn this.spineItems[index] || null;\r\n\t}\r\n\r\n\t/**\r\n\t * Append a Section to the Spine\r\n\t * @private\r\n\t * @param  {Section} section\r\n\t */\r\n\tappend(section) {\r\n\t\tvar index = this.spineItems.length;\r\n\t\tsection.index = index;\r\n\r\n\t\tthis.spineItems.push(section);\r\n\r\n\t\t// Encode and Decode href lookups\r\n\t\t// see pr for details: https://github.com/futurepress/epub.js/pull/358\r\n\t\tthis.spineByHref[decodeURI(section.href)] = index;\r\n\t\tthis.spineByHref[encodeURI(section.href)] = index;\r\n\t\tthis.spineByHref[section.href] = index;\r\n\r\n\t\tthis.spineById[section.idref] = index;\r\n\r\n\t\treturn index;\r\n\t}\r\n\r\n\t/**\r\n\t * Prepend a Section to the Spine\r\n\t * @private\r\n\t * @param  {Section} section\r\n\t */\r\n\tprepend(section) {\r\n\t\t// var index = this.spineItems.unshift(section);\r\n\t\tthis.spineByHref[section.href] = 0;\r\n\t\tthis.spineById[section.idref] = 0;\r\n\r\n\t\t// Re-index\r\n\t\tthis.spineItems.forEach(function (item, index) {\r\n\t\t\titem.index = index;\r\n\t\t});\r\n\r\n\t\treturn 0;\r\n\t}\r\n\r\n\t// insert(section, index) {\r\n\t//\r\n\t// };\r\n\r\n\t/**\r\n\t * Remove a Section from the Spine\r\n\t * @private\r\n\t * @param  {Section} section\r\n\t */\r\n\tremove(section) {\r\n\t\tvar index = this.spineItems.indexOf(section);\r\n\r\n\t\tif (index > -1) {\r\n\t\t\tdelete this.spineByHref[section.href];\r\n\t\t\tdelete this.spineById[section.idref];\r\n\r\n\t\t\treturn this.spineItems.splice(index, 1);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Loop over the Sections in the Spine\r\n\t * @return {method} forEach\r\n\t */\r\n\teach() {\r\n\t\treturn this.spineItems.forEach.apply(this.spineItems, arguments);\r\n\t}\r\n\r\n\t/**\r\n\t * Find the first Section in the Spine\r\n\t * @return {Section} first section\r\n\t */\r\n\tfirst() {\r\n\t\tlet index = 0;\r\n\r\n\t\tdo {\r\n\t\t\tlet next = this.get(index);\r\n\r\n\t\t\t//김병현 주석 linear 때문에 첫 표지 안뜸??\r\n\t\t\t// if (next && next.linear) {\r\n\t\t\tif (next) {\r\n\t\t\t\treturn next;\r\n\t\t\t}\r\n\t\t\tindex += 1;\r\n\t\t} while (index < this.spineItems.length);\r\n\t}\r\n\r\n\t/**\r\n\t * Find the last Section in the Spine\r\n\t * @return {Section} last section\r\n\t */\r\n\tlast() {\r\n\t\tlet index = this.spineItems.length - 1;\r\n\r\n\t\tdo {\r\n\t\t\tlet prev = this.get(index);\r\n\t\t\t// if (prev && prev.linear) {\r\n\t\t\tif (prev) {\r\n\t\t\t\treturn prev;\r\n\t\t\t}\r\n\t\t\tindex -= 1;\r\n\t\t} while (index >= 0);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.each((section) => section.destroy());\r\n\r\n\t\tthis.spineItems = undefined\r\n\t\tthis.spineByHref = undefined\r\n\t\tthis.spineById = undefined\r\n\r\n\t\tthis.hooks.serialize.clear();\r\n\t\tthis.hooks.content.clear();\r\n\t\tthis.hooks = undefined;\r\n\r\n\t\tthis.epubcfi = undefined;\r\n\r\n\t\tthis.loaded = false;\r\n\r\n\t\tthis.items = undefined;\r\n\t\tthis.manifest = undefined;\r\n\t\tthis.spineNodeIndex = undefined;\r\n\t\tthis.baseUrl = undefined;\r\n\t\tthis.length = undefined;\r\n\t}\r\n}\r\n\r\nexport default Spine;\r\n","import {qs, sprint, locationOf, defer} from \"./utils/core\";\r\nimport Queue from \"./utils/queue\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport { EVENTS } from \"./utils/constants\";\r\nimport EventEmitter from \"event-emitter\";\r\n\r\n/**\r\n * Find Locations for a Book\r\n * @param {Spine} spine\r\n * @param {request} request\r\n * @param {number} [pause=100]\r\n */\r\nclass Locations {\r\n\tconstructor(spine, request, pause) {\r\n\t\tthis.spine = spine;\r\n\t\tthis.request = request;\r\n\t\tthis.pause = pause || 100;\r\n\r\n\t\tthis.q = new Queue(this);\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis._locations = [];\r\n\t\tthis._locationsWords = [];\r\n\t\tthis.total = 0;\r\n\r\n\t\tthis.break = 150;\r\n\r\n\t\tthis._current = 0;\r\n\r\n\t\tthis._wordCounter = 0;\r\n\r\n\t\tthis.currentLocation = '';\r\n\t\tthis._currentCfi ='';\r\n\t\tthis.processingTimeout = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Load all of sections in the book to generate locations\r\n\t * @param  {int} chars how many chars to split on\r\n\t * @return {object} locations\r\n\t */\r\n\tgenerate(chars) {\r\n\t\tif (chars) {\r\n\t\t\tthis.break = chars;\r\n\t\t}\r\n\r\n\t\tthis.q.pause();\r\n\r\n\t\tthis.spine.each(function(section) {\r\n\t\t\tif (section.linear) {\r\n\t\t\t\tthis.q.enqueue(this.process.bind(this), section);\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\r\n\t\treturn this.q.run().then(function() {\r\n\t\t\tthis.total = this._locations.length - 1;\r\n\r\n\t\t\tif (this._currentCfi) {\r\n\t\t\t\tthis.currentLocation = this._currentCfi;\r\n\t\t\t}\r\n\r\n\t\t\treturn this._locations;\r\n\t\t\t// console.log(this.percentage(this.book.rendition.location.start), this.percentage(this.book.rendition.location.end));\r\n\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\tcreateRange () {\r\n\t\treturn {\r\n\t\t\tstartContainer: undefined,\r\n\t\t\tstartOffset: undefined,\r\n\t\t\tendContainer: undefined,\r\n\t\t\tendOffset: undefined\r\n\t\t};\r\n\t}\r\n\r\n\tprocess(section) {\r\n\r\n\t\treturn section.load(this.request)\r\n\t\t\t.then(function(contents) {\r\n\t\t\t\tvar completed = new defer();\r\n\t\t\t\tvar locations = this.parse(contents, section.cfiBase);\r\n\t\t\t\tthis._locations = this._locations.concat(locations);\r\n\r\n\t\t\t\tsection.unload();\r\n\r\n\t\t\t\tthis.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\r\n\t\t\t\treturn completed.promise;\r\n\t\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\tparse(contents, cfiBase, chars) {\r\n\t\tvar locations = [];\r\n\t\tvar range;\r\n\t\tvar doc = contents.ownerDocument;\r\n\t\tvar body = qs(doc, \"body\");\r\n\t\tvar counter = 0;\r\n\t\tvar prev;\r\n\t\tvar _break = chars || this.break;\r\n\t\tvar parser = function(node) {\r\n\t\t\tvar len = node.length;\r\n\t\t\tvar dist;\r\n\t\t\tvar pos = 0;\r\n\r\n\t\t\tif (node.textContent.trim().length === 0) {\r\n\t\t\t\treturn false; // continue\r\n\t\t\t}\r\n\r\n\t\t\t// Start range\r\n\t\t\tif (counter == 0) {\r\n\t\t\t\trange = this.createRange();\r\n\t\t\t\trange.startContainer = node;\r\n\t\t\t\trange.startOffset = 0;\r\n\t\t\t}\r\n\r\n\t\t\tdist = _break - counter;\r\n\r\n\t\t\t// Node is smaller than a break,\r\n\t\t\t// skip over it\r\n\t\t\tif(dist > len){\r\n\t\t\t\tcounter += len;\r\n\t\t\t\tpos = len;\r\n\t\t\t}\r\n\r\n\r\n\t\t\twhile (pos < len) {\r\n\t\t\t\tdist = _break - counter;\r\n\r\n\t\t\t\tif (counter === 0) {\r\n\t\t\t\t\t// Start new range\r\n\t\t\t\t\tpos += 1;\r\n\t\t\t\t\trange = this.createRange();\r\n\t\t\t\t\trange.startContainer = node;\r\n\t\t\t\t\trange.startOffset = pos;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// pos += dist;\r\n\r\n\t\t\t\t// Gone over\r\n\t\t\t\tif(pos + dist >= len){\r\n\t\t\t\t\t// Continue counter for next node\r\n\t\t\t\t\tcounter += len - pos;\r\n\t\t\t\t\t// break\r\n\t\t\t\t\tpos = len;\r\n\t\t\t\t// At End\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Advance pos\r\n\t\t\t\t\tpos += dist;\r\n\r\n\t\t\t\t\t// End the previous range\r\n\t\t\t\t\trange.endContainer = node;\r\n\t\t\t\t\trange.endOffset = pos;\r\n\t\t\t\t\t// cfi = section.cfiFromRange(range);\r\n\t\t\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\r\n\t\t\t\t\tlocations.push(cfi);\r\n\t\t\t\t\tcounter = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprev = node;\r\n\t\t};\r\n\r\n\t\tsprint(body, parser.bind(this));\r\n\r\n\t\t// Close remaining\r\n\t\tif (range && range.startContainer && prev) {\r\n\t\t\trange.endContainer = prev;\r\n\t\t\trange.endOffset = prev.length;\r\n\t\t\tlet cfi = new EpubCFI(range, cfiBase).toString();\r\n\t\t\tlocations.push(cfi);\r\n\t\t\tcounter = 0;\r\n\t\t}\r\n\t\treturn locations;\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Load all of sections in the book to generate locations\r\n\t * @param  {string} startCfi start position\r\n\t * @param  {int} wordCount how many words to split on\r\n\t * @param  {int} count result count\r\n\t * @return {object} locations\r\n\t */\r\n\tgenerateFromWords(startCfi, wordCount, count) {\r\n\t\tvar start = startCfi ? new EpubCFI(startCfi) : undefined;\r\n\t\tthis.q.pause();\r\n\t\tthis._locationsWords = [];\r\n\t\tthis._wordCounter = 0;\r\n\r\n\t\tthis.spine.each(function(section) {\r\n\t\t\tif (section.linear) {\r\n\t\t\t\tif (start) {\r\n\t\t\t\t\tif (section.index >= start.spinePos) {\r\n\t\t\t\t\t\tthis.q.enqueue(this.processWords.bind(this), section, wordCount, start, count);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.q.enqueue(this.processWords.bind(this), section, wordCount, start, count);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\r\n\t\treturn this.q.run().then(function() {\r\n\t\t\tif (this._currentCfi) {\r\n\t\t\t\tthis.currentLocation = this._currentCfi;\r\n\t\t\t}\r\n\r\n\t\t\treturn this._locationsWords;\r\n\t\t}.bind(this));\r\n\r\n\t}\r\n\r\n\tprocessWords(section, wordCount, startCfi, count) {\r\n\t\tif (count && this._locationsWords.length >= count) {\r\n\t\t\treturn Promise.resolve();\r\n\t\t}\r\n\r\n\t\treturn section.load(this.request)\r\n\t\t\t.then(function(contents) {\r\n\t\t\t\tvar completed = new defer();\r\n\t\t\t\tvar locations = this.parseWords(contents, section, wordCount, startCfi);\r\n\t\t\t\tvar remainingCount = count - this._locationsWords.length;\r\n\t\t\t\tthis._locationsWords = this._locationsWords.concat(locations.length >= count ? locations.slice(0, remainingCount) : locations);\r\n\r\n\t\t\t\tsection.unload();\r\n\r\n\t\t\t\tthis.processingTimeout = setTimeout(() => completed.resolve(locations), this.pause);\r\n\t\t\t\treturn completed.promise;\r\n\t\t\t}.bind(this));\r\n\t}\r\n\r\n\t//http://stackoverflow.com/questions/18679576/counting-words-in-string\r\n\tcountWords(s) {\r\n\t\ts = s.replace(/(^\\s*)|(\\s*$)/gi, \"\");//exclude  start and end white-space\r\n\t\ts = s.replace(/[ ]{2,}/gi, \" \");//2 or more space to 1\r\n\t\ts = s.replace(/\\n /, \"\\n\"); // exclude newline with a start spacing\r\n\t\treturn s.split(\" \").length;\r\n\t}\r\n\r\n\tparseWords(contents, section, wordCount, startCfi) {\r\n\t\tvar cfiBase = section.cfiBase;\r\n\t\tvar locations = [];\r\n\t\tvar doc = contents.ownerDocument;\r\n\t\tvar body = qs(doc, \"body\");\r\n\t\tvar prev;\r\n\t\tvar _break = wordCount;\r\n\t\tvar foundStartNode = startCfi ? startCfi.spinePos !== section.index : true;\r\n\t\tvar startNode;\r\n\t\tif (startCfi && section.index === startCfi.spinePos) {\r\n\t\t\tstartNode = startCfi.findNode(startCfi.range ? startCfi.path.steps.concat(startCfi.start.steps) : startCfi.path.steps, contents.ownerDocument);\r\n\t\t}\r\n\t\tvar parser = function(node) {\r\n\t\t\tif (!foundStartNode) {\r\n\t\t\t\tif (node === startNode) {\r\n\t\t\t\t\tfoundStartNode = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (node.textContent.length < 10) {\r\n\t\t\t\tif (node.textContent.trim().length === 0) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar len  = this.countWords(node.textContent);\r\n\t\t\tvar dist;\r\n\t\t\tvar pos = 0;\r\n\r\n\t\t\tif (len === 0) {\r\n\t\t\t\treturn false; // continue\r\n\t\t\t}\r\n\r\n\t\t\tdist = _break - this._wordCounter;\r\n\r\n\t\t\t// Node is smaller than a break,\r\n\t\t\t// skip over it\r\n\t\t\tif (dist > len) {\r\n\t\t\t\tthis._wordCounter += len;\r\n\t\t\t\tpos = len;\r\n\t\t\t}\r\n\r\n\r\n\t\t\twhile (pos < len) {\r\n\t\t\t\tdist = _break - this._wordCounter;\r\n\r\n\t\t\t\t// Gone over\r\n\t\t\t\tif (pos + dist >= len) {\r\n\t\t\t\t\t// Continue counter for next node\r\n\t\t\t\t\tthis._wordCounter += len - pos;\r\n\t\t\t\t\t// break\r\n\t\t\t\t\tpos = len;\r\n\t\t\t\t\t// At End\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Advance pos\r\n\t\t\t\t\tpos += dist;\r\n\r\n\t\t\t\t\tlet cfi = new EpubCFI(node, cfiBase);\r\n\t\t\t\t\tlocations.push({ cfi: cfi.toString(), wordCount: this._wordCounter });\r\n\t\t\t\t\tthis._wordCounter = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tprev = node;\r\n\t\t};\r\n\r\n\t\tsprint(body, parser.bind(this));\r\n\r\n\t\treturn locations;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a location from an EpubCFI\r\n\t * @param {EpubCFI} cfi\r\n\t * @return {number}\r\n\t */\r\n\tlocationFromCfi(cfi){\r\n\t\tlet loc;\r\n\t\tif (EpubCFI.prototype.isCfiString(cfi)) {\r\n\t\t\tcfi = new EpubCFI(cfi);\r\n\t\t}\r\n\t\t// Check if the location has not been set yet\r\n\t\tif(this._locations.length === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\tloc = locationOf(cfi, this._locations, this.epubcfi.compare);\r\n\r\n\t\tif (loc > this.total) {\r\n\t\t\treturn this.total;\r\n\t\t}\r\n\r\n\t\treturn loc;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a percentage position in locations from an EpubCFI\r\n\t * @param {EpubCFI} cfi\r\n\t * @return {number}\r\n\t */\r\n\tpercentageFromCfi(cfi) {\r\n\t\tif(this._locations.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\t// Find closest cfi\r\n\t\tvar loc = this.locationFromCfi(cfi);\r\n\t\t// Get percentage in total\r\n\t\treturn this.percentageFromLocation(loc);\r\n\t}\r\n\r\n\t/**\r\n\t * Get a percentage position from a location index\r\n\t * @param {number} location\r\n\t * @return {number}\r\n\t */\r\n\tpercentageFromLocation(loc) {\r\n\t\tif (!loc || !this.total) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\treturn (loc / this.total);\r\n\t}\r\n\r\n\t/**\r\n\t * Get an EpubCFI from location index\r\n\t * @param {number} loc\r\n\t * @return {EpubCFI} cfi\r\n\t */\r\n\tcfiFromLocation(loc){\r\n\t\tvar cfi = -1;\r\n\t\t// check that pg is an int\r\n\t\tif(typeof loc != \"number\"){\r\n\t\t\tloc = parseInt(loc);\r\n\t\t}\r\n\r\n\t\tif(loc >= 0 && loc < this._locations.length) {\r\n\t\t\tcfi = this._locations[loc];\r\n\t\t}\r\n\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\t/**\r\n\t * Get an EpubCFI from location percentage\r\n\t * @param {number} percentage\r\n\t * @return {EpubCFI} cfi\r\n\t */\r\n\tcfiFromPercentage(percentage){\r\n\t\tlet loc;\r\n\t\tif (percentage > 1) {\r\n\t\t\tconsole.warn(\"Normalize cfiFromPercentage value to between 0 - 1\");\r\n\t\t}\r\n\r\n\t\t// Make sure 1 goes to very end\r\n\t\tif (percentage >= 1) {\r\n\t\t\tlet cfi = new EpubCFI(this._locations[this.total]);\r\n\t\t\tcfi.collapse();\r\n\t\t\treturn cfi.toString();\r\n\t\t}\r\n\r\n\t\tloc = Math.ceil(this.total * percentage);\r\n\t\treturn this.cfiFromLocation(loc);\r\n\t}\r\n\r\n\t/**\r\n\t * Load locations from JSON\r\n\t * @param {json} locations\r\n\t */\r\n\tload(locations){\r\n\t\tif (typeof locations === \"string\") {\r\n\t\t\tthis._locations = JSON.parse(locations);\r\n\t\t} else {\r\n\t\t\tthis._locations = locations;\r\n\t\t}\r\n\t\tthis.total = this._locations.length - 1;\r\n\t\treturn this._locations;\r\n\t}\r\n\r\n\t/**\r\n\t * Save locations to JSON\r\n\t * @return {json}\r\n\t */\r\n\tsave(){\r\n\t\treturn JSON.stringify(this._locations);\r\n\t}\r\n\r\n\tgetCurrent(){\r\n\t\treturn this._current;\r\n\t}\r\n\r\n\tsetCurrent(curr){\r\n\t\tvar loc;\r\n\r\n\t\tif(typeof curr == \"string\"){\r\n\t\t\tthis._currentCfi = curr;\r\n\t\t} else if (typeof curr == \"number\") {\r\n\t\t\tthis._current = curr;\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(this._locations.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(typeof curr == \"string\"){\r\n\t\t\tloc = this.locationFromCfi(curr);\r\n\t\t\tthis._current = loc;\r\n\t\t} else {\r\n\t\t\tloc = curr;\r\n\t\t}\r\n\r\n\t\tthis.emit(EVENTS.LOCATIONS.CHANGED, {\r\n\t\t\tpercentage: this.percentageFromLocation(loc)\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current location\r\n\t */\r\n\tget currentLocation() {\r\n\t\treturn this._current;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the current location\r\n\t */\r\n\tset currentLocation(curr) {\r\n\t\tthis.setCurrent(curr);\r\n\t}\r\n\r\n\t/**\r\n\t * Locations length\r\n\t */\r\n\tlength () {\r\n\t\treturn this._locations.length;\r\n\t}\r\n\r\n\tdestroy () {\r\n\t\tthis.spine = undefined;\r\n\t\tthis.request = undefined;\r\n\t\tthis.pause = undefined;\r\n\r\n\t\tthis.q.stop();\r\n\t\tthis.q = undefined;\r\n\t\tthis.epubcfi = undefined;\r\n\r\n\t\tthis._locations = undefined\r\n\t\tthis.total = undefined;\r\n\r\n\t\tthis.break = undefined;\r\n\t\tthis._current = undefined;\r\n\r\n\t\tthis.currentLocation = undefined;\r\n\t\tthis._currentCfi = undefined;\r\n\t\tclearTimeout(this.processingTimeout);\r\n\t}\r\n}\r\n\r\nEventEmitter(Locations.prototype);\r\n\r\nexport default Locations;\r\n","import path from \"path-webpack\";\r\nimport {qs} from \"./utils/core\";\r\n\r\n/**\r\n * Handles Parsing and Accessing an Epub Container\r\n * @class\r\n * @param {document} [containerDocument] xml document\r\n */\r\nclass Container {\r\n\tconstructor(containerDocument) {\r\n\t\tthis.packagePath = '';\r\n\t\tthis.directory = '';\r\n\t\tthis.encoding = '';\r\n\r\n\t\tif (containerDocument) {\r\n\t\t\tthis.parse(containerDocument);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse the Container XML\r\n\t * @param  {document} containerDocument\r\n\t */\r\n\tparse(containerDocument){\r\n\t\t//-- <rootfile full-path=\"OPS/package.opf\" media-type=\"application/oebps-package+xml\"/>\r\n\t\tvar rootfile;\r\n\r\n\t\tif(!containerDocument) {\r\n\t\t\tthrow new Error(\"Container File Not Found\");\r\n\t\t}\r\n\r\n\t\trootfile = qs(containerDocument, \"rootfile\");\r\n\r\n\t\tif(!rootfile) {\r\n\t\t\tthrow new Error(\"No RootFile Found\");\r\n\t\t}\r\n\r\n\t\tthis.packagePath = rootfile.getAttribute(\"full-path\");\r\n\t\tthis.directory = path.dirname(this.packagePath);\r\n\t\tthis.encoding = containerDocument.xmlEncoding;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.packagePath = undefined;\r\n\t\tthis.directory = undefined;\r\n\t\tthis.encoding = undefined;\r\n\t}\r\n}\r\n\r\nexport default Container;\r\n","import {qs, qsa, qsp, indexOfElementNode} from \"./utils/core\";\r\n\r\n/**\r\n * Open Packaging Format Parser\r\n * @class\r\n * @param {document} packageDocument OPF XML\r\n */\r\nclass Packaging {\r\n\tconstructor(packageDocument) {\r\n\t\tthis.manifest = {};\r\n\t\tthis.navPath = '';\r\n\t\tthis.ncxPath = '';\r\n\t\tthis.coverPath = '';\r\n\t\tthis.spineNodeIndex = 0;\r\n\t\tthis.spine = [];\r\n\t\tthis.metadata = {};\r\n\r\n\t\tif (packageDocument) {\r\n\t\t\tthis.parse(packageDocument);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse OPF XML\r\n\t * @param  {document} packageDocument OPF XML\r\n\t * @return {object} parsed package parts\r\n\t */\r\n\tparse(packageDocument){\r\n\t\tvar metadataNode, manifestNode, spineNode;\r\n\r\n\t\tif(!packageDocument) {\r\n\t\t\tthrow new Error(\"Package File Not Found\");\r\n\t\t}\r\n\r\n\t\tmetadataNode = qs(packageDocument, \"metadata\");\r\n\t\tif(!metadataNode) {\r\n\t\t\tthrow new Error(\"No Metadata Found\");\r\n\t\t}\r\n\r\n\t\tmanifestNode = qs(packageDocument, \"manifest\");\r\n\t\tif(!manifestNode) {\r\n\t\t\tthrow new Error(\"No Manifest Found\");\r\n\t\t}\r\n\r\n\t\tspineNode = qs(packageDocument, \"spine\");\r\n\t\tif(!spineNode) {\r\n\t\t\tthrow new Error(\"No Spine Found\");\r\n\t\t}\r\n\r\n\t\tthis.manifest = this.parseManifest(manifestNode);\r\n\t\tthis.navPath = this.findNavPath(manifestNode);\r\n\t\tthis.ncxPath = this.findNcxPath(manifestNode, spineNode);\r\n\t\tthis.coverPath = this.findCoverPath(packageDocument);\r\n\r\n\t\tthis.spineNodeIndex = indexOfElementNode(spineNode);\r\n\r\n\t\tthis.spine = this.parseSpine(spineNode, this.manifest);\r\n\r\n\t\tthis.uniqueIdentifier = this.findUniqueIdentifier(packageDocument);\r\n\t\tthis.metadata = this.parseMetadata(metadataNode);\r\n\r\n\t\tthis.metadata.direction = spineNode.getAttribute(\"page-progression-direction\");\r\n\r\n\t\treturn {\r\n\t\t\t\"metadata\" : this.metadata,\r\n\t\t\t\"spine\"    : this.spine,\r\n\t\t\t\"manifest\" : this.manifest,\r\n\t\t\t\"navPath\"  : this.navPath,\r\n\t\t\t\"ncxPath\"  : this.ncxPath,\r\n\t\t\t\"coverPath\": this.coverPath,\r\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Parse Metadata\r\n\t * @private\r\n\t * @param  {node} xml\r\n\t * @return {object} metadata\r\n\t */\r\n\tparseMetadata(xml){\r\n\t\tvar metadata = {};\r\n\r\n\t\tmetadata.title = this.getElementText(xml, \"title\");\r\n\t\tmetadata.creator = this.getElementText(xml, \"creator\");\r\n\t\tmetadata.description = this.getElementText(xml, \"description\");\r\n\r\n\t\tmetadata.pubdate = this.getElementText(xml, \"date\");\r\n\r\n\t\tmetadata.publisher = this.getElementText(xml, \"publisher\");\r\n\r\n\t\tmetadata.identifier = this.getElementText(xml, \"identifier\");\r\n\t\tmetadata.language = this.getElementText(xml, \"language\");\r\n\t\tmetadata.rights = this.getElementText(xml, \"rights\");\r\n\r\n\t\tmetadata.modified_date = this.getPropertyText(xml, \"dcterms:modified\");\r\n\r\n\t\tmetadata.layout = this.getPropertyText(xml, \"rendition:layout\");\r\n\t\tmetadata.orientation = this.getPropertyText(xml, \"rendition:orientation\");\r\n\t\tmetadata.flow = this.getPropertyText(xml, \"rendition:flow\");\r\n\t\tmetadata.viewport = this.getPropertyText(xml, \"rendition:viewport\");\r\n\t\tmetadata.media_active_class = this.getPropertyText(xml, \"media:active-class\");\r\n\t\tmetadata.spread = this.getPropertyText(xml, \"rendition:spread\");\r\n\t\t// metadata.page_prog_dir = packageXml.querySelector(\"spine\").getAttribute(\"page-progression-direction\");\r\n\r\n\t\treturn metadata;\r\n\t}\r\n\r\n\t/**\r\n\t * Parse Manifest\r\n\t * @private\r\n\t * @param  {node} manifestXml\r\n\t * @return {object} manifest\r\n\t */\r\n\tparseManifest(manifestXml){\r\n\t\tvar manifest = {};\r\n\r\n\t\t//-- Turn items into an array\r\n\t\t// var selected = manifestXml.querySelectorAll(\"item\");\r\n\t\tvar selected = qsa(manifestXml, \"item\");\r\n\t\tvar items = Array.prototype.slice.call(selected);\r\n\r\n\t\t//-- Create an object with the id as key\r\n\t\titems.forEach(function(item){\r\n\t\t\tvar id = item.getAttribute(\"id\"),\r\n\t\t\t\t\thref = item.getAttribute(\"href\") || \"\",\r\n\t\t\t\t\ttype = item.getAttribute(\"media-type\") || \"\",\r\n\t\t\t\t\toverlay = item.getAttribute(\"media-overlay\") || \"\",\r\n\t\t\t\t\tproperties = item.getAttribute(\"properties\") || \"\";\r\n\r\n\t\t\tmanifest[id] = {\r\n\t\t\t\t\"href\" : href,\r\n\t\t\t\t// \"url\" : href,\r\n\t\t\t\t\"type\" : type,\r\n\t\t\t\t\"overlay\" : overlay,\r\n\t\t\t\t\"properties\" : properties.length ? properties.split(\" \") : []\r\n\t\t\t};\r\n\r\n\t\t});\r\n\r\n\t\treturn manifest;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Parse Spine\r\n\t * @private\r\n\t * @param  {node} spineXml\r\n\t * @param  {Packaging.manifest} manifest\r\n\t * @return {object} spine\r\n\t */\r\n\tparseSpine(spineXml, manifest){\r\n\t\tvar spine = [];\r\n\r\n\t\tvar selected = qsa(spineXml, \"itemref\");\r\n\t\tvar items = Array.prototype.slice.call(selected);\r\n\r\n\t\t// var epubcfi = new EpubCFI();\r\n\r\n\t\t//-- Add to array to mantain ordering and cross reference with manifest\r\n\t\titems.forEach(function(item, index){\r\n\t\t\tvar idref = item.getAttribute(\"idref\");\r\n\t\t\t// var cfiBase = epubcfi.generateChapterComponent(spineNodeIndex, index, Id);\r\n\t\t\tvar props = item.getAttribute(\"properties\") || \"\";\r\n\t\t\tvar propArray = props.length ? props.split(\" \") : [];\r\n\t\t\t// var manifestProps = manifest[Id].properties;\r\n\t\t\t// var manifestPropArray = manifestProps.length ? manifestProps.split(\" \") : [];\r\n\r\n\t\t\tvar itemref = {\r\n\t\t\t\t\"idref\" : idref,\r\n\t\t\t\t\"linear\" : item.getAttribute(\"linear\") || \"yes\",\r\n\t\t\t\t\"properties\" : propArray,\r\n\t\t\t\t// \"href\" : manifest[Id].href,\r\n\t\t\t\t// \"url\" :  manifest[Id].url,\r\n\t\t\t\t\"index\" : index\r\n\t\t\t\t// \"cfiBase\" : cfiBase\r\n\t\t\t};\r\n\t\t\tspine.push(itemref);\r\n\t\t});\r\n\r\n\t\treturn spine;\r\n\t}\r\n\r\n\t/**\r\n\t * Find Unique Identifier\r\n\t * @private\r\n\t * @param  {node} packageXml\r\n\t * @return {string} Unique Identifier text\r\n\t */\r\n\tfindUniqueIdentifier(packageXml){\r\n\t\tvar uniqueIdentifierId = packageXml.documentElement.getAttribute(\"unique-identifier\");\r\n\t\tif (! uniqueIdentifierId) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\tvar identifier = packageXml.getElementById(uniqueIdentifierId);\r\n\t\tif (! identifier) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\tif (identifier.localName === \"identifier\" && identifier.namespaceURI === \"http://purl.org/dc/elements/1.1/\") {\r\n\t\t\treturn identifier.childNodes.length > 0 ? identifier.childNodes[0].nodeValue.trim() : \"\";\r\n\t\t}\r\n\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Find TOC NAV\r\n\t * @private\r\n\t * @param {element} manifestNode\r\n\t * @return {string}\r\n\t */\r\n\tfindNavPath(manifestNode){\r\n\t\t// Find item with property \"nav\"\r\n\t\t// Should catch nav irregardless of order\r\n\t\t// var node = manifestNode.querySelector(\"item[properties$='nav'], item[properties^='nav '], item[properties*=' nav ']\");\r\n\t\tvar node = qsp(manifestNode, \"item\", {\"properties\":\"nav\"});\r\n\t\treturn node ? node.getAttribute(\"href\") : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Find TOC NCX\r\n\t * media-type=\"application/x-dtbncx+xml\" href=\"toc.ncx\"\r\n\t * @private\r\n\t * @param {element} manifestNode\r\n\t * @param {element} spineNode\r\n\t * @return {string}\r\n\t */\r\n\tfindNcxPath(manifestNode, spineNode){\r\n\t\t// var node = manifestNode.querySelector(\"item[media-type='application/x-dtbncx+xml']\");\r\n\t\tvar node = qsp(manifestNode, \"item\", {\"media-type\":\"application/x-dtbncx+xml\"});\r\n\t\tvar tocId;\r\n\r\n\t\t// If we can't find the toc by media-type then try to look for id of the item in the spine attributes as\r\n\t\t// according to http://www.idpf.org/epub/20/spec/OPF_2.0.1_draft.htm#Section2.4.1.2,\r\n\t\t// \"The item that describes the NCX must be referenced by the spine toc attribute.\"\r\n\t\tif (!node) {\r\n\t\t\ttocId = spineNode.getAttribute(\"toc\");\r\n\t\t\tif(tocId) {\r\n\t\t\t\t// node = manifestNode.querySelector(\"item[id='\" + tocId + \"']\");\r\n\t\t\t\tnode = manifestNode.querySelector(`#${tocId}`);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn node ? node.getAttribute(\"href\") : false;\r\n\t}\r\n\r\n\t/**\r\n\t * Find the Cover Path\r\n\t * <item properties=\"cover-image\" id=\"ci\" href=\"cover.svg\" media-type=\"image/svg+xml\" />\r\n\t * Fallback for Epub 2.0\r\n\t * @private\r\n\t * @param  {node} packageXml\r\n\t * @return {string} href\r\n\t */\r\n\tfindCoverPath(packageXml){\r\n\t\tvar pkg = qs(packageXml, \"package\");\r\n\t\tvar epubVersion = pkg.getAttribute(\"version\");\r\n\t\t\r\n\t\t// Try parsing cover with epub 3.\r\n\t\t// var node = packageXml.querySelector(\"item[properties='cover-image']\");\r\n\t\tvar node = qsp(packageXml, \"item\", {\"properties\":\"cover-image\"});\r\n\t\tif (node) return node.getAttribute(\"href\");\r\n\t\t\r\n\t\t// Fallback to epub 2.\r\n\t\tvar metaCover = qsp(packageXml, \"meta\", {\"name\":\"cover\"});\r\n\r\n\t\tif (metaCover) {\r\n\t\t\tvar coverId = metaCover.getAttribute(\"content\");\r\n\t\t\t// var cover = packageXml.querySelector(\"item[id='\" + coverId + \"']\");\r\n\t\t\tvar cover = packageXml.getElementById(coverId);\r\n\t\t\treturn cover ? cover.getAttribute(\"href\") : \"\";\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get text of a namespaced element\r\n\t * @private\r\n\t * @param  {node} xml\r\n\t * @param  {string} tag\r\n\t * @return {string} text\r\n\t */\r\n\tgetElementText(xml, tag){\r\n\t\tvar found = xml.getElementsByTagNameNS(\"http://purl.org/dc/elements/1.1/\", tag);\r\n\t\tvar el;\r\n\r\n\t\tif(!found || found.length === 0) return \"\";\r\n\r\n\t\tel = found[0];\r\n\r\n\t\tif(el.childNodes.length){\r\n\t\t\treturn el.childNodes[0].nodeValue;\r\n\t\t}\r\n\r\n\t\treturn \"\";\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get text by property\r\n\t * @private\r\n\t * @param  {node} xml\r\n\t * @param  {string} property\r\n\t * @return {string} text\r\n\t */\r\n\tgetPropertyText(xml, property){\r\n\t\tvar el = qsp(xml, \"meta\", {\"property\":property});\r\n\r\n\t\tif(el && el.childNodes.length){\r\n\t\t\treturn el.childNodes[0].nodeValue;\r\n\t\t}\r\n\r\n\t\treturn \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * Load JSON Manifest\r\n\t * @param  {document} packageDocument OPF XML\r\n\t * @return {object} parsed package parts\r\n\t */\r\n\tload(json) {\r\n\t\tthis.metadata = json.metadata;\r\n\r\n\t\tlet spine = json.readingOrder || json.spine;\r\n\t\tthis.spine = spine.map((item, index) =>{\r\n\t\t\t\titem.index = index;\r\n\t\t\titem.linear = item.linear || \"yes\";\r\n\t\t\treturn item;\r\n\t\t});\r\n\r\n\t\tjson.resources.forEach((item, index) => {\r\n\t\t\tthis.manifest[index] = item;\r\n\r\n\t\t\tif (item.rel && item.rel[0] === \"cover\") {\r\n\t\t\t\tthis.coverPath = item.href;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.spineNodeIndex = 0;\r\n\r\n\t\tthis.toc = json.toc.map((item, index) =>{\r\n\t\t\titem.label = item.title;\r\n\t\t\treturn item;\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\t\"metadata\" : this.metadata,\r\n\t\t\t\"spine\"    : this.spine,\r\n\t\t\t\"manifest\" : this.manifest,\r\n\t\t\t\"navPath\"  : this.navPath,\r\n\t\t\t\"ncxPath\"  : this.ncxPath,\r\n\t\t\t\"coverPath\": this.coverPath,\r\n\t\t\t\"spineNodeIndex\" : this.spineNodeIndex,\r\n\t\t\t\"toc\" : this.toc\r\n\t\t};\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.manifest = undefined;\r\n\t\tthis.navPath = undefined;\r\n\t\tthis.ncxPath = undefined;\r\n\t\tthis.coverPath = undefined;\r\n\t\tthis.spineNodeIndex = undefined;\r\n\t\tthis.spine = undefined;\r\n\t\tthis.metadata = undefined;\r\n\t}\r\n}\r\n\r\nexport default Packaging;\r\n","import { qs, qsa, querySelectorByType, filterChildren, getParentByTagName } from \"./utils/core\";\r\n\r\n/**\r\n * Navigation Parser\r\n * @param {document} xml navigation html / xhtml / ncx\r\n */\r\nclass Navigation {\r\n\tconstructor(xml) {\r\n\t\tthis.toc = [];\r\n\t\tthis.tocByHref = {};\r\n\t\tthis.tocById = {};\r\n\r\n\t\tthis.landmarks = [];\r\n\t\tthis.landmarksByType = {};\r\n\r\n\t\tthis.length = 0;\r\n\t\tif (xml) {\r\n\t\t\tthis.parse(xml);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse out the navigation items\r\n\t * @param {document} xml navigation html / xhtml / ncx\r\n\t */\r\n\tparse(xml) {\r\n\t\tlet isXml = xml.nodeType;\r\n\t\tlet html;\r\n\t\tlet ncx;\r\n\r\n\t\tif (isXml) {\r\n\t\t\thtml = qs(xml, \"html\");\r\n\t\t\tncx = qs(xml, \"ncx\");\r\n\t\t}\r\n\r\n\t\tif (!isXml) {\r\n\t\t\tthis.toc = this.load(xml);\r\n\t\t} else if (html) {\r\n\t\t\tthis.toc = this.parseNav(xml);\r\n\t\t\tthis.landmarks = this.parseLandmarks(xml);\r\n\t\t} else if (ncx) {\r\n\t\t\tthis.toc = this.parseNcx(xml);\r\n\t\t}\r\n\r\n\t\tthis.length = 0;\r\n\r\n\t\tthis.unpack(this.toc);\r\n\t}\r\n\r\n\t/**\r\n\t * Unpack navigation items\r\n\t * @private\r\n\t * @param  {array} toc\r\n\t */\r\n\tunpack(toc) {\r\n\r\n\t\tvar item;\r\n\r\n\t\tfor (var i = 0; i < toc.length; i++) {\r\n\t\t\titem = toc[i];\r\n\r\n\t\t\tif (item.href) {\r\n\t\t\t\tthis.tocByHref[item.href] = i;\r\n\t\t\t}\r\n\r\n\t\t\tif (item.id) {\r\n\t\t\t\tthis.tocById[item.id] = i;\r\n\t\t\t}\r\n\r\n\t\t\tthis.length++;\r\n\r\n\t\t\tif (item.subitems.length) {\r\n\t\t\t\tthis.unpack(item.subitems);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get an item from the navigation\r\n\t * @param  {string} target\r\n\t * @return {object} navItem\r\n\t */\r\n\tget(target) {\r\n\r\n\t\tvar index;\r\n\r\n\t\tif (!target) {\r\n\t\t\treturn this.toc;\r\n\t\t}\r\n\r\n\t\tif (target.indexOf(\"#\") === 0) {\r\n\t\t\tindex = this.tocById[target.substring(1)];\r\n\t\t} else if (target in this.tocByHref) {\r\n\t\t\tindex = this.tocByHref[target];\r\n\t\t}\r\n\t\tif (!index) {\r\n\t\t\tfor (let item in this.tocByHref) {\r\n\r\n\t\t\t\tif (target == item.substring(item.indexOf(\"#\"), 0)) {\r\n\t\t\t\t\tindex = this.tocByHref[item];\r\n\t\t\t\t\ttarget = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\r\n\t\treturn this.getByIndex(target, index, this.toc);\r\n\t}\r\n\r\n\t/**\r\n\t * Get an item from navigation subitems recursively by index\r\n\t * @param  {string} target\r\n\t * @param  {number} index\r\n\t * @param  {array} navItems\r\n\t * @return {object} navItem\r\n\t */\r\n\tgetByIndex(target, index, navItems) {\r\n\r\n\t\tif (navItems.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst item = navItems[index];\r\n\t\tif (item && (target === item.id || target === item.href)) {\r\n\t\t\treturn item;\r\n\t\t} else {\r\n\t\t\tlet result;\r\n\t\t\tfor (let i = 0; i < navItems.length; ++i) {\r\n\t\t\t\tresult = this.getByIndex(target, index, navItems[i].subitems);\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get a landmark by type\r\n\t * List of types: https://idpf.github.io/epub-vocabs/structure/\r\n\t * @param  {string} type\r\n\t * @return {object} landmarkItem\r\n\t */\r\n\tlandmark(type) {\r\n\t\tvar index;\r\n\r\n\t\tif (!type) {\r\n\t\t\treturn this.landmarks;\r\n\t\t}\r\n\r\n\t\tindex = this.landmarksByType[type];\r\n\r\n\t\treturn this.landmarks[index];\r\n\t}\r\n\r\n\t/**\r\n\t * Parse toc from a Epub > 3.0 Nav\r\n\t * @private\r\n\t * @param  {document} navHtml\r\n\t * @return {array} navigation list\r\n\t */\r\n\tparseNav(navHtml) {\r\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"toc\");\r\n\t\tvar list = [];\r\n\r\n\t\tif (!navElement) return list;\r\n\r\n\t\tlet navList = filterChildren(navElement, \"ol\", true);\r\n\t\tif (!navList) return list;\r\n\r\n\t\tlist = this.parseNavList(navList);\r\n\t\treturn list;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses lists in the toc\r\n\t * @param  {document} navListHtml\r\n\t * @param  {string} parent id\r\n\t * @return {array} navigation list\r\n\t */\r\n\tparseNavList(navListHtml, parent) {\r\n\t\tconst result = [];\r\n\r\n\t\tif (!navListHtml) return result;\r\n\t\tif (!navListHtml.children) return result;\r\n\r\n\t\tfor (let i = 0; i < navListHtml.children.length; i++) {\r\n\t\t\tconst item = this.navItem(navListHtml.children[i], parent);\r\n\r\n\t\t\tif (item) {\r\n\t\t\t\tresult.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a navItem\r\n\t * @private\r\n\t * @param  {element} item\r\n\t * @return {object} navItem\r\n\t */\r\n\tnavItem(item, parent) {\r\n\t\tlet id = item.getAttribute(\"id\") || undefined;\r\n\t\tlet content = filterChildren(item, \"a\", true);\r\n\r\n\t\tif (!content) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet src = content.getAttribute(\"href\") || \"\";\r\n\r\n\t\tif (!id) {\r\n\t\t\tid = src;\r\n\t\t}\r\n\t\tlet text = content.textContent || \"\";\r\n\r\n\t\tlet subitems = [];\r\n\t\tlet nested = filterChildren(item, \"ol\", true);\r\n\t\tif (nested) {\r\n\t\t\tsubitems = this.parseNavList(nested, id);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t\"id\": id,\r\n\t\t\t\"href\": src,\r\n\t\t\t\"label\": text,\r\n\t\t\t\"subitems\": subitems,\r\n\t\t\t\"parent\": parent\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Parse landmarks from a Epub > 3.0 Nav\r\n\t * @private\r\n\t * @param  {document} navHtml\r\n\t * @return {array} landmarks list\r\n\t */\r\n\tparseLandmarks(navHtml) {\r\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"landmarks\");\r\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\r\n\t\tvar length = navItems.length;\r\n\t\tvar i;\r\n\t\tvar list = [];\r\n\t\tvar item;\r\n\r\n\t\tif (!navItems || length === 0) return list;\r\n\r\n\t\tfor (i = 0; i < length; ++i) {\r\n\t\t\titem = this.landmarkItem(navItems[i]);\r\n\t\t\tif (item) {\r\n\t\t\t\tlist.push(item);\r\n\t\t\t\tthis.landmarksByType[item.type] = i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a landmarkItem\r\n\t * @private\r\n\t * @param  {element} item\r\n\t * @return {object} landmarkItem\r\n\t */\r\n\tlandmarkItem(item) {\r\n\t\tlet content = filterChildren(item, \"a\", true);\r\n\r\n\t\tif (!content) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet type = content.getAttributeNS(\"http://www.idpf.org/2007/ops\", \"type\") || undefined;\r\n\t\tlet href = content.getAttribute(\"href\") || \"\";\r\n\t\tlet text = content.textContent || \"\";\r\n\r\n\t\treturn {\r\n\t\t\t\"href\": href,\r\n\t\t\t\"label\": text,\r\n\t\t\t\"type\": type\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Parse from a Epub > 3.0 NC\r\n\t * @private\r\n\t * @param  {document} navHtml\r\n\t * @return {array} navigation list\r\n\t */\r\n\tparseNcx(tocXml) {\r\n\t\tvar navPoints = qsa(tocXml, \"navPoint\");\r\n\t\tvar length = navPoints.length;\r\n\t\tvar i;\r\n\t\tvar toc = {};\r\n\t\tvar list = [];\r\n\t\tvar item, parent;\r\n\r\n\t\tif (!navPoints || length === 0) return list;\r\n\r\n\t\tfor (i = 0; i < length; ++i) {\r\n\r\n\t\t\titem = this.ncxItem(navPoints[i]);\r\n\t\t\ttoc[item.id] = item;\r\n\t\t\tif (!item.parent) {\r\n\t\t\t\tlist.push(item);\r\n\t\t\t} else {\r\n\t\t\t\tparent = toc[item.parent];\r\n\t\t\t\tparent.subitems.push(item);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\t}\r\n\r\n\t/**\r\n\t * Create a ncxItem\r\n\t * @private\r\n\t * @param  {element} item\r\n\t * @return {object} ncxItem\r\n\t */\r\n\tncxItem(item) {\r\n\r\n\t\tvar id = item.getAttribute(\"id\") || false,\r\n\t\t\tcontent = qs(item, \"content\"),\r\n\t\t\tsrc = content.getAttribute(\"src\"),\r\n\t\t\tnavLabel = qs(item, \"navLabel\"),\r\n\t\t\ttext = navLabel.textContent ? navLabel.textContent : \"\",\r\n\t\t\tsubitems = [],\r\n\t\t\tparentNode = item.parentNode,\r\n\t\t\tparent;\r\n\r\n\t\tif (parentNode && (parentNode.nodeName === \"navPoint\" || parentNode.nodeName.split(':').slice(-1)[0] === \"navPoint\")) {\r\n\t\t\tparent = parentNode.getAttribute(\"id\");\r\n\t\t}\r\n\r\n\r\n\t\treturn {\r\n\t\t\t\"id\": id,\r\n\t\t\t\"href\": src,\r\n\t\t\t\"label\": text,\r\n\t\t\t\"subitems\": subitems,\r\n\t\t\t\"parent\": parent\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Load Spine Items\r\n\t * @param  {object} json the items to be loaded\r\n\t * @return {Array} navItems\r\n\t */\r\n\tload(json) {\r\n\t\treturn json.map(item => {\r\n\t\t\titem.label = item.title;\r\n\t\t\titem.subitems = item.children ? this.load(item.children) : [];\r\n\t\t\treturn item;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * forEach pass through\r\n\t * @param  {Function} fn function to run on each item\r\n\t * @return {method} forEach loop\r\n\t */\r\n\tforEach(fn) {\r\n\t\treturn this.toc.forEach(fn);\r\n\t}\r\n}\r\n\r\nexport default Navigation;\r\n","/*\r\n From Zip.js, by Gildas Lormeau\r\nedited down\r\n */\r\n\r\nvar table = {\r\n\t\"application\" : {\r\n\t\t\"ecmascript\" : [ \"es\", \"ecma\" ],\r\n\t\t\"javascript\" : \"js\",\r\n\t\t\"ogg\" : \"ogx\",\r\n\t\t\"pdf\" : \"pdf\",\r\n\t\t\"postscript\" : [ \"ps\", \"ai\", \"eps\", \"epsi\", \"epsf\", \"eps2\", \"eps3\" ],\r\n\t\t\"rdf+xml\" : \"rdf\",\r\n\t\t\"smil\" : [ \"smi\", \"smil\" ],\r\n\t\t\"xhtml+xml\" : [ \"xhtml\", \"xht\" ],\r\n\t\t\"xml\" : [ \"xml\", \"xsl\", \"xsd\", \"opf\", \"ncx\" ],\r\n\t\t\"zip\" : \"zip\",\r\n\t\t\"x-httpd-eruby\" : \"rhtml\",\r\n\t\t\"x-latex\" : \"latex\",\r\n\t\t\"x-maker\" : [ \"frm\", \"maker\", \"frame\", \"fm\", \"fb\", \"book\", \"fbdoc\" ],\r\n\t\t\"x-object\" : \"o\",\r\n\t\t\"x-shockwave-flash\" : [ \"swf\", \"swfl\" ],\r\n\t\t\"x-silverlight\" : \"scr\",\r\n\t\t\"epub+zip\" : \"epub\",\r\n\t\t\"font-tdpfr\" : \"pfr\",\r\n\t\t\"inkml+xml\" : [ \"ink\", \"inkml\" ],\r\n\t\t\"json\" : \"json\",\r\n\t\t\"jsonml+json\" : \"jsonml\",\r\n\t\t\"mathml+xml\" : \"mathml\",\r\n\t\t\"metalink+xml\" : \"metalink\",\r\n\t\t\"mp4\" : \"mp4s\",\r\n\t\t// \"oebps-package+xml\" : \"opf\",\r\n\t\t\"omdoc+xml\" : \"omdoc\",\r\n\t\t\"oxps\" : \"oxps\",\r\n\t\t\"vnd.amazon.ebook\" : \"azw\",\r\n\t\t\"widget\" : \"wgt\",\r\n\t\t// \"x-dtbncx+xml\" : \"ncx\",\r\n\t\t\"x-dtbook+xml\" : \"dtb\",\r\n\t\t\"x-dtbresource+xml\" : \"res\",\r\n\t\t\"x-font-bdf\" : \"bdf\",\r\n\t\t\"x-font-ghostscript\" : \"gsf\",\r\n\t\t\"x-font-linux-psf\" : \"psf\",\r\n\t\t\"x-font-otf\" : \"otf\",\r\n\t\t\"x-font-pcf\" : \"pcf\",\r\n\t\t\"x-font-snf\" : \"snf\",\r\n\t\t\"x-font-ttf\" : [ \"ttf\", \"ttc\" ],\r\n\t\t\"x-font-type1\" : [ \"pfa\", \"pfb\", \"pfm\", \"afm\" ],\r\n\t\t\"x-font-woff\" : \"woff\",\r\n\t\t\"x-mobipocket-ebook\" : [ \"prc\", \"mobi\" ],\r\n\t\t\"x-mspublisher\" : \"pub\",\r\n\t\t\"x-nzb\" : \"nzb\",\r\n\t\t\"x-tgif\" : \"obj\",\r\n\t\t\"xaml+xml\" : \"xaml\",\r\n\t\t\"xml-dtd\" : \"dtd\",\r\n\t\t\"xproc+xml\" : \"xpl\",\r\n\t\t\"xslt+xml\" : \"xslt\",\r\n\t\t\"internet-property-stream\" : \"acx\",\r\n\t\t\"x-compress\" : \"z\",\r\n\t\t\"x-compressed\" : \"tgz\",\r\n\t\t\"x-gzip\" : \"gz\",\r\n\t},\r\n\t\"audio\" : {\r\n\t\t\"flac\" : \"flac\",\r\n\t\t\"midi\" : [ \"mid\", \"midi\", \"kar\", \"rmi\" ],\r\n\t\t\"mpeg\" : [ \"mpga\", \"mpega\", \"mp2\", \"mp3\", \"m4a\", \"mp2a\", \"m2a\", \"m3a\" ],\r\n\t\t\"mpegurl\" : \"m3u\",\r\n\t\t\"ogg\" : [ \"oga\", \"ogg\", \"spx\" ],\r\n\t\t\"x-aiff\" : [ \"aif\", \"aiff\", \"aifc\" ],\r\n\t\t\"x-ms-wma\" : \"wma\",\r\n\t\t\"x-wav\" : \"wav\",\r\n\t\t\"adpcm\" : \"adp\",\r\n\t\t\"mp4\" : \"mp4a\",\r\n\t\t\"webm\" : \"weba\",\r\n\t\t\"x-aac\" : \"aac\",\r\n\t\t\"x-caf\" : \"caf\",\r\n\t\t\"x-matroska\" : \"mka\",\r\n\t\t\"x-pn-realaudio-plugin\" : \"rmp\",\r\n\t\t\"xm\" : \"xm\",\r\n\t\t\"mid\" : [ \"mid\", \"rmi\" ]\r\n\t},\r\n\t\"image\" : {\r\n\t\t\"gif\" : \"gif\",\r\n\t\t\"ief\" : \"ief\",\r\n\t\t\"jpeg\" : [ \"jpeg\", \"jpg\", \"jpe\" ],\r\n\t\t\"pcx\" : \"pcx\",\r\n\t\t\"png\" : \"png\",\r\n\t\t\"svg+xml\" : [ \"svg\", \"svgz\" ],\r\n\t\t\"tiff\" : [ \"tiff\", \"tif\" ],\r\n\t\t\"x-icon\" : \"ico\",\r\n\t\t\"bmp\" : \"bmp\",\r\n\t\t\"webp\" : \"webp\",\r\n\t\t\"x-pict\" : [ \"pic\", \"pct\" ],\r\n\t\t\"x-tga\" : \"tga\",\r\n\t\t\"cis-cod\" : \"cod\"\r\n\t},\r\n\t\"text\" : {\r\n\t\t\"cache-manifest\" : [ \"manifest\", \"appcache\" ],\r\n\t\t\"css\" : \"css\",\r\n\t\t\"csv\" : \"csv\",\r\n\t\t\"html\" : [ \"html\", \"htm\", \"shtml\", \"stm\" ],\r\n\t\t\"mathml\" : \"mml\",\r\n\t\t\"plain\" : [ \"txt\", \"text\", \"brf\", \"conf\", \"def\", \"list\", \"log\", \"in\", \"bas\" ],\r\n\t\t\"richtext\" : \"rtx\",\r\n\t\t\"tab-separated-values\" : \"tsv\",\r\n\t\t\"x-bibtex\" : \"bib\"\r\n\t},\r\n\t\"video\" : {\r\n\t\t\"mpeg\" : [ \"mpeg\", \"mpg\", \"mpe\", \"m1v\", \"m2v\", \"mp2\", \"mpa\", \"mpv2\" ],\r\n\t\t\"mp4\" : [ \"mp4\", \"mp4v\", \"mpg4\" ],\r\n\t\t\"quicktime\" : [ \"qt\", \"mov\" ],\r\n\t\t\"ogg\" : \"ogv\",\r\n\t\t\"vnd.mpegurl\" : [ \"mxu\", \"m4u\" ],\r\n\t\t\"x-flv\" : \"flv\",\r\n\t\t\"x-la-asf\" : [ \"lsf\", \"lsx\" ],\r\n\t\t\"x-mng\" : \"mng\",\r\n\t\t\"x-ms-asf\" : [ \"asf\", \"asx\", \"asr\" ],\r\n\t\t\"x-ms-wm\" : \"wm\",\r\n\t\t\"x-ms-wmv\" : \"wmv\",\r\n\t\t\"x-ms-wmx\" : \"wmx\",\r\n\t\t\"x-ms-wvx\" : \"wvx\",\r\n\t\t\"x-msvideo\" : \"avi\",\r\n\t\t\"x-sgi-movie\" : \"movie\",\r\n\t\t\"x-matroska\" : [ \"mpv\", \"mkv\", \"mk3d\", \"mks\" ],\r\n\t\t\"3gpp2\" : \"3g2\",\r\n\t\t\"h261\" : \"h261\",\r\n\t\t\"h263\" : \"h263\",\r\n\t\t\"h264\" : \"h264\",\r\n\t\t\"jpeg\" : \"jpgv\",\r\n\t\t\"jpm\" : [ \"jpm\", \"jpgm\" ],\r\n\t\t\"mj2\" : [ \"mj2\", \"mjp2\" ],\r\n\t\t\"vnd.ms-playready.media.pyv\" : \"pyv\",\r\n\t\t\"vnd.uvvu.mp4\" : [ \"uvu\", \"uvvu\" ],\r\n\t\t\"vnd.vivo\" : \"viv\",\r\n\t\t\"webm\" : \"webm\",\r\n\t\t\"x-f4v\" : \"f4v\",\r\n\t\t\"x-m4v\" : \"m4v\",\r\n\t\t\"x-ms-vob\" : \"vob\",\r\n\t\t\"x-smv\" : \"smv\"\r\n\t}\r\n};\r\n\r\nvar mimeTypes = (function() {\r\n\tvar type, subtype, val, index, mimeTypes = {};\r\n\tfor (type in table) {\r\n\t\tif (table.hasOwnProperty(type)) {\r\n\t\t\tfor (subtype in table[type]) {\r\n\t\t\t\tif (table[type].hasOwnProperty(subtype)) {\r\n\t\t\t\t\tval = table[type][subtype];\r\n\t\t\t\t\tif (typeof val == \"string\") {\r\n\t\t\t\t\t\tmimeTypes[val] = type + \"/\" + subtype;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (index = 0; index < val.length; index++) {\r\n\t\t\t\t\t\t\tmimeTypes[val[index]] = type + \"/\" + subtype;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn mimeTypes;\r\n})();\r\n\r\nvar defaultValue = \"text/plain\";//\"application/octet-stream\";\r\n\r\nfunction lookup(filename) {\r\n\treturn filename && mimeTypes[filename.split(\".\").pop().toLowerCase()] || defaultValue;\r\n};\r\n\r\nexport default { lookup };\r\n","import {substitute} from \"./utils/replacements\";\r\nimport {createBase64Url, createBlobUrl, blob2base64} from \"./utils/core\";\r\nimport Url from \"./utils/url\";\r\nimport mime from \"./utils/mime\";\r\nimport Path from \"./utils/path\";\r\nimport path from \"path-webpack\";\r\n\r\n/**\r\n * Handle Package Resources\r\n * @class\r\n * @param {Manifest} manifest\r\n * @param {object} [options]\r\n * @param {string} [options.replacements=\"base64\"]\r\n * @param {Archive} [options.archive]\r\n * @param {method} [options.resolver]\r\n */\r\nclass Resources {\r\n\tconstructor(manifest, options) {\r\n\t\tthis.settings = {\r\n\t\t\treplacements: (options && options.replacements) || \"base64\",\r\n\t\t\tarchive: (options && options.archive),\r\n\t\t\tresolver: (options && options.resolver),\r\n\t\t\trequest: (options && options.request)\r\n\t\t};\r\n\r\n\t\tthis.process(manifest);\r\n\t}\r\n\r\n\t/**\r\n\t * Process resources\r\n\t * @param {Manifest} manifest\r\n\t */\r\n\tprocess(manifest){\r\n\t\tthis.manifest = manifest;\r\n\t\tthis.resources = Object.keys(manifest).\r\n\t\t\tmap(function (key){\r\n\t\t\t\treturn manifest[key];\r\n\t\t\t});\r\n\r\n\t\tthis.replacementUrls = [];\r\n\r\n\t\tthis.html = [];\r\n\t\tthis.assets = [];\r\n\t\tthis.css = [];\r\n\r\n\t\tthis.urls = [];\r\n\t\tthis.cssUrls = [];\r\n\r\n\t\tthis.split();\r\n\t\tthis.splitUrls();\r\n\t}\r\n\r\n\t/**\r\n\t * Split resources by type\r\n\t * @private\r\n\t */\r\n\tsplit(){\r\n\r\n\t\t// HTML\r\n\t\tthis.html = this.resources.\r\n\t\t\tfilter(function (item){\r\n\t\t\t\tif (item.type === \"application/xhtml+xml\" ||\r\n\t\t\t\t\t\titem.type === \"text/html\") {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t// Exclude HTML\r\n\t\tthis.assets = this.resources.\r\n\t\t\tfilter(function (item){\r\n\t\t\t\tif (item.type !== \"application/xhtml+xml\" &&\r\n\t\t\t\t\t\titem.type !== \"text/html\") {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t// Only CSS\r\n\t\tthis.css = this.resources.\r\n\t\t\tfilter(function (item){\r\n\t\t\t\tif (item.type === \"text/css\") {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Convert split resources into Urls\r\n\t * @private\r\n\t */\r\n\tsplitUrls(){\r\n\r\n\t\t// All Assets Urls\r\n\t\tthis.urls = this.assets.\r\n\t\t\tmap(function(item) {\r\n\t\t\t\treturn item.href;\r\n\t\t\t}.bind(this));\r\n\r\n\t\t// Css Urls\r\n\t\tthis.cssUrls = this.css.map(function(item) {\r\n\t\t\treturn item.href;\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Create a url to a resource\r\n\t * @param {string} url\r\n\t * @return {Promise<string>} Promise resolves with url string\r\n\t */\r\n\tcreateUrl (url) {\r\n\t\tvar parsedUrl = new Url(url);\r\n\t\tvar mimeType = mime.lookup(parsedUrl.filename);\r\n\r\n\t\tif (this.settings.archive) {\r\n\t\t\treturn this.settings.archive.createUrl(url, {\"base64\": (this.settings.replacements === \"base64\")});\r\n\t\t} else {\r\n\t\t\tif (this.settings.replacements === \"base64\") {\r\n\t\t\t\treturn this.settings.request(url, 'blob')\r\n\t\t\t\t\t.then((blob) => {\r\n\t\t\t\t\t\treturn blob2base64(blob);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.then((blob) => {\r\n\t\t\t\t\t\treturn createBase64Url(blob, mimeType);\r\n\t\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn this.settings.request(url, 'blob').then((blob) => {\r\n\t\t\t\t\treturn createBlobUrl(blob, mimeType);\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Create blob urls for all the assets\r\n\t * @return {Promise}         returns replacement urls\r\n\t */\r\n\treplacements(){\r\n\t\tif (this.settings.replacements === \"none\") {\r\n\t\t\treturn new Promise(function(resolve) {\r\n\t\t\t\tresolve(this.urls);\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\r\n\t\tvar replacements = this.urls.map( (url) => {\r\n\t\t\t\tvar absolute = this.settings.resolver(url);\r\n\r\n\t\t\t\treturn this.createUrl(absolute).\r\n\t\t\t\t\tcatch((err) => {\r\n\t\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\treturn Promise.all(replacements)\r\n\t\t\t.then( (replacementUrls) => {\r\n\t\t\t\tthis.replacementUrls = replacementUrls.filter((url) => {\r\n\t\t\t\t\treturn (typeof(url) === \"string\");\r\n\t\t\t\t});\r\n\t\t\t\treturn replacementUrls;\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Replace URLs in CSS resources\r\n\t * @private\r\n\t * @param  {Archive} [archive]\r\n\t * @param  {method} [resolver]\r\n\t * @return {Promise}\r\n\t */\r\n\treplaceCss(archive, resolver){\r\n\t\tvar replaced = [];\r\n\t\tarchive = archive || this.settings.archive;\r\n\t\tresolver = resolver || this.settings.resolver;\r\n\t\tthis.cssUrls.forEach(function(href) {\r\n\t\t\tvar replacement = this.createCssFile(href, archive, resolver)\r\n\t\t\t\t.then(function (replacementUrl) {\r\n\t\t\t\t\t// switch the url in the replacementUrls\r\n\t\t\t\t\tvar indexInUrls = this.urls.indexOf(href);\r\n\t\t\t\t\tif (indexInUrls > -1) {\r\n\t\t\t\t\t\tthis.replacementUrls[indexInUrls] = replacementUrl;\r\n\t\t\t\t\t}\r\n\t\t\t\t}.bind(this))\r\n\r\n\r\n\t\t\treplaced.push(replacement);\r\n\t\t}.bind(this));\r\n\t\treturn Promise.all(replaced);\r\n\t}\r\n\r\n\t/**\r\n\t * Create a new CSS file with the replaced URLs\r\n\t * @private\r\n\t * @param  {string} href the original css file\r\n\t * @return {Promise}  returns a BlobUrl to the new CSS file or a data url\r\n\t */\r\n\tcreateCssFile(href){\r\n\t\tvar newUrl;\r\n\r\n\t\tif (path.isAbsolute(href)) {\r\n\t\t\treturn new Promise(function(resolve){\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar absolute = this.settings.resolver(href);\r\n\r\n\t\t// Get the text of the css file from the archive\r\n\t\tvar textResponse;\r\n\r\n\t\tif (this.settings.archive) {\r\n\t\t\ttextResponse = this.settings.archive.getText(absolute);\r\n\t\t} else {\r\n\t\t\ttextResponse = this.settings.request(absolute, \"text\");\r\n\t\t}\r\n\r\n\t\t// Get asset links relative to css file\r\n\t\tvar relUrls = this.urls.map( (assetHref) => {\r\n\t\t\tvar resolved = this.settings.resolver(assetHref);\r\n\t\t\tvar relative = new Path(absolute).relative(resolved);\r\n\r\n\t\t\treturn relative;\r\n\t\t});\r\n\r\n\t\tif (!textResponse) {\r\n\t\t\t// file not found, don't replace\r\n\t\t\treturn new Promise(function(resolve){\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn textResponse.then( (text) => {\r\n\t\t\t// Replacements in the css text\r\n\t\t\ttext = substitute(text, relUrls, this.replacementUrls);\r\n\r\n\t\t\t// Get the new url\r\n\t\t\tif (this.settings.replacements === \"base64\") {\r\n\t\t\t\tnewUrl = createBase64Url(text, \"text/css\");\r\n\t\t\t} else {\r\n\t\t\t\tnewUrl = createBlobUrl(text, \"text/css\");\r\n\t\t\t}\r\n\r\n\t\t\treturn newUrl;\r\n\t\t}, (err) => {\r\n\t\t\t// handle response errors\r\n\t\t\treturn new Promise(function(resolve){\r\n\t\t\t\tresolve();\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve all resources URLs relative to an absolute URL\r\n\t * @param  {string} absolute to be resolved to\r\n\t * @param  {resolver} [resolver]\r\n\t * @return {string[]} array with relative Urls\r\n\t */\r\n\trelativeTo(absolute, resolver){\r\n\t\tresolver = resolver || this.settings.resolver;\r\n\r\n\t\t// Get Urls relative to current sections\r\n\t\treturn this.urls.\r\n\t\t\tmap(function(href) {\r\n\t\t\t\tvar resolved = resolver(href);\r\n\t\t\t\tvar relative = new Path(absolute).relative(resolved);\r\n\t\t\t\treturn relative;\r\n\t\t\t}.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Get a URL for a resource\r\n\t * @param  {string} path\r\n\t * @return {string} url\r\n\t */\r\n\tget(path) {\r\n\t\tvar indexInUrls = this.urls.indexOf(path);\r\n\t\tif (indexInUrls === -1) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.replacementUrls.length) {\r\n\t\t\treturn new Promise(function(resolve, reject) {\r\n\t\t\t\tresolve(this.replacementUrls[indexInUrls]);\r\n\t\t\t}.bind(this));\r\n\t\t} else {\r\n\t\t\treturn this.createUrl(path);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Substitute urls in content, with replacements,\r\n\t * relative to a url if provided\r\n\t * @param  {string} content\r\n\t * @param  {string} [url]   url to resolve to\r\n\t * @return {string}         content with urls substituted\r\n\t */\r\n\tsubstitute(content, url) {\r\n\t\tvar relUrls;\r\n\t\tif (url) {\r\n\t\t\trelUrls = this.relativeTo(url);\r\n\t\t} else {\r\n\t\t\trelUrls = this.urls;\r\n\t\t}\r\n\t\treturn substitute(content, relUrls, this.replacementUrls);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.settings = undefined;\r\n\t\tthis.manifest = undefined;\r\n\t\tthis.resources = undefined;\r\n\t\tthis.replacementUrls = undefined;\r\n\t\tthis.html = undefined;\r\n\t\tthis.assets = undefined;\r\n\t\tthis.css = undefined;\r\n\r\n\t\tthis.urls = undefined;\r\n\t\tthis.cssUrls = undefined;\r\n\t}\r\n}\r\n\r\nexport default Resources;\r\n","import EpubCFI from \"./epubcfi\";\r\nimport {\r\n\tqs,\r\n\tqsa,\r\n\tquerySelectorByType,\r\n\tindexOfSorted,\r\n\tlocationOf\r\n} from \"./utils/core\";\r\n\r\n/**\r\n * Page List Parser\r\n * @param {document} [xml]\r\n */\r\nclass PageList {\r\n\tconstructor(xml) {\r\n\t\tthis.pages = [];\r\n\t\tthis.locations = [];\r\n\t\tthis.epubcfi = new EpubCFI();\r\n\r\n\t\tthis.firstPage = 0;\r\n\t\tthis.lastPage = 0;\r\n\t\tthis.totalPages = 0;\r\n\r\n\t\tthis.toc = undefined;\r\n\t\tthis.ncx = undefined;\r\n\r\n\t\tif (xml) {\r\n\t\t\tthis.pageList = this.parse(xml);\r\n\t\t}\r\n\r\n\t\tif(this.pageList && this.pageList.length) {\r\n\t\t\tthis.process(this.pageList);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse PageList Xml\r\n\t * @param  {document} xml\r\n\t */\r\n\tparse(xml) {\r\n\t\tvar html = qs(xml, \"html\");\r\n\t\tvar ncx = qs(xml, \"ncx\");\r\n\r\n\t\tif(html) {\r\n\t\t\treturn this.parseNav(xml);\r\n\t\t} else if(ncx){\r\n\t\t\treturn this.parseNcx(xml);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Parse a Nav PageList\r\n\t * @private\r\n\t * @param  {node} navHtml\r\n\t * @return {PageList.item[]} list\r\n\t */\r\n\tparseNav(navHtml){\r\n\t\tvar navElement = querySelectorByType(navHtml, \"nav\", \"page-list\");\r\n\t\tvar navItems = navElement ? qsa(navElement, \"li\") : [];\r\n\t\tvar length = navItems.length;\r\n\t\tvar i;\r\n\t\tvar list = [];\r\n\t\tvar item;\r\n\r\n\t\tif(!navItems || length === 0) return list;\r\n\r\n\t\tfor (i = 0; i < length; ++i) {\r\n\t\t\titem = this.item(navItems[i]);\r\n\t\t\tlist.push(item);\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\t}\r\n\r\n\tparseNcx(navXml) {\r\n\t\tvar list = [];\r\n\t\tvar i = 0;\r\n\t\tvar item;\r\n\t\tvar pageList;\r\n\t\tvar pageTargets;\r\n\t\tvar length = 0;\r\n\r\n\t\tpageList = qs(navXml, \"pageList\");\r\n\t\tif (!pageList) return list;\r\n\r\n\t\tpageTargets = qsa(pageList, \"pageTarget\");\r\n\t\tlength = pageTargets.length;\r\n\r\n\t\tif (!pageTargets || pageTargets.length === 0) {\r\n\t\t\treturn list;\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < length; ++i) {\r\n\t\t\titem = this.ncxItem(pageTargets[i]);\r\n\t\t\tlist.push(item);\r\n\t\t}\r\n\r\n\t\treturn list;\r\n\t}\r\n\r\n\tncxItem(item) {\r\n\t\tvar navLabel = qs(item, \"navLabel\");\r\n\t\tvar navLabelText = qs(navLabel, \"text\");\r\n\t\tvar pageText = navLabelText.textContent;\r\n\t\tvar content = qs(item, \"content\");\r\n\r\n\t\tvar href = content.getAttribute(\"src\");\r\n\t\tvar page = parseInt(pageText, 10);\r\n\r\n\t\treturn {\r\n\t\t\t\"href\": href,\r\n\t\t\t\"page\": page,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Page List Item\r\n\t * @private\r\n\t * @param  {node} item\r\n\t * @return {object} pageListItem\r\n\t */\r\n\titem(item){\r\n\t\tvar content = qs(item, \"a\"),\r\n\t\t\t\thref = content.getAttribute(\"href\") || \"\",\r\n\t\t\t\ttext = content.textContent || \"\",\r\n\t\t\t\tpage = parseInt(text),\r\n\t\t\t\tisCfi = href.indexOf(\"epubcfi\"),\r\n\t\t\t\tsplit,\r\n\t\t\t\tpackageUrl,\r\n\t\t\t\tcfi;\r\n\r\n\t\tif(isCfi != -1) {\r\n\t\t\tsplit = href.split(\"#\");\r\n\t\t\tpackageUrl = split[0];\r\n\t\t\tcfi = split.length > 1 ? split[1] : false;\r\n\t\t\treturn {\r\n\t\t\t\t\"cfi\" : cfi,\r\n\t\t\t\t\"href\" : href,\r\n\t\t\t\t\"packageUrl\" : packageUrl,\r\n\t\t\t\t\"page\" : page\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn {\r\n\t\t\t\t\"href\" : href,\r\n\t\t\t\t\"page\" : page\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Process pageList items\r\n\t * @private\r\n\t * @param  {array} pageList\r\n\t */\r\n\tprocess(pageList){\r\n\t\tpageList.forEach(function(item){\r\n\t\t\tthis.pages.push(item.page);\r\n\t\t\tif (item.cfi) {\r\n\t\t\t\tthis.locations.push(item.cfi);\r\n\t\t\t}\r\n\t\t}, this);\r\n\t\tthis.firstPage = parseInt(this.pages[0]);\r\n\t\tthis.lastPage = parseInt(this.pages[this.pages.length-1]);\r\n\t\tthis.totalPages = this.lastPage - this.firstPage;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a PageList result from a EpubCFI\r\n\t * @param  {string} cfi EpubCFI String\r\n\t * @return {number} page\r\n\t */\r\n\tpageFromCfi(cfi){\r\n\t\tvar pg = -1;\r\n\r\n\t\t// Check if the pageList has not been set yet\r\n\t\tif(this.locations.length === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\r\n\t\t// TODO: check if CFI is valid?\r\n\r\n\t\t// check if the cfi is in the location list\r\n\t\t// var index = this.locations.indexOf(cfi);\r\n\t\tvar index = indexOfSorted(cfi, this.locations, this.epubcfi.compare);\r\n\t\tif(index != -1) {\r\n\t\t\tpg = this.pages[index];\r\n\t\t} else {\r\n\t\t\t// Otherwise add it to the list of locations\r\n\t\t\t// Insert it in the correct position in the locations page\r\n\t\t\t//index = EPUBJS.core.insert(cfi, this.locations, this.epubcfi.compare);\r\n\t\t\tindex = locationOf(cfi, this.locations, this.epubcfi.compare);\r\n\t\t\t// Get the page at the location just before the new one, or return the first\r\n\t\t\tpg = index-1 >= 0 ? this.pages[index-1] : this.pages[0];\r\n\t\t\tif(pg !== undefined) {\r\n\t\t\t\t// Add the new page in so that the locations and page array match up\r\n\t\t\t\t//this.pages.splice(index, 0, pg);\r\n\t\t\t} else {\r\n\t\t\t\tpg = -1;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\treturn pg;\r\n\t}\r\n\r\n\t/**\r\n\t * Get an EpubCFI from a Page List Item\r\n\t * @param  {string | number} pg\r\n\t * @return {string} cfi\r\n\t */\r\n\tcfiFromPage(pg){\r\n\t\tvar cfi = -1;\r\n\t\t// check that pg is an int\r\n\t\tif(typeof pg != \"number\"){\r\n\t\t\tpg = parseInt(pg);\r\n\t\t}\r\n\r\n\t\t// check if the cfi is in the page list\r\n\t\t// Pages could be unsorted.\r\n\t\tvar index = this.pages.indexOf(pg);\r\n\t\tif(index != -1) {\r\n\t\t\tcfi = this.locations[index];\r\n\t\t}\r\n\t\t// TODO: handle pages not in the list\r\n\t\treturn cfi;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a Page from Book percentage\r\n\t * @param  {number} percent\r\n\t * @return {number} page\r\n\t */\r\n\tpageFromPercentage(percent){\r\n\t\tvar pg = Math.round(this.totalPages * percent);\r\n\t\treturn pg;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a value between 0 - 1 corresponding to the location of a page\r\n\t * @param  {number} pg the page\r\n\t * @return {number} percentage\r\n\t */\r\n\tpercentageFromPage(pg){\r\n\t\tvar percentage = (pg - this.firstPage) / this.totalPages;\r\n\t\treturn Math.round(percentage * 1000) / 1000;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a value between 0 - 1 corresponding to the location of a cfi\r\n\t * @param  {string} cfi EpubCFI String\r\n\t * @return {number} percentage\r\n\t */\r\n\tpercentageFromCfi(cfi){\r\n\t\tvar pg = this.pageFromCfi(cfi);\r\n\t\tvar percentage = this.percentageFromPage(pg);\r\n\t\treturn percentage;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.pages = undefined;\r\n\t\tthis.locations = undefined;\r\n\t\tthis.epubcfi = undefined;\r\n\r\n\t\tthis.pageList = undefined;\r\n\r\n\t\tthis.toc = undefined;\r\n\t\tthis.ncx = undefined;\r\n\t}\r\n}\r\n\r\nexport default PageList;\r\n","import { defer, isXml, parse } from \"./utils/core\";\r\nimport request from \"./utils/request\";\r\nimport mime from \"./utils/mime\";\r\nimport Path from \"./utils/path\";\r\nimport JSZip from \"jszip/dist/jszip\";\r\n\r\n/**\r\n * Handles Unzipping a requesting files from an Epub Archive\r\n * @class\r\n */\r\nclass Archive {\r\n\r\n\tconstructor() {\r\n\t\tthis.zip = undefined;\r\n\t\tthis.urlCache = {};\r\n\r\n\t\tthis.checkRequirements();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Checks to see if JSZip exists in global namspace,\r\n\t * Requires JSZip if it isn't there\r\n\t * @private\r\n\t */\r\n\tcheckRequirements() {\r\n\t\ttry {\r\n\t\t\tthis.zip = new JSZip();\r\n\t\t} catch (e) {\r\n\t\t\tthrow new Error(\"JSZip lib not loaded\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Open an archive\r\n\t * @param  {binary} input\r\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\r\n\t * @return {Promise} zipfile\r\n\t */\r\n\topen(input, isBase64) {\r\n\t\treturn this.zip.loadAsync(input, { \"base64\": isBase64 });\r\n\t}\r\n\r\n\t/**\r\n\t * Load and Open an archive\r\n\t * @param  {string} zipUrl\r\n\t * @param  {boolean} [isBase64] tells JSZip if the input data is base64 encoded\r\n\t * @return {Promise} zipfile\r\n\t */\r\n\topenUrl(zipUrl, isBase64) {\r\n\t\treturn request(zipUrl, \"binary\")\r\n\t\t\t.then(function (data) {\r\n\t\t\t\treturn this.zip.loadAsync(data, { \"base64\": isBase64 });\r\n\t\t\t}.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * Request a url from the archive\r\n\t * @param  {string} url  a url to request from the archive\r\n\t * @param  {string} [type] specify the type of the returned result\r\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\r\n\t */\r\n\trequest(url, type) {\r\n\t\tvar deferred = new defer();\r\n\t\tvar response;\r\n\t\tvar path = new Path(url);\r\n\r\n\t\t// If type isn't set, determine it from the file extension\r\n\t\tif (!type) {\r\n\t\t\ttype = path.extension;\r\n\t\t}\r\n\r\n\t\tif (type == \"blob\") {\r\n\t\t\tresponse = this.getBlob(url);\r\n\t\t} else {\r\n\t\t\tresponse = this.getText(url);\r\n\t\t}\r\n\r\n\t\tif (response) {\r\n\t\t\tresponse.then(function (r) {\r\n\t\t\t\tlet result = this.handleResponse(r, type);\r\n\t\t\t\tdeferred.resolve(result);\r\n\t\t\t}.bind(this));\r\n\t\t} else {\r\n\t\t\tdeferred.reject({\r\n\t\t\t\tmessage: \"File not found in the epub: \" + url,\r\n\t\t\t\tstack: new Error().stack\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn deferred.promise;\r\n\t}\r\n\r\n\t/**\r\n\t * Handle the response from request\r\n\t * @private\r\n\t * @param  {any} response\r\n\t * @param  {string} [type]\r\n\t * @return {any} the parsed result\r\n\t */\r\n\thandleResponse(response, type) {\r\n\t\tvar r;\r\n\r\n\t\tif (type == \"json\") {\r\n\t\t\tr = JSON.parse(response);\r\n\t\t}\r\n\t\telse\r\n\t\t\tif (isXml(type)) {\r\n\t\t\t\tr = parse(response, \"text/xml\");\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tif (type == \"xhtml\") {\r\n\t\t\t\t\tr = parse(response, \"application/xhtml+xml\");\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t\tif (type == \"html\" || type == \"htm\") {\r\n\t\t\t\t\t\tr = parse(response, \"text/html\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tr = response;\r\n\t\t\t\t\t}\r\n\r\n\t\treturn r;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a Blob from Archive by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [mimeType]\r\n\t * @return {Blob}\r\n\t */\r\n\tgetBlob(url, mimeType) {\r\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\t\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\t\tif (entry) {\r\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\r\n\t\t\treturn entry.async(\"uint8array\").then(function (uint8array) {\r\n\t\t\t\treturn new Blob([uint8array], { type: mimeType });\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get Text from Archive by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [encoding]\r\n\t * @return {string}\r\n\t */\r\n\tgetText(url, encoding) {\r\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\t\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\t\tif (entry) {\r\n\t\t\treturn entry.async(\"string\").then(function (text) {\r\n\t\t\t\treturn text;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Get a base64 encoded result from Archive by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [mimeType]\r\n\t * @return {string} base64 encoded\r\n\t */\r\n\tgetBase64(url, mimeType) {\r\n\t\tvar decodededUrl = window.decodeURIComponent(url.substr(1)); // Remove first slash\r\n\t\tvar entry = this.zip.file(decodededUrl);\r\n\r\n\t\tif (entry) {\r\n\t\t\tmimeType = mimeType || mime.lookup(entry.name);\r\n\t\t\treturn entry.async(\"base64\").then(function (data) {\r\n\t\t\t\treturn \"data:\" + mimeType + \";base64,\" + data;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Create a Url from an unarchived item\r\n\t * @param  {string} url\r\n\t * @param  {object} [options.base64] use base64 encoding or blob url\r\n\t * @return {Promise} url promise with Url string\r\n\t */\r\n\tcreateUrl(url, options) {\r\n\t\tvar deferred = new defer();\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tvar tempUrl;\r\n\t\tvar response;\r\n\t\tvar useBase64 = options && options.base64;\r\n\r\n\t\tif (url in this.urlCache) {\r\n\t\t\tdeferred.resolve(this.urlCache[url]);\r\n\t\t\treturn deferred.promise;\r\n\t\t}\r\n\r\n\t\tif (useBase64) {\r\n\t\t\tresponse = this.getBase64(url);\r\n\r\n\t\t\tif (response) {\r\n\t\t\t\tresponse.then(function (tempUrl) {\r\n\r\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tresponse = this.getBlob(url);\r\n\r\n\t\t\tif (response) {\r\n\t\t\t\tresponse.then(function (blob) {\r\n\r\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\r\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!response) {\r\n\t\t\tdeferred.reject({\r\n\t\t\t\tmessage: \"File not found in the epub: \" + url,\r\n\t\t\t\tstack: new Error().stack\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn deferred.promise;\r\n\t}\r\n\r\n\t/**\r\n\t * Revoke Temp Url for a achive item\r\n\t * @param  {string} url url of the item in the archive\r\n\t */\r\n\trevokeUrl(url) {\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tvar fromCache = this.urlCache[url];\r\n\t\tif (fromCache) _URL.revokeObjectURL(fromCache);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tfor (let fromCache in this.urlCache) {\r\n\t\t\t_URL.revokeObjectURL(fromCache);\r\n\t\t}\r\n\t\tthis.zip = undefined;\r\n\t\tthis.urlCache = {};\r\n\t}\r\n}\r\n\r\nexport default Archive;\r\n","import {defer, isXml, parse} from \"./utils/core\";\r\nimport httpRequest from \"./utils/request\";\r\nimport mime from \"./utils/mime\";\r\nimport Path from \"./utils/path\";\r\nimport EventEmitter from \"event-emitter\";\r\nimport localforage from \"localforage\";\r\n\r\n/**\r\n * Handles saving and requesting files from local storage\r\n * @class\r\n * @param {string} name This should be the name of the application for modals\r\n * @param {function} [requester]\r\n * @param {function} [resolver]\r\n */\r\nclass Store {\r\n\r\n\tconstructor(name, requester, resolver) {\r\n\t\tthis.urlCache = {};\r\n\r\n\t\tthis.storage = undefined;\r\n\r\n\t\tthis.name = name;\r\n\t\tthis.requester = requester || httpRequest;\r\n\t\tthis.resolver = resolver;\r\n\r\n\t\tthis.online = true;\r\n\r\n\t\tthis.checkRequirements();\r\n\r\n\t\tthis.addListeners();\r\n\t}\r\n\r\n\t/**\r\n\t * Checks to see if localForage exists in global namspace,\r\n\t * Requires localForage if it isn't there\r\n\t * @private\r\n\t */\r\n\tcheckRequirements(){\r\n\t\ttry {\r\n\t\t\tlet store;\r\n\t\t\tif (typeof localforage === \"undefined\") {\r\n\t\t\t\tstore = localforage;\r\n\t\t\t}\r\n\t\t\tthis.storage = store.createInstance({\r\n\t\t\t\t\tname: this.name\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\tthrow new Error(\"localForage lib not loaded\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add online and offline event listeners\r\n\t * @private\r\n\t */\r\n\taddListeners() {\r\n\t\tthis._status = this.status.bind(this);\r\n\t\twindow.addEventListener('online',  this._status);\r\n\t  window.addEventListener('offline', this._status);\r\n\t}\r\n\r\n\t/**\r\n\t * Remove online and offline event listeners\r\n\t * @private\r\n\t */\r\n\tremoveListeners() {\r\n\t\twindow.removeEventListener('online',  this._status);\r\n\t  window.removeEventListener('offline', this._status);\r\n\t\tthis._status = undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Update the online / offline status\r\n\t * @private\r\n\t */\r\n\tstatus(event) {\r\n\t\tlet online = navigator.onLine;\r\n\t\tthis.online = online;\r\n\t\tif (online) {\r\n\t\t\tthis.emit(\"online\", this);\r\n\t\t} else {\r\n\t\t\tthis.emit(\"offline\", this);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Add all of a book resources to the store\r\n\t * @param  {Resources} resources  book resources\r\n\t * @param  {boolean} [force] force resaving resources\r\n\t * @return {Promise<object>} store objects\r\n\t */\r\n\tadd(resources, force) {\r\n\t\tlet mapped = resources.resources.map((item) => {\r\n\t\t\tlet { href } = item;\r\n\t\t\tlet url = this.resolver(href);\r\n\t\t\tlet encodedUrl = window.encodeURIComponent(url);\r\n\r\n\t\t\treturn this.storage.getItem(encodedUrl).then((item) => {\r\n\t\t\t\tif (!item || force) {\r\n\t\t\t\t\treturn this.requester(url, \"binary\")\r\n\t\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn item;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t\treturn Promise.all(mapped);\r\n\t}\r\n\r\n\t/**\r\n\t * Put binary data from a url to storage\r\n\t * @param  {string} url  a url to request from storage\r\n\t * @param  {boolean} [withCredentials]\r\n\t * @param  {object} [headers]\r\n\t * @return {Promise<Blob>}\r\n\t */\r\n\tput(url, withCredentials, headers) {\r\n\t\tlet encodedUrl = window.encodeURIComponent(url);\r\n\r\n\t\treturn this.storage.getItem(encodedUrl).then((result) => {\r\n\t\t\tif (!result) {\r\n\t\t\t\treturn this.requester(url, \"binary\", withCredentials, headers).then((data) => {\r\n\t\t\t\t\treturn this.storage.setItem(encodedUrl, data);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Request a url\r\n\t * @param  {string} url  a url to request from storage\r\n\t * @param  {string} [type] specify the type of the returned result\r\n\t * @param  {boolean} [withCredentials]\r\n\t * @param  {object} [headers]\r\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\r\n\t */\r\n\trequest(url, type, withCredentials, headers){\r\n\t\tif (this.online) {\r\n\t\t\t// From network\r\n\t\t\treturn this.requester(url, type, withCredentials, headers).then((data) => {\r\n\t\t\t\t// save to store if not present\r\n\t\t\t\tthis.put(url);\r\n\t\t\t\treturn data;\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// From store\r\n\t\t\treturn this.retrieve(url, type);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Request a url from storage\r\n\t * @param  {string} url  a url to request from storage\r\n\t * @param  {string} [type] specify the type of the returned result\r\n\t * @return {Promise<Blob | string | JSON | Document | XMLDocument>}\r\n\t */\r\n\tretrieve(url, type) {\r\n\t\tvar deferred = new defer();\r\n\t\tvar response;\r\n\t\tvar path = new Path(url);\r\n\r\n\t\t// If type isn't set, determine it from the file extension\r\n\t\tif(!type) {\r\n\t\t\ttype = path.extension;\r\n\t\t}\r\n\r\n\t\tif(type == \"blob\"){\r\n\t\t\tresponse = this.getBlob(url);\r\n\t\t} else {\r\n\t\t\tresponse = this.getText(url);\r\n\t\t}\r\n\r\n\r\n\t\treturn response.then((r) => {\r\n\t\t\tvar deferred = new defer();\r\n\t\t\tvar result;\r\n\t\t\tif (r) {\r\n\t\t\t\tresult = this.handleResponse(r, type);\r\n\t\t\t\tdeferred.resolve(result);\r\n\t\t\t} else {\r\n\t\t\t\tdeferred.reject({\r\n\t\t\t\t\tmessage : \"File not found in storage: \" + url,\r\n\t\t\t\t\tstack : new Error().stack\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\treturn deferred.promise;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Handle the response from request\r\n\t * @private\r\n\t * @param  {any} response\r\n\t * @param  {string} [type]\r\n\t * @return {any} the parsed result\r\n\t */\r\n\thandleResponse(response, type){\r\n\t\tvar r;\r\n\r\n\t\tif(type == \"json\") {\r\n\t\t\tr = JSON.parse(response);\r\n\t\t}\r\n\t\telse\r\n\t\tif(isXml(type)) {\r\n\t\t\tr = parse(response, \"text/xml\");\r\n\t\t}\r\n\t\telse\r\n\t\tif(type == \"xhtml\") {\r\n\t\t\tr = parse(response, \"application/xhtml+xml\");\r\n\t\t}\r\n\t\telse\r\n\t\tif(type == \"html\" || type == \"htm\") {\r\n\t\t\tr = parse(response, \"text/html\");\r\n\t\t } else {\r\n\t\t\t r = response;\r\n\t\t }\r\n\r\n\t\treturn r;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a Blob from Storage by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [mimeType]\r\n\t * @return {Blob}\r\n\t */\r\n\tgetBlob(url, mimeType){\r\n\t\tlet encodedUrl = window.encodeURIComponent(url);\r\n\r\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\r\n\t\t\tif(!uint8array) return;\r\n\r\n\t\t\tmimeType = mimeType || mime.lookup(url);\r\n\r\n\t\t\treturn new Blob([uint8array], {type : mimeType});\r\n\t\t});\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get Text from Storage by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [mimeType]\r\n\t * @return {string}\r\n\t */\r\n\tgetText(url, mimeType){\r\n\t\tlet encodedUrl = window.encodeURIComponent(url);\r\n\r\n\t\tmimeType = mimeType || mime.lookup(url);\r\n\r\n\t\treturn this.storage.getItem(encodedUrl).then(function(uint8array) {\r\n\t\t\tvar deferred = new defer();\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\tvar blob;\r\n\r\n\t\t\tif(!uint8array) return;\r\n\r\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\r\n\r\n\t\t\treader.addEventListener(\"loadend\", () => {\r\n\t\t\t\tdeferred.resolve(reader.result);\r\n\t\t\t});\r\n\r\n\t\t\treader.readAsText(blob, mimeType);\r\n\r\n\t\t\treturn deferred.promise;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Get a base64 encoded result from Storage by Url\r\n\t * @param  {string} url\r\n\t * @param  {string} [mimeType]\r\n\t * @return {string} base64 encoded\r\n\t */\r\n\tgetBase64(url, mimeType){\r\n\t\tlet encodedUrl = window.encodeURIComponent(url);\r\n\r\n\t\tmimeType = mimeType || mime.lookup(url);\r\n\r\n\t\treturn this.storage.getItem(encodedUrl).then((uint8array) => {\r\n\t\t\tvar deferred = new defer();\r\n\t\t\tvar reader = new FileReader();\r\n\t\t\tvar blob;\r\n\r\n\t\t\tif(!uint8array) return;\r\n\r\n\t\t\tblob = new Blob([uint8array], {type : mimeType});\r\n\r\n\t\t\treader.addEventListener(\"loadend\", () => {\r\n\t\t\t\tdeferred.resolve(reader.result);\r\n\t\t\t});\r\n\t\t\treader.readAsDataURL(blob, mimeType);\r\n\r\n\t\t\treturn deferred.promise;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Create a Url from a stored item\r\n\t * @param  {string} url\r\n\t * @param  {object} [options.base64] use base64 encoding or blob url\r\n\t * @return {Promise} url promise with Url string\r\n\t */\r\n\tcreateUrl(url, options){\r\n\t\tvar deferred = new defer();\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tvar tempUrl;\r\n\t\tvar response;\r\n\t\tvar useBase64 = options && options.base64;\r\n\r\n\t\tif(url in this.urlCache) {\r\n\t\t\tdeferred.resolve(this.urlCache[url]);\r\n\t\t\treturn deferred.promise;\r\n\t\t}\r\n\r\n\t\tif (useBase64) {\r\n\t\t\tresponse = this.getBase64(url);\r\n\r\n\t\t\tif (response) {\r\n\t\t\t\tresponse.then(function(tempUrl) {\r\n\r\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tresponse = this.getBlob(url);\r\n\r\n\t\t\tif (response) {\r\n\t\t\t\tresponse.then(function(blob) {\r\n\r\n\t\t\t\t\ttempUrl = _URL.createObjectURL(blob);\r\n\t\t\t\t\tthis.urlCache[url] = tempUrl;\r\n\t\t\t\t\tdeferred.resolve(tempUrl);\r\n\r\n\t\t\t\t}.bind(this));\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tif (!response) {\r\n\t\t\tdeferred.reject({\r\n\t\t\t\tmessage : \"File not found in storage: \" + url,\r\n\t\t\t\tstack : new Error().stack\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn deferred.promise;\r\n\t}\r\n\r\n\t/**\r\n\t * Revoke Temp Url for a achive item\r\n\t * @param  {string} url url of the item in the store\r\n\t */\r\n\trevokeUrl(url){\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tvar fromCache = this.urlCache[url];\r\n\t\tif(fromCache) _URL.revokeObjectURL(fromCache);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tvar _URL = window.URL || window.webkitURL || window.mozURL;\r\n\t\tfor (let fromCache in this.urlCache) {\r\n\t\t\t_URL.revokeObjectURL(fromCache);\r\n\t\t}\r\n\t\tthis.urlCache = {};\r\n\t\tthis.removeListeners();\r\n\t}\r\n}\r\n\r\nEventEmitter(Store.prototype);\r\n\r\nexport default Store;\r\n","import {qs, qsa } from \"./utils/core\";\r\n\r\n/**\r\n * Open DisplayOptions Format Parser\r\n * @class\r\n * @param {document} displayOptionsDocument XML\r\n */\r\nclass DisplayOptions {\r\n\tconstructor(displayOptionsDocument) {\r\n\t\tthis.interactive = \"\";\r\n\t\tthis.fixedLayout = \"\";\r\n\t\tthis.openToSpread = \"\";\r\n\t\tthis.orientationLock = \"\";\r\n\r\n\t\tif (displayOptionsDocument) {\r\n\t\t\tthis.parse(displayOptionsDocument);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Parse XML\r\n\t * @param  {document} displayOptionsDocument XML\r\n\t * @return {DisplayOptions} self\r\n\t */\r\n\tparse(displayOptionsDocument) {\r\n\t\tif(!displayOptionsDocument) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tconst displayOptionsNode = qs(displayOptionsDocument, \"display_options\");\r\n\t\tif(!displayOptionsNode) {\r\n\t\t\treturn this;\r\n\t\t} \r\n\r\n\t\tconst options = qsa(displayOptionsNode, \"option\");\r\n\t\toptions.forEach((el) => {\r\n\t\t\tlet value = \"\";\r\n\r\n\t\t\tif (el.childNodes.length) {\r\n\t\t\t\tvalue = el.childNodes[0].nodeValue;\r\n\t\t\t}\r\n\r\n\t\t\tswitch (el.attributes.name.value) {\r\n\t\t\t    case \"interactive\":\r\n\t\t\t        this.interactive = value;\r\n\t\t\t        break;\r\n\t\t\t    case \"fixed-layout\":\r\n\t\t\t        this.fixedLayout = value;\r\n\t\t\t        break;\r\n\t\t\t    case \"open-to-spread\":\r\n\t\t\t        this.openToSpread = value;\r\n\t\t\t        break;\r\n\t\t\t    case \"orientation-lock\":\r\n\t\t\t        this.orientationLock = value;\r\n\t\t\t        break;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.interactive = undefined;\r\n\t\tthis.fixedLayout = undefined;\r\n\t\tthis.openToSpread = undefined;\r\n\t\tthis.orientationLock = undefined;\r\n\t}\r\n}\r\n\r\nexport default DisplayOptions;\r\n","import EventEmitter from \"event-emitter\";\r\nimport {extend, defer} from \"./utils/core\";\r\nimport Url from \"./utils/url\";\r\nimport Path from \"./utils/path\";\r\nimport Spine from \"./spine\";\r\nimport Locations from \"./locations\";\r\nimport Container from \"./container\";\r\nimport Packaging from \"./packaging\";\r\nimport Navigation from \"./navigation\";\r\nimport Resources from \"./resources\";\r\nimport PageList from \"./pagelist\";\r\nimport Rendition from \"./rendition\";\r\nimport Archive from \"./archive\";\r\nimport request from \"./utils/request\";\r\nimport EpubCFI from \"./epubcfi\";\r\nimport Store from \"./store\";\r\nimport DisplayOptions from \"./displayoptions\";\r\nimport { EPUBJS_VERSION, EVENTS } from \"./utils/constants\";\r\n\r\nconst CONTAINER_PATH = \"META-INF/container.xml\";\r\nconst IBOOKS_DISPLAY_OPTIONS_PATH = \"META-INF/com.apple.ibooks.display-options.xml\";\r\n\r\nconst INPUT_TYPE = {\r\n\tBINARY: \"binary\",\r\n\tBASE64: \"base64\",\r\n\tEPUB: \"epub\",\r\n\tOPF: \"opf\",\r\n\tMANIFEST: \"json\",\r\n\tDIRECTORY: \"directory\"\r\n};\r\n\r\n/**\r\n * An Epub representation with methods for the loading, parsing and manipulation\r\n * of its contents.\r\n * @class\r\n * @param {string} [url]\r\n * @param {object} [options]\r\n * @param {method} [options.requestMethod] a request function to use instead of the default\r\n * @param {boolean} [options.requestCredentials=undefined] send the xhr request withCredentials\r\n * @param {object} [options.requestHeaders=undefined] send the xhr request headers\r\n * @param {string} [options.encoding=binary] optional to pass 'binary' or base64' for archived Epubs\r\n * @param {string} [options.replacements=none] use base64, blobUrl, or none for replacing assets in archived Epubs\r\n * @param {method} [options.canonical] optional function to determine canonical urls for a path\r\n * @param {string} [options.openAs] optional string to determine the input type\r\n * @param {string} [options.store=false] cache the contents in local storage, value should be the name of the reader\r\n * @returns {Book}\r\n * @example new Book(\"/path/to/book.epub\", {})\r\n * @example new Book({ replacements: \"blobUrl\" })\r\n */\r\nclass Book {\r\n\tconstructor(url, options) {\r\n\t\t// Allow passing just options to the Book\r\n\t\tif (typeof(options) === \"undefined\" &&\r\n\t\t\t  typeof(url) !== \"string\" &&\r\n\t\t    url instanceof Blob === false &&\r\n\t\t    url instanceof ArrayBuffer === false) {\r\n\t\t\toptions = url;\r\n\t\t\turl = undefined;\r\n\t\t}\r\n\r\n\t\tthis.settings = extend(this.settings || {}, {\r\n\t\t\trequestMethod: undefined,\r\n\t\t\trequestCredentials: undefined,\r\n\t\t\trequestHeaders: undefined,\r\n\t\t\tencoding: undefined,\r\n\t\t\treplacements: undefined,\r\n\t\t\tcanonical: undefined,\r\n\t\t\topenAs: undefined,\r\n\t\t\tstore: undefined\r\n\t\t});\r\n\r\n\t\textend(this.settings, options);\r\n\r\n\r\n\t\t// Promises\r\n\t\tthis.opening = new defer();\r\n\t\t/**\r\n\t\t * @member {promise} opened returns after the book is loaded\r\n\t\t * @memberof Book\r\n\t\t */\r\n\t\tthis.opened = this.opening.promise;\r\n\t\tthis.isOpen = false;\r\n\r\n\t\tthis.loading = {\r\n\t\t\tmanifest: new defer(),\r\n\t\t\tspine: new defer(),\r\n\t\t\tmetadata: new defer(),\r\n\t\t\tcover: new defer(),\r\n\t\t\tnavigation: new defer(),\r\n\t\t\tpageList: new defer(),\r\n\t\t\tresources: new defer(),\r\n\t\t\tdisplayOptions: new defer()\r\n\t\t};\r\n\r\n\t\tthis.loaded = {\r\n\t\t\tmanifest: this.loading.manifest.promise,\r\n\t\t\tspine: this.loading.spine.promise,\r\n\t\t\tmetadata: this.loading.metadata.promise,\r\n\t\t\tcover: this.loading.cover.promise,\r\n\t\t\tnavigation: this.loading.navigation.promise,\r\n\t\t\tpageList: this.loading.pageList.promise,\r\n\t\t\tresources: this.loading.resources.promise,\r\n\t\t\tdisplayOptions: this.loading.displayOptions.promise\r\n\t\t};\r\n\r\n\t\t/**\r\n\t\t * @member {promise} ready returns after the book is loaded and parsed\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.ready = Promise.all([\r\n\t\t\tthis.loaded.manifest,\r\n\t\t\tthis.loaded.spine,\r\n\t\t\tthis.loaded.metadata,\r\n\t\t\tthis.loaded.cover,\r\n\t\t\tthis.loaded.navigation,\r\n\t\t\tthis.loaded.resources,\r\n\t\t\tthis.loaded.displayOptions\r\n\t\t]);\r\n\r\n\r\n\t\t// Queue for methods used before opening\r\n\t\tthis.isRendered = false;\r\n\t\t// this._q = queue(this);\r\n\r\n\t\t/**\r\n\t\t * @member {method} request\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.request = this.settings.requestMethod || request;\r\n\r\n\t\t/**\r\n\t\t * @member {Spine} spine\r\n\t\t * @memberof Book\r\n\t\t */\r\n\t\tthis.spine = new Spine();\r\n\r\n\t\t/**\r\n\t\t * @member {Locations} locations\r\n\t\t * @memberof Book\r\n\t\t */\r\n\t\tthis.locations = new Locations(this.spine, this.load.bind(this));\r\n\r\n\t\t/**\r\n\t\t * @member {Navigation} navigation\r\n\t\t * @memberof Book\r\n\t\t */\r\n\t\tthis.navigation = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {PageList} pagelist\r\n\t\t * @memberof Book\r\n\t\t */\r\n\t\tthis.pageList = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Url} url\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.url = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Path} path\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.path = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {boolean} archived\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.archived = false;\r\n\r\n\t\t/**\r\n\t\t * @member {Archive} archive\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.archive = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Store} storage\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.storage = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Resources} resources\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.resources = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Rendition} rendition\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.rendition = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Container} container\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.container = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {Packaging} packaging\r\n\t\t * @memberof Book\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.packaging = undefined;\r\n\r\n\t\t/**\r\n\t\t * @member {DisplayOptions} displayOptions\r\n\t\t * @memberof DisplayOptions\r\n\t\t * @private\r\n\t\t */\r\n\t\tthis.displayOptions = undefined;\r\n\r\n\t\t// this.toc = undefined;\r\n\t\tif (this.settings.store) {\r\n\t\t\tthis.store(this.settings.store);\r\n\t\t}\r\n\r\n\t\tif(url) {\r\n\t\t\tthis.open(url, this.settings.openAs).catch((error) => {\r\n\t\t\t\tvar err = new Error(\"Cannot load book at \"+ url );\r\n\t\t\t\tthis.emit(EVENTS.BOOK.OPEN_FAILED, err);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Open a epub or url\r\n\t * @param {string | ArrayBuffer} input Url, Path or ArrayBuffer\r\n\t * @param {string} [what=\"binary\", \"base64\", \"epub\", \"opf\", \"json\", \"directory\"] force opening as a certain type\r\n\t * @returns {Promise} of when the book has been loaded\r\n\t * @example book.open(\"/path/to/book.epub\")\r\n\t */\r\n\topen(input, what) {\r\n\t\tvar opening;\r\n\t\tvar type = what || this.determineType(input);\r\n\r\n\t\tif (type === INPUT_TYPE.BINARY) {\r\n\t\t\tthis.archived = true;\r\n\t\t\tthis.url = new Url(\"/\", \"\");\r\n\t\t\topening = this.openEpub(input);\r\n\t\t} else if (type === INPUT_TYPE.BASE64) {\r\n\t\t\tthis.archived = true;\r\n\t\t\tthis.url = new Url(\"/\", \"\");\r\n\t\t\topening = this.openEpub(input, type);\r\n\t\t} else if (type === INPUT_TYPE.EPUB) {\r\n\t\t\tthis.archived = true;\r\n\t\t\tthis.url = new Url(\"/\", \"\");\r\n\t\t\topening = this.request(input, \"binary\", this.settings.requestCredentials, this.settings.requestHeaders)\r\n\t\t\t\t.then(this.openEpub.bind(this));\r\n\t\t} else if(type == INPUT_TYPE.OPF) {\r\n\t\t\tthis.url = new Url(input);\r\n\t\t\topening = this.openPackaging(this.url.Path.toString());\r\n\t\t} else if(type == INPUT_TYPE.MANIFEST) {\r\n\t\t\tthis.url = new Url(input);\r\n\t\t\topening = this.openManifest(this.url.Path.toString());\r\n\t\t} else {\r\n\t\t\tthis.url = new Url(input);\r\n\t\t\topening = this.openContainer(CONTAINER_PATH)\r\n\t\t\t\t.then(this.openPackaging.bind(this));\r\n\t\t}\r\n\r\n\t\treturn opening;\r\n\t}\r\n\r\n\t/**\r\n\t * Open an archived epub\r\n\t * @private\r\n\t * @param  {binary} data\r\n\t * @param  {string} [encoding]\r\n\t * @return {Promise}\r\n\t */\r\n\topenEpub(data, encoding) {\r\n\t\treturn this.unarchive(data, encoding || this.settings.encoding)\r\n\t\t\t.then(() => {\r\n\t\t\t\treturn this.openContainer(CONTAINER_PATH);\r\n\t\t\t})\r\n\t\t\t.then((packagePath) => {\r\n\t\t\t\treturn this.openPackaging(packagePath);\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Open the epub container\r\n\t * @private\r\n\t * @param  {string} url\r\n\t * @return {string} packagePath\r\n\t */\r\n\topenContainer(url) {\r\n\t\treturn this.load(url)\r\n\t\t\t.then((xml) => {\r\n\t\t\t\tthis.container = new Container(xml);\r\n\t\t\t\treturn this.resolve(this.container.packagePath);\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Open the Open Packaging Format Xml\r\n\t * @private\r\n\t * @param  {string} url\r\n\t * @return {Promise}\r\n\t */\r\n\topenPackaging(url) {\r\n\t\tthis.path = new Path(url);\r\n\t\treturn this.load(url)\r\n\t\t\t.then((xml) => {\r\n\t\t\t\tthis.packaging = new Packaging(xml);\r\n\t\t\t\treturn this.unpack(this.packaging);\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Open the manifest JSON\r\n\t * @private\r\n\t * @param  {string} url\r\n\t * @return {Promise}\r\n\t */\r\n\topenManifest(url) {\r\n\t\tthis.path = new Path(url);\r\n\t\treturn this.load(url)\r\n\t\t\t.then((json) => {\r\n\t\t\t\tthis.packaging = new Packaging();\r\n\t\t\t\tthis.packaging.load(json);\r\n\t\t\t\treturn this.unpack(this.packaging);\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Load a resource from the Book\r\n\t * @param  {string} path path to the resource to load\r\n\t * @return {Promise}     returns a promise with the requested resource\r\n\t */\r\n\tload(path) {\r\n\t\tvar resolved = this.resolve(path);\r\n\t\tif(this.archived) {\r\n\t\t\treturn this.archive.request(resolved);\r\n\t\t} else {\r\n\t\t\treturn this.request(resolved, null, this.settings.requestCredentials, this.settings.requestHeaders);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a path to it's absolute position in the Book\r\n\t * @param  {string} path\r\n\t * @param  {boolean} [absolute] force resolving the full URL\r\n\t * @return {string}          the resolved path string\r\n\t */\r\n\tresolve(path, absolute) {\r\n\t\tif (!path) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar resolved = path;\r\n\t\tvar isAbsolute = (path.indexOf(\"://\") > -1);\r\n\r\n\t\tif (isAbsolute) {\r\n\t\t\treturn path;\r\n\t\t}\r\n\r\n\t\tif (this.path) {\r\n\t\t\tresolved = this.path.resolve(path);\r\n\t\t}\r\n\r\n\t\tif(absolute != false && this.url) {\r\n\t\t\tresolved = this.url.resolve(resolved);\r\n\t\t}\r\n\r\n\t\treturn resolved;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a canonical link to a path\r\n\t * @param  {string} path\r\n\t * @return {string} the canonical path string\r\n\t */\r\n\tcanonical(path) {\r\n\t\tvar url = path;\r\n\r\n\t\tif (!path) {\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\r\n\t\tif (this.settings.canonical) {\r\n\t\t\turl = this.settings.canonical(path);\r\n\t\t} else {\r\n\t\t\turl = this.resolve(path, true);\r\n\t\t}\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\t/**\r\n\t * Determine the type of they input passed to open\r\n\t * @private\r\n\t * @param  {string} input\r\n\t * @return {string}  binary | directory | epub | opf\r\n\t */\r\n\tdetermineType(input) {\r\n\t\tvar url;\r\n\t\tvar path;\r\n\t\tvar extension;\r\n\r\n\t\tif (this.settings.encoding === \"base64\") {\r\n\t\t\treturn INPUT_TYPE.BASE64;\r\n\t\t}\r\n\r\n\t\tif(typeof(input) != \"string\") {\r\n\t\t\treturn INPUT_TYPE.BINARY;\r\n\t\t}\r\n\r\n\t\turl = new Url(input);\r\n\t\tpath = url.path();\r\n\t\textension = path.extension;\r\n\r\n\t\t// If there's a search string, remove it before determining type\r\n\t\tif (extension) {\r\n\t\t\textension = extension.replace(/\\?.*$/, \"\");\r\n\t\t}\r\n\r\n\t\tif (!extension) {\r\n\t\t\treturn INPUT_TYPE.DIRECTORY;\r\n\t\t}\r\n\r\n\t\tif(extension === \"epub\"){\r\n\t\t\treturn INPUT_TYPE.EPUB;\r\n\t\t}\r\n\r\n\t\tif(extension === \"opf\"){\r\n\t\t\treturn INPUT_TYPE.OPF;\r\n\t\t}\r\n\r\n\t\tif(extension === \"json\"){\r\n\t\t\treturn INPUT_TYPE.MANIFEST;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * unpack the contents of the Books packaging\r\n\t * @private\r\n\t * @param {Packaging} packaging object\r\n\t */\r\n\tunpack(packaging) {\r\n\t\tthis.package = packaging; //TODO: deprecated this\r\n\r\n\t\tif (this.packaging.metadata.layout === \"\") {\r\n\t\t\t// rendition:layout not set - check display options if book is pre-paginated\r\n\t\t\tthis.load(this.url.resolve(IBOOKS_DISPLAY_OPTIONS_PATH)).then((xml) => {\r\n\t\t\t\tthis.displayOptions = new DisplayOptions(xml);\r\n\t\t\t\tthis.loading.displayOptions.resolve(this.displayOptions);\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tthis.displayOptions = new DisplayOptions();\r\n\t\t\t\tthis.loading.displayOptions.resolve(this.displayOptions);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tthis.displayOptions = new DisplayOptions();\r\n\t\t\tthis.loading.displayOptions.resolve(this.displayOptions);\r\n\t\t}\r\n\r\n\t\tthis.spine.unpack(this.packaging, this.resolve.bind(this), this.canonical.bind(this));\r\n\r\n\t\tthis.resources = new Resources(this.packaging.manifest, {\r\n\t\t\tarchive: this.archive,\r\n\t\t\tresolver: this.resolve.bind(this),\r\n\t\t\trequest: this.request.bind(this),\r\n\t\t\treplacements: this.settings.replacements || (this.archived ? \"blobUrl\" : \"base64\")\r\n\t\t});\r\n\r\n\t\tthis.loadNavigation(this.packaging).then(() => {\r\n\t\t\t// this.toc = this.navigation.toc;\r\n\t\t\tthis.loading.navigation.resolve(this.navigation);\r\n\t\t});\r\n\r\n\t\tif (this.packaging.coverPath) {\r\n\t\t\tthis.cover = this.resolve(this.packaging.coverPath);\r\n\t\t}\r\n\t\t// Resolve promises\r\n\t\tthis.loading.manifest.resolve(this.packaging.manifest);\r\n\t\tthis.loading.metadata.resolve(this.packaging.metadata);\r\n\t\tthis.loading.spine.resolve(this.spine);\r\n\t\tthis.loading.cover.resolve(this.cover);\r\n\t\tthis.loading.resources.resolve(this.resources);\r\n\t\tthis.loading.pageList.resolve(this.pageList);\r\n\r\n\t\tthis.isOpen = true;\r\n\r\n\t\tif(this.archived || this.settings.replacements && this.settings.replacements != \"none\") {\r\n\t\t\tthis.replacements().then(() => {\r\n\t\t\t\tthis.loaded.displayOptions.then(() => {\r\n\t\t\t\t\tthis.opening.resolve(this);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// Resolve book opened promise\r\n\t\t\tthis.loaded.displayOptions.then(() => {\r\n\t\t\t\tthis.opening.resolve(this);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Load Navigation and PageList from package\r\n\t * @private\r\n\t * @param {Packaging} packaging\r\n\t */\r\n\tloadNavigation(packaging) {\r\n\t\t\r\n\t\tlet navPath = packaging.navPath || packaging.ncxPath;\r\n\t\tlet toc = packaging.toc;\r\n\r\n\t\t// From json manifest\r\n\t\tif (toc) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t\r\n\t\t\t\tthis.navigation = new Navigation(toc);\r\n\r\n\t\t\t\tif (packaging.pageList) {\r\n\t\t\t\t\tthis.pageList = new PageList(packaging.pageList); // TODO: handle page lists from Manifest\r\n\t\t\t\t}\r\n\r\n\t\t\t\tresolve(this.navigation);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (!navPath) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tthis.navigation = new Navigation();\r\n\t\t\t\tthis.pageList = new PageList();\r\n\r\n\t\t\t\tresolve(this.navigation);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn this.load(navPath, \"xml\")\r\n\t\t\t.then((xml) => {\r\n\t\t\t\tthis.navigation = new Navigation(xml);\r\n\t\t\t\tthis.pageList = new PageList(xml);\r\n\t\t\t\treturn this.navigation;\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Gets a Section of the Book from the Spine\r\n\t * Alias for `book.spine.get`\r\n\t * @param {string} target\r\n\t * @return {Section}\r\n\t */\r\n\tsection(target) {\r\n\t\treturn this.spine.get(target);\r\n\t}\r\n\r\n\t/**\r\n\t * Sugar to render a book to an element\r\n\t * @param  {element | string} element element or string to add a rendition to\r\n\t * @param  {object} [options]\r\n\t * @return {Rendition}\r\n\t */\r\n\trenderTo(element, options) {\r\n\t\tthis.rendition = new Rendition(this, options);\r\n\t\tthis.rendition.attachTo(element);\r\n\r\n\t\treturn this.rendition;\r\n\t}\r\n\r\n\t/**\r\n\t * Set if request should use withCredentials\r\n\t * @param {boolean} credentials\r\n\t */\r\n\tsetRequestCredentials(credentials) {\r\n\t\tthis.settings.requestCredentials = credentials;\r\n\t}\r\n\r\n\t/**\r\n\t * Set headers request should use\r\n\t * @param {object} headers\r\n\t */\r\n\tsetRequestHeaders(headers) {\r\n\t\tthis.settings.requestHeaders = headers;\r\n\t}\r\n\r\n\t/**\r\n\t * Unarchive a zipped epub\r\n\t * @private\r\n\t * @param  {binary} input epub data\r\n\t * @param  {string} [encoding]\r\n\t * @return {Archive}\r\n\t */\r\n\tunarchive(input, encoding) {\r\n\t\tthis.archive = new Archive();\r\n\t\treturn this.archive.open(input, encoding);\r\n\t}\r\n\r\n\t/**\r\n\t * Store the epubs contents\r\n\t * @private\r\n\t * @param  {binary} input epub data\r\n\t * @param  {string} [encoding]\r\n\t * @return {Store}\r\n\t */\r\n\tstore(name) {\r\n\t\t// Use \"blobUrl\" or \"base64\" for replacements\r\n\t\tlet replacementsSetting = this.settings.replacements && this.settings.replacements !== \"none\";\r\n\t\t// Save original url\r\n\t\tlet originalUrl = this.url;\r\n\t\t// Save original request method\r\n\t\tlet requester = this.settings.requestMethod || request.bind(this);\r\n\t\t// Create new Store\r\n\t\tthis.storage = new Store(name, requester, this.resolve.bind(this));\r\n\t\t// Replace request method to go through store\r\n\t\tthis.request = this.storage.request.bind(this.storage);\r\n\r\n\t\tthis.opened.then(() => {\r\n\t\t\tif (this.archived) {\r\n\t\t\t\tthis.storage.requester = this.archive.request.bind(this.archive);\r\n\t\t\t}\r\n\t\t\t// Substitute hook\r\n\t\t\tlet substituteResources = (output, section) => {\r\n\t\t\t\tsection.output = this.resources.substitute(output, section.url);\r\n\t\t\t};\r\n\r\n\t\t\t// Set to use replacements\r\n\t\t\tthis.resources.settings.replacements = replacementsSetting || \"blobUrl\";\r\n\t\t\t// Create replacement urls\r\n\t\t\tthis.resources.replacements().\r\n\t\t\t\tthen(() => {\r\n\t\t\t\t\treturn this.resources.replaceCss();\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.storage.on(\"offline\", () => {\r\n\t\t\t\t// Remove url to use relative resolving for hrefs\r\n\t\t\t\tthis.url = new Url(\"/\", \"\");\r\n\t\t\t\t// Add hook to replace resources in contents\r\n\t\t\t\tthis.spine.hooks.serialize.register(substituteResources);\r\n\t\t\t});\r\n\r\n\t\t\tthis.storage.on(\"online\", () => {\r\n\t\t\t\t// Restore original url\r\n\t\t\t\tthis.url = originalUrl;\r\n\t\t\t\t// Remove hook\r\n\t\t\t\tthis.spine.hooks.serialize.deregister(substituteResources);\r\n\t\t\t});\r\n\r\n\t\t});\r\n\r\n\t\treturn this.storage;\r\n\t}\r\n\r\n\t/**\r\n\t * Get the cover url\r\n\t * @return {Promise<?string>} coverUrl\r\n\t */\r\n\tcoverUrl() {\r\n\t\treturn this.loaded.cover.then(() => {\r\n\t\t\tif (!this.cover) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this.archived) {\r\n\t\t\t\treturn this.archive.createUrl(this.cover);\r\n\t\t\t} else {\r\n\t\t\t\treturn this.cover;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Load replacement urls\r\n\t * @private\r\n\t * @return {Promise} completed loading urls\r\n\t */\r\n\treplacements() {\r\n\t\tthis.spine.hooks.serialize.register((output, section) => {\r\n\t\t\tsection.output = this.resources.substitute(output, section.url);\r\n\t\t});\r\n\r\n\t\treturn this.resources.replacements().\r\n\t\t\tthen(() => {\r\n\t\t\t\treturn this.resources.replaceCss();\r\n\t\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Find a DOM Range for a given CFI Range\r\n\t * @param  {EpubCFI} cfiRange a epub cfi range\r\n\t * @return {Promise}\r\n\t */\r\n\tgetRange(cfiRange) {\r\n\t\tvar cfi = new EpubCFI(cfiRange);\r\n\t\tvar item = this.spine.get(cfi.spinePos);\r\n\t\tvar _request = this.load.bind(this);\r\n\t\tif (!item) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\treject(\"CFI could not be found\");\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn item.load(_request).then(function (contents) {\r\n\t\t\tvar range = cfi.toRange(item.document);\r\n\t\t\treturn range;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Generates the Book Key using the identifer in the manifest or other string provided\r\n\t * @param  {string} [identifier] to use instead of metadata identifier\r\n\t * @return {string} key\r\n\t */\r\n\tkey(identifier) {\r\n\t\tvar ident = identifier || this.packaging.metadata.identifier || this.url.filename;\r\n\t\treturn `epubjs:${EPUBJS_VERSION}:${ident}`;\r\n\t}\r\n\r\n\t/**\r\n\t * Destroy the Book and all associated objects\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.opened = undefined;\r\n\t\tthis.loading = undefined;\r\n\t\tthis.loaded = undefined;\r\n\t\tthis.ready = undefined;\r\n\r\n\t\tthis.isOpen = false;\r\n\t\tthis.isRendered = false;\r\n\r\n\t\tthis.spine && this.spine.destroy();\r\n\t\tthis.locations && this.locations.destroy();\r\n\t\tthis.pageList && this.pageList.destroy();\r\n\t\tthis.archive && this.archive.destroy();\r\n\t\tthis.resources && this.resources.destroy();\r\n\t\tthis.container && this.container.destroy();\r\n\t\tthis.packaging && this.packaging.destroy();\r\n\t\tthis.rendition && this.rendition.destroy();\r\n\t\tthis.displayOptions && this.displayOptions.destroy();\r\n\r\n\t\tthis.spine = undefined;\r\n\t\tthis.locations = undefined;\r\n\t\tthis.pageList = undefined;\r\n\t\tthis.archive = undefined;\r\n\t\tthis.resources = undefined;\r\n\t\tthis.container = undefined;\r\n\t\tthis.packaging = undefined;\r\n\t\tthis.rendition = undefined;\r\n\r\n\t\tthis.navigation = undefined;\r\n\t\tthis.url = undefined;\r\n\t\tthis.path = undefined;\r\n\t\tthis.archived = false;\r\n\t}\r\n\r\n}\r\n\r\n//-- Enable binding events to book\r\nEventEmitter(Book.prototype);\r\n\r\nexport default Book;\r\n","\"use strict\";\n\n// ES3 safe\nvar _undefined = void 0;\n\nmodule.exports = function (value) { return value !== _undefined && value !== null; };\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var debounce = require('./debounce'),\n    isObject = require('./isObject');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/**\n * Creates a throttled function that only invokes `func` at most once per\n * every `wait` milliseconds. The throttled function comes with a `cancel`\n * method to cancel delayed `func` invocations and a `flush` method to\n * immediately invoke them. Provide `options` to indicate whether `func`\n * should be invoked on the leading and/or trailing edge of the `wait`\n * timeout. The `func` is invoked with the last arguments provided to the\n * throttled function. Subsequent calls to the throttled function return the\n * result of the last `func` invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the throttled function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.throttle` and `_.debounce`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to throttle.\n * @param {number} [wait=0] The number of milliseconds to throttle invocations to.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=true]\n *  Specify invoking on the leading edge of the timeout.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new throttled function.\n * @example\n *\n * // Avoid excessively updating the position while scrolling.\n * jQuery(window).on('scroll', _.throttle(updatePosition, 100));\n *\n * // Invoke `renewToken` when the click event is fired, but not more than once every 5 minutes.\n * var throttled = _.throttle(renewToken, 300000, { 'trailing': false });\n * jQuery(element).on('click', throttled);\n *\n * // Cancel the trailing throttled invocation.\n * jQuery(window).on('popstate', throttled.cancel);\n */\nfunction throttle(func, wait, options) {\n  var leading = true,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  if (isObject(options)) {\n    leading = 'leading' in options ? !!options.leading : leading;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n  return debounce(func, wait, {\n    'leading': leading,\n    'maxWait': wait,\n    'trailing': trailing\n  });\n}\n\nmodule.exports = throttle;\n","module.exports = __WEBPACK_EXTERNAL_MODULE__28__;","import Book from \"./book\";\r\nimport Rendition from \"./rendition\";\r\nimport CFI from \"./epubcfi\";\r\nimport Contents from \"./contents\";\r\nimport * as utils from \"./utils/core\";\r\nimport { EPUBJS_VERSION } from \"./utils/constants\";\r\n\r\nimport IframeView from \"./managers/views/iframe\";\r\nimport DefaultViewManager from \"./managers/default\";\r\nimport ContinuousViewManager from \"./managers/continuous\";\r\n\r\n/**\r\n * Creates a new Book\r\n * @param {string|ArrayBuffer} url URL, Path or ArrayBuffer\r\n * @param {object} options to pass to the book\r\n * @returns {Book} a new Book object\r\n * @example ePub(\"/path/to/book.epub\", {})\r\n */\r\nfunction ePub(url, options) {\r\n\treturn new Book(url, options);\r\n}\r\n\r\nePub.VERSION = EPUBJS_VERSION;\r\n\r\nif (typeof(global) !== \"undefined\") {\r\n\tglobal.EPUBJS_VERSION = EPUBJS_VERSION;\r\n}\r\n\r\nePub.Book = Book;\r\nePub.Rendition = Rendition;\r\nePub.Contents = Contents;\r\nePub.CFI = CFI;\r\nePub.utils = utils;\r\n\r\nexport default ePub;\r\n","\"use strict\";\n\nvar isValue         = require(\"type/value/is\")\n  , isPlainFunction = require(\"type/plain-function/is\")\n  , assign          = require(\"es5-ext/object/assign\")\n  , normalizeOpts   = require(\"es5-ext/object/normalize-options\")\n  , contains        = require(\"es5-ext/string/#/contains\");\n\nvar d = (module.exports = function (dscr, value/*, options*/) {\n\tvar c, e, w, options, desc;\n\tif (arguments.length < 2 || typeof dscr !== \"string\") {\n\t\toptions = value;\n\t\tvalue = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[2];\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t\tw = contains.call(dscr, \"w\");\n\t} else {\n\t\tc = w = true;\n\t\te = false;\n\t}\n\n\tdesc = { value: value, configurable: c, enumerable: e, writable: w };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n});\n\nd.gs = function (dscr, get, set/*, options*/) {\n\tvar c, e, options, desc;\n\tif (typeof dscr !== \"string\") {\n\t\toptions = set;\n\t\tset = get;\n\t\tget = dscr;\n\t\tdscr = null;\n\t} else {\n\t\toptions = arguments[3];\n\t}\n\tif (!isValue(get)) {\n\t\tget = undefined;\n\t} else if (!isPlainFunction(get)) {\n\t\toptions = get;\n\t\tget = set = undefined;\n\t} else if (!isValue(set)) {\n\t\tset = undefined;\n\t} else if (!isPlainFunction(set)) {\n\t\toptions = set;\n\t\tset = undefined;\n\t}\n\tif (isValue(dscr)) {\n\t\tc = contains.call(dscr, \"c\");\n\t\te = contains.call(dscr, \"e\");\n\t} else {\n\t\tc = true;\n\t\te = false;\n\t}\n\n\tdesc = { get: get, set: set, configurable: c, enumerable: e };\n\treturn !options ? desc : assign(normalizeOpts(options), desc);\n};\n","\"use strict\";\n\nvar isFunction = require(\"../function/is\");\n\nvar classRe = /^\\s*class[\\s{/}]/, functionToString = Function.prototype.toString;\n\nmodule.exports = function (value) {\n\tif (!isFunction(value)) return false;\n\tif (classRe.test(functionToString.call(value))) return false;\n\treturn true;\n};\n","\"use strict\";\n\nvar isPrototype = require(\"../prototype/is\");\n\nmodule.exports = function (value) {\n\tif (typeof value !== \"function\") return false;\n\n\tif (!hasOwnProperty.call(value, \"length\")) return false;\n\n\ttry {\n\t\tif (typeof value.length !== \"number\") return false;\n\t\tif (typeof value.call !== \"function\") return false;\n\t\tif (typeof value.apply !== \"function\") return false;\n\t} catch (error) {\n\t\treturn false;\n\t}\n\n\treturn !isPrototype(value);\n};\n","\"use strict\";\n\nvar isObject = require(\"../object/is\");\n\nmodule.exports = function (value) {\n\tif (!isObject(value)) return false;\n\ttry {\n\t\tif (!value.constructor) return false;\n\t\treturn value.constructor.prototype === value;\n\t} catch (error) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../value/is\");\n\n// prettier-ignore\nvar possibleTypes = { \"object\": true, \"function\": true, \"undefined\": true /* document.all */ };\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) return false;\n\treturn hasOwnProperty.call(possibleTypes, typeof value);\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.assign : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\tvar assign = Object.assign, obj;\n\tif (typeof assign !== \"function\") return false;\n\tobj = { foo: \"raz\" };\n\tassign(obj, { bar: \"dwa\" }, { trzy: \"trzy\" });\n\treturn obj.foo + obj.bar + obj.trzy === \"razdwatrzy\";\n};\n","\"use strict\";\n\nvar keys  = require(\"../keys\")\n  , value = require(\"../valid-value\")\n  , max   = Math.max;\n\nmodule.exports = function (dest, src /*, …srcn*/) {\n\tvar error, i, length = max(arguments.length, 2), assign;\n\tdest = Object(value(dest));\n\tassign = function (key) {\n\t\ttry {\n\t\t\tdest[key] = src[key];\n\t\t} catch (e) {\n\t\t\tif (!error) error = e;\n\t\t}\n\t};\n\tfor (i = 1; i < length; ++i) {\n\t\tsrc = arguments[i];\n\t\tkeys(src).forEach(assign);\n\t}\n\tif (error !== undefined) throw error;\n\treturn dest;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? Object.keys : require(\"./shim\");\n","\"use strict\";\n\nmodule.exports = function () {\n\ttry {\n\t\tObject.keys(\"primitive\");\n\t\treturn true;\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n","\"use strict\";\n\nvar isValue = require(\"../is-value\");\n\nvar keys = Object.keys;\n\nmodule.exports = function (object) { return keys(isValue(object) ? Object(object) : object); };\n","\"use strict\";\n\n// eslint-disable-next-line no-empty-function\nmodule.exports = function () {};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nmodule.exports = function (value) {\n\tif (!isValue(value)) throw new TypeError(\"Cannot use null or undefined\");\n\treturn value;\n};\n","\"use strict\";\n\nvar isValue = require(\"./is-value\");\n\nvar forEach = Array.prototype.forEach, create = Object.create;\n\nvar process = function (src, obj) {\n\tvar key;\n\tfor (key in src) obj[key] = src[key];\n};\n\n// eslint-disable-next-line no-unused-vars\nmodule.exports = function (opts1 /*, …options*/) {\n\tvar result = create(null);\n\tforEach.call(arguments, function (options) {\n\t\tif (!isValue(options)) return;\n\t\tprocess(Object(options), result);\n\t});\n\treturn result;\n};\n","\"use strict\";\n\nmodule.exports = require(\"./is-implemented\")() ? String.prototype.contains : require(\"./shim\");\n","\"use strict\";\n\nvar str = \"razdwatrzy\";\n\nmodule.exports = function () {\n\tif (typeof str.contains !== \"function\") return false;\n\treturn str.contains(\"dwa\") === true && str.contains(\"foo\") === false;\n};\n","\"use strict\";\n\nvar indexOf = String.prototype.indexOf;\n\nmodule.exports = function (searchString /*, position*/) {\n\treturn indexOf.call(this, searchString, arguments[1]) > -1;\n};\n","\"use strict\";\n\nmodule.exports = function (fn) {\n\tif (typeof fn !== \"function\") throw new TypeError(fn + \" is not a function\");\n\treturn fn;\n};\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.createElement = createElement;\nfunction createElement(name) {\n    return document.createElementNS('http://www.w3.org/2000/svg', name);\n}\n\nexports.default = {\n    createElement: createElement\n};\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.proxyMouse = proxyMouse;\nexports.clone = clone;\n// import 'babelify/polyfill'; // needed for Object.assign\n\nexports.default = {\n    proxyMouse: proxyMouse\n};\n\n/**\n * Start proxying all mouse events that occur on the target node to each node in\n * a set of tracked nodes.\n *\n * The items in tracked do not strictly have to be DOM Nodes, but they do have\n * to have dispatchEvent, getBoundingClientRect, and getClientRects methods.\n *\n * @param target {Node} The node on which to listen for mouse events.\n * @param tracked {Node[]} A (possibly mutable) array of nodes to which to proxy\n *                         events.\n */\n\nfunction proxyMouse(target, tracked) {\n    function dispatch(e) {\n        // We walk through the set of tracked elements in reverse order so that\n        // events are sent to those most recently added first.\n        //\n        // This is the least surprising behaviour as it simulates the way the\n        // browser would work if items added later were drawn \"on top of\"\n        // earlier ones.\n        for (var i = tracked.length - 1; i >= 0; i--) {\n            var t = tracked[i];\n            var x = e.clientX;\n            var y = e.clientY;\n\n            if (e.touches && e.touches.length) {\n                x = e.touches[0].clientX;\n                y = e.touches[0].clientY;\n            }\n\n            if (!contains(t, target, x, y)) {\n                continue;\n            }\n\n            // The event targets this mark, so dispatch a cloned event:\n            t.dispatchEvent(clone(e));\n            // We only dispatch the cloned event to the first matching mark.\n            break;\n        }\n    }\n\n    if (target.nodeName === \"iframe\" || target.nodeName === \"IFRAME\") {\n\n        try {\n            // Try to get the contents if same domain\n            this.target = target.contentDocument;\n        } catch (err) {\n            this.target = target;\n        }\n    } else {\n        this.target = target;\n    }\n\n    var _arr = ['mouseup', 'mousedown', 'click', 'touchstart'];\n    for (var _i = 0; _i < _arr.length; _i++) {\n        var ev = _arr[_i];\n        this.target.addEventListener(ev, function (e) {\n            return dispatch(e);\n        }, false);\n    }\n}\n\n/**\n * Clone a mouse event object.\n *\n * @param e {MouseEvent} A mouse event object to clone.\n * @returns {MouseEvent}\n */\nfunction clone(e) {\n    var opts = Object.assign({}, e, { bubbles: false });\n    try {\n        return new MouseEvent(e.type, opts);\n    } catch (err) {\n        // compat: webkit\n        var copy = document.createEvent('MouseEvents');\n        copy.initMouseEvent(e.type, false, opts.cancelable, opts.view, opts.detail, opts.screenX, opts.screenY, opts.clientX, opts.clientY, opts.ctrlKey, opts.altKey, opts.shiftKey, opts.metaKey, opts.button, opts.relatedTarget);\n        return copy;\n    }\n}\n\n/**\n * Check if the item contains the point denoted by the passed coordinates\n * @param item {Object} An object with getBoundingClientRect and getClientRects\n *                      methods.\n * @param x {Number}\n * @param y {Number}\n * @returns {Boolean}\n */\nfunction contains(item, target, x, y) {\n    // offset\n    var offset = target.getBoundingClientRect();\n\n    function rectContains(r, x, y) {\n        var top = r.top - offset.top;\n        var left = r.left - offset.left;\n        var bottom = top + r.height;\n        var right = left + r.width;\n        return top <= y && left <= x && bottom > y && right > x;\n    }\n\n    // Check overall bounding box first\n    var rect = item.getBoundingClientRect();\n    if (!rectContains(rect, x, y)) {\n        return false;\n    }\n\n    // Then continue to check each child rect\n    var rects = item.getClientRects();\n    for (var i = 0, len = rects.length; i < len; i++) {\n        if (rectContains(rects[i], x, y)) {\n            return true;\n        }\n    }\n    return false;\n}\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var baseTrim = require('./_baseTrim'),\n    isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = baseTrim(value);\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var trimmedEndIndex = require('./_trimmedEndIndex');\n\n/** Used to match leading whitespace. */\nvar reTrimStart = /^\\s+/;\n\n/**\n * The base implementation of `_.trim`.\n *\n * @private\n * @param {string} string The string to trim.\n * @returns {string} Returns the trimmed string.\n */\nfunction baseTrim(string) {\n  return string\n    ? string.slice(0, trimmedEndIndex(string) + 1).replace(reTrimStart, '')\n    : string;\n}\n\nmodule.exports = baseTrim;\n","/** Used to match a single whitespace character. */\nvar reWhitespace = /\\s/;\n\n/**\n * Used by `_.trim` and `_.trimEnd` to get the index of the last non-whitespace\n * character of `string`.\n *\n * @private\n * @param {string} string The string to inspect.\n * @returns {number} Returns the index of the last non-whitespace character.\n */\nfunction trimmedEndIndex(string) {\n  var index = string.length;\n\n  while (index-- && reWhitespace.test(string.charAt(index))) {}\n  return index;\n}\n\nmodule.exports = trimmedEndIndex;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n"],"sourceRoot":""}